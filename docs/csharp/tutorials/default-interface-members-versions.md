---
title: Aggiornare le interfacce in modo sicuro con i membri dell'interfaccia predefiniti in C#
description: Questa esercitazione avanzata esplora come sia possibile aggiungere in modo sicuro nuove funzionalità alle definizioni di interfaccia esistenti senza interrompere tutte le classi e gli struct che implementano tale interfaccia.
ms.date: 05/06/2019
ms.custom: mvc
ms.openlocfilehash: 2d7265b7705fc931d356a3b7fe3504ab7f21c0b3
ms.sourcegitcommit: a97ecb94437362b21fffc5eb3c38b6c0b4368999
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 08/13/2019
ms.locfileid: "68971429"
---
# <a name="tutorial-update-interfaces-with-default-interface-members-in-c-80"></a><span data-ttu-id="f7158-103">Esercitazione: Aggiornare le interfacce con i membri di interfaccia predefiniti in C# 8.0</span><span class="sxs-lookup"><span data-stu-id="f7158-103">Tutorial: Update interfaces with default interface members in C# 8.0</span></span>

<span data-ttu-id="f7158-104">A partire da C# 8.0 su .NET Core 3.0 è possibile definire un'implementazione quando si dichiara un membro di un'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="f7158-104">Beginning with C# 8.0 on .NET Core 3.0, you can define an implementation when you declare a member of an interface.</span></span> <span data-ttu-id="f7158-105">Lo scenario più comune consiste nell'aggiunta sicura di membri a un'interfaccia già rilasciata e usata da innumerevoli client.</span><span class="sxs-lookup"><span data-stu-id="f7158-105">The most common scenario is to safely add members to an interface already released and used by innumerable clients.</span></span>

<span data-ttu-id="f7158-106">In questa esercitazione si imparerà a:</span><span class="sxs-lookup"><span data-stu-id="f7158-106">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="f7158-107">Estendere le interfacce in modo sicuro aggiungendo metodi con implementazioni.</span><span class="sxs-lookup"><span data-stu-id="f7158-107">Extend interfaces safely by adding methods with implementations.</span></span>
> * <span data-ttu-id="f7158-108">Creare implementazioni con parametri per una maggiore flessibilità.</span><span class="sxs-lookup"><span data-stu-id="f7158-108">Create parameterized implementations to provide greater flexibility.</span></span>
> * <span data-ttu-id="f7158-109">Abilitare gli implementatori per fornire un'implementazione più specifica sotto forma di override.</span><span class="sxs-lookup"><span data-stu-id="f7158-109">Enable implementers to provide a more specific implementation in the form of an override.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="f7158-110">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="f7158-110">Prerequisites</span></span>

<span data-ttu-id="f7158-111">Sarà necessario configurare il computer per l'esecuzione di .NET Core, incluso il compilatore di anteprima di C# 8.0.</span><span class="sxs-lookup"><span data-stu-id="f7158-111">You’ll need to set up your machine to run .NET Core, including the C# 8.0 preview compiler.</span></span> <span data-ttu-id="f7158-112">Il compilatore di anteprima di C# 8.0 è disponibile a partire [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) o dalla versione più recente del [SDK dell'anteprima di .NET Core 3.0](https://dotnet.microsoft.com/download/dotnet-core/3.0).</span><span class="sxs-lookup"><span data-stu-id="f7158-112">The C# 8.0 preview compiler is available starting with [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019), or the latest [.NET Core 3.0 preview SDK](https://dotnet.microsoft.com/download/dotnet-core/3.0).</span></span> <span data-ttu-id="f7158-113">I membri di interfaccia predefiniti sono disponibili a partire dall'anteprima 4 di .NET Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="f7158-113">Default interface members are available beginning with .NET Core 3.0 preview 4.</span></span>

## <a name="scenario-overview"></a><span data-ttu-id="f7158-114">Panoramica dello scenario</span><span class="sxs-lookup"><span data-stu-id="f7158-114">Scenario overview</span></span>

<span data-ttu-id="f7158-115">Questa esercitazione inizia con la versione 1 di una raccolta di relazioni con i clienti.</span><span class="sxs-lookup"><span data-stu-id="f7158-115">This tutorial starts with version 1 of a customer relationship library.</span></span> <span data-ttu-id="f7158-116">L'applicazione di base è disponibile nel [repository di esempi in GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="f7158-116">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span> <span data-ttu-id="f7158-117">L'azienda che ha realizzato questa raccolta intende farla adottare dai clienti con le applicazioni esistenti.</span><span class="sxs-lookup"><span data-stu-id="f7158-117">The company that built this library intended customers with existing applications to adopt their library.</span></span> <span data-ttu-id="f7158-118">Agli utenti della raccolta vengono fornite definizioni di interfaccia minime da implementare.</span><span class="sxs-lookup"><span data-stu-id="f7158-118">They provided minimal interface definitions for users of their library to implement.</span></span> <span data-ttu-id="f7158-119">Ecco la definizione di interfaccia per un cliente:</span><span class="sxs-lookup"><span data-stu-id="f7158-119">Here's the interface definition for a customer:</span></span>

[!code-csharp[InitialCustomerInterface](~/samples/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/ICustomer.cs?name=SnippetICustomerVersion1)]

<span data-ttu-id="f7158-120">Viene definita una seconda interfaccia che rappresenta un ordine:</span><span class="sxs-lookup"><span data-stu-id="f7158-120">They defined a second interface that represents an order:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/IOrder.cs?name=SnippetIorderVersion1)]

<span data-ttu-id="f7158-121">Da queste interfacce il team potrebbe realizzare una raccolta per consentire agli utenti di creare un'esperienza migliore per i clienti.</span><span class="sxs-lookup"><span data-stu-id="f7158-121">From those interfaces, the team could build a library for their users to create a better experience for their customers.</span></span> <span data-ttu-id="f7158-122">L'obiettivo è consolidare le relazioni con i clienti esistenti e migliorare quelle con i nuovi clienti.</span><span class="sxs-lookup"><span data-stu-id="f7158-122">Their goal was to create a deeper relationship with existing customers and improve their relationships with new customers.</span></span>

<span data-ttu-id="f7158-123">Ora è il momento di aggiornare la raccolta per la versione successiva.</span><span class="sxs-lookup"><span data-stu-id="f7158-123">Now, it's time to upgrade the library for the next release.</span></span> <span data-ttu-id="f7158-124">Una delle funzionalità richieste è la definizione di uno sconto fedeltà per i clienti con molti ordini.</span><span class="sxs-lookup"><span data-stu-id="f7158-124">One of the requested features enables a loyalty discount for customers that have lots of orders.</span></span> <span data-ttu-id="f7158-125">Questo nuovo sconto fedeltà viene applicato ogni volta che un cliente effettua un ordine.</span><span class="sxs-lookup"><span data-stu-id="f7158-125">This new loyalty discount gets applied whenever a customer makes an order.</span></span> <span data-ttu-id="f7158-126">Lo sconto specifico è una proprietà di ogni singolo cliente.</span><span class="sxs-lookup"><span data-stu-id="f7158-126">The specific discount is a property of each individual customer.</span></span> <span data-ttu-id="f7158-127">Ogni implementazione di ICustomer può impostare ruoli diversi per lo sconto fedeltà.</span><span class="sxs-lookup"><span data-stu-id="f7158-127">Each implementation of ICustomer can set different rules for the loyalty discount.</span></span> 

<span data-ttu-id="f7158-128">Il modo più naturale per aggiungere questa funzionalità consiste nell'ottimizzare l'interfaccia `ICustomer` con un metodo per applicare qualsiasi sconto fedeltà.</span><span class="sxs-lookup"><span data-stu-id="f7158-128">The most natural way to add this functionality is to enhance the `ICustomer` interface with a method to apply any loyalty discount.</span></span> <span data-ttu-id="f7158-129">Questo suggerimento di progettazione genera preoccupazione tra gli sviluppatori esperti perché si ritiene che, una volta rilasciate, le interfacce non siano più modificabili</span><span class="sxs-lookup"><span data-stu-id="f7158-129">This design suggestion caused concern among experienced developers: "Interfaces are immutable once they've been released!</span></span> <span data-ttu-id="f7158-130">a meno di generare errori.</span><span class="sxs-lookup"><span data-stu-id="f7158-130">This is a breaking change!"</span></span> <span data-ttu-id="f7158-131">In C# 8.0 sono state aggiunte *implementazioni di interfaccia predefinite* per l'aggiornamento delle interfacce.</span><span class="sxs-lookup"><span data-stu-id="f7158-131">C# 8.0 adds *default interface implementations* for upgrading interfaces.</span></span> <span data-ttu-id="f7158-132">Gli autori della raccolta possono aggiungere nuovi membri all'interfaccia a cui applicare un'implementazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="f7158-132">The library authors can add new members to the interface and provide a default implementation for those members.</span></span>

<span data-ttu-id="f7158-133">Le implementazioni di interfaccia predefinite consentono agli sviluppatori di aggiornare un'interfaccia, ma possono comunque essere sottoposte a override da qualsiasi implementatore.</span><span class="sxs-lookup"><span data-stu-id="f7158-133">Default interface implementations enable developers to upgrade an interface while still enabling any implementors to override that implementation.</span></span> <span data-ttu-id="f7158-134">Gli utenti della raccolta possono accettare l'implementazione predefinita come modifica che non causa interruzioni.</span><span class="sxs-lookup"><span data-stu-id="f7158-134">Users of the library can accept the default implementation as a non-breaking change.</span></span> <span data-ttu-id="f7158-135">Se le regole business sono diverse, possono eseguire l'override.</span><span class="sxs-lookup"><span data-stu-id="f7158-135">If their business rules are different, they can override.</span></span>

## <a name="upgrade-with-default-interface-members"></a><span data-ttu-id="f7158-136">Aggiornare con membri di interfaccia predefiniti</span><span class="sxs-lookup"><span data-stu-id="f7158-136">Upgrade with default interface members</span></span>

<span data-ttu-id="f7158-137">Il team concorda sull'implementazione predefinita più probabile: uno sconto fedeltà per i clienti.</span><span class="sxs-lookup"><span data-stu-id="f7158-137">The team agreed on the most likely default implementation: a loyalty discount for customers.</span></span>

<span data-ttu-id="f7158-138">L'aggiornamento dovrà fornire la funzionalità per impostare due proprietà: il numero di ordini necessario per avere diritto allo sconto e la percentuale dello sconto.</span><span class="sxs-lookup"><span data-stu-id="f7158-138">The upgrade should provide the functionality to set two properties: the number of orders needed to be eligible for the discount, and the percentage of the discount.</span></span> <span data-ttu-id="f7158-139">Questo scenario è perfetto per i membri di interfaccia predefiniti.</span><span class="sxs-lookup"><span data-stu-id="f7158-139">This makes it a perfect scenario for default interface members.</span></span> <span data-ttu-id="f7158-140">È possibile aggiungere un metodo all'interfaccia ICustomer e fornire l'implementazione più probabile.</span><span class="sxs-lookup"><span data-stu-id="f7158-140">You can add a method to the ICustomer interface, and provide the most likely implementation.</span></span> <span data-ttu-id="f7158-141">Tutte le implementazioni esistenti e quelle nuove possono usare l'implementazione predefinita o una personalizzata.</span><span class="sxs-lookup"><span data-stu-id="f7158-141">All existing, and any new implementations can use the default implementation, or provide their own.</span></span>

<span data-ttu-id="f7158-142">Prima di tutto aggiungere il nuovo metodo all'implementazione:</span><span class="sxs-lookup"><span data-stu-id="f7158-142">First, add the new method to the implementation:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionOne)]

<span data-ttu-id="f7158-143">L'autore della raccolta scrive un primo test per verificare l'implementazione:</span><span class="sxs-lookup"><span data-stu-id="f7158-143">The library author wrote a first test to check the implementation:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetTestDefaultImplementation)]

<span data-ttu-id="f7158-144">Si noti la parte seguente del test:</span><span class="sxs-lookup"><span data-stu-id="f7158-144">Notice the following portion of the test:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetHighlightCast)]

<span data-ttu-id="f7158-145">Il cast da `SampleCustomer` a `ICustomer` è necessario.</span><span class="sxs-lookup"><span data-stu-id="f7158-145">That cast from `SampleCustomer` to `ICustomer` is necessary.</span></span> <span data-ttu-id="f7158-146">La classe `SampleCustomer` non deve necessariamente fornire un'implementazione per `ComputeLoyaltyDiscount`, perché viene fornita dall'interfaccia `ICustomer`.</span><span class="sxs-lookup"><span data-stu-id="f7158-146">The `SampleCustomer` class doesn't need to provide an implementation for `ComputeLoyaltyDiscount`; that's provided by the `ICustomer` interface.</span></span> <span data-ttu-id="f7158-147">Tuttavia, la classe `SampleCustomer` non eredita i membri dalle relative interfacce.</span><span class="sxs-lookup"><span data-stu-id="f7158-147">However, the `SampleCustomer` class doesn't inherit members from its interfaces.</span></span> <span data-ttu-id="f7158-148">Questa regola non è cambiata.</span><span class="sxs-lookup"><span data-stu-id="f7158-148">That rule hasn't changed.</span></span> <span data-ttu-id="f7158-149">Per chiamare qualsiasi metodo dichiarato e implementato nell'interfaccia, la variabile deve essere il tipo dell'interfaccia, in questo esempio `ICustomer`.</span><span class="sxs-lookup"><span data-stu-id="f7158-149">In order to call any method declared and implemented in the interface, the variable must be the type of the interface, `ICustomer` in this example.</span></span>

## <a name="provide-parameterization"></a><span data-ttu-id="f7158-150">Fornire la parametrizzazione</span><span class="sxs-lookup"><span data-stu-id="f7158-150">Provide parameterization</span></span>

<span data-ttu-id="f7158-151">Anche se si tratta di un buon inizio,</span><span class="sxs-lookup"><span data-stu-id="f7158-151">That's a good start.</span></span> <span data-ttu-id="f7158-152">l'implementazione predefinita è troppo restrittiva.</span><span class="sxs-lookup"><span data-stu-id="f7158-152">But, the default implementation is too restrictive.</span></span> <span data-ttu-id="f7158-153">Molti utenti di questo sistema potrebbero scegliere soglie diverse per il numero di acquisti, una durata diversa dell'iscrizione o una percentuale di sconto diversa.</span><span class="sxs-lookup"><span data-stu-id="f7158-153">Many consumers of this system may choose different thresholds for number of purchases, a different length of membership, or a different percentage discount.</span></span> <span data-ttu-id="f7158-154">È possibile fornire un'esperienza di aggiornamento migliore per più clienti offrendo la possibilità di impostare questi parametri.</span><span class="sxs-lookup"><span data-stu-id="f7158-154">You can provide a better upgrade experience for more customers by providing a way to set those parameters.</span></span> <span data-ttu-id="f7158-155">A questo scopo, aggiungere un metodo statico che imposta questi tre parametri che controllano l'implementazione predefinita:</span><span class="sxs-lookup"><span data-stu-id="f7158-155">Let's add a static method that sets those three parameters controlling the default implementation:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionTwo)]

<span data-ttu-id="f7158-156">In questo piccolo frammento di codice sono visibili molte nuove funzionalità del linguaggio.</span><span class="sxs-lookup"><span data-stu-id="f7158-156">There's many new language capabilities shown in that small code fragment.</span></span> <span data-ttu-id="f7158-157">Le interfacce possono ora includere membri statici, tra cui campi e metodi.</span><span class="sxs-lookup"><span data-stu-id="f7158-157">Interfaces can now include static members, including fields and methods.</span></span> <span data-ttu-id="f7158-158">Sono inoltre abilitati diversi modificatori di accesso.</span><span class="sxs-lookup"><span data-stu-id="f7158-158">Different access modifiers are also enabled.</span></span> <span data-ttu-id="f7158-159">I campi aggiuntivi sono privati, mentre il nuovo metodo è pubblico.</span><span class="sxs-lookup"><span data-stu-id="f7158-159">The additional fields are private, the new method is public.</span></span> <span data-ttu-id="f7158-160">Per i membri dell'interfaccia è consentito qualsiasi modificatore.</span><span class="sxs-lookup"><span data-stu-id="f7158-160">Any of the modifiers are allowed on interface members.</span></span>

<span data-ttu-id="f7158-161">Per le applicazioni in cui si usa la formula generale per calcolare lo sconto fedeltà, ma con parametri diversi, non è necessario fornire un'implementazione personalizzata perché è possibile impostare gli argomenti tramite un metodo statico.</span><span class="sxs-lookup"><span data-stu-id="f7158-161">Applications that use the general formula for computing the loyalty discount, but different parameters, don't need to provide a custom implementation; they can set the arguments through a static method.</span></span> <span data-ttu-id="f7158-162">Il codice seguente imposta ad esempio un "apprezzamento del cliente" che premia qualsiasi cliente che si sia iscritto da più di un mese:</span><span class="sxs-lookup"><span data-stu-id="f7158-162">For example, the following code sets a "customer appreciation" that rewards any customer with more than one month's membership:</span></span>

[!code-csharp[SetLoyaltyThresholds](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetSetLoyaltyThresholds)]

## <a name="extend-the-default-implementation"></a><span data-ttu-id="f7158-163">Estendere l'implementazione predefinita</span><span class="sxs-lookup"><span data-stu-id="f7158-163">Extend the default implementation</span></span>

<span data-ttu-id="f7158-164">Il codice aggiunto finora offre un'implementazione utile per gli scenari in cui gli utenti vogliono qualcosa di simile all'implementazione predefinita o per fornire un set non correlato di regole.</span><span class="sxs-lookup"><span data-stu-id="f7158-164">The code you've added so far has provided a convenient implementation for those scenarios where users want something like the default implementation, or to provide an unrelated set of rules.</span></span> <span data-ttu-id="f7158-165">Per una funzionalità finale, verrà eseguito il refactoring del codice per abilitare scenari in cui gli utenti potrebbero scegliere di sviluppare ulteriormente l'implementazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="f7158-165">For a final feature, let's refactor the code a bit to enable scenarios where users may want to build on the default implementation.</span></span> 

<span data-ttu-id="f7158-166">Si supponga ad esempio che una startup voglia attirare nuovi clienti.</span><span class="sxs-lookup"><span data-stu-id="f7158-166">Consider a startup that wants to attract new customers.</span></span> <span data-ttu-id="f7158-167">Offre uno sconto del 50% sul primo ordine di un nuovo cliente.</span><span class="sxs-lookup"><span data-stu-id="f7158-167">They offer a 50% discount off a new customer's first order.</span></span> <span data-ttu-id="f7158-168">Altrimenti, i clienti esistenti ottengono lo sconto standard.</span><span class="sxs-lookup"><span data-stu-id="f7158-168">Otherwise, existing customers get the standard discount.</span></span> <span data-ttu-id="f7158-169">L'autore della raccolta deve trasferire l'implementazione predefinita in un metodo `protected static` in modo che qualsiasi classe che implementi questa interfaccia possa riutilizzare il codice nella propria implementazione.</span><span class="sxs-lookup"><span data-stu-id="f7158-169">The library author needs to move the default implementation into a `protected static` method so that any class implementing this interface can reuse the code in their implementation.</span></span> <span data-ttu-id="f7158-170">L'implementazione predefinita del membro di interfaccia chiama anche questo metodo predefinito:</span><span class="sxs-lookup"><span data-stu-id="f7158-170">The default implementation of the interface member calls this shared method as well:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetFinalVersion)]

<span data-ttu-id="f7158-171">In un'implementazione di una classe che implementa questa interfaccia, l'override può chiamare il metodo helper statico ed estendere questa logica per fornire lo sconto "nuovo cliente":</span><span class="sxs-lookup"><span data-stu-id="f7158-171">In an implementation of a class that implements this interface, the override can call the static helper method, and extend that logic to provide the "new customer" discount:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/SampleCustomer.cs?name=SnippetOverrideAndExtend)]

<span data-ttu-id="f7158-172">È possibile visualizzare il codice completo nel [repository degli esempi su GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="f7158-172">You can see the entire finished code in our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span></span> <span data-ttu-id="f7158-173">L'applicazione di base è disponibile nel [repository di esempi in GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="f7158-173">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span>

<span data-ttu-id="f7158-174">Queste nuove funzionalità implicano che le interfacce possono essere aggiornate in modo sicuro quando è disponibile un'implementazione predefinita ragionevole per questi nuovi membri.</span><span class="sxs-lookup"><span data-stu-id="f7158-174">These new features mean that interfaces can be updated safely when there's a reasonable default implementation for those new members.</span></span> <span data-ttu-id="f7158-175">Progettare con attenzione le interfacce per esprimere singole idee funzionali che possono essere implementate da più classi.</span><span class="sxs-lookup"><span data-stu-id="f7158-175">Carefully design interfaces to express single functional ideas that can be implemented by multiple classes.</span></span> <span data-ttu-id="f7158-176">In questo modo è più facile aggiornare le definizioni di queste interfacce quando vengono individuati nuovi requisiti per la stessa idea funzionale.</span><span class="sxs-lookup"><span data-stu-id="f7158-176">That makes it easier to upgrade those interface definitions when new requirements are discovered for that same functional idea.</span></span>
