---
title: Aggiornare le API con attributi per definire le aspettative null
description: Questo articolo illustra le motivazioni e le tecniche per l'aggiunta di attributi descrittivi per descrivere lo stato null degli argomenti e i valori restituiti dalle API
ms.date: 07/31/2019
ms.openlocfilehash: eebd3d190b8c93833de6e1c1f1594c1c1f56e14e
ms.sourcegitcommit: 9ee6cd851b6e176a5811ea28ed0d5935c71950f9
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/09/2019
ms.locfileid: "70234669"
---
# <a name="update-libraries-to-use-nullable-reference-types-and-communicate-nullable-rules-to-callers"></a><span data-ttu-id="46129-103">Aggiornare le librerie per usare i tipi di riferimento nullable e comunicare le regole Nullable ai chiamanti.</span><span class="sxs-lookup"><span data-stu-id="46129-103">Update libraries to use nullable reference types and communicate nullable rules to callers.</span></span>

<span data-ttu-id="46129-104">L'aggiunta di [tipi di riferimento Nullable](nullable-references.md) significa che è possibile dichiarare se è `null` consentito o meno un valore per ogni variabile.</span><span class="sxs-lookup"><span data-stu-id="46129-104">The addition of [nullable reference types](nullable-references.md) means you can declare whether or not a `null` value is allowed or expected for every variable.</span></span> <span data-ttu-id="46129-105">Che offre un'esperienza ottimale durante la scrittura del codice.</span><span class="sxs-lookup"><span data-stu-id="46129-105">That provides a great experience as you write code.</span></span> <span data-ttu-id="46129-106">Si ottengono avvisi se una variabile che non ammette i valori null può `null`essere impostata su.</span><span class="sxs-lookup"><span data-stu-id="46129-106">You get warnings if a non-nullable variable might be set to `null`.</span></span> <span data-ttu-id="46129-107">Si ottengono avvisi se una variabile nullable non è controllata da null prima di dereferenziarla.</span><span class="sxs-lookup"><span data-stu-id="46129-107">You get warnings if a nullable variable isn't null-checked before you dereference it.</span></span> <span data-ttu-id="46129-108">L'aggiornamento delle librerie può richiedere tempo, ma i profitti valgono.</span><span class="sxs-lookup"><span data-stu-id="46129-108">Updating your libraries can take time, but the payoffs are worth it.</span></span> <span data-ttu-id="46129-109">Maggiori sono le informazioni fornite al compilatore *quando* un `null` valore è consentito o proibito, gli avvisi migliori che gli utenti dell'API otterranno.</span><span class="sxs-lookup"><span data-stu-id="46129-109">The more information you provide to the compiler about *when* a `null` value is allowed or prohibited, the better warnings users of your API will get.</span></span> <span data-ttu-id="46129-110">Iniziamo con un esempio familiare.</span><span class="sxs-lookup"><span data-stu-id="46129-110">Let's start with a familiar example.</span></span> <span data-ttu-id="46129-111">Si supponga che la libreria disponga dell'API seguente per recuperare una stringa di risorsa:</span><span class="sxs-lookup"><span data-stu-id="46129-111">Imagine your library has the following API to retrieve a resource string:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="46129-112">L'esempio precedente segue il modello `Try*` familiare in .NET.</span><span class="sxs-lookup"><span data-stu-id="46129-112">The preceding example follows the familiar `Try*` pattern in .NET.</span></span> <span data-ttu-id="46129-113">Per questa API sono disponibili due argomenti di riferimento: `key` `message` e.</span><span class="sxs-lookup"><span data-stu-id="46129-113">There are two reference arguments for this API: the `key` and the `message` parameter.</span></span> <span data-ttu-id="46129-114">Questa API presenta le regole seguenti relative al valore null di questi argomenti:</span><span class="sxs-lookup"><span data-stu-id="46129-114">This API has the following rules relating to the nullness of these arguments:</span></span>

- <span data-ttu-id="46129-115">I chiamanti non `null` devono passare come argomento `key`per.</span><span class="sxs-lookup"><span data-stu-id="46129-115">Callers shouldn't pass `null` as the argument for `key`.</span></span>
- <span data-ttu-id="46129-116">I chiamanti possono passare una variabile il cui `null` valore è come argomento `message`per.</span><span class="sxs-lookup"><span data-stu-id="46129-116">Callers can pass a variable whose value is `null` as the argument for `message`.</span></span>
- <span data-ttu-id="46129-117">Se il `TryGetMessage` metodo restituisce `true`, il valore di `message` non è null.</span><span class="sxs-lookup"><span data-stu-id="46129-117">If the `TryGetMessage` method returns `true`, the value of `message` isn't null.</span></span> <span data-ttu-id="46129-118">Se il valore restituito è `false,` il valore di `message` (e il relativo stato null) è null.</span><span class="sxs-lookup"><span data-stu-id="46129-118">If the return value is `false,` the value of `message` (and its null state) is null.</span></span>

<span data-ttu-id="46129-119">La regola per `key` può essere interamente espressa dal tipo di variabile: `key` deve essere un tipo di riferimento non nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-119">The rule for `key` can be completely expressed by the variable type: `key` should be a non-nullable reference type.</span></span> <span data-ttu-id="46129-120">Il `message` parametro è più complesso.</span><span class="sxs-lookup"><span data-stu-id="46129-120">The `message` parameter is more complex.</span></span> <span data-ttu-id="46129-121">Consente `null` come argomento, ma garantisce che, in seguito all'esito positivo `out` , l'argomento non sia null.</span><span class="sxs-lookup"><span data-stu-id="46129-121">It allows `null` as the argument, but guarantees that, on success, that `out` argument isn't null.</span></span> <span data-ttu-id="46129-122">Per questi scenari, è necessario un vocabolario più completo per descrivere le aspettative.</span><span class="sxs-lookup"><span data-stu-id="46129-122">For these scenarios, you need a richer vocabulary to describe the expectations.</span></span>

<span data-ttu-id="46129-123">Per l'aggiornamento della libreria per i riferimenti Nullable è necessario `?` più di un'irrigazione su alcune variabili e nomi di tipo.</span><span class="sxs-lookup"><span data-stu-id="46129-123">Updating your library for nullable references requires more than sprinkling `?` on some of the variables and type names.</span></span> <span data-ttu-id="46129-124">L'esempio precedente mostra che è necessario esaminare le API e prendere in considerazione le aspettative per ogni argomento di input.</span><span class="sxs-lookup"><span data-stu-id="46129-124">The preceding example shows that you need to examine your APIs and consider your expectations for each input argument.</span></span> <span data-ttu-id="46129-125">Prendere in considerazione le garanzie per il valore restituito e `out` gli `ref` eventuali argomenti o sul valore restituito dal metodo.</span><span class="sxs-lookup"><span data-stu-id="46129-125">Consider the guarantees for the return value, and any `out` or `ref` arguments upon the method's return.</span></span> <span data-ttu-id="46129-126">Comunicare quindi tali regole al compilatore e il compilatore fornirà avvisi quando i chiamanti non rispettano tali regole.</span><span class="sxs-lookup"><span data-stu-id="46129-126">Then communicate those rules to the compiler, and the compiler will provide warnings when callers don't abide by those rules.</span></span>

<span data-ttu-id="46129-127">Questo lavoro richiede tempo.</span><span class="sxs-lookup"><span data-stu-id="46129-127">This work takes time.</span></span> <span data-ttu-id="46129-128">Iniziamo con le strategie per rendere la libreria o l'applicazione compatibile con i valori null, con il bilanciamento di altri requisiti e risultati finali.</span><span class="sxs-lookup"><span data-stu-id="46129-128">Let's start with strategies to make your library or application nullable-aware, while balancing other requirements and deliverables.</span></span> <span data-ttu-id="46129-129">Si vedrà come bilanciare lo sviluppo in corso abilitando i tipi di riferimento Nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-129">You'll see how to balance ongoing development enabling nullable reference types.</span></span> <span data-ttu-id="46129-130">Verranno illustrate le esigenze per le definizioni di tipo generico.</span><span class="sxs-lookup"><span data-stu-id="46129-130">You'll learn challenges for generic type definitions.</span></span> <span data-ttu-id="46129-131">Si apprenderà come applicare gli attributi per descrivere le condizioni preliminari e successive sulle singole API.</span><span class="sxs-lookup"><span data-stu-id="46129-131">You'll learn to apply attributes to describe pre- and post-conditions on individual APIs.</span></span>

## <a name="choose-a-nullable-strategy"></a><span data-ttu-id="46129-132">Scegliere una strategia Nullable</span><span class="sxs-lookup"><span data-stu-id="46129-132">Choose a nullable strategy</span></span>

<span data-ttu-id="46129-133">La prima scelta è se i tipi di riferimento nullable devono essere attivati o disattivati per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="46129-133">The first choice is whether nullable reference types should be on or off by default.</span></span> <span data-ttu-id="46129-134">Sono disponibili due strategie:</span><span class="sxs-lookup"><span data-stu-id="46129-134">You have two strategies:</span></span>

- <span data-ttu-id="46129-135">Abilitare i tipi di riferimento Nullable per l'intero progetto e disabilitarlo nel codice non pronto.</span><span class="sxs-lookup"><span data-stu-id="46129-135">Enable nullable reference types for the entire project, and disable it in code that's not ready.</span></span>
- <span data-ttu-id="46129-136">Abilitare solo i tipi di riferimento Nullable per il codice che è stato annotato per i tipi di riferimento Nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-136">Only enable nullable reference types for code that's been annotated for nullable reference types.</span></span>

<span data-ttu-id="46129-137">La prima strategia funziona meglio quando si aggiungono altre funzionalità alla libreria durante l'aggiornamento per i tipi di riferimento Nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-137">The first strategy works best when you're adding other features to the library as you update it for nullable reference types.</span></span> <span data-ttu-id="46129-138">Tutti i nuovi sviluppi supportano i valori null.</span><span class="sxs-lookup"><span data-stu-id="46129-138">All new development is nullable aware.</span></span> <span data-ttu-id="46129-139">Quando si aggiorna il codice esistente, si abilitano i tipi di riferimento nullable in tali classi.</span><span class="sxs-lookup"><span data-stu-id="46129-139">As you update existing code, you enable nullable reference types in those classes.</span></span>

<span data-ttu-id="46129-140">Seguendo questa prima strategia, si eseguono le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="46129-140">Following this first strategy, you do the following:</span></span>

1. <span data-ttu-id="46129-141">Abilitare i tipi Nullable per l'intero progetto aggiungendo l' `<Nullable>enable</Nullable>` elemento ai file *csproj* .</span><span class="sxs-lookup"><span data-stu-id="46129-141">Enable nullable types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span> 
1. <span data-ttu-id="46129-142">Aggiungere il `#nullable disable` pragma a ogni file di origine nel progetto.</span><span class="sxs-lookup"><span data-stu-id="46129-142">Add the `#nullable disable` pragma to every source file in your project.</span></span> 
1. <span data-ttu-id="46129-143">Quando si lavora su ogni file, rimuovere il pragma e risolvere eventuali avvisi.</span><span class="sxs-lookup"><span data-stu-id="46129-143">As you work on each file, remove the pragma and address any warnings.</span></span>

<span data-ttu-id="46129-144">Questa prima strategia ha più lavoro iniziale per aggiungere il pragma a ogni file.</span><span class="sxs-lookup"><span data-stu-id="46129-144">This first strategy has more up-front work to add the pragma to every file.</span></span> <span data-ttu-id="46129-145">Il vantaggio è che ogni nuovo file di codice aggiunto al progetto sarà abilitato per i valori null.</span><span class="sxs-lookup"><span data-stu-id="46129-145">The advantage is that every new code file added to the project will be nullable enabled.</span></span> <span data-ttu-id="46129-146">Eventuali nuovi lavori saranno in grado di riconoscere i valori null. è necessario aggiornare solo il codice esistente.</span><span class="sxs-lookup"><span data-stu-id="46129-146">Any new work will be nullable aware; only existing code must be updated.</span></span>

<span data-ttu-id="46129-147">La seconda strategia funziona meglio se la libreria è in genere stabile e l'obiettivo principale dello sviluppo è l'adozione di tipi di riferimento Nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-147">The second strategy works better if the library is generally stable, and the main focus of the development is to adopt nullable reference types.</span></span> <span data-ttu-id="46129-148">Si attivano i tipi di riferimento Nullable durante l'annotazione delle API.</span><span class="sxs-lookup"><span data-stu-id="46129-148">You turn on nullable reference types as you annotate APIs.</span></span> <span data-ttu-id="46129-149">Al termine, si abilitano i tipi di riferimento Nullable per l'intero progetto.</span><span class="sxs-lookup"><span data-stu-id="46129-149">When you've finished, you enable nullable reference types for the entire project.</span></span>

<span data-ttu-id="46129-150">Seguendo questa seconda strategia si eseguono le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="46129-150">Following this second strategy you do the following:</span></span>

1. <span data-ttu-id="46129-151">Aggiungere il `#nullable enable` pragma al file che si desidera rendere compatibile con Nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-151">Add the `#nullable enable` pragma to the file you want to make nullable aware.</span></span>
1. <span data-ttu-id="46129-152">Risolvere tutti gli avvisi.</span><span class="sxs-lookup"><span data-stu-id="46129-152">Address any warnings.</span></span>
1. <span data-ttu-id="46129-153">Continuare questi primi due passaggi fino a quando non è stata resa disponibile l'intera libreria Nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-153">Continue these first two steps until you've made the entire library nullable aware.</span></span>
1. <span data-ttu-id="46129-154">Abilitare i tipi Nullable per l'intero progetto aggiungendo l' `<Nullable>enable</Nullable>` elemento ai file *csproj* .</span><span class="sxs-lookup"><span data-stu-id="46129-154">Enable nullable types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span> 
1. <span data-ttu-id="46129-155">Rimuovere i `#nullable enable` pragma, perché non sono più necessari.</span><span class="sxs-lookup"><span data-stu-id="46129-155">Remove the `#nullable enable` pragmas, as they're no longer needed.</span></span>

<span data-ttu-id="46129-156">Questa seconda strategia ha meno lavoro in primo piano.</span><span class="sxs-lookup"><span data-stu-id="46129-156">This second strategy has less work up-front.</span></span> <span data-ttu-id="46129-157">Il compromesso consiste nel fatto che la prima attività quando si crea un nuovo file consiste nell'aggiungere il pragma e renderlo compatibile con i valori null.</span><span class="sxs-lookup"><span data-stu-id="46129-157">The tradeoff is that the first task when you create a new file is to add the pragma and make it nullable aware.</span></span> <span data-ttu-id="46129-158">Se gli sviluppatori del team dimenticano, il nuovo codice si trova ora nel backlog di lavoro per rendere il codice Nullable compatibile.</span><span class="sxs-lookup"><span data-stu-id="46129-158">If any developers on your team forget, that new code is now in the backlog of work to make all code nullable aware.</span></span>

<span data-ttu-id="46129-159">La scelta di queste strategie dipende dalla quantità di attività di sviluppo attive nel progetto.</span><span class="sxs-lookup"><span data-stu-id="46129-159">Which of these strategies you pick depends on how much active development is taking place in your project.</span></span> <span data-ttu-id="46129-160">Il progetto è più maturo e stabile, migliore sarà la seconda strategia.</span><span class="sxs-lookup"><span data-stu-id="46129-160">The more mature and stable your project, the better the second strategy.</span></span> <span data-ttu-id="46129-161">Maggiore è la maggior parte delle funzionalità sviluppate, migliore sarà la prima strategia.</span><span class="sxs-lookup"><span data-stu-id="46129-161">The more features being developed, the better the first strategy.</span></span>

## <a name="should-nullable-warnings-introduce-breaking-changes"></a><span data-ttu-id="46129-162">Gli avvisi Nullable introducono modifiche di rilievo?</span><span class="sxs-lookup"><span data-stu-id="46129-162">Should nullable warnings introduce breaking changes?</span></span>

<span data-ttu-id="46129-163">Prima di abilitare i tipi di riferimento Nullable, le variabili sono considerate *Nullable ignare*.</span><span class="sxs-lookup"><span data-stu-id="46129-163">Before you enable nullable reference types, variables are considered *nullable oblivious*.</span></span> <span data-ttu-id="46129-164">Quando si abilitano i tipi di riferimento Nullable, tutte queste variabili *non ammettono valori null*.</span><span class="sxs-lookup"><span data-stu-id="46129-164">Once you enable nullable reference types, all those variables are *non-nullable*.</span></span> <span data-ttu-id="46129-165">Il compilatore emetterà avvisi se tali variabili non vengono inizializzate su valori non null.</span><span class="sxs-lookup"><span data-stu-id="46129-165">The compiler will issue warnings if those variables aren't initialized to non-null values.</span></span>

<span data-ttu-id="46129-166">Un'altra fonte di avvisi probabile è la restituzione di valori quando il valore non è stato inizializzato.</span><span class="sxs-lookup"><span data-stu-id="46129-166">Another likely source of warnings is return values when the value hasn't been initialized.</span></span>

<span data-ttu-id="46129-167">Il primo passaggio per indirizzare gli avvisi del compilatore consiste `?` nell'usare le annotazioni sui tipi Parameter e Return per indicare quando gli argomenti o i valori restituiti possono essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-167">The first step in addressing the compiler warnings is to use `?` annotations on parameter and return types to indicate when arguments or return values may be null.</span></span> <span data-ttu-id="46129-168">Quando le variabili di riferimento non devono essere null, la dichiarazione originale è corretta.</span><span class="sxs-lookup"><span data-stu-id="46129-168">When reference variables must not be null, the original declaration is correct.</span></span> <span data-ttu-id="46129-169">Quando si esegue questa operazione, l'obiettivo non è solo correggere gli avvisi.</span><span class="sxs-lookup"><span data-stu-id="46129-169">As you do this, your goal isn't just to fix warnings.</span></span> <span data-ttu-id="46129-170">L'obiettivo più importante è fare in modo che il compilatore conosca le finalità dei potenziali valori null.</span><span class="sxs-lookup"><span data-stu-id="46129-170">The more important goal is to make the compiler understand your intent for potential null values.</span></span> <span data-ttu-id="46129-171">Quando si esaminano gli avvisi, si raggiunge la decisione principale successiva per la raccolta.</span><span class="sxs-lookup"><span data-stu-id="46129-171">As you examine the warnings, you reach your next major decision for your library.</span></span> <span data-ttu-id="46129-172">Si desidera modificare le firme dell'API per comunicare in modo più chiaro lo scopo della progettazione?</span><span class="sxs-lookup"><span data-stu-id="46129-172">Do you want to consider modifying API signatures to more clearly communicate your design intent?</span></span> <span data-ttu-id="46129-173">Una firma API migliore per il `TryGetMessage` metodo esaminato in precedenza potrebbe essere:</span><span class="sxs-lookup"><span data-stu-id="46129-173">A better API signature for the `TryGetMessage` method examined earlier could be:</span></span>

```csharp
string? TryGetMessage(string key);
```

<span data-ttu-id="46129-174">Il valore restituito indica l'esito positivo o negativo e contiene il valore se il valore è stato trovato.</span><span class="sxs-lookup"><span data-stu-id="46129-174">The return value indicates success or failure, and carries the value if the value was found.</span></span> <span data-ttu-id="46129-175">In molti casi, la modifica delle firme API può migliorare il modo in cui comunicano i valori null.</span><span class="sxs-lookup"><span data-stu-id="46129-175">In many cases, changing API signatures can improve how they communicate null values.</span></span>

<span data-ttu-id="46129-176">Tuttavia, per le librerie pubbliche o le librerie con basi utente di grandi dimensioni, è preferibile non introdurre modifiche alla firma dell'API.</span><span class="sxs-lookup"><span data-stu-id="46129-176">However, for public libraries, or libraries with large user bases, you may prefer not introducing any API signature changes.</span></span> <span data-ttu-id="46129-177">Per questi casi e altri modelli comuni, è possibile applicare gli attributi per definire in modo più chiaro quando un argomento o un valore `null`restituito può essere.</span><span class="sxs-lookup"><span data-stu-id="46129-177">For those cases, and other common patterns, you can apply attributes to more clearly define when an argument or return value may be `null`.</span></span> <span data-ttu-id="46129-178">Indipendentemente dalla possibilità di modificare la superficie dell'API, probabilmente si noterà che le annotazioni di tipo non sono sufficienti per descrivere `null` i valori per gli argomenti o i valori restituiti.</span><span class="sxs-lookup"><span data-stu-id="46129-178">Whether or not you consider changing the surface of your API, you'll likely find that type annotations alone aren't sufficient for describing `null` values for arguments or return values.</span></span> <span data-ttu-id="46129-179">In questi casi, è possibile applicare gli attributi per descrivere più chiaramente un'API.</span><span class="sxs-lookup"><span data-stu-id="46129-179">In those instances, you can apply attributes to more clearly describe an API.</span></span> 

## <a name="attributes-extend-type-annotations"></a><span data-ttu-id="46129-180">Attributi estensione delle annotazioni di tipo</span><span class="sxs-lookup"><span data-stu-id="46129-180">Attributes extend type annotations</span></span>

<span data-ttu-id="46129-181">Sono stati aggiunti diversi attributi per esprimere informazioni aggiuntive sullo stato null delle variabili.</span><span class="sxs-lookup"><span data-stu-id="46129-181">Several attributes have been added to express additional information about the null state of variables.</span></span> <span data-ttu-id="46129-182">Tutto il codice scritto prima C# di 8 introduce i tipi di riferimento Nullable è un *valore null ignaro*.</span><span class="sxs-lookup"><span data-stu-id="46129-182">All code you wrote before C# 8 introduced nullable reference types was *null oblivious*.</span></span> <span data-ttu-id="46129-183">Ciò significa che qualsiasi variabile di tipo riferimento può essere null, ma non sono necessari controlli null.</span><span class="sxs-lookup"><span data-stu-id="46129-183">That means any reference type variable may be null, but null checks aren't required.</span></span> <span data-ttu-id="46129-184">Quando il codice *ammette i valori null*, tali regole cambiano.</span><span class="sxs-lookup"><span data-stu-id="46129-184">Once your code is *nullable aware*, those rules change.</span></span> <span data-ttu-id="46129-185">I tipi di riferimento non devono `null` mai essere il valore e i tipi di riferimento Nullable `null` devono essere controllati prima di essere dereferenziati.</span><span class="sxs-lookup"><span data-stu-id="46129-185">Reference types should never be the `null` value, and nullable reference types must be checked against `null` before being dereferenced.</span></span>

<span data-ttu-id="46129-186">Le regole per le API sono probabilmente più complesse, come si è visto con `TryGetValue` lo scenario API.</span><span class="sxs-lookup"><span data-stu-id="46129-186">The rules for your APIs are likely more complicated, as you saw with the `TryGetValue` API scenario.</span></span> <span data-ttu-id="46129-187">Molte API hanno regole più complesse quando le variabili possono o non possono essere `null`.</span><span class="sxs-lookup"><span data-stu-id="46129-187">Many of your APIs have more complex rules for when variables can or can't be `null`.</span></span> <span data-ttu-id="46129-188">In questi casi, si userà uno degli attributi seguenti per esprimere queste regole:</span><span class="sxs-lookup"><span data-stu-id="46129-188">In these cases, you'll use one of the following attributes to express those rules:</span></span>

- <span data-ttu-id="46129-189">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): Un argomento di input che non ammette i valori null può essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-189">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="46129-190">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): Un argomento di input nullable non deve mai essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-190">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>
- <span data-ttu-id="46129-191">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): Un valore restituito non nullable può essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-191">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="46129-192">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): Un valore restituito nullable non sarà mai null.</span><span class="sxs-lookup"><span data-stu-id="46129-192">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>
- <span data-ttu-id="46129-193">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): Un argomento non Nullable `out` o `ref` può essere null quando il valore restituito soddisfa una condizione.</span><span class="sxs-lookup"><span data-stu-id="46129-193">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable `out` or `ref` argument may be null when the return value satisfies a condition.</span></span>
- <span data-ttu-id="46129-194">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): Un argomento `out` Nullable `ref` o non può essere null se il valore restituito soddisfa una condizione.</span><span class="sxs-lookup"><span data-stu-id="46129-194">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable `out` or `ref` argument may not be null when the return value satisfies a condition.</span></span>
- <span data-ttu-id="46129-195">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): Un valore restituito non è null se l'argomento di input per il parametro specificato non è null.</span><span class="sxs-lookup"><span data-stu-id="46129-195">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the input argument for the specified parameter isn't null.</span></span>

<span data-ttu-id="46129-196">Le descrizioni precedenti sono un riferimento rapido a ogni attributo.</span><span class="sxs-lookup"><span data-stu-id="46129-196">The preceding descriptions are a quick reference to what each attribute does.</span></span> <span data-ttu-id="46129-197">Ogni sezione seguente descrive il comportamento e il significato più approfondito.</span><span class="sxs-lookup"><span data-stu-id="46129-197">Each following section describes the behavior and meaning more thoroughly.</span></span>

<span data-ttu-id="46129-198">L'aggiunta di questi attributi offre al compilatore ulteriori informazioni sulle regole per l'API.</span><span class="sxs-lookup"><span data-stu-id="46129-198">Adding these attributes gives the compiler more information about the rules for your API.</span></span> <span data-ttu-id="46129-199">Quando il codice chiamante viene compilato in un contesto abilitato Nullable, il compilatore avvisa i chiamanti quando violano tali regole.</span><span class="sxs-lookup"><span data-stu-id="46129-199">When calling code is compiled in a nullable enabled context, the compiler will warn callers when they violate those rules.</span></span> <span data-ttu-id="46129-200">Questi attributi non abilitano controlli aggiuntivi nell'implementazione.</span><span class="sxs-lookup"><span data-stu-id="46129-200">These attributes don't enable additional checks on your implementation.</span></span>

## <a name="specify-preconditions-allownull-and-disallownull"></a><span data-ttu-id="46129-201">Specificare le precondizioni `AllowNull` : e`DisallowNull`</span><span class="sxs-lookup"><span data-stu-id="46129-201">Specify preconditions: `AllowNull` and `DisallowNull`</span></span>

<span data-ttu-id="46129-202">Si consideri una proprietà di lettura/ `null` scrittura che non restituisce mai perché ha un valore predefinito ragionevole.</span><span class="sxs-lookup"><span data-stu-id="46129-202">Consider a read/write property that never returns `null` because it has a reasonable default value.</span></span> <span data-ttu-id="46129-203">I chiamanti `null` passano alla funzione di accesso set quando vengono impostati su tale valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="46129-203">Callers pass `null` to the set accessor when setting it to that default value.</span></span> <span data-ttu-id="46129-204">Si consideri, ad esempio, un sistema di messaggistica che richiede un nome di schermata in una chat room.</span><span class="sxs-lookup"><span data-stu-id="46129-204">For example, consider a messaging system that asks for a screen name in a chat room.</span></span> <span data-ttu-id="46129-205">Se non viene specificato alcun valore, il sistema genera un nome casuale:</span><span class="sxs-lookup"><span data-stu-id="46129-205">If none is provided, the system generates a random name:</span></span>

```csharp
public string ScreenName
{
   get => screenName;
   set => screenName = value ?? GenerateRandomScreenName();
}
private string screenName;
```

<span data-ttu-id="46129-206">Quando si compila il codice precedente in un contesto ignaro Nullable, tutto funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="46129-206">When you compile the preceding code in a nullable oblivious context, everything is fine.</span></span> <span data-ttu-id="46129-207">Quando si abilitano i tipi di riferimento `ScreenName` Nullable, la proprietà diventa un riferimento che non ammette i valori null.</span><span class="sxs-lookup"><span data-stu-id="46129-207">Once you enable nullable reference types, the `ScreenName` property becomes a non-nullable reference.</span></span> <span data-ttu-id="46129-208">Questo è corretto per la `get` funzione di accesso: non `null`restituisce mai.</span><span class="sxs-lookup"><span data-stu-id="46129-208">That's correct for the `get` accessor: it never returns `null`.</span></span> <span data-ttu-id="46129-209">I chiamanti non devono controllare la proprietà restituita `null`per.</span><span class="sxs-lookup"><span data-stu-id="46129-209">Callers don't need to check the returned property for `null`.</span></span> <span data-ttu-id="46129-210">Ma ora impostando la proprietà `null` su viene generato un avviso.</span><span class="sxs-lookup"><span data-stu-id="46129-210">But now setting the property to `null` generates a warning.</span></span> <span data-ttu-id="46129-211">Per continuare a supportare questo tipo di codice, aggiungere l' <xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute?displayProperty=nameWithType> attributo alla proprietà, come illustrato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46129-211">In order to continue to support this type of code, you add the <xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute?displayProperty=nameWithType> attribute to the property, as shown in the following code:</span></span> 

```csharp
[AllowNull]
public string ScreenName
{
   get => screenName;
   set => screenName = value ?? GenerateRandomScreenName();
}
private string screenName = GenerateRandomScreenName();
```

<span data-ttu-id="46129-212">Potrebbe essere necessario aggiungere una `using` direttiva per <xref:System.Diagnostics.CodeAnalysis> per usare questo e altri attributi descritti in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="46129-212">You may need to add a `using` directive for <xref:System.Diagnostics.CodeAnalysis> to use this and other attributes discussed in this article.</span></span> <span data-ttu-id="46129-213">L'attributo viene applicato alla proprietà, non alla `set` funzione di accesso.</span><span class="sxs-lookup"><span data-stu-id="46129-213">The attribute is applied to the property, not the `set` accessor.</span></span> <span data-ttu-id="46129-214">L' `AllowNull` attributo specifica le *condizioni preliminari*e si applica solo agli input.</span><span class="sxs-lookup"><span data-stu-id="46129-214">The `AllowNull` attribute specifies *pre-conditions*, and only applies to inputs.</span></span> <span data-ttu-id="46129-215">La `get` funzione di accesso ha un valore restituito, ma nessun argomento di input.</span><span class="sxs-lookup"><span data-stu-id="46129-215">The `get` accessor has a return value, but no input arguments.</span></span> <span data-ttu-id="46129-216">Pertanto, l' `AllowNull` attributo si applica solo `set` alla funzione di accesso.</span><span class="sxs-lookup"><span data-stu-id="46129-216">Therefore, the `AllowNull` attribute only applies to the `set` accessor.</span></span>

<span data-ttu-id="46129-217">Nell'esempio precedente viene illustrato cosa cercare quando si aggiunge l' `AllowNull` attributo in un argomento:</span><span class="sxs-lookup"><span data-stu-id="46129-217">The preceding example demonstrates what to look for when adding the `AllowNull` attribute on an argument:</span></span>

1. <span data-ttu-id="46129-218">Il contratto generale per tale variabile è che non deve essere `null`, pertanto si desidera un tipo di riferimento non nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-218">The general contract for that variable is that it shouldn't be `null`, so you want a non-nullable reference type.</span></span>
1. <span data-ttu-id="46129-219">Esistono scenari per la variabile di `null`input, sebbene non siano l'utilizzo più comune.</span><span class="sxs-lookup"><span data-stu-id="46129-219">There are scenarios for the input variable to be `null`, though they aren't the most common usage.</span></span>

<span data-ttu-id="46129-220">Spesso è necessario questo attributo per le proprietà, `in` `out`gli argomenti, e `ref` .</span><span class="sxs-lookup"><span data-stu-id="46129-220">Most often you'll need this attribute for properties, or `in`, `out`, and `ref` arguments.</span></span> <span data-ttu-id="46129-221">L' `AllowNull` attributo è la scelta migliore quando una variabile è in genere non null, ma è necessario consentirla `null` come precondizione.</span><span class="sxs-lookup"><span data-stu-id="46129-221">The `AllowNull` attribute is the best choice when a variable is typically non-null, but you need to allow `null` as a precondition.</span></span>

<span data-ttu-id="46129-222">Si differenziano dagli scenari per `DisallowNull`l'utilizzo di: Usare questo attributo per specificare che una variabile di input di un tipo nullable non deve `null`essere.</span><span class="sxs-lookup"><span data-stu-id="46129-222">Contrast that with scenarios for using `DisallowNull`: You use this attribute to specify that an input variable of a nullable type shouldn't be `null`.</span></span> <span data-ttu-id="46129-223">Si consideri `null` una proprietà in cui è il valore predefinito, ma i client possono impostarlo solo su un valore non null.</span><span class="sxs-lookup"><span data-stu-id="46129-223">Consider a property where `null` is the default value, but clients can only set it to a non-null value.</span></span> <span data-ttu-id="46129-224">Esaminare il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46129-224">Consider the following code:</span></span>

```csharp
public string ReviewComment
{
    get => _comment;
    set => _comment = value ?? throw new ArgumentNullException(nameof(value), "Cannot set to null");
}
string _comment;
```

<span data-ttu-id="46129-225">Il codice precedente rappresenta il modo migliore per esprimere la progettazione che `ReviewComment` può essere `null`, ma non può essere impostato su `null`.</span><span class="sxs-lookup"><span data-stu-id="46129-225">The preceding code is the best way to express your design that the `ReviewComment` could be `null`, but can't be set to `null`.</span></span> <span data-ttu-id="46129-226">Una volta che il codice ammette i valori null, è possibile esprimere questo concetto in modo più chiaro <xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute?displayProperty=nameWithType>ai chiamanti utilizzando:</span><span class="sxs-lookup"><span data-stu-id="46129-226">Once this code is nullable aware, you can express this concept more clearly to callers using the <xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute?displayProperty=nameWithType>:</span></span>

```csharp
[DisallowNull] 
public string? ReviewComment
{
    get => _comment;
    set => _comment = value ?? throw new ArgumentNullException(nameof(value), "Cannot set to null");
}
string? _comment;
```

<span data-ttu-id="46129-227">In un contesto Nullable la `ReviewComment` `get` funzione di `null`accesso può restituire il valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="46129-227">In a nullable context, the `ReviewComment` `get` accessor could return the default value of `null`.</span></span> <span data-ttu-id="46129-228">Il compilatore avverte che è necessario verificarlo prima dell'accesso.</span><span class="sxs-lookup"><span data-stu-id="46129-228">The compiler warns that it must be checked before access.</span></span> <span data-ttu-id="46129-229">Inoltre, avvisa i chiamanti che, anche se potrebbero essere `null`, i chiamanti non devono impostarlo in modo esplicito su. `null`</span><span class="sxs-lookup"><span data-stu-id="46129-229">Furthermore, it warns callers that, even though it could be `null`, callers shouldn't explicitly set it to `null`.</span></span> <span data-ttu-id="46129-230">L' `DisallowNull` attributo specifica anche una *condizione preliminare*, non influisce sulla `get` funzione di accesso.</span><span class="sxs-lookup"><span data-stu-id="46129-230">The `DisallowNull` attribute also specifies a *pre-condition*, it does not affect the `get` accessor.</span></span> <span data-ttu-id="46129-231">È consigliabile scegliere di usare l' `DisallowNull` attributo quando si osservano queste caratteristiche:</span><span class="sxs-lookup"><span data-stu-id="46129-231">You should choose to use the `DisallowNull` attribute when you observe these characteristics about:</span></span>

1. <span data-ttu-id="46129-232">La variabile potrebbe trovarsi negli scenari principali, spesso quando viene `null` creata per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="46129-232">The variable could be `null` in core scenarios, often when first instantiated.</span></span>
1. <span data-ttu-id="46129-233">La variabile non deve essere impostata in modo `null`esplicito su.</span><span class="sxs-lookup"><span data-stu-id="46129-233">The variable shouldn't be explicitly set to `null`.</span></span>

<span data-ttu-id="46129-234">Queste situazioni sono comuni nel codice che originariamente era *null ignaro*.</span><span class="sxs-lookup"><span data-stu-id="46129-234">These situations are common in code that was originally *null oblivious*.</span></span> <span data-ttu-id="46129-235">È possibile che le proprietà dell'oggetto siano impostate in due operazioni di inizializzazione distinte.</span><span class="sxs-lookup"><span data-stu-id="46129-235">It may be that object properties are set in two distinct initialization operations.</span></span> <span data-ttu-id="46129-236">È possibile che alcune proprietà siano impostate solo dopo il completamento di alcune operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="46129-236">It may be that some properties are set only after some asynchronous work has completed.</span></span>

<span data-ttu-id="46129-237">Gli `AllowNull` attributi `DisallowNull` e consentono di specificare che le precondizioni sulle variabili potrebbero non corrispondere alle annotazioni Nullable di tali variabili.</span><span class="sxs-lookup"><span data-stu-id="46129-237">The `AllowNull` and `DisallowNull` attributes enable you to specify that preconditions on variables may not match the nullable annotations on those variables.</span></span> <span data-ttu-id="46129-238">Sono disponibili informazioni più dettagliate sulle caratteristiche dell'API.</span><span class="sxs-lookup"><span data-stu-id="46129-238">These provide more detail about the characteristics of your API.</span></span> <span data-ttu-id="46129-239">Queste informazioni aggiuntive consentono ai chiamanti di usare correttamente l'API.</span><span class="sxs-lookup"><span data-stu-id="46129-239">This additional information helps callers use your API correctly.</span></span> <span data-ttu-id="46129-240">Ricordare di specificare le precondizioni usando gli attributi seguenti:</span><span class="sxs-lookup"><span data-stu-id="46129-240">Remember you specify preconditions using the following attributes:</span></span>

- <span data-ttu-id="46129-241">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): Un argomento di input che non ammette i valori null può essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-241">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="46129-242">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): Un argomento di input nullable non deve mai essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-242">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>

## <a name="specify-post-conditions-maybenull-and-notnull"></a><span data-ttu-id="46129-243">Specificare le post-conditions: `MaybeNull` e`NotNull`</span><span class="sxs-lookup"><span data-stu-id="46129-243">Specify post-conditions: `MaybeNull` and `NotNull`</span></span>

<span data-ttu-id="46129-244">Si supponga di avere un metodo con la firma seguente:</span><span class="sxs-lookup"><span data-stu-id="46129-244">Suppose you have a method with the following signature:</span></span>

```csharp
public Customer FindCustomer(string lastName, string firstName)
```

<span data-ttu-id="46129-245">Probabilmente è stato scritto un metodo come questo per restituire `null` quando il nome cercato non è stato trovato.</span><span class="sxs-lookup"><span data-stu-id="46129-245">You've likely written a method like this to return `null` when the name sought wasn't found.</span></span> <span data-ttu-id="46129-246">Indica `null` chiaramente che il record non è stato trovato.</span><span class="sxs-lookup"><span data-stu-id="46129-246">The `null` clearly indicates that the record wasn't found.</span></span> <span data-ttu-id="46129-247">In questo esempio è probabile che si modifichi il tipo restituito da `Customer` a `Customer?`.</span><span class="sxs-lookup"><span data-stu-id="46129-247">In this example, you'd likely change the return type from `Customer` to `Customer?`.</span></span> <span data-ttu-id="46129-248">La dichiarazione del valore restituito come tipo di riferimento Nullable specifica lo scopo di questa API in modo chiaro.</span><span class="sxs-lookup"><span data-stu-id="46129-248">Declaring the return value as a nullable reference type specifies the intent of this API clearly.</span></span> 

<span data-ttu-id="46129-249">Per motivi trattati in [definizioni generiche e supporto di valori null,](#generic-definitions-and-nullability) la tecnica non funziona con i metodi generici.</span><span class="sxs-lookup"><span data-stu-id="46129-249">For reasons covered under [Generic definitions and nullability](#generic-definitions-and-nullability) that technique does not work with generic methods.</span></span> <span data-ttu-id="46129-250">È possibile che si disponga di un metodo generico che segue un modello simile:</span><span class="sxs-lookup"><span data-stu-id="46129-250">You may have a generic method that follows a similar pattern:</span></span>

```csharp
public T Find<T>(IEnumerable<T> sequence, Func<T, bool> match)
```

<span data-ttu-id="46129-251">Non è possibile specificare che il valore restituito `T?`è.</span><span class="sxs-lookup"><span data-stu-id="46129-251">You can't specify that the return value is `T?`.</span></span> <span data-ttu-id="46129-252">Il metodo restituisce `null` quando l'elemento cercato non viene trovato.</span><span class="sxs-lookup"><span data-stu-id="46129-252">The method returns `null` when the sought item isn't found.</span></span> <span data-ttu-id="46129-253">Poiché non è possibile dichiarare `T?` un tipo restituito, è necessario `MaybeNull` aggiungere l'annotazione al metodo restituito:</span><span class="sxs-lookup"><span data-stu-id="46129-253">Since you can't declare a `T?` return type, you add the `MaybeNull` annotation to the method return:</span></span>

```csharp
[return: MaybeNull]
public T Find<T>(IEnumerable<T> sequence, Func<T, bool> match)
```

<span data-ttu-id="46129-254">Il codice precedente informa i chiamanti che il contratto implica un tipo non nullable, ma il valore restituito *può* essere effettivamente null.</span><span class="sxs-lookup"><span data-stu-id="46129-254">The preceding code informs callers that the contract implies a non-nullable type, but the return value *may* actually be null.</span></span>  <span data-ttu-id="46129-255">Usare l' `MaybeNull` attributo quando l'API deve essere un tipo non nullable, in genere un parametro di tipo generico, ma possono essere presenti istanze `null` in cui verrebbe restituito.</span><span class="sxs-lookup"><span data-stu-id="46129-255">Use the `MaybeNull` attribute when your API should be a non-nullable type, typically a generic type parameter, but there may be instances where `null` would be returned.</span></span>

<span data-ttu-id="46129-256">È anche possibile specificare che un valore restituito o un `out` argomento `ref` o non sia null anche se il tipo è un tipo Nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-256">You can also specify that a return value or an `out` or `ref` argument isn't null even though the type is a nullable type.</span></span> <span data-ttu-id="46129-257">Si consideri un metodo che garantisce che una matrice sia sufficientemente grande da mantenere un numero di elementi.</span><span class="sxs-lookup"><span data-stu-id="46129-257">Consider a method that ensures an array is large enough to hold a number of elements.</span></span> <span data-ttu-id="46129-258">Se l'argomento di input non dispone di capacità, la routine alloca una nuova matrice e copia tutti gli elementi esistenti al suo interno.</span><span class="sxs-lookup"><span data-stu-id="46129-258">If the input argument doesn't have capacity, the routine would allocate a new array and copy all the existing elements into it.</span></span> <span data-ttu-id="46129-259">Se l'argomento di input `null`è, la routine allocherà la nuova risorsa di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="46129-259">If the input argument is `null`, the routine would allocate new storage.</span></span> <span data-ttu-id="46129-260">Se la capacità è sufficiente, la routine non esegue alcuna operazione:</span><span class="sxs-lookup"><span data-stu-id="46129-260">If there's sufficient capacity, the routine does nothing:</span></span>

```csharp
public void EnsureCapacity<T>(ref T[] storage, int size)
```

<span data-ttu-id="46129-261">È possibile chiamare questa routine come segue:</span><span class="sxs-lookup"><span data-stu-id="46129-261">You could call this routine as follows:</span></span>

```csharp
// messages has the default value (null) when EnsureCapacity is called:
EnsureCapacity<string>(ref messages, 10);
// messages is not null.
EnsureCapacity<string>(messages, 50);
```

<span data-ttu-id="46129-262">Dopo aver abilitato i tipi di riferimento null, è necessario assicurarsi che il codice precedente venga compilato senza avvisi.</span><span class="sxs-lookup"><span data-stu-id="46129-262">After enabling null reference types, you want to ensure that the preceding code compiles without warnings.</span></span> <span data-ttu-id="46129-263">Quando il metodo restituisce un risultato `storage` , l'argomento è sicuramente not null.</span><span class="sxs-lookup"><span data-stu-id="46129-263">When the method returns, the `storage` argument is guaranteed to be not null.</span></span> <span data-ttu-id="46129-264">Tuttavia, è accettabile chiamare `EnsureCapacity` con un riferimento null.</span><span class="sxs-lookup"><span data-stu-id="46129-264">However, it's acceptable to call `EnsureCapacity` with a null reference.</span></span> <span data-ttu-id="46129-265">È possibile creare `storage` un tipo di riferimento nullable e aggiungere la `NotNull` post-condizione alla dichiarazione del parametro:</span><span class="sxs-lookup"><span data-stu-id="46129-265">You can make `storage` a nullable reference type, and add the `NotNull` post-condition to the parameter declaration:</span></span>

```csharp
public void EnsureCapacity<T>([NotNull]ref T[]? storage, int size)
```

<span data-ttu-id="46129-266">Il codice precedente esprime molto chiaramente il contratto esistente: I chiamanti possono passare una variabile con `null` il valore, ma il valore restituito non è mai null.</span><span class="sxs-lookup"><span data-stu-id="46129-266">The preceding code expresses the existing contract very clearly: Callers can pass a variable with the `null` value, but the return value is guaranteed to never be null.</span></span> <span data-ttu-id="46129-267">L' `NotNull` attributo è particolarmente utile per `ref` gli `out` argomenti e `null` , dove può essere passato come argomento, ma tale argomento è sicuramente not null quando il metodo restituisce.</span><span class="sxs-lookup"><span data-stu-id="46129-267">The `NotNull` attribute is most useful for `ref` and `out` arguments where `null` may be passed as an argument, but that argument is guaranteed to be not null when the method returns.</span></span>

<span data-ttu-id="46129-268">È possibile specificare postcondizioni non condizionali usando gli attributi seguenti:</span><span class="sxs-lookup"><span data-stu-id="46129-268">You specify unconditional postconditions using the following attributes:</span></span>

- <span data-ttu-id="46129-269">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): Un valore restituito non nullable può essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-269">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="46129-270">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): Un valore restituito nullable non sarà mai null.</span><span class="sxs-lookup"><span data-stu-id="46129-270">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>

## <a name="specify-conditional-post-conditions-notnullwhen-and-maybenullwhen"></a><span data-ttu-id="46129-271">Specificare le condizioni postali condizionali: `NotNullWhen` e`MaybeNullWhen`</span><span class="sxs-lookup"><span data-stu-id="46129-271">Specify conditional post-conditions: `NotNullWhen` and `MaybeNullWhen`</span></span>

<span data-ttu-id="46129-272">È probabile che si abbia familiarità <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType>con il `string` metodo.</span><span class="sxs-lookup"><span data-stu-id="46129-272">You're likely familiar with the `string` method <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType>.</span></span> <span data-ttu-id="46129-273">Questo metodo restituisce `true` quando l'argomento non è null e non la stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="46129-273">This method returns `true` when the argument isn't null, and not the empty string.</span></span> <span data-ttu-id="46129-274">Si tratta di un tipo di controllo null: I chiamanti non devono avere un valore null. controllare l'argomento se `false`il metodo restituisce.</span><span class="sxs-lookup"><span data-stu-id="46129-274">It is a form of null-check: Callers don't need to null-check the argument if the method returns `false`.</span></span> <span data-ttu-id="46129-275">Per rendere un metodo simile a Nullable, impostare l'argomento su un tipo nullable e aggiungere l' `NotNullWhen` attributo:</span><span class="sxs-lookup"><span data-stu-id="46129-275">To make a method like this nullable aware, you'd set the argument to a nullable type, and add the `NotNullWhen` attribute:</span></span>

```csharp
bool IsNullOrEmpty([NotNullWhen(false)]string? value);
```

<span data-ttu-id="46129-276">Che informa il compilatore che il codice in cui il valore `false` restituito non deve essere verificato come null.</span><span class="sxs-lookup"><span data-stu-id="46129-276">That informs the compiler that any code where the return value is `false` need not be null-checked.</span></span> <span data-ttu-id="46129-277">L'aggiunta dell'attributo informa l'analisi statica del compilatore che `IsNullOrEmpty` esegue il controllo null necessario: quando restituisce `false`, l'argomento di input non `null`lo è.</span><span class="sxs-lookup"><span data-stu-id="46129-277">The addition of the attribute informs the compiler's static analysis that `IsNullOrEmpty` performs the necessary null check: when it returns `false`, the input argument is not `null`.</span></span>

```csharp
string? userInput = GetUserInput();
if (!(string.IsNullOrEmpty(userInput))
{
   int messageLength = userInput.Length; // no null check needed.
}
// null check needed on userInput here.
```

<span data-ttu-id="46129-278">Il <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType> metodo verrà annotato come illustrato in precedenza per .NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="46129-278">The <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType> method will be annotated as shown above for .NET Core 3.0.</span></span> <span data-ttu-id="46129-279">Nella codebase potrebbero essere presenti metodi simili che controllano lo stato degli oggetti per i valori null.</span><span class="sxs-lookup"><span data-stu-id="46129-279">You may have similar methods in your codebase that check the state of objects for null values.</span></span> <span data-ttu-id="46129-280">Il compilatore non riconosce i metodi di controllo null personalizzati ed è necessario aggiungervi le annotazioni.</span><span class="sxs-lookup"><span data-stu-id="46129-280">The compiler won't recognize custom null check methods, and you'll need to add the annotations yourself.</span></span> <span data-ttu-id="46129-281">Quando si aggiunge l'attributo, l'analisi statica del compilatore sa quando la variabile testata è stata verificata come null.</span><span class="sxs-lookup"><span data-stu-id="46129-281">When you add the attribute, the compiler's static analysis knows when the tested variable has been null checked.</span></span>

<span data-ttu-id="46129-282">Un altro uso di questi attributi è `Try*` il modello.</span><span class="sxs-lookup"><span data-stu-id="46129-282">Another use for these attributes is the `Try*` pattern.</span></span> <span data-ttu-id="46129-283">Le postcondizioni per `ref` le `out` variabili e vengono comunicate tramite il valore restituito.</span><span class="sxs-lookup"><span data-stu-id="46129-283">The postconditions for `ref` and `out` variables are communicated through the return value.</span></span> <span data-ttu-id="46129-284">Si consideri questo metodo illustrato in precedenza:</span><span class="sxs-lookup"><span data-stu-id="46129-284">Consider this method shown earlier:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="46129-285">Il metodo precedente segue un normale idioma .NET: il valore restituito indica `message` se è stato impostato sul valore trovato o, se non viene trovato alcun messaggio, al valore predefinito.</span><span class="sxs-lookup"><span data-stu-id="46129-285">The preceding method follows a typical .NET idiom: the return value indicates if `message` was set to the found value or, if no message is found, to the default value.</span></span> <span data-ttu-id="46129-286">Se il metodo restituisce `true`, il valore di `message` non è null; in caso contrario, `message` il metodo imposta su null.</span><span class="sxs-lookup"><span data-stu-id="46129-286">If the method returns `true`, the value of `message` isn't null; otherwise, the method sets `message` to null.</span></span>

<span data-ttu-id="46129-287">È possibile comunicare tale idioma usando `NotNullWhen` l'attributo.</span><span class="sxs-lookup"><span data-stu-id="46129-287">You can communicate that idiom using the `NotNullWhen` attribute.</span></span> <span data-ttu-id="46129-288">Quando si aggiorna la firma per i tipi di riferimento Nullable `message` , `string?` creare un oggetto e aggiungere un attributo:</span><span class="sxs-lookup"><span data-stu-id="46129-288">When you update the signature for nullable reference types, make `message` a `string?` and add an attribute:</span></span>

```csharp
bool TryGetMessage(string key, [NotNullWhen(true)] out string? message)
```

<span data-ttu-id="46129-289">Nell'esempio precedente, il valore di `message` è noto come not null quando `TryGetMessage` restituisce `true`.</span><span class="sxs-lookup"><span data-stu-id="46129-289">In the preceding example, the value of `message` is known to be not null when `TryGetMessage` returns `true`.</span></span> <span data-ttu-id="46129-290">È necessario annotare metodi simili nella codebase nello stesso modo: gli argomenti potrebbero essere `null`, e sono noti come not null quando il metodo restituisce. `true`</span><span class="sxs-lookup"><span data-stu-id="46129-290">You should annotate similar methods in your codebase in the same way: the arguments could be `null`, and are known to be not null when the method returns `true`.</span></span>

<span data-ttu-id="46129-291">È possibile che sia necessario anche un attributo finale.</span><span class="sxs-lookup"><span data-stu-id="46129-291">There's one final attribute you may also need.</span></span> <span data-ttu-id="46129-292">A volte lo stato null di un valore restituito dipende dallo stato null di uno o più argomenti di input.</span><span class="sxs-lookup"><span data-stu-id="46129-292">Sometimes the null state of a return value depends on the null state of one or more input arguments.</span></span> <span data-ttu-id="46129-293">Questi metodi restituiranno un valore non null ogni volta che determinati argomenti di `null`input non sono.</span><span class="sxs-lookup"><span data-stu-id="46129-293">These methods will return a non-null value whenever certain input arguments aren't `null`.</span></span> <span data-ttu-id="46129-294">Per annotare correttamente questi metodi, usare l' `NotNullIfNotNull` attributo.</span><span class="sxs-lookup"><span data-stu-id="46129-294">To correctly annotate these methods, you use the `NotNullIfNotNull` attribute.</span></span> <span data-ttu-id="46129-295">Si consideri il seguente metodo:</span><span class="sxs-lookup"><span data-stu-id="46129-295">Consider the following method:</span></span>

```csharp
string GetTopLevelDomainFromFullUrl(string url);
```

<span data-ttu-id="46129-296">Se l' `url` argomento non è null, l'output `null`non è.</span><span class="sxs-lookup"><span data-stu-id="46129-296">If the `url` argument isn't null, the output isn't `null`.</span></span> <span data-ttu-id="46129-297">Una volta abilitati i riferimenti Nullable, la firma funziona correttamente, purché l'API non accetti mai un input null.</span><span class="sxs-lookup"><span data-stu-id="46129-297">Once nullable references are enabled, that signature works correctly, provided your API never accepts a null input.</span></span> <span data-ttu-id="46129-298">Tuttavia, se l'input può essere null, il valore restituito può anche essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-298">However, if the input could be null, then return value could also be null.</span></span> <span data-ttu-id="46129-299">Pertanto, è possibile modificare la firma con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46129-299">Therefore, you could change the signature to the following code:</span></span>

```csharp
string? GetTopLevelDomainFromFullUrl(string? url);
```

<span data-ttu-id="46129-300">Che funziona, ma spesso impone ai chiamanti di implementare controlli aggiuntivi `null` .</span><span class="sxs-lookup"><span data-stu-id="46129-300">That also works, but will often force callers to implement extra `null` checks.</span></span> <span data-ttu-id="46129-301">Il contratto è che il valore `null` restituito è solo quando l'argomento `url` di input è `null`.</span><span class="sxs-lookup"><span data-stu-id="46129-301">The contract is that the return value would be `null` only when the input argument `url` is `null`.</span></span> <span data-ttu-id="46129-302">Per esprimere il contratto, è necessario annotare questo metodo come illustrato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="46129-302">To express that contract, you would annotate this method as shown in the following code:</span></span>

```csharp
[return: NotNullIfNotNull("url")]
string? GetTopLevelDomainFromFullUrl(string? url);
```

<span data-ttu-id="46129-303">Il valore restituito e l'argomento sono entrambi annotati con l' `?` oggetto che indica che può `null`essere.</span><span class="sxs-lookup"><span data-stu-id="46129-303">The return value and the argument have both been annotated with the `?` indicating that either could be `null`.</span></span> <span data-ttu-id="46129-304">L'attributo chiarisce ulteriormente che il valore restituito non sarà null quando l' `url` argomento non `null`è.</span><span class="sxs-lookup"><span data-stu-id="46129-304">The attribute further clarifies that the return value won't be null when the `url` argument isn't `null`.</span></span>

<span data-ttu-id="46129-305">È possibile specificare le postcondizioni condizionali usando questi attributi:</span><span class="sxs-lookup"><span data-stu-id="46129-305">You specify conditional postconditions using these attributes:</span></span>

- <span data-ttu-id="46129-306">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): Un argomento non Nullable `out` o `ref` può essere null quando il valore restituito soddisfa una condizione.</span><span class="sxs-lookup"><span data-stu-id="46129-306">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable `out` or `ref` argument may be null when the return value satisfies a condition.</span></span>
- <span data-ttu-id="46129-307">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): Un argomento `out` Nullable `ref` o non può essere null se il valore restituito soddisfa una condizione.</span><span class="sxs-lookup"><span data-stu-id="46129-307">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable `out` or `ref` argument may not be null when the return value satisfies a condition.</span></span>
- <span data-ttu-id="46129-308">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): Un valore restituito non è null se l'argomento di input per il parametro specificato non è null.</span><span class="sxs-lookup"><span data-stu-id="46129-308">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the input argument for the specified parameter isn't null.</span></span>

## <a name="generic-definitions-and-nullability"></a><span data-ttu-id="46129-309">Definizioni generiche e supporto dei valori null</span><span class="sxs-lookup"><span data-stu-id="46129-309">Generic definitions and nullability</span></span>

<span data-ttu-id="46129-310">La comunicazione corretta dello stato null dei tipi generici e dei metodi generici richiede particolare attenzione.</span><span class="sxs-lookup"><span data-stu-id="46129-310">Correctly communicating the null state of generic types and generic methods requires special care.</span></span> <span data-ttu-id="46129-311">Questo deriva dal fatto che un tipo di valore nullable e un tipo di riferimento nullable sono fondamentalmente diversi.</span><span class="sxs-lookup"><span data-stu-id="46129-311">This stems from the fact that a nullable value type and a nullable reference type are fundamentally different.</span></span> <span data-ttu-id="46129-312">Un `int?` oggetto è un sinonimo di `string?` `Nullable<int>`, `string` mentre è con un attributo aggiunto dal compilatore.</span><span class="sxs-lookup"><span data-stu-id="46129-312">An `int?` is a synonym for `Nullable<int>`, whereas `string?` is `string` with an attribute added by the compiler.</span></span> <span data-ttu-id="46129-313">Il risultato è che il compilatore non può generare codice corretto `T?` per senza sapere `T` se è `class` o `struct`.</span><span class="sxs-lookup"><span data-stu-id="46129-313">The result is that the compiler can't generate correct code for `T?` without knowing if `T` is a `class` or a `struct`.</span></span> 

<span data-ttu-id="46129-314">Ciò non significa che non è possibile usare un tipo Nullable (tipo di valore o tipo di riferimento) come argomento di tipo per un tipo generico chiuso.</span><span class="sxs-lookup"><span data-stu-id="46129-314">This doesn't mean you can't use a nullable type (either value type or reference type) as the type argument for a closed generic type.</span></span> <span data-ttu-id="46129-315">E sono istanze valide di `List<T>`. `List<string?>` `List<int?>`</span><span class="sxs-lookup"><span data-stu-id="46129-315">Both `List<string?>` and `List<int?>` are valid instantiations of `List<T>`.</span></span> 

<span data-ttu-id="46129-316">Cosa significa che non è possibile usare `T?` in una dichiarazione di classe o metodo generica senza vincoli.</span><span class="sxs-lookup"><span data-stu-id="46129-316">What it does mean is that you can't use `T?` in a generic class or method declaration without constraints.</span></span> <span data-ttu-id="46129-317">Ad esempio, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> non verrà modificato in return `T?`.</span><span class="sxs-lookup"><span data-stu-id="46129-317">For example, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> won't be changed to return `T?`.</span></span> <span data-ttu-id="46129-318">Per ovviare a questa limitazione, è possibile `struct` aggiungere `class` il vincolo o.</span><span class="sxs-lookup"><span data-stu-id="46129-318">You can overcome this limitation by adding either the `struct` or `class` constraint.</span></span> <span data-ttu-id="46129-319">Con uno di questi vincoli, il compilatore sa come generare codice sia `T` per che `T?`per.</span><span class="sxs-lookup"><span data-stu-id="46129-319">With either of those constraints, the compiler knows how to generate code for both `T` and `T?`.</span></span>

<span data-ttu-id="46129-320">Potrebbe essere necessario limitare i tipi utilizzati per un argomento di tipo generico in modo che siano tipi non nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-320">You may want to restrict the types used for a generic type argument to be non-nullable types.</span></span> <span data-ttu-id="46129-321">A tale scopo, è possibile aggiungere `notnull` il vincolo su tale argomento di tipo.</span><span class="sxs-lookup"><span data-stu-id="46129-321">You can do that by adding the `notnull` constraint on that type argument.</span></span> <span data-ttu-id="46129-322">Quando viene applicato il vincolo, l'argomento di tipo non deve essere un tipo Nullable.</span><span class="sxs-lookup"><span data-stu-id="46129-322">When that constraint is applied, the type argument must not be a nullable type.</span></span>

## <a name="conclusions"></a><span data-ttu-id="46129-323">Conclusioni</span><span class="sxs-lookup"><span data-stu-id="46129-323">Conclusions</span></span>

<span data-ttu-id="46129-324">L'aggiunta di tipi di riferimento Nullable fornisce un vocabolario iniziale per descrivere le aspettative delle API `null`per le variabili che potrebbero essere.</span><span class="sxs-lookup"><span data-stu-id="46129-324">Adding nullable reference types provides an initial vocabulary to describe your APIs expectations for variables that could be `null`.</span></span> <span data-ttu-id="46129-325">Gli attributi aggiuntivi forniscono un vocabolario più completo per descrivere lo stato null delle variabili come precondizioni e postcondizioni.</span><span class="sxs-lookup"><span data-stu-id="46129-325">The additional attributes provide a richer vocabulary to describe the null state of variables as preconditions and postconditions.</span></span> <span data-ttu-id="46129-326">Questi attributi descrivono in modo più chiaro le aspettative e offrono un'esperienza migliore per gli sviluppatori che usano le API.</span><span class="sxs-lookup"><span data-stu-id="46129-326">These attributes more clearly describe your expectations and provide a better experience for the developers using your APIs.</span></span>

<span data-ttu-id="46129-327">Quando si aggiornano le librerie per un contesto Nullable, aggiungere questi attributi per guidare gli utenti delle API all'uso corretto.</span><span class="sxs-lookup"><span data-stu-id="46129-327">As you update libraries for a nullable context, add these attributes to guide users of your APIs to the correct usage.</span></span> <span data-ttu-id="46129-328">Questi attributi consentono di descrivere completamente lo stato null degli argomenti di input e dei valori restituiti:</span><span class="sxs-lookup"><span data-stu-id="46129-328">These attributes help you fully describe the null-state of input arguments and return values:</span></span>

- <span data-ttu-id="46129-329">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): Un argomento di input che non ammette i valori null può essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-329">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="46129-330">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): Un argomento di input nullable non deve mai essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-330">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>
- <span data-ttu-id="46129-331">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): Un valore restituito non nullable può essere null.</span><span class="sxs-lookup"><span data-stu-id="46129-331">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="46129-332">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): Un valore restituito nullable non sarà mai null.</span><span class="sxs-lookup"><span data-stu-id="46129-332">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>
- <span data-ttu-id="46129-333">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): Un argomento non Nullable `out` o `ref` può essere null quando il valore restituito soddisfa una condizione.</span><span class="sxs-lookup"><span data-stu-id="46129-333">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable `out` or `ref` argument may be null when the return value satisfies a condition.</span></span>
- <span data-ttu-id="46129-334">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): Un argomento `out` Nullable `ref` o non può essere null se il valore restituito soddisfa una condizione.</span><span class="sxs-lookup"><span data-stu-id="46129-334">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable `out` or `ref` argument may not be null when the return value satisfies a condition.</span></span>
- <span data-ttu-id="46129-335">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): Un valore restituito non è null se l'argomento di input per il parametro specificato non è null.</span><span class="sxs-lookup"><span data-stu-id="46129-335">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the input argument for the specified parameter isn't null.</span></span>
