---
title: Principi fondamentali di Garbage Collection
description: Informazioni su come funziona il Garbage Collector e su come può essere configurato per ottenere prestazioni ottimali.
ms.date: 03/08/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- garbage collection, generations
- garbage collection, background garbage collection
- garbage collection, concurrent garbage collection
- garbage collection, server garbage collection
- garbage collection, workstation garbage collection
- garbage collection, managed heap
ms.assetid: 67c5a20d-1be1-4ea7-8a9a-92b0b08658d2
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 0c0fa0e2c59856beda65ec5804b8896352db98b3
ms.sourcegitcommit: dfd612ba454ce775a766bcc6fe93bc1d43dfda47
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/09/2019
ms.locfileid: "72180187"
---
# <a name="fundamentals-of-garbage-collection"></a><span data-ttu-id="28faa-103">Principi fondamentali di Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="28faa-103">Fundamentals of garbage collection</span></span>

<a name="top"></a> <span data-ttu-id="28faa-104">In Common Language Runtime (CLR) il Garbage Collector funge da gestore di memoria automatico,</span><span class="sxs-lookup"><span data-stu-id="28faa-104">In the common language runtime (CLR), the garbage collector serves as an automatic memory manager.</span></span> <span data-ttu-id="28faa-105">offrendo i seguenti vantaggi:</span><span class="sxs-lookup"><span data-stu-id="28faa-105">It provides the following benefits:</span></span>

- <span data-ttu-id="28faa-106">Consente di sviluppare l'applicazione senza dover liberare manualmente la memoria per gli oggetti creati.</span><span class="sxs-lookup"><span data-stu-id="28faa-106">Enables you to develop your application without having to manually free memory for objects you create.</span></span>

- <span data-ttu-id="28faa-107">Alloca gli oggetti nell'heap gestito in maniera efficiente.</span><span class="sxs-lookup"><span data-stu-id="28faa-107">Allocates objects on the managed heap efficiently.</span></span>

- <span data-ttu-id="28faa-108">Recupera gli oggetti inutilizzati, ne cancella la memoria e tiene la memoria a disposizione per le future allocazioni.</span><span class="sxs-lookup"><span data-stu-id="28faa-108">Reclaims objects that are no longer being used, clears their memory, and keeps the memory available for future allocations.</span></span> <span data-ttu-id="28faa-109">Gli oggetti gestiti ottengono automaticamente contenuto pulito con il quale iniziare, pertanto i costruttori non devono inizializzare ogni campo dati.</span><span class="sxs-lookup"><span data-stu-id="28faa-109">Managed objects automatically get clean content to start with, so their constructors do not have to initialize every data field.</span></span>

- <span data-ttu-id="28faa-110">Garantisce protezione per la memoria assicurando che un oggetto non possa usare il contenuto di un altro oggetto.</span><span class="sxs-lookup"><span data-stu-id="28faa-110">Provides memory safety by making sure that an object cannot use the content of another object.</span></span>

 <span data-ttu-id="28faa-111">In questo argomento vengono descritti i concetti principali di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="28faa-111">This topic describes the core concepts of garbage collection.</span></span>

<a name="fundamentals_of_memory"></a>

## <a name="fundamentals-of-memory"></a><span data-ttu-id="28faa-112">Nozioni fondamentali sulla memoria</span><span class="sxs-lookup"><span data-stu-id="28faa-112">Fundamentals of memory</span></span>

<span data-ttu-id="28faa-113">Nell'elenco seguente sono riepilogati concetti importanti relativi alla memoria CLR.</span><span class="sxs-lookup"><span data-stu-id="28faa-113">The following list summarizes important CLR memory concepts.</span></span>

- <span data-ttu-id="28faa-114">Ogni processo dispone di un proprio spazio degli indirizzi virtuali distinto.</span><span class="sxs-lookup"><span data-stu-id="28faa-114">Each process has its own, separate virtual address space.</span></span> <span data-ttu-id="28faa-115">Tutti i processi nello stesso computer condividono la stessa memoria fisica e condividono il file di paging, se presente.</span><span class="sxs-lookup"><span data-stu-id="28faa-115">All processes on the same computer share the same physical memory, and share the page file if there is one.</span></span>

- <span data-ttu-id="28faa-116">Per impostazione predefinita, nei computer a 32 bit ogni processo dispone di uno spazio degli indirizzi virtuali in modalità utente da 2 GB.</span><span class="sxs-lookup"><span data-stu-id="28faa-116">By default, on 32-bit computers, each process has a 2-GB user-mode virtual address space.</span></span>

- <span data-ttu-id="28faa-117">Uno sviluppatore di applicazioni usa solo lo spazio degli indirizzi virtuali e non modifica mai direttamente la memoria fisica.</span><span class="sxs-lookup"><span data-stu-id="28faa-117">As an application developer, you work only with virtual address space and never manipulate physical memory directly.</span></span> <span data-ttu-id="28faa-118">Il Garbage Collector alloca e libera automaticamente la memoria virtuale nell'heap gestito.</span><span class="sxs-lookup"><span data-stu-id="28faa-118">The garbage collector allocates and frees virtual memory for you on the managed heap.</span></span>

  <span data-ttu-id="28faa-119">Se si sta scrivendo in codice nativo, si usano funzioni Win32 per lavorare con lo spazio degli indirizzi virtuali.</span><span class="sxs-lookup"><span data-stu-id="28faa-119">If you are writing native code, you use Win32 functions to work with the virtual address space.</span></span> <span data-ttu-id="28faa-120">Queste funzioni allocano e liberano automaticamente la memoria virtuale negli heap nativi.</span><span class="sxs-lookup"><span data-stu-id="28faa-120">These functions allocate and free virtual memory for you on native heaps.</span></span>

- <span data-ttu-id="28faa-121">La memoria virtuale può trovarsi in tre stati:</span><span class="sxs-lookup"><span data-stu-id="28faa-121">Virtual memory can be in three states:</span></span>

  - <span data-ttu-id="28faa-122">Libero.</span><span class="sxs-lookup"><span data-stu-id="28faa-122">Free.</span></span> <span data-ttu-id="28faa-123">Non vi sono riferimenti al blocco di memoria, che è disponibile per l'allocazione.</span><span class="sxs-lookup"><span data-stu-id="28faa-123">The block of memory has no references to it and is available for allocation.</span></span>

  - <span data-ttu-id="28faa-124">Riservato.</span><span class="sxs-lookup"><span data-stu-id="28faa-124">Reserved.</span></span> <span data-ttu-id="28faa-125">Il blocco di memoria è disponibile per l'utilizzo e non può essere usato da un'altra richiesta di allocazione.</span><span class="sxs-lookup"><span data-stu-id="28faa-125">The block of memory is available for your use and cannot be used for any other allocation request.</span></span> <span data-ttu-id="28faa-126">Non è tuttavia possibile archiviare i dati in questo blocco di memoria fino a quando non viene eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="28faa-126">However, you cannot store data to this memory block until it is committed.</span></span>

  - <span data-ttu-id="28faa-127">Eseguito.</span><span class="sxs-lookup"><span data-stu-id="28faa-127">Committed.</span></span> <span data-ttu-id="28faa-128">Il blocco di memoria è assegnato all'archiviazione fisica.</span><span class="sxs-lookup"><span data-stu-id="28faa-128">The block of memory is assigned to physical storage.</span></span>

- <span data-ttu-id="28faa-129">Lo spazio degli indirizzi virtuali può diventare frammentato.</span><span class="sxs-lookup"><span data-stu-id="28faa-129">Virtual address space can get fragmented.</span></span> <span data-ttu-id="28faa-130">Ciò significa che sono presenti blocchi liberi, noti anche come buchi, nello spazio degli indirizzi.</span><span class="sxs-lookup"><span data-stu-id="28faa-130">This means that there are free blocks, also known as holes, in the address space.</span></span> <span data-ttu-id="28faa-131">Quando viene richiesta un'allocazione della memoria virtuale, il gestore di memoria virtuale deve trovare un singolo blocco libero con dimensioni sufficienti per soddisfare la richiesta di allocazione.</span><span class="sxs-lookup"><span data-stu-id="28faa-131">When a virtual memory allocation is requested, the virtual memory manager has to find a single free block that is large enough to satisfy that allocation request.</span></span> <span data-ttu-id="28faa-132">Anche se si hanno 2 GB di spazio disponibile, l'allocazione che richiede 2 GB avrà esito negativo a meno che tutto lo spazio disponibile si trovi in un unico blocco di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="28faa-132">Even if you have 2 GB of free space, the allocation that requires 2 GB will be unsuccessful unless all of that free space is in a single address block.</span></span>

- <span data-ttu-id="28faa-133">È possibile esaurire la memoria se si esaurisce lo spazio degli indirizzi virtuali da riservare o lo spazio fisico di cui eseguire il commit.</span><span class="sxs-lookup"><span data-stu-id="28faa-133">You can run out of memory if you run out of virtual address space to reserve or physical space to commit.</span></span>

<span data-ttu-id="28faa-134">Il file di paging viene usato anche se la pressione della memoria fisica (ovvero, la richiesta di memoria fisica) è bassa.</span><span class="sxs-lookup"><span data-stu-id="28faa-134">Your page file is used even if physical memory pressure (that is, demand for physical memory) is low.</span></span> <span data-ttu-id="28faa-135">La prima volta che la pressione della memoria fisica è elevata, il sistema operativo deve fare spazio nella memoria fisica per archiviare i dati ed esegue il backup di alcuni dei dati che si trovano nella memoria fisica nel file di paging.</span><span class="sxs-lookup"><span data-stu-id="28faa-135">The first time your physical memory pressure is high, the operating system must make room in physical memory to store data, and it backs up some of the data that is in physical memory to the page file.</span></span> <span data-ttu-id="28faa-136">Il paging dei dati non viene eseguito fino a quando non è necessario, pertanto è possibile riscontrare il paging in situazioni in cui la pressione della memoria fisica è molto bassa.</span><span class="sxs-lookup"><span data-stu-id="28faa-136">That data is not paged until it is needed, so it is possible to encounter paging in situations where the physical memory pressure is very low.</span></span>

[<span data-ttu-id="28faa-137">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-137">Back to top</span></span>](#top)

<a name="conditions_for_a_garbage_collection"></a>

## <a name="conditions-for-a-garbage-collection"></a><span data-ttu-id="28faa-138">Condizioni per un'operazione di Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="28faa-138">Conditions for a garbage collection</span></span>

<span data-ttu-id="28faa-139">Le operazioni di Garbage Collection vengono eseguite in presenza di una delle seguenti condizioni:</span><span class="sxs-lookup"><span data-stu-id="28faa-139">Garbage collection occurs when one of the following conditions is true:</span></span>

- <span data-ttu-id="28faa-140">La memoria fisica del sistema è insufficiente.</span><span class="sxs-lookup"><span data-stu-id="28faa-140">The system has low physical memory.</span></span> <span data-ttu-id="28faa-141">Questa viene rilevata tramite la notifica di memoria non sufficiente dal sistema operativo o di memoria non sufficiente indicata dall'host.</span><span class="sxs-lookup"><span data-stu-id="28faa-141">This is detected by either the low memory notification from the OS or low memory indicated by the host.</span></span>

- <span data-ttu-id="28faa-142">La memoria usata dagli oggetti allocati nell'heap gestito supera una soglia accettabile.</span><span class="sxs-lookup"><span data-stu-id="28faa-142">The memory that is used by allocated objects on the managed heap surpasses an acceptable threshold.</span></span> <span data-ttu-id="28faa-143">Questa soglia viene continuamente modificata durante l'esecuzione del processo.</span><span class="sxs-lookup"><span data-stu-id="28faa-143">This threshold is continuously adjusted as the process runs.</span></span>

- <span data-ttu-id="28faa-144">Viene chiamato il metodo <xref:System.GC.Collect%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="28faa-144">The <xref:System.GC.Collect%2A?displayProperty=nameWithType> method is called.</span></span> <span data-ttu-id="28faa-145">Nella quasi totalità dei casi non è necessario chiamare questo metodo, in quanto il Garbage Collector viene eseguito senza interruzioni.</span><span class="sxs-lookup"><span data-stu-id="28faa-145">In almost all cases, you do not have to call this method, because the garbage collector runs continuously.</span></span> <span data-ttu-id="28faa-146">Il metodo viene usato principalmente in situazioni eccezionali e per scopi di test.</span><span class="sxs-lookup"><span data-stu-id="28faa-146">This method is primarily used for unique situations and testing.</span></span>

[<span data-ttu-id="28faa-147">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-147">Back to top</span></span>](#top)

<a name="the_managed_heap"></a>

## <a name="the-managed-heap"></a><span data-ttu-id="28faa-148">Heap gestito</span><span class="sxs-lookup"><span data-stu-id="28faa-148">The managed heap</span></span>

<span data-ttu-id="28faa-149">Dopo essere stato inizializzato da CLR, il Garbage Collector alloca un segmento di memoria per archiviare e gestire oggetti.</span><span class="sxs-lookup"><span data-stu-id="28faa-149">After the garbage collector is initialized by the CLR, it allocates a segment of memory to store and manage objects.</span></span> <span data-ttu-id="28faa-150">Questa memoria è definita heap gestito, in contrapposizione a un heap nativo presente nel sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="28faa-150">This memory is called the managed heap, as opposed to a native heap in the operating system.</span></span>

<span data-ttu-id="28faa-151">Per ogni processo gestito esiste un heap gestito.</span><span class="sxs-lookup"><span data-stu-id="28faa-151">There is a managed heap for each managed process.</span></span> <span data-ttu-id="28faa-152">Tutti i thread nel processo allocano memoria per gli oggetti sullo stesso heap.</span><span class="sxs-lookup"><span data-stu-id="28faa-152">All threads in the process allocate memory for objects on the same heap.</span></span>

<span data-ttu-id="28faa-153">Per riservare memoria, il Garbage Collector chiama la funzione [VirtualAlloc](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc) Win32 e riserva un segmento di memoria alla volta per le applicazioni gestite.</span><span class="sxs-lookup"><span data-stu-id="28faa-153">To reserve memory, the garbage collector calls the Win32 [VirtualAlloc](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc) function, and reserves one segment of memory at a time for managed applications.</span></span> <span data-ttu-id="28faa-154">Il Garbage Collector riserva inoltre i segmenti secondo le esigenze e li rilascia al sistema operativo dopo aver cancellato tutti gli oggetti, chiamando la funzione [VirtualFree](/windows/desktop/api/memoryapi/nf-memoryapi-virtualfree) Win32.</span><span class="sxs-lookup"><span data-stu-id="28faa-154">The garbage collector also reserves segments as needed, and releases segments back to the operating system (after clearing them of any objects) by calling the Win32 [VirtualFree](/windows/desktop/api/memoryapi/nf-memoryapi-virtualfree) function.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="28faa-155">La dimensione dei segmenti allocati dal Garbage Collector è specifica dell'implementazione ed è soggetta a modifiche in qualsiasi momento, tra cui aggiornamenti periodici.</span><span class="sxs-lookup"><span data-stu-id="28faa-155">The size of segments allocated by the garbage collector is implementation-specific and is subject to change at any time, including in periodic updates.</span></span> <span data-ttu-id="28faa-156">L'applicazione non deve dare per scontata o dipendere da una particolare dimensione del segmento, né provare a configurare la quantità di memoria disponibile per le allocazioni di segmenti.</span><span class="sxs-lookup"><span data-stu-id="28faa-156">Your app should never make assumptions about or depend on a particular segment size, nor should it attempt to configure the amount of memory available for segment allocations.</span></span>

<span data-ttu-id="28faa-157">Minore è il numero di oggetti allocati nell'heap, minore sarà il lavoro del Garbage Collector.</span><span class="sxs-lookup"><span data-stu-id="28faa-157">The fewer objects allocated on the heap, the less work the garbage collector has to do.</span></span> <span data-ttu-id="28faa-158">Quando si allocano oggetti, non usare valori arrotondati per eccesso che superino le proprie esigenze, ad esempio non allocare una matrice di 32 byte se sono necessari solo 15 byte.</span><span class="sxs-lookup"><span data-stu-id="28faa-158">When you allocate objects, do not use rounded-up values that exceed your needs, such as allocating an array of 32 bytes when you need only 15 bytes.</span></span>

<span data-ttu-id="28faa-159">Quando viene attivata un'operazione di Garbage Collection, il Garbage Collector recupera la memoria occupata dagli oggetti inutilizzati.</span><span class="sxs-lookup"><span data-stu-id="28faa-159">When a garbage collection is triggered, the garbage collector reclaims the memory that is occupied by dead objects.</span></span> <span data-ttu-id="28faa-160">Durante il processo di recupero, gli oggetti attivi vengono compattati in modo da poter essere spostati insieme e lo spazio inutilizzato viene rimosso, riducendo le dimensioni dell'heap.</span><span class="sxs-lookup"><span data-stu-id="28faa-160">The reclaiming process compacts live objects so that they are moved together, and the dead space is removed, thereby making the heap smaller.</span></span> <span data-ttu-id="28faa-161">In questo modo si garantisce che gli oggetti allocati insieme restino uniti nell'heap gestito, preservandone la vicinanza.</span><span class="sxs-lookup"><span data-stu-id="28faa-161">This ensures that objects that are allocated together stay together on the managed heap, to preserve their locality.</span></span>

<span data-ttu-id="28faa-162">L'impatto (frequenza e durata) delle operazioni di Garbage Collection è il risultato del volume di allocazioni e della quantità di memoria esclusa nell'heap gestito.</span><span class="sxs-lookup"><span data-stu-id="28faa-162">The intrusiveness (frequency and duration) of garbage collections is the result of the volume of allocations and the amount of survived memory on the managed heap.</span></span>

<span data-ttu-id="28faa-163">L'heap può essere considerato l'insieme di due heap: l'[heap degli oggetti grandi](large-object-heap.md) e l'heap degli oggetti piccoli.</span><span class="sxs-lookup"><span data-stu-id="28faa-163">The heap can be considered as the accumulation of two heaps: the [large object heap](large-object-heap.md) and the small object heap.</span></span>

<span data-ttu-id="28faa-164">L'[heap degli oggetti grandi](large-object-heap.md) contiene oggetti molto grandi di dimensioni pari o superiori a 85.000 byte.</span><span class="sxs-lookup"><span data-stu-id="28faa-164">The [large object heap](large-object-heap.md) contains very large objects that are 85,000 bytes and larger.</span></span> <span data-ttu-id="28faa-165">Gli oggetti sull'heap oggetti grandi sono in genere matrici.</span><span class="sxs-lookup"><span data-stu-id="28faa-165">The objects on the large object heap are usually arrays.</span></span> <span data-ttu-id="28faa-166">È raro che un oggetto istanza sia particolarmente grande.</span><span class="sxs-lookup"><span data-stu-id="28faa-166">It is rare for an instance object to be extremely large.</span></span>

[<span data-ttu-id="28faa-167">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-167">Back to top</span></span>](#top)

<a name="generations"></a>

## <a name="generations"></a><span data-ttu-id="28faa-168">Generazioni</span><span class="sxs-lookup"><span data-stu-id="28faa-168">Generations</span></span>

<span data-ttu-id="28faa-169">L'heap è organizzato in generazioni, così da poter gestire oggetti di lunga durata e di breve durata.</span><span class="sxs-lookup"><span data-stu-id="28faa-169">The heap is organized into generations so it can handle long-lived and short-lived objects.</span></span> <span data-ttu-id="28faa-170">Durante un'operazione di Garbage Collection vengono recuperati per primi gli oggetti di breve durata, che in genere occupano solo una piccola parte dell'heap.</span><span class="sxs-lookup"><span data-stu-id="28faa-170">Garbage collection primarily occurs with the reclamation of short-lived objects that typically occupy only a small part of the heap.</span></span> <span data-ttu-id="28faa-171">Esistono tre generazioni di oggetti nell'heap:</span><span class="sxs-lookup"><span data-stu-id="28faa-171">There are three generations of objects on the heap:</span></span>

- <span data-ttu-id="28faa-172">**Generazione 0**.</span><span class="sxs-lookup"><span data-stu-id="28faa-172">**Generation 0**.</span></span> <span data-ttu-id="28faa-173">È la generazione più recente e contiene oggetti di breve durata.</span><span class="sxs-lookup"><span data-stu-id="28faa-173">This is the youngest generation and contains short-lived objects.</span></span> <span data-ttu-id="28faa-174">Un esempio di oggetto di breve durata è una variabile temporanea.</span><span class="sxs-lookup"><span data-stu-id="28faa-174">An example of a short-lived object is a temporary variable.</span></span> <span data-ttu-id="28faa-175">Le operazioni di Garbage Collection vengono eseguite il più delle volte in questa generazione.</span><span class="sxs-lookup"><span data-stu-id="28faa-175">Garbage collection occurs most frequently in this generation.</span></span>

  <span data-ttu-id="28faa-176">Gli oggetti appena allocati formano una nuova generazione di oggetti e sono implicitamente raccolte di generazione 0, a meno che non siano oggetti grandi, nel qual caso vengono inseriti nell'heap degli oggetti grandi in una raccolta di generazione 2.</span><span class="sxs-lookup"><span data-stu-id="28faa-176">Newly allocated objects form a new generation of objects and are implicitly generation 0 collections, unless they are large objects, in which case they go on the large object heap in a generation 2 collection.</span></span>

  <span data-ttu-id="28faa-177">Gran parte degli oggetti vengono recuperati tramite Garbage Collection nella generazione 0 e non passano alla generazione successiva.</span><span class="sxs-lookup"><span data-stu-id="28faa-177">Most objects are reclaimed for garbage collection in generation 0 and do not survive to the next generation.</span></span>

- <span data-ttu-id="28faa-178">**Generazione 1**.</span><span class="sxs-lookup"><span data-stu-id="28faa-178">**Generation 1**.</span></span> <span data-ttu-id="28faa-179">Questa generazione contiene oggetti di breve durata e funge da buffer tra gli oggetti di breve durata e gli oggetti di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="28faa-179">This generation contains short-lived objects and serves as a buffer between short-lived objects and long-lived objects.</span></span>

- <span data-ttu-id="28faa-180">**Generazione 2**.</span><span class="sxs-lookup"><span data-stu-id="28faa-180">**Generation 2**.</span></span> <span data-ttu-id="28faa-181">Questa generazione contiene oggetti di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="28faa-181">This generation contains long-lived objects.</span></span> <span data-ttu-id="28faa-182">Un esempio di oggetto di lunga durata è un oggetto in un'applicazione server contenente dati statici che restano attivi per la durata del processo.</span><span class="sxs-lookup"><span data-stu-id="28faa-182">An example of a long-lived object is an object in a server application that contains static data that is live for the duration of the process.</span></span>

<span data-ttu-id="28faa-183">Le operazioni di Garbage Collection vengono eseguite in generazioni specifiche a seconda delle condizioni.</span><span class="sxs-lookup"><span data-stu-id="28faa-183">Garbage collections occur on specific generations as conditions warrant.</span></span> <span data-ttu-id="28faa-184">Raccogliere una generazione significa raccogliere gli oggetti in quella generazione e in tutte le generazioni più recenti.</span><span class="sxs-lookup"><span data-stu-id="28faa-184">Collecting a generation means collecting objects in that generation and all its younger generations.</span></span> <span data-ttu-id="28faa-185">Un'operazione di Garbage Collection di generazione 2 viene definita completa, in quanto recupera tutti gli oggetti in tutte le generazioni, vale a dire tutti gli oggetti nell'heap gestito.</span><span class="sxs-lookup"><span data-stu-id="28faa-185">A generation 2 garbage collection is also known as a full garbage collection, because it reclaims all objects in all generations (that is, all objects in the managed heap).</span></span>

### <a name="survival-and-promotions"></a><span data-ttu-id="28faa-186">Esclusione e promozioni</span><span class="sxs-lookup"><span data-stu-id="28faa-186">Survival and promotions</span></span>

<span data-ttu-id="28faa-187">Gli oggetti che non vengono recuperati durante un'operazione di Garbage Collection sono definiti oggetti esclusi e vengono promossi alla generazione successiva.</span><span class="sxs-lookup"><span data-stu-id="28faa-187">Objects that are not reclaimed in a garbage collection are known as survivors, and are promoted to the next generation.</span></span> <span data-ttu-id="28faa-188">Gli oggetti esclusi da un'operazione di Garbage Collection di generazione 0 vengono promossi alla generazione 1; gli oggetti esclusi da un'operazione di Garbage Collection di generazione 1 vengono promossi alla generazione 2; gli oggetti esclusi da un'operazione di Garbage Collection di generazione 2 restano nella generazione 2.</span><span class="sxs-lookup"><span data-stu-id="28faa-188">Objects that survive a generation 0 garbage collection are promoted to generation 1; objects that survive a generation 1 garbage collection are promoted to generation 2; and objects that survive a generation 2 garbage collection remain in generation 2.</span></span>

<span data-ttu-id="28faa-189">Quando il Garbage Collector rileva un tasso di esclusione elevato in una generazione, aumenta la relativa soglia delle allocazioni, in modo che la raccolta successiva generi un recupero di memoria sostanziale.</span><span class="sxs-lookup"><span data-stu-id="28faa-189">When the garbage collector detects that the survival rate is high in a generation, it increases the threshold of allocations for that generation, so the next collection gets a substantial size of reclaimed memory.</span></span> <span data-ttu-id="28faa-190">CLR bilancia continuamente due priorità: impedire che il working set di un'applicazione diventi troppo grande e limitare la durata delle operazioni di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="28faa-190">The CLR continually balances two priorities: not letting an application's working set get too big and not letting the garbage collection take too much time.</span></span>

### <a name="ephemeral-generations-and-segments"></a><span data-ttu-id="28faa-191">Generazioni e segmenti temporanei</span><span class="sxs-lookup"><span data-stu-id="28faa-191">Ephemeral generations and segments</span></span>

<span data-ttu-id="28faa-192">Poiché gli oggetti nelle generazioni 0 e 1 sono di breve durata, queste vengono definite generazioni temporanee.</span><span class="sxs-lookup"><span data-stu-id="28faa-192">Because objects in generations 0 and 1 are short-lived, these generations are known as the ephemeral generations.</span></span>

<span data-ttu-id="28faa-193">Le generazioni temporanee devono essere allocate nel segmento di memoria noto come segmento temporaneo.</span><span class="sxs-lookup"><span data-stu-id="28faa-193">Ephemeral generations must be allocated in the memory segment that is known as the ephemeral segment.</span></span> <span data-ttu-id="28faa-194">Ogni nuovo segmento acquisito dal Garbage Collector diventa il nuovo segmento temporaneo e contiene gli oggetti esclusi da un'operazione di Garbage Collection di generazione 0.</span><span class="sxs-lookup"><span data-stu-id="28faa-194">Each new segment acquired by the garbage collector becomes the new ephemeral segment and contains the objects that survived a generation 0 garbage collection.</span></span> <span data-ttu-id="28faa-195">Il segmento temporaneo precedente diventa il nuovo segmento di generazione 2.</span><span class="sxs-lookup"><span data-stu-id="28faa-195">The old ephemeral segment becomes the new generation 2 segment.</span></span>

<span data-ttu-id="28faa-196">La dimensione del segmento temporaneo varia a seconda del sistema, a 32 o a 64 bit, e al tipo di procedura di Garbage Collector in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="28faa-196">The size of the ephemeral segment varies depending on whether a system is 32- or 64-bit, and on the type of garbage collector it is running.</span></span> <span data-ttu-id="28faa-197">Nella tabella che segue sono riportati i valori predefiniti.</span><span class="sxs-lookup"><span data-stu-id="28faa-197">Default values are shown in the following table.</span></span>

||<span data-ttu-id="28faa-198">32 bit</span><span class="sxs-lookup"><span data-stu-id="28faa-198">32-bit</span></span>|<span data-ttu-id="28faa-199">64 bit</span><span class="sxs-lookup"><span data-stu-id="28faa-199">64-bit</span></span>|
|-|-------------|-------------|
|<span data-ttu-id="28faa-200">GC workstation</span><span class="sxs-lookup"><span data-stu-id="28faa-200">Workstation GC</span></span>|<span data-ttu-id="28faa-201">16 MB</span><span class="sxs-lookup"><span data-stu-id="28faa-201">16 MB</span></span>|<span data-ttu-id="28faa-202">256 MB</span><span class="sxs-lookup"><span data-stu-id="28faa-202">256 MB</span></span>|
|<span data-ttu-id="28faa-203">GC server</span><span class="sxs-lookup"><span data-stu-id="28faa-203">Server GC</span></span>|<span data-ttu-id="28faa-204">64 MB</span><span class="sxs-lookup"><span data-stu-id="28faa-204">64 MB</span></span>|<span data-ttu-id="28faa-205">4 GB</span><span class="sxs-lookup"><span data-stu-id="28faa-205">4 GB</span></span>|
|<span data-ttu-id="28faa-206">GC server con > 4 CPU logiche</span><span class="sxs-lookup"><span data-stu-id="28faa-206">Server GC with > 4 logical CPUs</span></span>|<span data-ttu-id="28faa-207">32 MB</span><span class="sxs-lookup"><span data-stu-id="28faa-207">32 MB</span></span>|<span data-ttu-id="28faa-208">2 GB</span><span class="sxs-lookup"><span data-stu-id="28faa-208">2 GB</span></span>|
|<span data-ttu-id="28faa-209">GC server con > 8 CPU logiche</span><span class="sxs-lookup"><span data-stu-id="28faa-209">Server GC with > 8 logical CPUs</span></span>|<span data-ttu-id="28faa-210">16 MB</span><span class="sxs-lookup"><span data-stu-id="28faa-210">16 MB</span></span>|<span data-ttu-id="28faa-211">1 GB</span><span class="sxs-lookup"><span data-stu-id="28faa-211">1 GB</span></span>|

<span data-ttu-id="28faa-212">Il segmento temporaneo può includere oggetti di generazione 2,</span><span class="sxs-lookup"><span data-stu-id="28faa-212">The ephemeral segment can include generation 2 objects.</span></span> <span data-ttu-id="28faa-213">i quali possono usare più segmenti (nella misura richiesta dal processo e consentita dalla memoria).</span><span class="sxs-lookup"><span data-stu-id="28faa-213">Generation 2 objects can use multiple segments (as many as your process requires and memory allows for).</span></span>

<span data-ttu-id="28faa-214">La quantità di memoria liberata da un'operazione di Garbage Collection temporanea è limitata alla dimensione del segmento temporaneo.</span><span class="sxs-lookup"><span data-stu-id="28faa-214">The amount of freed memory from an ephemeral garbage collection is limited to the size of the ephemeral segment.</span></span> <span data-ttu-id="28faa-215">Tale quantità di memoria è proporzionale allo spazio occupato dagli oggetti inutilizzati.</span><span class="sxs-lookup"><span data-stu-id="28faa-215">The amount of memory that is freed is proportional to the space that was occupied by the dead objects.</span></span>

[<span data-ttu-id="28faa-216">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-216">Back to top</span></span>](#top)

<a name="what_happens_during_a_garbage_collection"></a>

## <a name="what-happens-during-a-garbage-collection"></a><span data-ttu-id="28faa-217">Fasi di un'operazione di Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="28faa-217">What happens during a garbage collection</span></span>

<span data-ttu-id="28faa-218">Un'operazione di Garbage Collection si compone delle seguenti fasi:</span><span class="sxs-lookup"><span data-stu-id="28faa-218">A garbage collection has the following phases:</span></span>

- <span data-ttu-id="28faa-219">Una fase di contrassegno in cui vengono individuati tutti gli oggetti attivi e ne viene creato un elenco.</span><span class="sxs-lookup"><span data-stu-id="28faa-219">A marking phase that finds and creates a list of all live objects.</span></span>

- <span data-ttu-id="28faa-220">Una fase di rilocazione in cui vengono aggiornati i riferimenti agli oggetti che saranno compattati.</span><span class="sxs-lookup"><span data-stu-id="28faa-220">A relocating phase that updates the references to the objects that will be compacted.</span></span>

- <span data-ttu-id="28faa-221">Una fase di compattazione in cui lo spazio occupato dagli oggetti inutilizzati viene recuperato e gli oggetti esclusi compattati.</span><span class="sxs-lookup"><span data-stu-id="28faa-221">A compacting phase that reclaims the space occupied by the dead objects and compacts the surviving objects.</span></span> <span data-ttu-id="28faa-222">Durante questa fase, gli oggetti rimasti dopo un'operazione di Garbage Collection vengono spostati verso l'estremità meno recente del segmento.</span><span class="sxs-lookup"><span data-stu-id="28faa-222">The compacting phase moves objects that have survived a garbage collection toward the older end of the segment.</span></span>

  <span data-ttu-id="28faa-223">Poiché le raccolte di generazione 2 possono occupare più segmenti, gli oggetti promossi alla generazione 2 possono essere spostati in un segmento meno recente.</span><span class="sxs-lookup"><span data-stu-id="28faa-223">Because generation 2 collections can occupy multiple segments, objects that are promoted into generation 2 can be moved into an older segment.</span></span> <span data-ttu-id="28faa-224">Gli oggetti esclusi di generazione 1 e 2 possono essere spostati in un segmento diverso, in quanto vengono promossi alla generazione 2.</span><span class="sxs-lookup"><span data-stu-id="28faa-224">Both generation 1 and generation 2 survivors can be moved to a different segment, because they are promoted to generation 2.</span></span>

  <span data-ttu-id="28faa-225">L'heap oggetti grandi non viene in genere compresso perché la copia di oggetti grandi impone un calo delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="28faa-225">Ordinarily, the large object heap is not compacted, because copying large objects imposes a performance penalty.</span></span> <span data-ttu-id="28faa-226">Tuttavia, a partire da .NET Framework 4.5.1, è possibile usare la proprietà <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> per comprimere l'heap di oggetti di grandi dimensioni su richiesta.</span><span class="sxs-lookup"><span data-stu-id="28faa-226">However, starting with the .NET Framework 4.5.1, you can use the <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> property to compact the large object heap on demand.</span></span>

<span data-ttu-id="28faa-227">Per stabilire se gli oggetti sono attivi, il Garbage Collector usa le seguenti informazioni:</span><span class="sxs-lookup"><span data-stu-id="28faa-227">The garbage collector uses the following information to determine whether objects are live:</span></span>

- <span data-ttu-id="28faa-228">**Radici dello stack**.</span><span class="sxs-lookup"><span data-stu-id="28faa-228">**Stack roots**.</span></span> <span data-ttu-id="28faa-229">Variabili dello stack fornite dal compilatore JIT e dal percorso di chiamate nello stack.</span><span class="sxs-lookup"><span data-stu-id="28faa-229">Stack variables provided by the just-in-time (JIT) compiler and stack walker.</span></span> <span data-ttu-id="28faa-230">Si noti che le ottimizzazioni JIT possono allungare o abbreviare le aree di codice in cui le variabili dello stack vengono segnalate al Garbage Collector.</span><span class="sxs-lookup"><span data-stu-id="28faa-230">Note that JIT optimizations can lengthen or shorten regions of code within which stack variables are reported to the garbage collector.</span></span>

- <span data-ttu-id="28faa-231">**Handle di Garbage Collection**.</span><span class="sxs-lookup"><span data-stu-id="28faa-231">**Garbage collection handles**.</span></span> <span data-ttu-id="28faa-232">Handle che puntano agli oggetti gestiti e che possono essere allocati mediante codice utente o Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="28faa-232">Handles that point to managed objects and that can be allocated by user code or by the common language runtime.</span></span>

- <span data-ttu-id="28faa-233">**Dati statici**.</span><span class="sxs-lookup"><span data-stu-id="28faa-233">**Static data**.</span></span> <span data-ttu-id="28faa-234">Oggetti statici nei domini applicazione che possono fare riferimento ad altri oggetti.</span><span class="sxs-lookup"><span data-stu-id="28faa-234">Static objects in application domains that could be referencing other objects.</span></span> <span data-ttu-id="28faa-235">Ogni dominio applicazione tiene traccia dei rispettivi oggetti statici.</span><span class="sxs-lookup"><span data-stu-id="28faa-235">Each application domain keeps track of its static objects.</span></span>

<span data-ttu-id="28faa-236">Prima di eseguire un'operazione di Garbage Collection, tutti i thread gestiti vengono sospesi, eccetto il thread che attiva l'operazione.</span><span class="sxs-lookup"><span data-stu-id="28faa-236">Before a garbage collection starts, all managed threads are suspended except for the thread that triggered the garbage collection.</span></span>

<span data-ttu-id="28faa-237">Nell'illustrazione seguente viene illustrato un thread che attiva un'operazione di Garbage Collection causando la sospensione degli altri thread.</span><span class="sxs-lookup"><span data-stu-id="28faa-237">The following illustration shows a thread that triggers a garbage collection and causes the other threads to be suspended.</span></span>

<span data-ttu-id="28faa-238">![Quando un thread attiva un'operazione di Garbage Collection](../../../docs/standard/garbage-collection/media/gc-triggered.png "quando un thread attiva un'operazione di Garbage Collection")</span><span class="sxs-lookup"><span data-stu-id="28faa-238">![When a thread triggers a Garbage Collection](../../../docs/standard/garbage-collection/media/gc-triggered.png "When a thread triggers a Garbage Collection")</span></span>

[<span data-ttu-id="28faa-239">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-239">Back to top</span></span>](#top)

<a name="manipulating_unmanaged_resources"></a>

## <a name="manipulating-unmanaged-resources"></a><span data-ttu-id="28faa-240">Modifica delle risorse non gestite</span><span class="sxs-lookup"><span data-stu-id="28faa-240">Manipulating unmanaged resources</span></span>

<span data-ttu-id="28faa-241">Se gli oggetti gestiti fanno riferimento a oggetti non gestiti tramite i relativi handle di file nativi, è necessario liberare in modo esplicito gli oggetti non gestiti, poiché il Garbage Collector tiene traccia della memoria solo sull'heap gestito.</span><span class="sxs-lookup"><span data-stu-id="28faa-241">If your managed objects reference unmanaged objects by using their native file handles, you have to explicitly free the unmanaged objects, because the garbage collector tracks memory only on the managed heap.</span></span>

<span data-ttu-id="28faa-242">È possibile che gli utenti dell'oggetto gestito non eliminino le risorse native usate dall'oggetto.</span><span class="sxs-lookup"><span data-stu-id="28faa-242">Users of your managed object may not dispose the native resources used by the object.</span></span> <span data-ttu-id="28faa-243">Per eseguire la pulizia, è possibile rendere l'oggetto gestito finalizzabile.</span><span class="sxs-lookup"><span data-stu-id="28faa-243">To perform the cleanup, you can make your managed object finalizable.</span></span> <span data-ttu-id="28faa-244">La finalizzazione consiste in azioni di pulizia che si eseguono quando l'oggetto non è più usato.</span><span class="sxs-lookup"><span data-stu-id="28faa-244">Finalization consists of cleanup actions that you execute when the object is no longer in use.</span></span> <span data-ttu-id="28faa-245">Quando l'oggetto gestito cessa di essere usato, esegue azioni di pulizia specificate nel metodo del relativo finalizzatore.</span><span class="sxs-lookup"><span data-stu-id="28faa-245">When your managed object dies, it performs cleanup actions that are specified in its finalizer method.</span></span>

<span data-ttu-id="28faa-246">Quando viene individuato un oggetto finalizzabile inutilizzato, il relativo finalizzatore viene inserito in una coda in modo che vengano eseguite le azioni di pulizia, mentre l'oggetto stesso viene promosso alla generazione successiva.</span><span class="sxs-lookup"><span data-stu-id="28faa-246">When a finalizable object is discovered to be dead, its finalizer is put in a queue so that its cleanup actions are executed, but the object itself is promoted to the next generation.</span></span> <span data-ttu-id="28faa-247">Sarà pertanto necessario attendere l'operazione di Garbage Collection successiva eseguita in tale generazione, che non sarà necessariamente l'operazione immediatamente successiva, per stabilire se l'oggetto è stato recuperato.</span><span class="sxs-lookup"><span data-stu-id="28faa-247">Therefore, you have to wait until the next garbage collection that occurs on that generation (which is not necessarily the next garbage collection) to determine whether the object has been reclaimed.</span></span>

[<span data-ttu-id="28faa-248">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-248">Back to top</span></span>](#top)

<a name="workstation_and_server_garbage_collection"></a>

## <a name="workstation-and-server-garbage-collection"></a><span data-ttu-id="28faa-249">Operazione di Garbage Collection per workstation e server</span><span class="sxs-lookup"><span data-stu-id="28faa-249">Workstation and server garbage collection</span></span>

<span data-ttu-id="28faa-250">Il Garbage Collector si regola da sé e può funzionare in un'ampia varietà di scenari.</span><span class="sxs-lookup"><span data-stu-id="28faa-250">The garbage collector is self-tuning and can work in a wide variety of scenarios.</span></span> <span data-ttu-id="28faa-251">È possibile usare un'impostazione del file di configurazione per impostare il tipo di operazione di Garbage Collection, in base alle caratteristiche del carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="28faa-251">You can use a configuration file setting to set the type of garbage collection based on the characteristics of the workload.</span></span> <span data-ttu-id="28faa-252">CLR fornisce i seguenti tipi di Garbage Collection:</span><span class="sxs-lookup"><span data-stu-id="28faa-252">The CLR provides the following types of garbage collection:</span></span>

- <span data-ttu-id="28faa-253">Garbage Collection per workstation, per tutte le workstation client e i PC autonomi.</span><span class="sxs-lookup"><span data-stu-id="28faa-253">Workstation garbage collection, which is for all client workstations and stand-alone PCs.</span></span> <span data-ttu-id="28faa-254">Si tratta dell'impostazione predefinita per l'[elemento \<gcServer>](../../../docs/framework/configure-apps/file-schema/runtime/gcserver-element.md) nello schema di configurazione di runtime.</span><span class="sxs-lookup"><span data-stu-id="28faa-254">This is the default setting for the [\<gcServer> element](../../../docs/framework/configure-apps/file-schema/runtime/gcserver-element.md) in the runtime configuration schema.</span></span>

  <span data-ttu-id="28faa-255">Le operazioni di Garbage Collection per workstation possono essere eseguite in modalità simultanea o non simultanea.</span><span class="sxs-lookup"><span data-stu-id="28faa-255">Workstation garbage collection can be concurrent or non-concurrent.</span></span> <span data-ttu-id="28faa-256">La modalità simultanea consente ai thread gestiti di continuare le operazioni durante un'operazione di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="28faa-256">Concurrent garbage collection enables managed threads to continue operations during a garbage collection.</span></span>

  <span data-ttu-id="28faa-257">A partire da .NET Framework 4, la modalità simultanea è sostituita dalla modalità in background.</span><span class="sxs-lookup"><span data-stu-id="28faa-257">Starting with the .NET Framework 4, background garbage collection replaces concurrent garbage collection.</span></span>

- <span data-ttu-id="28faa-258">Garbage Collection per server, per le applicazioni server che richiedono scalabilità e velocità effettiva elevata.</span><span class="sxs-lookup"><span data-stu-id="28faa-258">Server garbage collection, which is intended for server applications that need high throughput and scalability.</span></span> <span data-ttu-id="28faa-259">L'operazione di Garbage Collection per server può essere eseguita non in modalità di concorrenza o in background.</span><span class="sxs-lookup"><span data-stu-id="28faa-259">Server garbage collection can be non-concurrent or background.</span></span>

<span data-ttu-id="28faa-260">La seguente illustrazione mostra i thread dedicati che eseguono l'operazione di Garbage Collection in un server.</span><span class="sxs-lookup"><span data-stu-id="28faa-260">The following illustration shows the dedicated threads that perform the garbage collection on a server.</span></span>

<span data-ttu-id="28faa-261">(../../../docs/standard/garbage-collection/media/gc-server.png "Thread di Garbage Collection") server ![thread di Garbage Collection]server</span><span class="sxs-lookup"><span data-stu-id="28faa-261">![Server Garbage Collection Threads](../../../docs/standard/garbage-collection/media/gc-server.png "Server Garbage Collection Threads")</span></span>

### <a name="configuring-garbage-collection"></a><span data-ttu-id="28faa-262">Configurazione dell'operazione di Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="28faa-262">Configuring garbage collection</span></span>

<span data-ttu-id="28faa-263">È possibile usare l'[elemento \<gcServer](../../../docs/framework/configure-apps/file-schema/runtime/gcserver-element.md) dello schema di configurazione di runtime per specificare il tipo di operazione di Garbage Collection da eseguire tramite CLR.</span><span class="sxs-lookup"><span data-stu-id="28faa-263">You can use the [\<gcServer> element](../../../docs/framework/configure-apps/file-schema/runtime/gcserver-element.md) of the runtime configuration schema to specify the type of garbage collection you want the CLR to perform.</span></span> <span data-ttu-id="28faa-264">Quando l'attributo `enabled` di questo elemento è impostato su `false` (impostazione predefinita), CLR esegue un'operazione di Garbage Collection per workstation.</span><span class="sxs-lookup"><span data-stu-id="28faa-264">When this element's `enabled` attribute is set to `false` (the default), the CLR performs workstation garbage collection.</span></span> <span data-ttu-id="28faa-265">Quando si imposta l'attributo `enabled` su `true`, CLR esegue un'operazione di Garbage Collection per server.</span><span class="sxs-lookup"><span data-stu-id="28faa-265">When you set the `enabled` attribute to `true`, the CLR performs server garbage collection.</span></span>

<span data-ttu-id="28faa-266">La modalità di concorrenza viene specificata con l'[elemento \<gcConcurrent>](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) dello schema di configurazione di runtime.</span><span class="sxs-lookup"><span data-stu-id="28faa-266">Concurrent garbage collection is specified with the [\<gcConcurrent> element](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) of the runtime configuration schema.</span></span> <span data-ttu-id="28faa-267">L'impostazione predefinita è `enabled`.</span><span class="sxs-lookup"><span data-stu-id="28faa-267">The default setting is `enabled`.</span></span> <span data-ttu-id="28faa-268">Questa impostazione controlla sia l'operazione di Garbage Collection simultanea che quella in background.</span><span class="sxs-lookup"><span data-stu-id="28faa-268">This setting controls both concurrent and background garbage collection.</span></span>

<span data-ttu-id="28faa-269">È anche possibile specificare operazioni di Garbage Collection per server con interfacce di hosting non gestite.</span><span class="sxs-lookup"><span data-stu-id="28faa-269">You can also specify server garbage collection with unmanaged hosting interfaces.</span></span> <span data-ttu-id="28faa-270">Si noti che ASP.NET e SQL Server abilitano automaticamente le operazioni di Garbage Collection per server se l'applicazione è ospitata in uno di questi ambienti.</span><span class="sxs-lookup"><span data-stu-id="28faa-270">Note that ASP.NET and SQL Server enable server garbage collection automatically if your application is hosted inside one of these environments.</span></span>

### <a name="comparing-workstation-and-server-garbage-collection"></a><span data-ttu-id="28faa-271">Confronto tra operazioni di Garbage Collection per workstation e server</span><span class="sxs-lookup"><span data-stu-id="28faa-271">Comparing workstation and server garbage collection</span></span>

<span data-ttu-id="28faa-272">Di seguito sono riportate alcune considerazioni su threading e prestazioni per l'operazione di Garbage Collection per workstation:</span><span class="sxs-lookup"><span data-stu-id="28faa-272">The following are threading and performance considerations for workstation garbage collection:</span></span>

- <span data-ttu-id="28faa-273">La raccolta viene eseguita nel thread dell'utente che ha attivato l'operazione di Garbage Collection e mantiene la stessa priorità.</span><span class="sxs-lookup"><span data-stu-id="28faa-273">The collection occurs on the user thread that triggered the garbage collection and remains at the same priority.</span></span> <span data-ttu-id="28faa-274">Poiché i thread dell'utente vengono in genere eseguiti con priorità normale, il Garbage Collector (eseguito in un thread con priorità normale) deve competere con altri thread per il tempo CPU.</span><span class="sxs-lookup"><span data-stu-id="28faa-274">Because user threads typically run at normal priority, the garbage collector (which runs on a normal priority thread) must compete with other threads for CPU time.</span></span>

  <span data-ttu-id="28faa-275">I thread che eseguono codice nativo non vengono sospesi.</span><span class="sxs-lookup"><span data-stu-id="28faa-275">Threads that are running native code are not suspended.</span></span>

- <span data-ttu-id="28faa-276">Le operazioni di Garbage Collection per workstation vengono sempre eseguite in computer con un solo processore, indipendentemente dall'impostazione di [\<gcServer>](../../../docs/framework/configure-apps/file-schema/runtime/gcserver-element.md).</span><span class="sxs-lookup"><span data-stu-id="28faa-276">Workstation garbage collection is always used on a computer that has only one processor, regardless of the [\<gcServer>](../../../docs/framework/configure-apps/file-schema/runtime/gcserver-element.md) setting.</span></span> <span data-ttu-id="28faa-277">Se si specifica un'operazione di Garbage Collection per server, tramite CLR viene usata la modalità per workstation, con la modalità simultanea disabilitata.</span><span class="sxs-lookup"><span data-stu-id="28faa-277">If you specify server garbage collection, the CLR uses workstation garbage collection with concurrency disabled.</span></span>

<span data-ttu-id="28faa-278">Di seguito sono riportate alcune considerazioni su threading e prestazioni per l'operazione di Garbage Collection per server:</span><span class="sxs-lookup"><span data-stu-id="28faa-278">The following are threading and performance considerations for server garbage collection:</span></span>

- <span data-ttu-id="28faa-279">La raccolta viene eseguita in più thread dedicati eseguiti con livello di priorità `THREAD_PRIORITY_HIGHEST` .</span><span class="sxs-lookup"><span data-stu-id="28faa-279">The collection occurs on multiple dedicated threads that are running at `THREAD_PRIORITY_HIGHEST` priority level.</span></span>

- <span data-ttu-id="28faa-280">Per ogni CPU vengono forniti un heap e un thread dedicato per l'esecuzione dell'operazione di Garbage Collection. Gli heap vengono raccolti contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="28faa-280">A heap and a dedicated thread to perform garbage collection are provided for each CPU, and the heaps are collected at the same time.</span></span> <span data-ttu-id="28faa-281">Ogni heap contiene un heap degli oggetti piccoli e un heap degli oggetti grandi; è possibile accedere a tutti gli heap tramite codice utente.</span><span class="sxs-lookup"><span data-stu-id="28faa-281">Each heap contains a small object heap and a large object heap, and all heaps can be accessed by user code.</span></span> <span data-ttu-id="28faa-282">Gli oggetti contenuti in heap diversi possono fare riferimento l'un l'altro.</span><span class="sxs-lookup"><span data-stu-id="28faa-282">Objects on different heaps can refer to each other.</span></span>

- <span data-ttu-id="28faa-283">Grazie all'utilizzo congiunto di più thread di Garbage Collection, le operazioni di Garbage Collection per server saranno più veloci delle operazioni per workstation in un heap di pari dimensioni.</span><span class="sxs-lookup"><span data-stu-id="28faa-283">Because multiple garbage collection threads work together, server garbage collection is faster than workstation garbage collection on the same size heap.</span></span>

- <span data-ttu-id="28faa-284">I segmenti di Garbage Collection per server sono spesso di dimensioni maggiori.</span><span class="sxs-lookup"><span data-stu-id="28faa-284">Server garbage collection often has larger size segments.</span></span> <span data-ttu-id="28faa-285">Si noti, tuttavia, che è solo una generalizzazione: le dimensioni dei segmenti sono specifiche dell'implementazione e soggette a modifiche.</span><span class="sxs-lookup"><span data-stu-id="28faa-285">Note, however, that this is only a generalization: segment size is implementation-specific and is subject to change.</span></span> <span data-ttu-id="28faa-286">È consigliabile non fare supposizioni sulle dimensioni dei segmenti allocati dal Garbage Collector durante l'ottimizzazione dell'app.</span><span class="sxs-lookup"><span data-stu-id="28faa-286">You should make no assumptions about the size of segments allocated by the garbage collector when tuning your app.</span></span>

- <span data-ttu-id="28faa-287">Le operazioni di Garbage Collection per server possono richiedere un utilizzo di risorse elevato.</span><span class="sxs-lookup"><span data-stu-id="28faa-287">Server garbage collection can be resource-intensive.</span></span> <span data-ttu-id="28faa-288">Ad esempio, se si hanno 12 processi in esecuzione in un computer dotato di 4 processori, si avranno 48 thread di Garbage Collection dedicati, a condizione che tutti utilizzino operazioni di Garbage Collection per server.</span><span class="sxs-lookup"><span data-stu-id="28faa-288">For example, if you have 12 processes running on a computer that has 4 processors, there will be 48 dedicated garbage collection threads if they are all using server garbage collection.</span></span> <span data-ttu-id="28faa-289">In una situazione di caricamento di memoria elevato, se tutti i processi eseguono operazioni di Garbage Collection, il Garbage Collector avrà 48 thread da pianificare.</span><span class="sxs-lookup"><span data-stu-id="28faa-289">In a high memory load situation, if all the processes start doing garbage collection, the garbage collector will have 48 threads to schedule.</span></span>

<span data-ttu-id="28faa-290">Se si eseguono centinaia di istanze di un'applicazione, è consigliabile usare operazioni di Garbage Collection per workstation con la modalità simultanea disabilitata.</span><span class="sxs-lookup"><span data-stu-id="28faa-290">If you are running hundreds of instances of an application, consider using workstation garbage collection with concurrent garbage collection disabled.</span></span> <span data-ttu-id="28faa-291">Si avranno meno cambi di contesto e un possibile miglioramento delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="28faa-291">This will result in less context switching, which can improve performance.</span></span>

[<span data-ttu-id="28faa-292">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-292">Back to top</span></span>](#top)

<a name="concurrent_garbage_collection"></a>

## <a name="concurrent-garbage-collection"></a><span data-ttu-id="28faa-293">Garbage Collection contemporanea</span><span class="sxs-lookup"><span data-stu-id="28faa-293">Concurrent garbage collection</span></span>

<span data-ttu-id="28faa-294">Nelle operazioni di Garbage Collection per workstation o server è possibile abilitare la modalità di concorrenza che consente l'esecuzione dei thread contemporaneamente a un thread dedicato che esegue l'operazione di Garbage Collection per la maggior parte della durata dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="28faa-294">In workstation or server garbage collection, you can enable concurrent garbage collection, which enables threads to run concurrently with a dedicated thread that performs the garbage collection for most of the duration of the collection.</span></span> <span data-ttu-id="28faa-295">Questa opzione riguarda solo le operazioni di Garbage Collection nella generazione 2; le generazioni 0 e 1 sono sempre non simultanee in quanto terminano molto velocemente.</span><span class="sxs-lookup"><span data-stu-id="28faa-295">This option affects only garbage collections in generation 2; generations 0 and 1 are always non-concurrent because they finish very fast.</span></span>

<span data-ttu-id="28faa-296">La modalità simultanea consente alle applicazioni interattive una maggiore efficienza di risposta riducendo al minimo le pause di una raccolta.</span><span class="sxs-lookup"><span data-stu-id="28faa-296">Concurrent garbage collection enables interactive applications to be more responsive by minimizing pauses for a collection.</span></span> <span data-ttu-id="28faa-297">È possibile continuare a eseguire i thread gestiti per la maggior parte del tempo in cui viene eseguito il thread di Garbage Collection in modalità simultanea.</span><span class="sxs-lookup"><span data-stu-id="28faa-297">Managed threads can continue to run most of the time while the concurrent garbage collection thread is running.</span></span> <span data-ttu-id="28faa-298">Il risultato saranno pause più brevi durante l'esecuzione di un'operazione di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="28faa-298">This results in shorter pauses while a garbage collection is occurring.</span></span>

<span data-ttu-id="28faa-299">Per migliorare le prestazioni in caso di esecuzione di numerosi processi, disabilitare la modalità simultanea.</span><span class="sxs-lookup"><span data-stu-id="28faa-299">To improve performance when several processes are running, disable concurrent garbage collection.</span></span> <span data-ttu-id="28faa-300">A questo scopo, è possibile aggiungere un [\<elemento gcConcurrent>](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) al file di configurazione dell'app e impostare il valore dell'attributo `enabled` su `"false"`.</span><span class="sxs-lookup"><span data-stu-id="28faa-300">You can do this by adding a [\<gcConcurrent> element](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) to the app's configuration file and setting the value of its `enabled` attribute to `"false"`.</span></span>

<span data-ttu-id="28faa-301">La modalità simultanea di Garbage Collection viene eseguita in un thread dedicato.</span><span class="sxs-lookup"><span data-stu-id="28faa-301">Concurrent garbage collection is performed on a dedicated thread.</span></span> <span data-ttu-id="28faa-302">Per impostazione predefinita, CLR esegue le operazioni di Garbage Collection per workstation con la modalità simultanea abilitata.</span><span class="sxs-lookup"><span data-stu-id="28faa-302">By default, the CLR runs workstation garbage collection with concurrent garbage collection enabled.</span></span> <span data-ttu-id="28faa-303">Ciò vale tanto per i computer a processore singolo quanto per quelli multiprocessore.</span><span class="sxs-lookup"><span data-stu-id="28faa-303">This is true for single-processor and multi-processor computers.</span></span>

<span data-ttu-id="28faa-304">La possibilità di allocare piccoli oggetti nell'heap durante un'operazione di Garbage Collection simultanea è limitata dagli oggetti che rimangono nel segmento temporaneo quando ha inizio tale operazione.</span><span class="sxs-lookup"><span data-stu-id="28faa-304">Your ability to allocate small objects on the heap during a concurrent garbage collection is limited by the objects left on the ephemeral segment when a concurrent garbage collection starts.</span></span> <span data-ttu-id="28faa-305">Non appena si raggiunge la fine del segmento, sarà necessario attendere il termine dell'operazione di Garbage Collection simultanea, mentre i thread gestiti responsabili delle allocazioni degli oggetti piccoli vengono sospesi.</span><span class="sxs-lookup"><span data-stu-id="28faa-305">As soon as you reach the end of the segment, you will have to wait for the concurrent garbage collection to finish while managed threads that have to make small object allocations are suspended.</span></span>

<span data-ttu-id="28faa-306">Le operazioni di Garbage Collection simultanee dispongono di un working set leggermente più ampio rispetto alle operazioni non simultanee, in quanto durante la raccolta simultanea è possibile allocare oggetti.</span><span class="sxs-lookup"><span data-stu-id="28faa-306">Concurrent garbage collection has a slightly bigger working set (compared with non-concurrent garbage collection), because you can allocate objects during concurrent collection.</span></span> <span data-ttu-id="28faa-307">Tuttavia questo può influire sulle prestazioni, poiché gli oggetti allocati diventano parte del working set.</span><span class="sxs-lookup"><span data-stu-id="28faa-307">However, this can affect performance, because the objects that you allocate become part of your working set.</span></span> <span data-ttu-id="28faa-308">Essenzialmente, la modalità simultanea sacrifica parte della CPU e della memoria in favore di pause più brevi.</span><span class="sxs-lookup"><span data-stu-id="28faa-308">Essentially, concurrent garbage collection trades some CPU and memory for shorter pauses.</span></span>

<span data-ttu-id="28faa-309">Nell'illustrazione riportata di seguito viene mostrata l'esecuzione simultanea di un'operazione di Garbage Collection in un thread dedicato separato.</span><span class="sxs-lookup"><span data-stu-id="28faa-309">The following illustration shows concurrent garbage collection performed on a separate dedicated thread.</span></span>

<span data-ttu-id="28faa-310">Thread di Garbage ![Collection simultanei](../../../docs/standard/garbage-collection/media/gc-concurrent.png "simultanei thread di Garbage Collection")</span><span class="sxs-lookup"><span data-stu-id="28faa-310">![Concurrent Garbage Collection Threads](../../../docs/standard/garbage-collection/media/gc-concurrent.png "Concurrent Garbage Collection Threads")</span></span>

[<span data-ttu-id="28faa-311">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-311">Back to top</span></span>](#top)

<a name="background_garbage_collection"></a>

## <a name="background-workstation-garbage-collection"></a><span data-ttu-id="28faa-312">Garbage Collection della workstation in background</span><span class="sxs-lookup"><span data-stu-id="28faa-312">Background workstation garbage collection</span></span>

<span data-ttu-id="28faa-313">Garbage Collection in background sostituisce Garbage Collection workstation simultanee a partire dal .NET Framework 4 e sostituisce Garbage Collection server simultanei a partire dal .NET Framework 4,5.</span><span class="sxs-lookup"><span data-stu-id="28faa-313">Background garbage collection replaces concurrent workstation garbage collection starting with the .NET Framework 4, and it replaces concurrent server garbage collection starting with the .NET Framework 4.5.</span></span>  <span data-ttu-id="28faa-314">In un'operazione di Garbage Collection in background, le generazioni temporanee (0 e 1) vengono raccolte in base alle esigenze mentre è in corso la raccolta di generazione 2.</span><span class="sxs-lookup"><span data-stu-id="28faa-314">In background garbage collection, ephemeral generations (0 and 1) are collected as needed while the collection of generation 2 is in progress.</span></span> <span data-ttu-id="28faa-315">Viene eseguita su un thread dedicato ed è applicabile solo alle raccolte di generazione 2.</span><span class="sxs-lookup"><span data-stu-id="28faa-315">It is performed on a dedicated thread and is applicable only to generation 2 collections.</span></span> <span data-ttu-id="28faa-316">Il Garbage Collection in background viene abilitato automaticamente per impostazione predefinita e può essere abilitato o disabilitato con l'impostazione di configurazione [> \<gcConcurrent](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) in applicazioni .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="28faa-316">Background garbage collection is automatically enabled by default, and can be enabled or disabled with the [\<gcConcurrent>](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) configuration setting in .NET Framework applications.</span></span> 

> [!NOTE]
> <span data-ttu-id="28faa-317">Le operazioni di Garbage Collection in background sono disponibili solo in .NET Framework 4 e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="28faa-317">Background garbage collection is available only in the .NET Framework 4 and later versions.</span></span> <span data-ttu-id="28faa-318">In .NET Framework 4 è supportato solo per l'operazione di Garbage Collection per workstation.</span><span class="sxs-lookup"><span data-stu-id="28faa-318">In the .NET Framework 4, it is supported only for workstation garbage collection.</span></span> <span data-ttu-id="28faa-319">A partire da .NET Framework 4.5, l'operazione di Garbage Collection in background è disponibile sia per workstation sia per server.</span><span class="sxs-lookup"><span data-stu-id="28faa-319">Starting with the .NET Framework 4.5, background garbage collection is available for both workstation and server garbage collection.</span></span>

<span data-ttu-id="28faa-320">Una raccolta nelle generazioni temporanee durante un'operazione in background è definita Garbage Collection in primo piano.</span><span class="sxs-lookup"><span data-stu-id="28faa-320">A collection on ephemeral generations during background garbage collection is known as foreground garbage collection.</span></span> <span data-ttu-id="28faa-321">Durante l'esecuzione di un'operazione di Garbage Collection in primo piano, tutti i thread gestiti vengono sospesi.</span><span class="sxs-lookup"><span data-stu-id="28faa-321">When foreground garbage collections occur, all managed threads are suspended.</span></span>

<span data-ttu-id="28faa-322">Quando è in corso un'operazione in background ed è stato allocato un numero sufficiente di oggetti nella generazione 0, CLR esegue un'operazione di Garbage Collection in primo piano della generazione 0 o 1.</span><span class="sxs-lookup"><span data-stu-id="28faa-322">When background garbage collection is in progress and you have allocated enough objects in generation 0, the CLR performs a generation 0 or generation 1 foreground garbage collection.</span></span> <span data-ttu-id="28faa-323">Il thread di Garbage Collection in background dedicato esegue controlli in corrispondenza di punti sicuri frequenti per stabilire se vi sia una richiesta di Garbage Collection in primo piano.</span><span class="sxs-lookup"><span data-stu-id="28faa-323">The dedicated background garbage collection thread checks at frequent safe points to determine whether there is a request for foreground garbage collection.</span></span> <span data-ttu-id="28faa-324">In caso affermativo, la raccolta in background si autosospende in modo che possa essere eseguita l'operazione in primo piano.</span><span class="sxs-lookup"><span data-stu-id="28faa-324">If there is, the background collection suspends itself so that foreground garbage collection can occur.</span></span> <span data-ttu-id="28faa-325">Una volta completata tale operazione, si ha la ripresa del thread di Garbage Collection in background dedicato e dei thread dell'utente.</span><span class="sxs-lookup"><span data-stu-id="28faa-325">After the foreground garbage collection is completed, the dedicated background garbage collection thread and user threads resume.</span></span>

<span data-ttu-id="28faa-326">La modalità in background elimina le restrizioni di allocazione imposte dalla modalità simultanea, dal momento che durante un'operazione di Garbage Collection in background è possibile eseguire operazioni temporanee.</span><span class="sxs-lookup"><span data-stu-id="28faa-326">Background garbage collection removes allocation restrictions imposed by concurrent garbage collection, because ephemeral garbage collections can occur during background garbage collection.</span></span> <span data-ttu-id="28faa-327">Ciò significa che, durante un'operazione di Garbage Collection di generazione 1, la modalità in background è in grado di rimuovere gli oggetti inutilizzati nelle generazioni temporanee ed anche espandere l'heap in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="28faa-327">This means that background garbage collection can remove dead objects in ephemeral generations and can also expand the heap if needed during a generation 1 garbage collection.</span></span>

<span data-ttu-id="28faa-328">La figura seguente illustra l'esecuzione in background di un'operazione di Garbage Collection in un thread dedicato separato su una workstation:</span><span class="sxs-lookup"><span data-stu-id="28faa-328">The following illustration shows background garbage collection performed on a separate dedicated thread on a workstation:</span></span>

<span data-ttu-id="28faa-329">![Diagramma che mostra Garbage Collection della workstation in background.](./media/fundamentals/background-workstation-garbage-collection.png "Diagramma che mostra Garbage Collection della workstation in background.")</span><span class="sxs-lookup"><span data-stu-id="28faa-329">![Diagram that shows background workstation garbage collection.](./media/fundamentals/background-workstation-garbage-collection.png "Diagram that shows background workstation garbage collection.")</span></span>

[<span data-ttu-id="28faa-330">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="28faa-330">Back to top</span></span>](#top)

<a name="background_server_garbage_collection"></a>

## <a name="background-server-garbage-collection"></a><span data-ttu-id="28faa-331">Garbage Collection del server in background</span><span class="sxs-lookup"><span data-stu-id="28faa-331">Background server garbage collection</span></span>

<span data-ttu-id="28faa-332">A partire da .NET Framework 4.5, l'operazione di Garbage Collection in background per server è la modalità predefinita per l'operazione di Garbage Collection per server.</span><span class="sxs-lookup"><span data-stu-id="28faa-332">Starting with the .NET Framework 4.5, background server garbage collection is the default mode for server garbage collection.</span></span> <span data-ttu-id="28faa-333">Per scegliere questa modalità, impostare l'attributo `enabled` dell'[elemento \<gcServer>](../../../docs/framework/configure-apps/file-schema/runtime/gcserver-element.md) su `true` nello schema di configurazione di runtime.</span><span class="sxs-lookup"><span data-stu-id="28faa-333">To choose this mode, set the `enabled` attribute of the [\<gcServer> element](../../../docs/framework/configure-apps/file-schema/runtime/gcserver-element.md) to `true` in the runtime configuration schema.</span></span> <span data-ttu-id="28faa-334">Questa modalità è simile alla modalità in background descritta nella sezione precedente, ma con alcune differenze.</span><span class="sxs-lookup"><span data-stu-id="28faa-334">This mode functions similarly to background workstation garbage collection, described in the previous section, but there are a few differences.</span></span> <span data-ttu-id="28faa-335">La modalità in background dell'operazione di Garbage Collection per workstation usa un thread di Garbage Collection in background dedicato, mentre quella dell'operazione di Garbage Collection per server usa più thread, in genere un thread dedicato per ogni processore logico.</span><span class="sxs-lookup"><span data-stu-id="28faa-335">Background workstation garbage collection uses one dedicated background garbage collection thread, whereas background server garbage collection uses multiple threads, typically a dedicated thread for each logical processor.</span></span> <span data-ttu-id="28faa-336">A differenza del thread di Garbage Collection in background per workstation, questi thread non scadono.</span><span class="sxs-lookup"><span data-stu-id="28faa-336">Unlike the workstation background garbage collection thread, these threads do not time out.</span></span>

<span data-ttu-id="28faa-337">La figura seguente illustra l'esecuzione in background di un'operazione di Garbage Collection in un thread dedicato separato su un server:</span><span class="sxs-lookup"><span data-stu-id="28faa-337">The following illustration shows background garbage collection performed on a separate dedicated thread on a server:</span></span>

<span data-ttu-id="28faa-338">![Diagramma che mostra Garbage Collection del server in background.](./media/fundamentals/background-server-garbage-collection.png "Diagramma che mostra Garbage Collection del server in background.")</span><span class="sxs-lookup"><span data-stu-id="28faa-338">![Diagram that shows background server garbage collection.](./media/fundamentals/background-server-garbage-collection.png "Diagram that shows background server garbage collection.")</span></span>

## <a name="see-also"></a><span data-ttu-id="28faa-339">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="28faa-339">See also</span></span>

- [<span data-ttu-id="28faa-340">Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="28faa-340">Garbage Collection</span></span>](../../../docs/standard/garbage-collection/index.md)
