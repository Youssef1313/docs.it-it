---
title: Funzioni di Azure durevoli-app senza server
description: Funzioni di Azure durevoli estendono il runtime di funzioni di Azure per abilitare i flussi di lavoro con stato nel codice.
author: cecilphillip
ms.author: cephilli
ms.date: 06/26/2018
ms.openlocfilehash: 2c0ad086640409ac187c3aa882add4d6b39b6ff9
ms.sourcegitcommit: 22be09204266253d45ece46f51cc6f080f2b3fd6
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/08/2019
ms.locfileid: "72522859"
---
# <a name="durable-azure-functions"></a><span data-ttu-id="9e5f0-103">Funzioni Durable di Azure</span><span class="sxs-lookup"><span data-stu-id="9e5f0-103">Durable Azure functions</span></span>

<span data-ttu-id="9e5f0-104">Quando si creano applicazioni senza server con funzioni di Azure, le operazioni vengono in genere progettate per essere eseguite in modo senza stato.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-104">When creating serverless applications with Azure Functions, your operations will typically be designed to run in a stateless manner.</span></span> <span data-ttu-id="9e5f0-105">Il motivo di questa scelta di progettazione è che, con la scalabilità della piattaforma, diventa difficile conoscere i server in cui viene eseguito il codice.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-105">The reason for this design choice is because as the platform scales, it becomes difficult to know what servers the code is running on.</span></span> <span data-ttu-id="9e5f0-106">È anche difficile capire il numero di istanze attive in un determinato punto.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-106">It also becomes difficult to know how many instances are active at any given point.</span></span> <span data-ttu-id="9e5f0-107">Tuttavia, esistono classi di applicazioni che richiedono che lo stato corrente di un processo sia noto.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-107">However, there are classes of applications that require the current state of a process to be known.</span></span> <span data-ttu-id="9e5f0-108">Si consideri il processo di invio di un ordine a un negozio online.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-108">Consider the process of submitting an order to an online store.</span></span> <span data-ttu-id="9e5f0-109">L'operazione di estrazione potrebbe essere un flusso di lavoro composto da più operazioni che devono essere a conoscenza dello stato del processo.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-109">The checkout operation might be a workflow that is composed of multiple operations that need to know the state of the process.</span></span> <span data-ttu-id="9e5f0-110">Tali informazioni possono includere l'inventario del prodotto, se il cliente dispone di crediti sull'account e anche i risultati dell'elaborazione della carta di credito.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-110">Such information may include the product inventory, if the customer has any credits on their account, and also the results of processing the credit card.</span></span> <span data-ttu-id="9e5f0-111">Queste operazioni possono essere facilmente i propri flussi di lavoro interni o persino i servizi di sistemi di terze parti.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-111">These operations could easily be their own internal workflows or even services from third-party systems.</span></span>

<span data-ttu-id="9e5f0-112">Attualmente esistono diversi modelli che assistono al coordinamento dello stato dell'applicazione tra sistemi interni ed esterni.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-112">Various patterns exist today that assist with the coordination of application state between internal and external systems.</span></span> <span data-ttu-id="9e5f0-113">Sono comuni le soluzioni che si basano su sistemi di Accodamento centralizzati, archivi chiave-valore distribuiti o database condivisi per gestire tale stato.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-113">It's common to come across solutions that rely on centralized queuing systems, distributed key-value stores, or shared databases to manage that state.</span></span> <span data-ttu-id="9e5f0-114">Tuttavia, si tratta di risorse aggiuntive che ora è necessario eseguire il provisioning e la gestione.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-114">However, these are all additional resources that now need to be provisioned and managed.</span></span> <span data-ttu-id="9e5f0-115">In un ambiente senza server, il codice potrebbe diventare un tentativo complesso di coordinarsi con queste risorse manualmente.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-115">In a serverless environment, your code could become cumbersome trying to coordinate with these resources manually.</span></span> <span data-ttu-id="9e5f0-116">Funzioni di Azure offre un'alternativa per la creazione di funzioni con stato denominate Durable Functions.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-116">Azure Functions offers an alternative for creating stateful functions called Durable Functions.</span></span>

<span data-ttu-id="9e5f0-117">Durable Functions è un'estensione del runtime di funzioni di Azure che consente la definizione di flussi di lavoro con stato nel codice.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-117">Durable Functions is an extension to the Azure Functions runtime that enables the definition of stateful workflows in code.</span></span> <span data-ttu-id="9e5f0-118">Suddividendo i flussi di lavoro in attività, l'estensione Durable Functions può gestire lo stato, creare checkpoint di stato e gestire la distribuzione delle chiamate di funzione tra i server.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-118">By breaking down workflows into activities, the Durable Functions extension can manage state, create progress checkpoints, and handle the distribution of function calls across servers.</span></span> <span data-ttu-id="9e5f0-119">In background, viene usato un account di archiviazione di Azure per rendere permanente la cronologia di esecuzione, pianificare le funzioni di attività e recuperare le risposte.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-119">In the background, it makes use of an Azure Storage account to persist execution history, schedule activity functions and retrieve responses.</span></span> <span data-ttu-id="9e5f0-120">Il codice senza server non deve mai interagire con le informazioni salvate in modo permanente nell'account di archiviazione e non è in genere un elemento con cui gli sviluppatori devono interagire.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-120">Your serverless code should never interact with persisted information in that storage account, and is typically not something with which developers need to interact.</span></span>

## <a name="triggering-a-stateful-workflow"></a><span data-ttu-id="9e5f0-121">Attivazione di un flusso di lavoro con stato</span><span class="sxs-lookup"><span data-stu-id="9e5f0-121">Triggering a stateful workflow</span></span>

<span data-ttu-id="9e5f0-122">I flussi di lavoro con stato in Durable Functions possono essere suddivisi in due componenti intrinseci. trigger di orchestrazione e di attività.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-122">Stateful workflows in Durable Functions can be broken down into two intrinsic components; orchestration and activity triggers.</span></span> <span data-ttu-id="9e5f0-123">I trigger e le associazioni sono componenti di base usati da funzioni di Azure per consentire alle funzioni senza server di ricevere notifiche quando avviare, ricevere input e restituire risultati.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-123">Triggers and bindings are core components used by Azure Functions to enable your serverless functions to be notified when to start, receive input, and return results.</span></span>

### <a name="working-with-the-orchestration-client"></a><span data-ttu-id="9e5f0-124">Utilizzo del client di orchestrazione</span><span class="sxs-lookup"><span data-stu-id="9e5f0-124">Working with the Orchestration client</span></span>

<span data-ttu-id="9e5f0-125">Le orchestrazioni sono univoche rispetto ad altri stili di operazioni attivate in funzioni di Azure.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-125">Orchestrations are unique when compared to other styles of triggered operations in Azure Functions.</span></span> <span data-ttu-id="9e5f0-126">Durable Functions consente l'esecuzione di funzioni che possono richiedere ore o persino giorni per il completamento.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-126">Durable Functions enables the execution of functions that may take hours or even days to complete.</span></span> <span data-ttu-id="9e5f0-127">Questo tipo di comportamento prevede la necessità di poter controllare lo stato di un'orchestrazione in esecuzione, terminare preventivamente o inviare notifiche di eventi esterni.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-127">That type of behavior comes with the need to able to check the status of a running orchestration, preemptively terminate, or send notifications of external events.</span></span>

<span data-ttu-id="9e5f0-128">In questi casi, l'estensione Durable Functions fornisce la classe `DurableOrchestrationClient` che consente di interagire con le funzioni orchestrate.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-128">For such cases, the Durable Functions extension provides the `DurableOrchestrationClient` class that allows you to interact with orchestrated functions.</span></span> <span data-ttu-id="9e5f0-129">Per ottenere l'accesso al client di orchestrazione, è possibile usare l'associazione `OrchestrationClientAttribute`.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-129">You get access to the orchestration client by using the `OrchestrationClientAttribute` binding.</span></span> <span data-ttu-id="9e5f0-130">In genere, è necessario includere questo attributo con un altro tipo di trigger, ad esempio un `HttpTrigger` o `ServiceBusTrigger`.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-130">Generally, you would include this attribute with another trigger type, such as an `HttpTrigger` or `ServiceBusTrigger`.</span></span> <span data-ttu-id="9e5f0-131">Una volta attivata la funzione di origine, è possibile utilizzare il client di orchestrazione per avviare una funzione dell'agente di orchestrazione.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-131">Once the source function has been triggered, the orchestration client can be used to start an orchestrator function.</span></span>

```csharp
[FunctionName("KickOff")]
public static async Task<HttpResponseMessage> Run(
    [HttpTrigger(AuthorizationLevel.Function, "POST")]HttpRequestMessage req,
    [OrchestrationClient ] DurableOrchestrationClient<orchestrationClient>)
{
    OrderRequestData data = await req.Content.ReadAsAsync<OrderRequestData>();

    string instanceId = await orchestrationClient.StartNewAsync("PlaceOrder", data);

    return orchestrationClient.CreateCheckStatusResponse(req, instanceId);
}
```

### <a name="the-orchestrator-function"></a><span data-ttu-id="9e5f0-132">Funzione dell'agente di orchestrazione</span><span class="sxs-lookup"><span data-stu-id="9e5f0-132">The orchestrator function</span></span>

<span data-ttu-id="9e5f0-133">Annotare una funzione con OrchestrationTriggerAttribute in funzioni di Azure contrassegna che funziona come funzione dell'agente di orchestrazione.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-133">Annotating a function with the OrchestrationTriggerAttribute in Azure Functions marks that function as an orchestrator function.</span></span> <span data-ttu-id="9e5f0-134">È responsabile della gestione delle varie attività che costituiscono il flusso di lavoro con stato.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-134">It's responsible for managing the various activities that make up your stateful workflow.</span></span>

<span data-ttu-id="9e5f0-135">Le funzioni dell'agente di orchestrazione non sono in grado di utilizzare binding diversi da OrchestrationTriggerAttribute.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-135">Orchestrator functions are unable to make use of bindings other than the OrchestrationTriggerAttribute.</span></span> <span data-ttu-id="9e5f0-136">Questo attributo può essere utilizzato solo con un tipo di parametro DurableOrchestrationContext.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-136">This attribute can only be used with a parameter type of DurableOrchestrationContext.</span></span> <span data-ttu-id="9e5f0-137">Non è possibile usare altri input perché la deserializzazione degli input nella firma della funzione non è supportata.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-137">No other inputs can be used since deserialization of inputs in the function signature isn't supported.</span></span> <span data-ttu-id="9e5f0-138">Per ottenere gli input forniti dal client di orchestrazione, è necessario utilizzare il metodo GetInput\<T\>.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-138">To get inputs provided by the orchestration client, the GetInput\<T\> method must be used.</span></span>

<span data-ttu-id="9e5f0-139">Inoltre, i tipi restituiti delle funzioni di orchestrazione devono essere void, Task o un valore serializzabile JSON.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-139">Also, the return types of orchestration functions must be either void, Task, or a JSON serializable value.</span></span>

> <span data-ttu-id="9e5f0-140">*Il codice di gestione degli errori è stato lasciato per brevità*</span><span class="sxs-lookup"><span data-stu-id="9e5f0-140">*Error handling code has been left out for brevity*</span></span>

```csharp
[FunctionName("PlaceOrder")]
public static async Task<string> PlaceOrder([OrchestrationTrigger] DurableOrchestrationContext context)
{
    OrderRequestData orderData = context.GetInput<OrderRequestData>();

    await context.CallActivityAsync<bool>("CheckAndReserveInventory", orderData);
    await context.CallActivityAsync<string>("ProcessPayment", orderData);

    string trackingNumber = await context.CallActivityAsync<string>("ScheduleShipping", orderData);
    await context.CallActivityAsync<string>("EmailCustomer", trackingNumber);

    return trackingNumber;
}
```

<span data-ttu-id="9e5f0-141">È possibile avviare ed eseguire contemporaneamente più istanze di un'orchestrazione.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-141">Multiple instances of an orchestration can be started and running at the same time.</span></span> <span data-ttu-id="9e5f0-142">Chiamando il metodo `StartNewAsync` sul `DurableOrchestrationClient` viene avviata una nuova istanza dell'orchestrazione.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-142">Calling the `StartNewAsync` method on the `DurableOrchestrationClient` launches a new instance of the orchestration.</span></span> <span data-ttu-id="9e5f0-143">Il metodo restituisce un `Task<string>` che viene completato quando l'orchestrazione è stata avviata.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-143">The method returns a `Task<string>` that completes when the orchestration has started.</span></span> <span data-ttu-id="9e5f0-144">Viene generata un'eccezione di tipo `TimeoutException` se l'orchestrazione non è stata avviata entro 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-144">An exception of type `TimeoutException` gets thrown if the orchestration hasn't started within 30 seconds.</span></span>

<span data-ttu-id="9e5f0-145">Il `Task<string>` completato da `StartNewAsync` deve contenere l'ID univoco dell'istanza dell'orchestrazione.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-145">The completed `Task<string>` from `StartNewAsync` should contain the unique ID of the orchestration instance.</span></span> <span data-ttu-id="9e5f0-146">Questo ID istanza può essere utilizzato per richiamare le operazioni su un'orchestrazione specifica.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-146">This instance ID can be used to invoke operations on that specific orchestration.</span></span> <span data-ttu-id="9e5f0-147">Per l'orchestrazione è possibile eseguire query per lo stato o le notifiche degli eventi inviati.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-147">The orchestration can be queried for the status or sent event notifications.</span></span>

### <a name="the-activity-functions"></a><span data-ttu-id="9e5f0-148">Funzioni di attività</span><span class="sxs-lookup"><span data-stu-id="9e5f0-148">The activity functions</span></span>

<span data-ttu-id="9e5f0-149">Le funzioni di attività sono le operazioni discrete che vengono composte insieme in una funzione di orchestrazione per creare il flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-149">Activity functions are the discrete operations that get composed together within an orchestration function to create the workflow.</span></span> <span data-ttu-id="9e5f0-150">Ecco dove si svolge la maggior parte del lavoro effettivo.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-150">Here is where most of actual work would take place.</span></span> <span data-ttu-id="9e5f0-151">Rappresentano la logica di business, i processi a esecuzione prolungata e le parti del puzzle a una soluzione più ampia.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-151">They represent the business logic, long running processes, and the puzzle pieces to a larger solution.</span></span>

<span data-ttu-id="9e5f0-152">Il `ActivityTriggerAttribute` viene utilizzato per annotare un parametro di funzione di tipo `DurableActivityContext`.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-152">The `ActivityTriggerAttribute` is used to annotate a function parameter of type `DurableActivityContext`.</span></span> <span data-ttu-id="9e5f0-153">L'uso dell'annotazione informa il runtime che la funzione deve essere usata come funzione di attività.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-153">Using the annotation informs the runtime that the function is intended to be used as an activity function.</span></span> <span data-ttu-id="9e5f0-154">I valori di input per le funzioni di attività vengono recuperati utilizzando il metodo `GetInput<T>` del parametro `DurableActivityContext`.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-154">Input values to activity functions are retrieved using the `GetInput<T>` method of the `DurableActivityContext` parameter.</span></span>

<span data-ttu-id="9e5f0-155">Analogamente alle funzioni di orchestrazione, i tipi restituiti delle funzioni di attività devono essere void, Task o un valore serializzabile JSON.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-155">Similar to orchestration functions, the return types of activity functions must be either void, Task, or a JSON serializable value.</span></span>

<span data-ttu-id="9e5f0-156">Eventuali eccezioni non gestite generate all'interno delle funzioni dell'attività vengono inviate alla funzione dell'agente di orchestrazione chiamante e presentate come `TaskFailedException`.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-156">Any unhandled exceptions that get thrown within activity functions will get sent up to the calling orchestrator function and presented as a `TaskFailedException`.</span></span> <span data-ttu-id="9e5f0-157">A questo punto, l'errore può essere intercettato e registrato nell'agente di orchestrazione e l'attività può essere ritentata.</span><span class="sxs-lookup"><span data-stu-id="9e5f0-157">At this point, the error can be caught and logged in the orchestrator, and the activity can be retried.</span></span>

```csharp
[FunctionName("CheckAndReserveInventory")]
public static bool CheckAndReserveInventory([ActivityTrigger] DurableActivityContext context)
{
    OrderRequestData orderData = context.GetInput<OrderRequestData>();

    // Connect to inventory system and try to reserve items
    return true;
}
```

## <a name="recommended-resources"></a><span data-ttu-id="9e5f0-158">Risorse consigliate</span><span class="sxs-lookup"><span data-stu-id="9e5f0-158">Recommended resources</span></span>

- [<span data-ttu-id="9e5f0-159">Durable Functions</span><span class="sxs-lookup"><span data-stu-id="9e5f0-159">Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-overview)
- [<span data-ttu-id="9e5f0-160">Binding per Durable Functions</span><span class="sxs-lookup"><span data-stu-id="9e5f0-160">Bindings for Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-bindings)
- [<span data-ttu-id="9e5f0-161">Gestire le istanze in Durable Functions</span><span class="sxs-lookup"><span data-stu-id="9e5f0-161">Manage instances in Durable Functions</span></span>](https://docs.microsoft.com/azure/azure-functions/durable-functions-instance-management)

>[!div class="step-by-step"]
><span data-ttu-id="9e5f0-162">[Precedente](event-grid.md)
>[Successivo](orchestration-patterns.md)</span><span class="sxs-lookup"><span data-stu-id="9e5f0-162">[Previous](event-grid.md)
[Next](orchestration-patterns.md)</span></span>
