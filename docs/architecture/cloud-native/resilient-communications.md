---
title: Comunicazione resiliente
description: Architettura di app .NET cloud native per Azure | Comunicazione resiliente
ms.date: 06/30/2019
ms.openlocfilehash: d7fd4552059f527ad5166dcb6be04248bfad8e4a
ms.sourcegitcommit: 56f1d1203d0075a461a10a301459d3aa452f4f47
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/24/2019
ms.locfileid: "71214499"
---
# <a name="resilient-communications"></a><span data-ttu-id="85ee4-103">Comunicazioni resilienti</span><span class="sxs-lookup"><span data-stu-id="85ee4-103">Resilient communications</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="85ee4-104">In questo libro abbiamo evangelizzato i meriti del passaggio oltre la tradizionale progettazione di applicazioni monolitiche e l'adozione di un'architettura basata su microservizi in cui un set di servizi distribuiti e indipendenti viene eseguito in modo indipendente e comunica con ognuno altro con protocolli di comunicazione standard, ad esempio HTTP e HTTPS.</span><span class="sxs-lookup"><span data-stu-id="85ee4-104">Throughout this book, we've evangelized the merits of moving beyond traditional monolithic application design and embracing a microservice-based architecture where a set of distributed, self-contained services run independently and communicate with each other using standard communication protocols such as HTTP and HTTPS.</span></span> <span data-ttu-id="85ee4-105">Sebbene tale architettura acquisti molti vantaggi importanti, presenta anche molti problemi.</span><span class="sxs-lookup"><span data-stu-id="85ee4-105">While such an architecture buys you many important benefits, it also presents many challenges.</span></span> <span data-ttu-id="85ee4-106">Si considerino, ad esempio, i seguenti aspetti:</span><span class="sxs-lookup"><span data-stu-id="85ee4-106">Consider, for example, the following concerns:</span></span>

- <span data-ttu-id="85ee4-107">*Comunicazione di rete out-of-process.*</span><span class="sxs-lookup"><span data-stu-id="85ee4-107">*Out-of-process network communication.*</span></span> <span data-ttu-id="85ee4-108">Ogni servizio comunica tramite un protocollo di rete che introduce congestioni di rete, latenza ed errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="85ee4-108">Each service communicates over a network protocol that introduces network congestion, latency, and transient faults.</span></span>
- <span data-ttu-id="85ee4-109">*Individuazione del servizio.*</span><span class="sxs-lookup"><span data-stu-id="85ee4-109">*Service discovery.*</span></span> <span data-ttu-id="85ee4-110">Con ogni servizio in esecuzione in un cluster di computer con il proprio indirizzo IP e la propria porta, in che modo i servizi individuano e comunicano tra loro?</span><span class="sxs-lookup"><span data-stu-id="85ee4-110">With each service running across a cluster of machines with its own IP address and port, how do services discover and communicate with each other?</span></span>
- <span data-ttu-id="85ee4-111">*Resilienza.*</span><span class="sxs-lookup"><span data-stu-id="85ee4-111">*Resiliency.*</span></span> <span data-ttu-id="85ee4-112">Come si gestiscono gli errori di breve durata e si mantiene stabile il sistema?</span><span class="sxs-lookup"><span data-stu-id="85ee4-112">How do you manage short-lived failures and keep the system stable?</span></span>
- <span data-ttu-id="85ee4-113">*Bilanciamento del carico.*</span><span class="sxs-lookup"><span data-stu-id="85ee4-113">*Load balancing.*</span></span> <span data-ttu-id="85ee4-114">In che modo il traffico in ingresso viene distribuito tra più istanze di un servizio?</span><span class="sxs-lookup"><span data-stu-id="85ee4-114">How does inbound traffic get distributed across multiple instances of a service?</span></span>
- <span data-ttu-id="85ee4-115">*Sicurezza.*</span><span class="sxs-lookup"><span data-stu-id="85ee4-115">*Security.*</span></span> <span data-ttu-id="85ee4-116">In che modo vengono applicati problemi di sicurezza, ad esempio la crittografia a livello di trasporto e la gestione dei certificati?</span><span class="sxs-lookup"><span data-stu-id="85ee4-116">How are security concerns such as transport-level encryption and certificate management enforced?</span></span>
- <span data-ttu-id="85ee4-117">\* Monitoraggio distribuito.</span><span class="sxs-lookup"><span data-stu-id="85ee4-117">\*Distributed Monitoring.</span></span> <span data-ttu-id="85ee4-118">-In che modo è possibile correlare e acquisire la tracciabilità e il monitoraggio per una singola richiesta tra più servizi consumer?</span><span class="sxs-lookup"><span data-stu-id="85ee4-118">- How do you correlate and capture traceability and monitoring for a single request across multiple consuming services?</span></span>

<span data-ttu-id="85ee4-119">Sebbene questi problemi possano essere risolti con diverse librerie e Framework, l'implementazione all'interno della codebase può essere costosa, complessa e dispendiosa in termini di tempo.</span><span class="sxs-lookup"><span data-stu-id="85ee4-119">While these concerns can be addressed with various libraries and frameworks, implementing them inside your codebase can be expensive, complex, and time-consuming.</span></span> <span data-ttu-id="85ee4-120">Inoltre, si finisce con una soluzione in cui i problemi di infrastruttura sono associati alla logica di business.</span><span class="sxs-lookup"><span data-stu-id="85ee4-120">Moreover, you end up with a solution where infrastructure concerns are coupled to business logic.</span></span>

## <a name="service-mesh"></a><span data-ttu-id="85ee4-121">Mesh del servizio</span><span class="sxs-lookup"><span data-stu-id="85ee4-121">Service mesh</span></span>

<span data-ttu-id="85ee4-122">Un approccio migliore consiste nel prendere in considerazione una tecnologia nuova e in rapida evoluzione denominata *mesh di servizi*.</span><span class="sxs-lookup"><span data-stu-id="85ee4-122">A better approach is to consider a new and rapidly evolving technology entitled *Service Mesh*.</span></span> <span data-ttu-id="85ee4-123">Una [rete mesh di servizi](https://www.nginx.com/blog/what-is-a-service-mesh/) è un livello di infrastruttura configurabile con funzionalità predefinite per gestire la comunicazione dei servizi e molti dei problemi menzionati in precedenza.</span><span class="sxs-lookup"><span data-stu-id="85ee4-123">A [service mesh](https://www.nginx.com/blog/what-is-a-service-mesh/) is a configurable infrastructure layer with built-in capabilities to handle service communication and many of the challenges mentioned above.</span></span> <span data-ttu-id="85ee4-124">Separa questi problemi dal codice aziendale e li sposta in un proxy del servizio, un'istanza di che accompagna ogni servizio.</span><span class="sxs-lookup"><span data-stu-id="85ee4-124">It decouples these concerns from your business code and moves them into a service proxy, an instance of which accompanies each of your services.</span></span> <span data-ttu-id="85ee4-125">Noto anche come [modello sidecar](https://docs.microsoft.com/azure/architecture/patterns/sidecar), il proxy mesh di servizi viene distribuito in un processo separato per fornire isolamento e incapsulamento dal codice aziendale.</span><span class="sxs-lookup"><span data-stu-id="85ee4-125">Often referred to as the [Sidecar pattern](https://docs.microsoft.com/azure/architecture/patterns/sidecar), the service mesh proxy is deployed into a separate process to provide isolation and encapsulation from your business code.</span></span> <span data-ttu-id="85ee4-126">Tuttavia, il proxy è strettamente collegato al servizio creato insieme a esso e condividendo il relativo ciclo di vita.</span><span class="sxs-lookup"><span data-stu-id="85ee4-126">However, the proxy is closely linked to the service being created along with it and sharing its lifecycle.</span></span> <span data-ttu-id="85ee4-127">Nella figura 6-9 è illustrato questo scenario.</span><span class="sxs-lookup"><span data-stu-id="85ee4-127">Figure 6-9 shows this scenario.</span></span>

![Rete di servizi con un'auto laterale](./media/service-mesh-with-side-car.png)

<span data-ttu-id="85ee4-129">**Figura 6-9**.</span><span class="sxs-lookup"><span data-stu-id="85ee4-129">**Figure 6-9**.</span></span> <span data-ttu-id="85ee4-130">Rete di servizi con un'auto laterale</span><span class="sxs-lookup"><span data-stu-id="85ee4-130">Service mesh with a side car</span></span>

<span data-ttu-id="85ee4-131">Nella figura precedente si noti il modo in cui il proxy intercetta e gestisce le comunicazioni tra i microservizi e il cluster.</span><span class="sxs-lookup"><span data-stu-id="85ee4-131">In the previous figure, note how the proxy intercepts and manages communication among the microservices and the cluster.</span></span>

<span data-ttu-id="85ee4-132">Una mesh di servizi viene suddivisa logicamente in due componenti diversi: [Piano dati](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) e [piano di controllo](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span><span class="sxs-lookup"><span data-stu-id="85ee4-132">A service mesh is logically split into two disparate components: A [data plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) and [control plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span></span> <span data-ttu-id="85ee4-133">La figura 6-10 illustra questi componenti e le relative responsabilità.</span><span class="sxs-lookup"><span data-stu-id="85ee4-133">Figure 6-10 shows these components and their responsibilities.</span></span>

![Controllo mesh di servizi e piano dati](./media/istio-control-and-data-plane.png)

<span data-ttu-id="85ee4-135">**Figura 6-10.**</span><span class="sxs-lookup"><span data-stu-id="85ee4-135">**Figure 6-10.**</span></span> <span data-ttu-id="85ee4-136">Controllo mesh di servizi e piano dati</span><span class="sxs-lookup"><span data-stu-id="85ee4-136">Service mesh control and data plane</span></span>

<span data-ttu-id="85ee4-137">Una volta configurata, una mesh del servizio è altamente funzionante.</span><span class="sxs-lookup"><span data-stu-id="85ee4-137">Once configured, a service mesh is highly functional.</span></span> <span data-ttu-id="85ee4-138">Può recuperare un pool di istanze corrispondente da un endpoint di individuazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="85ee4-138">It can retrieve a corresponding pool of instances from a service discovery endpoint.</span></span> <span data-ttu-id="85ee4-139">Può quindi inviare una richiesta a un'istanza specifica, registrando la latenza e il tipo di risposta del risultato.</span><span class="sxs-lookup"><span data-stu-id="85ee4-139">It can then send a request to a specific instance, recording the latency and response type of the result.</span></span> <span data-ttu-id="85ee4-140">Una mesh può scegliere l'istanza con maggiore probabilità di restituire una risposta rapida in base a molti fattori, inclusa la latenza osservata per le richieste recenti.</span><span class="sxs-lookup"><span data-stu-id="85ee4-140">A mesh can choose the instance most likely to return a fast response based on many factors, including its observed latency for recent requests.</span></span>

<span data-ttu-id="85ee4-141">Se un'istanza non risponde o non riesce, la mesh può ripetere la richiesta in un'altra istanza.</span><span class="sxs-lookup"><span data-stu-id="85ee4-141">If an instance is unresponsive or fails, the mesh can retry the request on another instance.</span></span> <span data-ttu-id="85ee4-142">Se un pool restituisce costantemente errori, una mesh può rimuoverla dal pool di bilanciamento del carico per essere ritentata periodicamente successivamente dopo la riparazione.</span><span class="sxs-lookup"><span data-stu-id="85ee4-142">If a pool consistently returns errors, a mesh can evict it from the load-balancing pool to be retried periodically later after it heals.</span></span> <span data-ttu-id="85ee4-143">Se una richiesta scade, una mesh può avere esito negativo e quindi ripetere la richiesta.</span><span class="sxs-lookup"><span data-stu-id="85ee4-143">If a request times out, a mesh can fail and then retry the request.</span></span> <span data-ttu-id="85ee4-144">Una mesh acquisisce il comportamento sotto forma di metriche e di traccia distribuita, che possono quindi essere emesse in un sistema di metriche centralizzate.</span><span class="sxs-lookup"><span data-stu-id="85ee4-144">A mesh captures behavior in the form of metrics and distributed tracing, which then can be emitted to a centralized metrics system.</span></span>

## <a name="istio-and-envoy"></a><span data-ttu-id="85ee4-145">Istio e inviato</span><span class="sxs-lookup"><span data-stu-id="85ee4-145">Istio and Envoy</span></span>

<span data-ttu-id="85ee4-146">Sebbene esistano alcune opzioni di mesh del servizio, [Istio](https://istio.io/docs/concepts/what-is-istio/) è il più popolare al momento della stesura di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="85ee4-146">While a few service mesh options currently exist, [Istio](https://istio.io/docs/concepts/what-is-istio/) is the most popular as of the time of this writing.</span></span> <span data-ttu-id="85ee4-147">Una joint venture da IBM, Google e Lyft è un'offerta open source che può essere integrata in un'applicazione distribuita nuova o esistente.</span><span class="sxs-lookup"><span data-stu-id="85ee4-147">A joint venture from IBM, Google, and Lyft, it's an open-source offering that can be integrated into a new or existing distributed application.</span></span> <span data-ttu-id="85ee4-148">Fornisce una soluzione coerente e completa per proteggere, connettere e monitorare i microservizi.</span><span class="sxs-lookup"><span data-stu-id="85ee4-148">It provides a consistent and complete solution to secure, connect, and monitor microservices.</span></span> <span data-ttu-id="85ee4-149">Le funzionalità includono:</span><span class="sxs-lookup"><span data-stu-id="85ee4-149">Its features include:</span></span>

- <span data-ttu-id="85ee4-150">Comunicazione da servizio a servizio sicura in un cluster con autenticazione e autorizzazione basate sulle identità complesse.</span><span class="sxs-lookup"><span data-stu-id="85ee4-150">Secure service-to-service communication in a cluster with strong identity-based authentication and authorization.</span></span>
- <span data-ttu-id="85ee4-151">Bilanciamento del carico automatico per il traffico HTTP, [gRPC](https://grpc.io/), WEBSOCKET e TCP.</span><span class="sxs-lookup"><span data-stu-id="85ee4-151">Automatic load balancing for HTTP, [gRPC](https://grpc.io/), WebSocket, and TCP traffic.</span></span>
- <span data-ttu-id="85ee4-152">Controllo con granularità fine del comportamento del traffico con regole di routing avanzate, tentativi, failover e attacchi di errore.</span><span class="sxs-lookup"><span data-stu-id="85ee4-152">Fine-grained control of traffic behavior with rich routing rules, retries, failovers, and fault injection.</span></span>
- <span data-ttu-id="85ee4-153">Un livello di criteri e un'API di configurazione collegabili che supportano i controlli di accesso, i limiti di frequenza e le quote.</span><span class="sxs-lookup"><span data-stu-id="85ee4-153">A pluggable policy layer and configuration API supporting access controls, rate limits, and quotas.</span></span>
- <span data-ttu-id="85ee4-154">Metriche automatiche, log e tracce per tutto il traffico all'interno di un cluster, tra cui ingresso e uscita del cluster.</span><span class="sxs-lookup"><span data-stu-id="85ee4-154">Automatic metrics, logs, and traces for all traffic within a cluster, including cluster ingress and egress.</span></span>

<span data-ttu-id="85ee4-155">Un componente chiave per un'implementazione di Istio è un servizio proxy denominato [proxy di invio](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span><span class="sxs-lookup"><span data-stu-id="85ee4-155">A key component for an Istio implementation is a proxy service entitled the [Envoy proxy](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span></span> <span data-ttu-id="85ee4-156">Originato da Lyft e successivamente contribuito al [cloud native Computing Foundation](https://www.cncf.io/) (descritto nel capitolo 1), il proxy inviato viene eseguito insieme a ogni servizio e fornisce una base indipendente dalla piattaforma per le seguenti funzionalità:</span><span class="sxs-lookup"><span data-stu-id="85ee4-156">Originating from Lyft and subsequently contributed to the [Cloud Native Computing Foundation](https://www.cncf.io/) (discussed in chapter 1), the Envoy proxy runs alongside each service and provides a platform-agnostic foundation for the following features:</span></span>

- <span data-ttu-id="85ee4-157">Individuazione dinamica del servizio.</span><span class="sxs-lookup"><span data-stu-id="85ee4-157">Dynamic service discovery.</span></span>
- <span data-ttu-id="85ee4-158">Bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="85ee4-158">Load balancing.</span></span>
- <span data-ttu-id="85ee4-159">Terminazione TLS.</span><span class="sxs-lookup"><span data-stu-id="85ee4-159">TLS termination.</span></span>
- <span data-ttu-id="85ee4-160">Proxy HTTP e gRPC.</span><span class="sxs-lookup"><span data-stu-id="85ee4-160">HTTP and gRPC proxies.</span></span>
- <span data-ttu-id="85ee4-161">Resilienza degli interruttori.</span><span class="sxs-lookup"><span data-stu-id="85ee4-161">Circuit breaker resiliency.</span></span>
- <span data-ttu-id="85ee4-162">Controlli di integrità.</span><span class="sxs-lookup"><span data-stu-id="85ee4-162">Health checks.</span></span>
- <span data-ttu-id="85ee4-163">Aggiornamenti in sequenza con distribuzioni [Canarie](https://martinfowler.com/bliki/CanaryRelease.html) .</span><span class="sxs-lookup"><span data-stu-id="85ee4-163">Rolling updates with [canary](https://martinfowler.com/bliki/CanaryRelease.html) deployments.</span></span>

<span data-ttu-id="85ee4-164">Come descritto in precedenza, l'inviato viene distribuito come sidecar a ogni microservizio del cluster.</span><span class="sxs-lookup"><span data-stu-id="85ee4-164">As previously discussed, Envoy is deployed as a sidecar to each microservice in the cluster.</span></span>

## <a name="integration-with-azure-kubernetes-services"></a><span data-ttu-id="85ee4-165">Integrazione con i servizi Kubernetes di Azure</span><span class="sxs-lookup"><span data-stu-id="85ee4-165">Integration with Azure Kubernetes Services</span></span>

<span data-ttu-id="85ee4-166">Il cloud di Azure abbraccia Istio e fornisce il supporto diretto per l'it all'interno dei servizi Kubernetes di Azure.</span><span class="sxs-lookup"><span data-stu-id="85ee4-166">The Azure cloud embraces Istio and provides direct support for it within Azure Kubernetes Services.</span></span> <span data-ttu-id="85ee4-167">I collegamenti seguenti possono essere utili per iniziare:</span><span class="sxs-lookup"><span data-stu-id="85ee4-167">The following links can help you get started:</span></span>

- [<span data-ttu-id="85ee4-168">Installazione di Istio in AKS</span><span class="sxs-lookup"><span data-stu-id="85ee4-168">Installing Istio in AKS</span></span>](https://docs.microsoft.com/azure/aks/istio-install)
- [<span data-ttu-id="85ee4-169">Uso di AKS e Istio</span><span class="sxs-lookup"><span data-stu-id="85ee4-169">Using AKS and Istio</span></span>](https://docs.microsoft.com/azure/aks/istio-scenario-routing)

>[!div class="step-by-step"]
><span data-ttu-id="85ee4-170">[Precedente](infrastructure-resiliency-azure.md)
>[Successivo](monitoring-health.md)</span><span class="sxs-lookup"><span data-stu-id="85ee4-170">[Previous](infrastructure-resiliency-azure.md)
[Next](monitoring-health.md)</span></span>
