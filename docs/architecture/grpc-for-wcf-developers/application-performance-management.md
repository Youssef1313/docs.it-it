---
title: Gestione delle prestazioni delle applicazioni-gRPC per sviluppatori WCF
description: Registrazione, metriche e traccia per ASP.NET Core le applicazioni gRPC.
author: markrendle
ms.date: 09/02/2019
ms.openlocfilehash: 6e4c32d057c1ac143e18a4a3ddc83dd8b1f62800
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/23/2019
ms.locfileid: "71184610"
---
# <a name="application-performance-management"></a><span data-ttu-id="f10d4-103">Gestione delle prestazioni delle applicazioni</span><span class="sxs-lookup"><span data-stu-id="f10d4-103">Application Performance Management</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="f10d4-104">Negli ambienti di produzione moderni come Kubernetes, è molto importante essere in grado di monitorare le applicazioni per assicurarsi che siano in esecuzione in modo ottimale.</span><span class="sxs-lookup"><span data-stu-id="f10d4-104">In modern production environments like Kubernetes, it's very important to be able to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="f10d4-105">Problemi quali la registrazione e le metriche non sono mai state ancora più importanti.</span><span class="sxs-lookup"><span data-stu-id="f10d4-105">Concerns like logging and metrics have never been more important.</span></span> <span data-ttu-id="f10d4-106">ASP.NET Core, incluso gRPC, ha un supporto di prima classe per la produzione e la gestione dei dati di log e delle metriche, oltre ai dati di *traccia* .</span><span class="sxs-lookup"><span data-stu-id="f10d4-106">ASP.NET Core, including gRPC, has first-class support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span> <span data-ttu-id="f10d4-107">In questa sezione vengono illustrate in dettaglio le aree.</span><span class="sxs-lookup"><span data-stu-id="f10d4-107">This section will explore these areas in more details.</span></span>

## <a name="logging-vs-metrics"></a><span data-ttu-id="f10d4-108">Registrazione rispetto alle metriche</span><span class="sxs-lookup"><span data-stu-id="f10d4-108">Logging vs Metrics</span></span>

<span data-ttu-id="f10d4-109">Prima di esaminare i dettagli di implementazione, è necessario comprendere la differenza tra la registrazione e la metrica.</span><span class="sxs-lookup"><span data-stu-id="f10d4-109">Before looking at the implementation details, it's necessary to understand the difference between logging and metrics.</span></span>

<span data-ttu-id="f10d4-110">La registrazione riguarda i messaggi di testo che registrano informazioni dettagliate sugli eventi che si sono verificati nel sistema.</span><span class="sxs-lookup"><span data-stu-id="f10d4-110">Logging is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="f10d4-111">I messaggi di log possono includere dati di eccezione come le analisi dello stack o dati strutturati che forniscono il contesto sul messaggio.</span><span class="sxs-lookup"><span data-stu-id="f10d4-111">Log messages may include exception data like stack traces, or structured data that provides context about the message.</span></span> <span data-ttu-id="f10d4-112">L'output di registrazione viene comunemente scritto in un archivio di testo in cui è possibile eseguire ricerche.</span><span class="sxs-lookup"><span data-stu-id="f10d4-112">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="f10d4-113">Le metriche si riferiscono a dati numerici progettati per essere aggregati e presentati mediante grafici e grafici in un dashboard che fornisce una visualizzazione dell'integrità e delle prestazioni generali di un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f10d4-113">Metrics refers to numeric data that is designed to be aggregated and presented using charts and graphs in a dashboard that provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="f10d4-114">I dati di metrica possono anche essere usati per attivare avvisi automatici quando viene superata una soglia.</span><span class="sxs-lookup"><span data-stu-id="f10d4-114">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="f10d4-115">Nell'elenco seguente sono riportati alcuni esempi di dati di metrica:</span><span class="sxs-lookup"><span data-stu-id="f10d4-115">The following list shows some examples of metrics data:</span></span>

- <span data-ttu-id="f10d4-116">Tempo impiegato per elaborare le richieste.</span><span class="sxs-lookup"><span data-stu-id="f10d4-116">Time taken to process requests.</span></span>
- <span data-ttu-id="f10d4-117">Numero di richieste al secondo gestite da un'istanza di un servizio.</span><span class="sxs-lookup"><span data-stu-id="f10d4-117">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="f10d4-118">Numero di richieste non riuscite in un'istanza.</span><span class="sxs-lookup"><span data-stu-id="f10d4-118">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="f10d4-119">Accesso ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="f10d4-119">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="f10d4-120">ASP.NET Core fornisce il supporto incorporato per la registrazione, sotto forma di pacchetto NuGet [Microsoft. Extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-120">ASP.NET Core provides built-in support for logging, in the form of the [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="f10d4-121">Le parti principali di questa libreria sono incluse in Web SDK, quindi non è necessario installarle manualmente.</span><span class="sxs-lookup"><span data-stu-id="f10d4-121">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="f10d4-122">Per impostazione predefinita, i messaggi di log vengono scritti nell'output standard (la "console") e in qualsiasi debugger collegato.</span><span class="sxs-lookup"><span data-stu-id="f10d4-122">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="f10d4-123">Per scrivere i log in archivi dati esterni permanenti, potrebbe essere necessario importare [pacchetti di sink di registrazione facoltativi](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span><span class="sxs-lookup"><span data-stu-id="f10d4-123">To write logs to persistent external data stores, you may need to import [optional logging sink packages](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="f10d4-124">Il ASP.NET Core Framework gRPC scrive messaggi di registrazione diagnostica dettagliati in questo framework di registrazione, in modo che possano essere elaborati o archiviati insieme ai messaggi dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f10d4-124">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework so they can be processed/stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="f10d4-125">Produrre messaggi di log</span><span class="sxs-lookup"><span data-stu-id="f10d4-125">Produce log messages</span></span>

<span data-ttu-id="f10d4-126">L'estensione di registrazione viene registrata automaticamente nel sistema di inserimento delle dipendenze di ASP.NET Core, quindi è possibile specificare i logger come parametro del costruttore nei tipi di servizio gRPC.</span><span class="sxs-lookup"><span data-stu-id="f10d4-126">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="f10d4-127">Molti messaggi di log relativi alle richieste, alle eccezioni e così via sono forniti dai componenti ASP.NET Core e gRPC Framework.</span><span class="sxs-lookup"><span data-stu-id="f10d4-127">Many log messages around requests, exceptions, and so on, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="f10d4-128">Aggiungere i propri messaggi di log per fornire dettagli e contesto sulla logica dell'applicazione anziché su problemi di basso livello.</span><span class="sxs-lookup"><span data-stu-id="f10d4-128">Add your own log messages to provide detail and context about application logic rather than lower-level concerns.</span></span>

<span data-ttu-id="f10d4-129">Per ulteriori informazioni sulla scrittura di messaggi di log e di destinazioni e sink di registrazione disponibili, vedere l'articolo relativo alla [registrazione in .NET Core e ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-129">For more information about writing log messages and available logging sinks and targets, see the [Logging in .NET Core and ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0) article.</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="f10d4-130">Metriche in ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="f10d4-130">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="f10d4-131">Il runtime di .NET Core fornisce un set di componenti per la creazione e l'osservazione di metriche che includono API come le <xref:System.Diagnostics.Tracing.EventSource> classi <xref:System.Diagnostics.Tracing.EventCounter> e.</span><span class="sxs-lookup"><span data-stu-id="f10d4-131">The .NET Core runtime provides a set of components for emitting and observing metrics that includes APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="f10d4-132">Queste API possono essere usate per creare dati numerici di base che possono essere usati da processi esterni come lo [strumento globale DotNet-Counters](https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md)oppure Event Tracing for Windows.</span><span class="sxs-lookup"><span data-stu-id="f10d4-132">These APIs can be used to emit basic numeric data that can be consumed by external processes like the [dotnet-counters global tool](https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="f10d4-133">Per altre informazioni sull'uso `EventCounter` di nel codice, vedere l'esercitazione [introduttiva di EventCounter](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-133">For more information about using `EventCounter` in your own code, see the [EventCounter Introduction](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md) tutorial.</span></span>

<span data-ttu-id="f10d4-134">Per metriche più avanzate e per la scrittura di dati di metrica in una gamma più ampia di archivi dati, è disponibile un progetto open source eccellente denominato metriche per le [app](https://www.app-metrics.io).</span><span class="sxs-lookup"><span data-stu-id="f10d4-134">For more advanced metrics and for writing metric data to a wider range of data stores, there's an excellent open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="f10d4-135">Questa suite di librerie fornisce un set completo di tipi per instrumentare il codice.</span><span class="sxs-lookup"><span data-stu-id="f10d4-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="f10d4-136">Offre anche pacchetti per scrivere metriche in diversi tipi di destinazioni che includono database di serie temporali, ad esempio Prometeo e InfluxDB, [applicazione Azure Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview)e altro ancora.</span><span class="sxs-lookup"><span data-stu-id="f10d4-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, [Azure Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview), and more.</span></span> <span data-ttu-id="f10d4-137">Il pacchetto NuGet [app. Metrics. AspNetCore. Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) aggiunge anche un set completo di metriche di base che vengono generate automaticamente tramite l'integrazione con il framework di ASP.NET Core e il sito Web fornisce [modelli](https://www.app-metrics.io/samples/grafana/) per la visualizzazione di tali metriche con la piattaforma di visualizzazione [Grafana](https://grafana.com/) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework, and the web site provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

<span data-ttu-id="f10d4-138">Per ulteriori informazioni e documentazione sulle metriche delle app, vedere il sito Web [app-Metrics.io](https://app-metrics.io) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-138">For more information and documentation about App Metrics, see the [app-metrics.io](https://app-metrics.io) website.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="f10d4-139">Produrre metriche</span><span class="sxs-lookup"><span data-stu-id="f10d4-139">Produce metrics</span></span>

<span data-ttu-id="f10d4-140">La maggior parte delle piattaforme di metrica supporta cinque tipi di metriche di base, descritti nella tabella seguente:</span><span class="sxs-lookup"><span data-stu-id="f10d4-140">Most metrics platforms support five basic types of metric, outlined in the following table:</span></span>

| <span data-ttu-id="f10d4-141">Tipo di metrica</span><span class="sxs-lookup"><span data-stu-id="f10d4-141">Metric type</span></span> | <span data-ttu-id="f10d4-142">Descrizione</span><span class="sxs-lookup"><span data-stu-id="f10d4-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="f10d4-143">Counter</span><span class="sxs-lookup"><span data-stu-id="f10d4-143">Counter</span></span>     | <span data-ttu-id="f10d4-144">Tiene traccia della frequenza con cui si verifica un evento, ad esempio richieste, errori e così via.</span><span class="sxs-lookup"><span data-stu-id="f10d4-144">Tracks how often something happens, such as requests, errors, and so on.</span></span> |
| <span data-ttu-id="f10d4-145">Calibro</span><span class="sxs-lookup"><span data-stu-id="f10d4-145">Gauge</span></span>       | <span data-ttu-id="f10d4-146">Registra un singolo valore che cambia nel tempo, ad esempio le connessioni attive.</span><span class="sxs-lookup"><span data-stu-id="f10d4-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="f10d4-147">Istogramma</span><span class="sxs-lookup"><span data-stu-id="f10d4-147">Histogram</span></span>   | <span data-ttu-id="f10d4-148">Misura una distribuzione di valori in limiti arbitrari.</span><span class="sxs-lookup"><span data-stu-id="f10d4-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="f10d4-149">Ad esempio, un istogramma può tenere traccia delle dimensioni del set di dati, contare il numero di record contenuti < 10, il numero di 11-100 e 101-1000 e > 1000 record.</span><span class="sxs-lookup"><span data-stu-id="f10d4-149">For example, a histogram could track data set size, counting how many contained <10 records, how many 11-100 and 101-1000, and >1000 records.</span></span> |
| <span data-ttu-id="f10d4-150">Metro</span><span class="sxs-lookup"><span data-stu-id="f10d4-150">Meter</span></span>       | <span data-ttu-id="f10d4-151">Misura la frequenza con cui si verifica un evento in diversi intervalli di tempo.</span><span class="sxs-lookup"><span data-stu-id="f10d4-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="f10d4-152">Timer</span><span class="sxs-lookup"><span data-stu-id="f10d4-152">Timer</span></span>       | <span data-ttu-id="f10d4-153">Tiene traccia della durata degli eventi e della frequenza con cui si verifica, archiviati come istogramma.</span><span class="sxs-lookup"><span data-stu-id="f10d4-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="f10d4-154">Usando le *metriche dell'app*, `IMetrics` un'interfaccia può essere ottenuta tramite l'inserimento di dipendenze e usata per registrare una qualsiasi di queste metriche per un servizio gRPC.</span><span class="sxs-lookup"><span data-stu-id="f10d4-154">Using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="f10d4-155">Nell'esempio seguente viene illustrato come contare il numero di `Get` richieste effettuate nel tempo:</span><span class="sxs-lookup"><span data-stu-id="f10d4-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="f10d4-156">Archiviare e visualizzare i dati delle metriche</span><span class="sxs-lookup"><span data-stu-id="f10d4-156">Store and visualize metrics data</span></span>

<span data-ttu-id="f10d4-157">Il modo migliore per archiviare i dati di metrica si trova in un *database di serie temporali*, un archivio dati specializzato progettato per registrare serie di dati numerici contrassegnati con timestamp.</span><span class="sxs-lookup"><span data-stu-id="f10d4-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="f10d4-158">I database più diffusi sono [Prometheus](https://prometheus.io/) e [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="f10d4-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="f10d4-159">Microsoft Azure fornisce anche l'archiviazione di metriche dedicate tramite il servizio [monitoraggio di Azure](https://docs.microsoft.com/azure/azure-monitor/overview) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="f10d4-160">La soluzione go-to corrente per la visualizzazione dei dati delle metriche è [Grafana](https://grafana.com), che funziona con un'ampia gamma di provider di archiviazione, tra cui monitoraggio di Azure, InfluxDB e Prometeo.</span><span class="sxs-lookup"><span data-stu-id="f10d4-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers including Azure Monitor, InfluxDB and Prometheus.</span></span> <span data-ttu-id="f10d4-161">La figura seguente mostra un dashboard di Grafana di esempio che visualizza le metriche della mesh del servizio Linkerd che esegue l'esempio StockData:</span><span class="sxs-lookup"><span data-stu-id="f10d4-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Dashboard di Grafana](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="f10d4-163">Avvisi basati sulle metriche</span><span class="sxs-lookup"><span data-stu-id="f10d4-163">Metrics-based alerting</span></span>

<span data-ttu-id="f10d4-164">La natura numerica dei dati di metrica significa che è ideale per guidare i sistemi di avvisi, informare gli sviluppatori o i tecnici del supporto quando un valore non rientra in una tolleranza definita.</span><span class="sxs-lookup"><span data-stu-id="f10d4-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="f10d4-165">Le piattaforme già citate offrono il supporto per gli avvisi tramite una gamma di opzioni, ad esempio messaggi di posta elettronica, messaggi di testo o visualizzazioni nel dashboard.</span><span class="sxs-lookup"><span data-stu-id="f10d4-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="f10d4-166">Traccia distribuita</span><span class="sxs-lookup"><span data-stu-id="f10d4-166">Distributed tracing</span></span>

<span data-ttu-id="f10d4-167">La *traccia distribuita* è uno sviluppo relativamente recente del monitoraggio, che è nato dal crescente uso dei microservizi e delle architetture distribuite.</span><span class="sxs-lookup"><span data-stu-id="f10d4-167">*Distributed tracing* is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="f10d4-168">Una singola richiesta da un browser client, un'applicazione o un dispositivo può essere suddivisa in molti passaggi e richieste secondarie e implica l'uso di molti servizi in una rete.</span><span class="sxs-lookup"><span data-stu-id="f10d4-168">A single request from a client browser, application, or device may be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="f10d4-169">Ciò rende difficile correlare i messaggi di log e le metriche con la richiesta specifica che li ha attivati.</span><span class="sxs-lookup"><span data-stu-id="f10d4-169">This makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="f10d4-170">La traccia distribuita applica gli identificatori alle richieste che consentono di correlare log e metriche con una determinata operazione.</span><span class="sxs-lookup"><span data-stu-id="f10d4-170">Distributed tracing applies identifiers to requests that allow logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="f10d4-171">Questa operazione è simile alla [traccia end-to-end di WCF](https://docs.microsoft.com/dotnet/framework/wcf/diagnostics/tracing/end-to-end-tracing), ma viene applicata su più piattaforme.</span><span class="sxs-lookup"><span data-stu-id="f10d4-171">This is similar to [WCF's end-to-end tracing](https://docs.microsoft.com/dotnet/framework/wcf/diagnostics/tracing/end-to-end-tracing), but applied across multiple platforms.</span></span>

<span data-ttu-id="f10d4-172">Sebbene si tratta ancora di un'area tecnologica emergente, la funzionalità di analisi distribuita è cresciuta rapidamente in popolarità e viene ora analizzata in un processo di standardizzazione.</span><span class="sxs-lookup"><span data-stu-id="f10d4-172">Although it's still a nascent technology area, distributed tracing has grown quickly in popularity and is now going through a standardization process.</span></span> <span data-ttu-id="f10d4-173">Cloud native Computing Foundation ha creato lo [standard Open Tracing](https://opentracing.io), cercando di fornire librerie indipendenti dal fornitore per lavorare con i backend, ad esempio [Jaeger](https://www.jaegertracing.io/) ed [APM Elastic](https://www.elastic.co/products/apm).</span><span class="sxs-lookup"><span data-stu-id="f10d4-173">The Cloud Native Computing Foundation created the [the Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with backends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="f10d4-174">Allo stesso tempo, Google ha creato il [progetto OpenCensus](https://opencensus.io/) per risolvere lo stesso set di problemi.</span><span class="sxs-lookup"><span data-stu-id="f10d4-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="f10d4-175">Questi due progetti vengono ora Uniti in un nuovo progetto, [OpenTelemetry](https://opentelemetry.io), che mira a essere il futuro standard del settore.</span><span class="sxs-lookup"><span data-stu-id="f10d4-175">These two projects are now being merged into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the future industry standard.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="f10d4-176">Funzionamento della traccia distribuita</span><span class="sxs-lookup"><span data-stu-id="f10d4-176">How distributed tracing works</span></span>

<span data-ttu-id="f10d4-177">La traccia distribuita si basa sul concetto di *intervalli*, ovvero operazioni a tempo denominate, che fanno parte di una singola *traccia*, che può comportare l'elaborazione in più nodi di un sistema.</span><span class="sxs-lookup"><span data-stu-id="f10d4-177">Distributed tracing is based on the concept of *Spans*: named, timed operations that are part of a single *Trace*, which may involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="f10d4-178">Quando viene avviata una nuova operazione, viene creata una traccia con un identificatore univoco.</span><span class="sxs-lookup"><span data-stu-id="f10d4-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="f10d4-179">Per ogni sottooperazione viene creato un intervallo con il proprio identificatore e identificatore di traccia.</span><span class="sxs-lookup"><span data-stu-id="f10d4-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="f10d4-180">Quando la richiesta viene passata al sistema, diversi componenti possono creare intervalli *figlio* che includono l'identificatore del *padre*.</span><span class="sxs-lookup"><span data-stu-id="f10d4-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="f10d4-181">Un intervallo ha un *contesto*che contiene gli identificatori di traccia e di intervallo, oltre a dati utili sotto forma di coppie chiave/valore (denominate *bagaglio*).</span><span class="sxs-lookup"><span data-stu-id="f10d4-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key/value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="f10d4-182">Traccia distribuita con DiagnosticSource</span><span class="sxs-lookup"><span data-stu-id="f10d4-182">Distributed tracing with DiagnosticSource</span></span>

<span data-ttu-id="f10d4-183">.NET Core dispone di un modulo interno che esegue il mapping delle tracce e delle ampiezze distribuite: [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="f10d4-183">.NET Core has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="f10d4-184">Oltre a fornire un modo semplice per produrre e utilizzare la diagnostica in un processo, il `DiagnosticSource` modulo ha il concetto di un' *attività*, che è in realtà un'implementazione di una traccia distribuita o un intervallo all'interno di una traccia.</span><span class="sxs-lookup"><span data-stu-id="f10d4-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *Activity*, which is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="f10d4-185">Gli elementi interni del modulo si occupano delle attività padre/figlio, inclusi gli identificatori di allocazione.</span><span class="sxs-lookup"><span data-stu-id="f10d4-185">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="f10d4-186">Per ulteriori informazioni sull'utilizzo del `Activity` tipo, vedere la [Guida dell'utente dell'attività su GitHub](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-186">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide)</span></span>

<span data-ttu-id="f10d4-187">Poiché DiagnosticSource fa parte del framework principale, è supportato da diversi componenti di base, tra cui <xref:System.Net.Http.HttpClient>Entity Framework Core e ASP.NET Core, incluso il supporto esplicito nel Framework gRPC.</span><span class="sxs-lookup"><span data-stu-id="f10d4-187">Because DiagnosticSource is a part of the core framework, it's supported by several core components, including <xref:System.Net.Http.HttpClient>, Entity Framework Core and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="f10d4-188">Quando ASP.NET Core riceve una richiesta, verifica la presenza di una coppia di intestazioni HTTP corrispondenti allo standard del [contesto di traccia W3C](https://www.w3.org/TR/trace-context) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-188">When ASP.NET Core receives a request, it  checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="f10d4-189">Se le intestazioni vengono trovate, un'attività viene avviata usando i valori Identity e il contesto dalle intestazioni.</span><span class="sxs-lookup"><span data-stu-id="f10d4-189">If the headers are found, an Activity is started using the identity values and context from the headers.</span></span> <span data-ttu-id="f10d4-190">Se non viene trovata alcuna intestazione, viene avviata un'attività con valori Identity generati che corrispondono al formato standard.</span><span class="sxs-lookup"><span data-stu-id="f10d4-190">If no headers are found, an Activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="f10d4-191">Qualsiasi diagnostica generata dal Framework o dal codice dell'applicazione durante il ciclo di vita di questa attività può essere contrassegnata con gli identificatori di traccia e di intervallo.</span><span class="sxs-lookup"><span data-stu-id="f10d4-191">Any diagnostics generated by the framework or by application code during the lifetime of this Activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="f10d4-192">Il `HttpClient` supporto si estende ulteriormente controllando la presenza di un'attività corrente per ogni richiesta e aggiungendo automaticamente le intestazioni di traccia alla richiesta in uscita.</span><span class="sxs-lookup"><span data-stu-id="f10d4-192">The `HttpClient` support extends this further by checking for a current Activity on every request and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="f10d4-193">Le librerie client e server ASP.NET Core gRPC includono il supporto esplicito per DiagnosticSource e attività e creeranno le attività e utilizzeranno automaticamente le informazioni di intestazione.</span><span class="sxs-lookup"><span data-stu-id="f10d4-193">The ASP.NET Core gRPC client and server libraries include explicit support for DiagnosticSource and Activity, and will create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="f10d4-194">Tutto questo si verifica solo se un *listener* sta consumando le informazioni di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="f10d4-194">All of this only happens if a *listener* is consuming the diagnostic information.</span></span> <span data-ttu-id="f10d4-195">Se non è presente alcun listener, non viene scritta alcuna diagnostica e non viene creata alcuna attività.</span><span class="sxs-lookup"><span data-stu-id="f10d4-195">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsources-and-activities"></a><span data-ttu-id="f10d4-196">Aggiungere DiagnosticSources e attività personali</span><span class="sxs-lookup"><span data-stu-id="f10d4-196">Add your own DiagnosticSources and Activities</span></span>

<span data-ttu-id="f10d4-197">Sebbene una buona quantità di dati venga generata automaticamente da ASP.NET Core, tra cui gRPC, nonché Entity Framework Core e `HttpClient`, potrebbe essere necessario aggiungere la propria diagnostica o creare intervalli espliciti all'interno del codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f10d4-197">Although a good quantity of data is automatically generated by ASP.NET Core, including gRPC, as well as Entity Framework Core and `HttpClient`, you may wish to add your own diagnostics or create explicit spans within your application code.</span></span> <span data-ttu-id="f10d4-198">Per informazioni dettagliate su come implementare la diagnostica personalizzata, vedere la guida dell' [utente di DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) e la [Guida dell'utente dell'attività](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage) .</span><span class="sxs-lookup"><span data-stu-id="f10d4-198">Refer to the [DiagnosticSource User Guide](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage) for details on how to implement your own diagnostics.</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="f10d4-199">Archiviare dati di traccia distribuiti</span><span class="sxs-lookup"><span data-stu-id="f10d4-199">Store distributed trace data</span></span>

<span data-ttu-id="f10d4-200">Al momento della stesura del progetto OpenTelemetry è ancora nelle fasi iniziali e sono disponibili solo pacchetti di qualità Alpha per le applicazioni .NET.</span><span class="sxs-lookup"><span data-stu-id="f10d4-200">At the time of writing the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="f10d4-201">Il progetto OpenTracing offre librerie più mature, ma queste verranno sostituite dalle librerie OpenTelemetry in futuro.</span><span class="sxs-lookup"><span data-stu-id="f10d4-201">The OpenTracing project offers more mature libraries, but these will be superseded by the OpenTelemetry libraries in the future.</span></span>

<span data-ttu-id="f10d4-202">L'API OpenTracing è descritta di seguito.</span><span class="sxs-lookup"><span data-stu-id="f10d4-202">The OpenTracing API is described below.</span></span> <span data-ttu-id="f10d4-203">Se si preferisce usare l'API OpenTelemetry più recente nell'applicazione, vedere il [repository OpenTelemetry .NET SDK su GitHub](https://github.com/open-telemetry/opentelemetry-dotnet).</span><span class="sxs-lookup"><span data-stu-id="f10d4-203">If you would prefer to use the newer OpenTelemetry API in your application, refer to the [OpenTelemetry .NET SDK repository on GitHub](https://github.com/open-telemetry/opentelemetry-dotnet).</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="f10d4-204">Usare il pacchetto OpenTracing per archiviare i dati di traccia distribuiti</span><span class="sxs-lookup"><span data-stu-id="f10d4-204">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="f10d4-205">[Pacchetto NuGet OpenTracing](https://www.nuget.org/packages/OpenTracing/) che supporta tutti i back-end conformi a OpenTracing (che possono essere usati indipendentemente da `DiagnosticSource`).</span><span class="sxs-lookup"><span data-stu-id="f10d4-205">The [an OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) that supports all OpenTracing-compliant back-ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="f10d4-206">È disponibile un pacchetto aggiuntivo dal progetto contributi API OpenTracing, [OpenTracing. contrib. Netcore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/), che aggiunge un `DiagnosticSource` listener e scrive eventi e attività in un back-end automaticamente.</span><span class="sxs-lookup"><span data-stu-id="f10d4-206">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/), which adds a `DiagnosticSource` listener and writes events and activities to a back-end automatically.</span></span> <span data-ttu-id="f10d4-207">L'abilitazione di questo pacchetto è semplice come installarla da NuGet e aggiungerla come servizio nella `Startup` classe.</span><span class="sxs-lookup"><span data-stu-id="f10d4-207">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="f10d4-208">Il pacchetto OpenTracing è un livello di astrazione e, di conseguenza, richiede un'implementazione specifica del back-end.</span><span class="sxs-lookup"><span data-stu-id="f10d4-208">The OpenTracing package is an abstraction layer and as such it requires a back-end-specific implementation.</span></span> <span data-ttu-id="f10d4-209">Le implementazioni dell'API OpenTracing sono disponibili per i back-end open source seguenti.</span><span class="sxs-lookup"><span data-stu-id="f10d4-209">OpenTracing API implementations are available for the following open source back-ends.</span></span>

| <span data-ttu-id="f10d4-210">nome</span><span class="sxs-lookup"><span data-stu-id="f10d4-210">Name</span></span> | <span data-ttu-id="f10d4-211">Pacchetto</span><span class="sxs-lookup"><span data-stu-id="f10d4-211">Package</span></span> | <span data-ttu-id="f10d4-212">Sito Web</span><span class="sxs-lookup"><span data-stu-id="f10d4-212">Web site</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="f10d4-213">Jaeger</span><span class="sxs-lookup"><span data-stu-id="f10d4-213">Jaeger</span></span> | [<span data-ttu-id="f10d4-214">Jaeger</span><span class="sxs-lookup"><span data-stu-id="f10d4-214">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="f10d4-215">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="f10d4-215">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="f10d4-216">APM elastica</span><span class="sxs-lookup"><span data-stu-id="f10d4-216">Elastic APM</span></span> | [<span data-ttu-id="f10d4-217">Elastic. APM. NetCoreAll</span><span class="sxs-lookup"><span data-stu-id="f10d4-217">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="f10d4-218">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="f10d4-218">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="f10d4-219">Per altre informazioni sull'API OpenTracing per .NET, vedere i repository [OpenTracing per C# ](https://github.com/opentracing/opentracing-csharp) e [OpenTracing contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) su GitHub.</span><span class="sxs-lookup"><span data-stu-id="f10d4-219">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="f10d4-220">[Precedente](load-balancing.md)
>[Successivo](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="f10d4-220">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>
