---
title: Autorizzazione basata su attestazioni con WIF
ms.date: 03/30/2017
ms.assetid: e24000a3-8fd8-4c0e-bdf0-39882cc0f6d8
author: BrucePerlerMS
ms.openlocfilehash: ebf4c28bd2a46c21535b596af22d1fa420d20e71
ms.sourcegitcommit: 289e06e904b72f34ac717dbcc5074239b977e707
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/17/2019
ms.locfileid: "71045497"
---
# <a name="claims-based-authorization-using-wif"></a><span data-ttu-id="d3392-102">Autorizzazione basata su attestazioni con WIF</span><span class="sxs-lookup"><span data-stu-id="d3392-102">Claims Based Authorization Using WIF</span></span>
<span data-ttu-id="d3392-103">Tramite l'autorizzazione di un'applicazione relying party vengono determinate le risorse di un'identità autenticata a cui è consentito l'accesso e le operazioni eseguibili in queste risorse.</span><span class="sxs-lookup"><span data-stu-id="d3392-103">In a relying party application, authorization determines what resources an authenticated identity is allowed to access and what operations it is allowed to perform on those resources.</span></span> <span data-ttu-id="d3392-104">Un'autorizzazione non corretta o debole comporta la diffusione di informazioni e l'alterazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="d3392-104">Improper or weak authorization leads to information disclosure and data tampering.</span></span> <span data-ttu-id="d3392-105">In questo argomento vengono descritti gli approcci disponibili per implementare l'autorizzazione per i servizi e le applicazioni Web ASP.NET in grado di riconoscere attestazioni mediante WIF (Windows Identity Foundation) e un servizio token di sicurezza (STS), ad esempio il Servizio di controllo di accesso (ACS) di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="d3392-105">This topic outlines the available approaches to implementing authorization for claims-aware ASP.NET web applications and services using Windows Identity Foundation (WIF) and a Security Token Service (STS), for example, the Windows Azure Access Control Service (ACS).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="d3392-106">Panoramica</span><span class="sxs-lookup"><span data-stu-id="d3392-106">Overview</span></span>  
 <span data-ttu-id="d3392-107">Fin dalla prima versione, in .NET Framework viene fornito un meccanismo flessibile per implementare l'autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="d3392-107">Since its first version, the .NET Framework has offered a flexible mechanism for implementing authorization.</span></span> <span data-ttu-id="d3392-108">Questo meccanismo è basato su due interfacce semplici, ovvero **IPrincipal** e **IIdentity**.</span><span class="sxs-lookup"><span data-stu-id="d3392-108">This mechanism is based on two simple interfaces—**IPrincipal** and **IIdentity**.</span></span> <span data-ttu-id="d3392-109">Le implementazioni concrete di **IIdentity** rappresentano un utente autenticato.</span><span class="sxs-lookup"><span data-stu-id="d3392-109">Concrete implementations of **IIdentity** represent an authenticated user.</span></span> <span data-ttu-id="d3392-110">Ad esempio, l'implementazione di **WindowsIdentity** rappresenta un utente autenticato da Active Directory e quella di **GenericIdentity** rappresenta un utente la cui identità viene verificata tramite un processo di autenticazione personalizzato.</span><span class="sxs-lookup"><span data-stu-id="d3392-110">For example, the **WindowsIdentity** implementation represents a user who is authenticated by Active Directory, and **GenericIdentity** represents a user whose identity is verified via a custom authentication process.</span></span> <span data-ttu-id="d3392-111">Le implementazioni concrete di **IPrincipal** consentono di verificare le autorizzazioni usando ruoli in base all'archivio ruoli.</span><span class="sxs-lookup"><span data-stu-id="d3392-111">Concrete implementations of **IPrincipal** help to check permissions using roles depending on the role store.</span></span> <span data-ttu-id="d3392-112">**WindowsPrincipal**, ad esempio, verifica l'appartenenza di **WindowsIdentity** ai gruppi di Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d3392-112">For example, **WindowsPrincipal** checks **WindowsIdentity** for membership in Active Directory groups.</span></span> <span data-ttu-id="d3392-113">Questo controllo viene eseguito chiamando il metodo **IsInRole** sull'interfaccia **IPrincipal**</span><span class="sxs-lookup"><span data-stu-id="d3392-113">This check is performed by calling the **IsInRole** method on the **IPrincipal** interface.</span></span> <span data-ttu-id="d3392-114">e viene definito controllo dell'accesso basato sui ruoli (RBAC).</span><span class="sxs-lookup"><span data-stu-id="d3392-114">Checking access based on roles is called Role-Based Access Control (RBAC).</span></span> <span data-ttu-id="d3392-115">Per altre informazioni, vedere [Controllo degli accessi in base al ruolo](claims-based-authorization-using-wif.md#BKMK_1).</span><span class="sxs-lookup"><span data-stu-id="d3392-115">For more information, see [Role-Based Access Control](claims-based-authorization-using-wif.md#BKMK_1).</span></span>  <span data-ttu-id="d3392-116">Le attestazioni possono essere utilizzate per trasferire le informazioni sui ruoli per supportare i comuni meccanismi dell'autorizzazione basata sui ruoli.</span><span class="sxs-lookup"><span data-stu-id="d3392-116">Claims can be used to carry information about roles to support familiar, role-based authorization mechanisms.</span></span>  
  
 <span data-ttu-id="d3392-117">Inoltre, possono essere utilizzate per abilitare decisioni di autorizzazione più complesse oltre ai ruoli.</span><span class="sxs-lookup"><span data-stu-id="d3392-117">Claims can also be used to enable more complicated authorization decisions beyond roles.</span></span> <span data-ttu-id="d3392-118">Le attestazioni possono essere basate su qualsiasi informazione relativa all'utente, ovvero età, codice postale, numero di scarpe e così via. Un meccanismo di controllo degli accessi basato su attestazioni arbitrarie è definito autorizzazione basata sulle attestazioni.</span><span class="sxs-lookup"><span data-stu-id="d3392-118">Claims can be based on virtually any information about the user - age, zip code, shoe size, etc. An access control mechanism that is based on arbitrary claims is called claims-based authorization.</span></span> <span data-ttu-id="d3392-119">Per altre informazioni, vedere [Autorizzazione basata sulle attestazioni](claims-based-authorization-using-wif.md#BKMK_2).</span><span class="sxs-lookup"><span data-stu-id="d3392-119">For more information, see [Claims-based Authorization](claims-based-authorization-using-wif.md#BKMK_2).</span></span>  
  
<a name="BKMK_1"></a>   
## <a name="role-based-access-control"></a><span data-ttu-id="d3392-120">Controllo degli accessi in base al ruolo</span><span class="sxs-lookup"><span data-stu-id="d3392-120">Role-Based Access Control</span></span>  
 <span data-ttu-id="d3392-121">Il controllo dell'accesso basato sui ruoli è un approccio di autorizzazione in cui le autorizzazioni utente vengono gestite e applicate da un'applicazione basata sui ruoli utente.</span><span class="sxs-lookup"><span data-stu-id="d3392-121">RBAC is an authorization approach in which user permissions are managed and enforced by an application based on user roles.</span></span> <span data-ttu-id="d3392-122">Se un utente dispone di un ruolo necessario per l'esecuzione di un'azione, l'accesso viene consentito; in caso contrario, viene negato.</span><span class="sxs-lookup"><span data-stu-id="d3392-122">If a user has a role that is required to perform an action, the access is granted; otherwise, access is denied.</span></span>  
  
### <a name="iprincipalisinrole-method"></a><span data-ttu-id="d3392-123">Metodo IPrincipal.IsInRole</span><span class="sxs-lookup"><span data-stu-id="d3392-123">IPrincipal.IsInRole Method</span></span>  
 <span data-ttu-id="d3392-124">Per implementare il controllo degli accessi in base al ruolo nelle applicazioni in grado di riconoscere attestazioni, usare il metodo **IsInRole ()** nell'interfaccia **IPrincipal** , esattamente come si farebbe con le applicazioni non in grado di riconoscere attestazioni.</span><span class="sxs-lookup"><span data-stu-id="d3392-124">To implement the RBAC approach in claims-aware applications, use the **IsInRole()** method in the **IPrincipal** interface, just as you would in non-claims-aware applications.</span></span> <span data-ttu-id="d3392-125">Il metodo **IsInRole()** può essere usato in diversi modi:</span><span class="sxs-lookup"><span data-stu-id="d3392-125">There are several ways of using the **IsInRole()** method:</span></span>  
  
- <span data-ttu-id="d3392-126">Eseguendo una chiamata esplicita su **IPrincipal.IsInRole("Administrator")** .</span><span class="sxs-lookup"><span data-stu-id="d3392-126">Explicitly calling on **IPrincipal.IsInRole("Administrator")**.</span></span> <span data-ttu-id="d3392-127">In questo approccio, il risultato è un valore booleano.</span><span class="sxs-lookup"><span data-stu-id="d3392-127">In this approach, the outcome is a Boolean.</span></span> <span data-ttu-id="d3392-128">Utilizzarlo nelle istruzioni condizionali.</span><span class="sxs-lookup"><span data-stu-id="d3392-128">Use it in your conditional statements.</span></span> <span data-ttu-id="d3392-129">Può essere utilizzato in modo arbitrario in qualsiasi punto nel codice.</span><span class="sxs-lookup"><span data-stu-id="d3392-129">It can be used arbitrarily any place in your code.</span></span>  
  
- <span data-ttu-id="d3392-130">Usando la richiesta di sicurezza **PrincipalPermission.Demand()** .</span><span class="sxs-lookup"><span data-stu-id="d3392-130">Using the security demand **PrincipalPermission.Demand()**.</span></span> <span data-ttu-id="d3392-131">In questo approccio, il risultato è un'eccezione in caso di richiesta non soddisfatta.</span><span class="sxs-lookup"><span data-stu-id="d3392-131">In this approach, the outcome is an exception in case the demand is not satisfied.</span></span> <span data-ttu-id="d3392-132">Deve rientrare nella strategia di gestione delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="d3392-132">This should fit your exception handling strategy.</span></span> <span data-ttu-id="d3392-133">La generazione di eccezioni è molto più costosa dal punto di vista delle prestazioni rispetto alla restituzione di un valore booleano.</span><span class="sxs-lookup"><span data-stu-id="d3392-133">Throwing exceptions is much more expensive from a performance perspective compared to returning Boolean.</span></span> <span data-ttu-id="d3392-134">Può essere utilizzata in qualsiasi punto nel codice.</span><span class="sxs-lookup"><span data-stu-id="d3392-134">This can be used any place in your code.</span></span>  
  
- <span data-ttu-id="d3392-135">Usando gli attributi dichiarativi **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]** .</span><span class="sxs-lookup"><span data-stu-id="d3392-135">Using the declarative attributes **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]**.</span></span> <span data-ttu-id="d3392-136">Questo approccio viene chiamato dichiarativo, in quanto viene utilizzato per decorare i metodi.</span><span class="sxs-lookup"><span data-stu-id="d3392-136">This approach is called declarative, because it is used to decorate methods.</span></span> <span data-ttu-id="d3392-137">Non può essere utilizzato in blocchi di codice nelle implementazioni del metodo.</span><span class="sxs-lookup"><span data-stu-id="d3392-137">It cannot be used in code blocks inside the method’s implementations.</span></span> <span data-ttu-id="d3392-138">Il risultato è un'eccezione in caso di richiesta non soddisfatta.</span><span class="sxs-lookup"><span data-stu-id="d3392-138">The outcome is an exception in case the demand is not satisfied.</span></span> <span data-ttu-id="d3392-139">È necessario assicurarsi che rientri nella strategia di gestione delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="d3392-139">You should make sure that it fits your exception-handling strategy.</span></span>  
  
- <span data-ttu-id="d3392-140">Usando l'autorizzazione basata su URL tramite la sezione **\<authorization>** in **web.config**. Questo approccio è utile quando si gestisce l'autorizzazione in un livello URL.</span><span class="sxs-lookup"><span data-stu-id="d3392-140">Using URL authorization, using the **\<authorization>** section in **web.config**. This approach is suitable when you are managing authorization on a URL level.</span></span> <span data-ttu-id="d3392-141">Si tratta del livello più grezzo tra quelli indicati in precedenza.</span><span class="sxs-lookup"><span data-stu-id="d3392-141">This is the most coarse level among those previously mentioned.</span></span> <span data-ttu-id="d3392-142">Il vantaggio di questo approccio è che le modifiche vengono apportate nel file di configurazione, pertanto il codice non deve essere compilato per sfruttare la modifica.</span><span class="sxs-lookup"><span data-stu-id="d3392-142">The advantage of this approach is that changes are made in the configuration file, which means that the code should not be compiled to take advantage of the change.</span></span>  
  
### <a name="expressing-roles-as-claims"></a><span data-ttu-id="d3392-143">Espressione dei ruoli come attestazioni</span><span class="sxs-lookup"><span data-stu-id="d3392-143">Expressing Roles as Claims</span></span>  
 <span data-ttu-id="d3392-144">Quando viene chiamato il metodo **IsInRole()** , viene eseguito un controllo per determinare se l'utente corrente dispone del ruolo in questione.</span><span class="sxs-lookup"><span data-stu-id="d3392-144">When the **IsInRole()** method is called, there is a check made to see if the current user has that role.</span></span> <span data-ttu-id="d3392-145">Nelle applicazioni in grado di riconoscere attestazioni il ruolo è espresso da un tipo di attestazione del ruolo che deve essere disponibile nel token.</span><span class="sxs-lookup"><span data-stu-id="d3392-145">In claims-aware applications, the role is expressed by a role claim type that should be available in the token.</span></span> <span data-ttu-id="d3392-146">Il tipo di attestazione del ruolo viene espresso tramite l'URI seguente:</span><span class="sxs-lookup"><span data-stu-id="d3392-146">The role claim type is expressed using the following URI:</span></span>  
  
 `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`
  
 <span data-ttu-id="d3392-147">Vi sono diversi modi per arricchire un token con un tipo di attestazione del ruolo:</span><span class="sxs-lookup"><span data-stu-id="d3392-147">There are several ways to enrich a token with a role claim type:</span></span>  
  
- <span data-ttu-id="d3392-148">**Durante il rilascio del token**.</span><span class="sxs-lookup"><span data-stu-id="d3392-148">**During token issuance**.</span></span> <span data-ttu-id="d3392-149">Quando un utente viene autenticato, l'attestazione del ruolo può essere emessa dal servizio token di sicurezza del provider di identità o da un provider di federazioni, ad esempio il Servizio di controllo di accesso di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="d3392-149">When a user is authenticated the role claim can be issued by the identity provider STS or by a federation provider such as the Windows Azure Access Control Service (ACS).</span></span>  
  
- <span data-ttu-id="d3392-150">**Trasformando le attestazioni arbitrarie in tipi di attestazioni del ruolo tramite ClaimsAuthenticationManager**.</span><span class="sxs-lookup"><span data-stu-id="d3392-150">**Transforming arbitrary claims into of claims role type using ClaimsAuthenticationManager**.</span></span> <span data-ttu-id="d3392-151">ClaimsAuthenticationManager è un componente fornito come parte di WIF.</span><span class="sxs-lookup"><span data-stu-id="d3392-151">The ClaimsAuthenticationManager is a component that ships as part of WIF.</span></span> <span data-ttu-id="d3392-152">Consente l'intercettazione delle richieste quando tramite esse viene avviata un'applicazione, esaminando i token e trasformandoli con l'aggiunta, la modifica o la rimozione di attestazioni.</span><span class="sxs-lookup"><span data-stu-id="d3392-152">It allows requests to be intercepted when they launch an application, inspecting tokens and transforming them by adding, changing, or removing claims.</span></span> <span data-ttu-id="d3392-153">Per ulteriori informazioni sull'utilizzo di ClaimsAuthenticationManager per la trasformazione delle attestazioni, vedere [procedura: Implementare il controllo degli accessi in base al ruolo (RBAC) in un'applicazione ASP.NET in](https://go.microsoft.com/fwlink/?LinkID=247445)grado di riconoscere attestazioni usando WIF e ACS.</span><span class="sxs-lookup"><span data-stu-id="d3392-153">For more information about how to use ClaimsAuthenticationManager for transforming claims, see [How To: Implement Role Based Access Control (RBAC) in a Claims Aware ASP.NET Application Using WIF and ACS](https://go.microsoft.com/fwlink/?LinkID=247445).</span></span>  
  
- <span data-ttu-id="d3392-154">**Eseguendo il mapping di attestazioni arbitrarie a un tipo di ruolo tramite la sezione di configurazione samlSecurityTokenRequirement**. Si tratta di un approccio dichiarativo in cui la trasformazione delle attestazioni viene eseguita usando solo la configurazione, senza intervenire sul codice.</span><span class="sxs-lookup"><span data-stu-id="d3392-154">**Mapping arbitrary claims to a role type using the samlSecurityTokenRequirement configuration section**—A declarative approach where the claims transformation is done using only the configuration and no coding is required.</span></span>  
  
<a name="BKMK_2"></a>   
## <a name="claims-based-authorization"></a><span data-ttu-id="d3392-155">Autorizzazione basata sulle attestazioni</span><span class="sxs-lookup"><span data-stu-id="d3392-155">Claims-based Authorization</span></span>  
 <span data-ttu-id="d3392-156">L'autorizzazione basata sulle attestazioni è un approccio in cui la decisione di autorizzazione di concedere o negare l'accesso è basata sulla logica arbitraria che utilizza i dati disponibili nelle attestazioni per prendere la decisione.</span><span class="sxs-lookup"><span data-stu-id="d3392-156">Claims-based authorization is an approach where the authorization decision to grant or deny access is based on arbitrary logic that uses data available in claims to make the decision.</span></span> <span data-ttu-id="d3392-157">Si tenga presente che nel caso del controllo dell'accesso basato sui ruoli, l'unica attestazione utilizzata è quella di tipo del ruolo.</span><span class="sxs-lookup"><span data-stu-id="d3392-157">Recall that in the case of RBAC, the only claim used was role type claim.</span></span> <span data-ttu-id="d3392-158">Per controllare se l'utente appartiene o meno a un ruolo specifico, è stata utilizzata un'attestazione di tipo del ruolo.</span><span class="sxs-lookup"><span data-stu-id="d3392-158">A role type claim was used to check if the user belongs to specific role or not.</span></span> <span data-ttu-id="d3392-159">Per illustrare il processo per prendere decisioni di autorizzazione utilizzando l'approccio basato sulle attestazioni, si tengano in considerazione i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="d3392-159">To illustrate the process of making the authorization decisions using claims-based authorization approach, consider the following steps:</span></span>  
  
1. <span data-ttu-id="d3392-160">Dall'applicazione viene ricevuta una richiesta in cui l'utente deve essere autenticato.</span><span class="sxs-lookup"><span data-stu-id="d3392-160">The application receives a request that requires the user is authenticated.</span></span>  
  
2. <span data-ttu-id="d3392-161">Tramite WIF l'utente viene reindirizzato al provider di identità. Dopo essere stata autenticata, la richiesta di applicazione viene eseguita con un token di sicurezza associato che rappresenta l'utente che contiene le attestazioni su di esse.</span><span class="sxs-lookup"><span data-stu-id="d3392-161">WIF redirects the user to their identity provider, after they are authenticated the application request is made with an associated security token representing the user containing claims about them.</span></span> <span data-ttu-id="d3392-162">Queste attestazioni vengono associate da WIF all'entità principale che rappresenta l'utente.</span><span class="sxs-lookup"><span data-stu-id="d3392-162">WIF associates those claims with the principal that represents the user.</span></span>  
  
3. <span data-ttu-id="d3392-163">Tramite l'applicazione le attestazioni vengono passate al meccanismo della logica delle decisioni.</span><span class="sxs-lookup"><span data-stu-id="d3392-163">The application passes the claims to the decision logic mechanism.</span></span> <span data-ttu-id="d3392-164">Può essere il codice in memoria, una chiamata a un servizio Web, una query a un database, un motore regole avanzato o l'utilizzo di ClaimsAuthorizationManager.</span><span class="sxs-lookup"><span data-stu-id="d3392-164">It can be in-memory code, a call to a web service, a query to a database, a sophisticated rules engine, or using the ClaimsAuthorizationManager.</span></span>  
  
4. <span data-ttu-id="d3392-165">Con il meccanismo delle decisioni viene calcolato il risultato in base alle attestazioni.</span><span class="sxs-lookup"><span data-stu-id="d3392-165">The decision mechanism calculates the outcome based on the claims.</span></span>  
  
5. <span data-ttu-id="d3392-166">L'accesso viene consentito se il risultato è true e viene negato se è false.</span><span class="sxs-lookup"><span data-stu-id="d3392-166">Access is granted if the outcome is true and denied if it is false.</span></span> <span data-ttu-id="d3392-167">Ad esempio, la regola potrebbe essere che l'utente ha 21 anni, o anche di più, e vive nello stato di Washington.</span><span class="sxs-lookup"><span data-stu-id="d3392-167">For example, the rule might be that the user is of age 21 or above and lives in Washington State.</span></span>  
  
 <span data-ttu-id="d3392-168">L'oggetto <xref:System.Security.Claims.ClaimsAuthorizationManager> è utile per esternalizzare la logica delle decisioni per l'autorizzazione basata su attestazioni nelle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="d3392-168"><xref:System.Security.Claims.ClaimsAuthorizationManager> is useful for externalizing the decision logic for  claims-based authorization in your applications.</span></span> <span data-ttu-id="d3392-169">ClaimsAuthorizationManager è un componente di WIF fornito come parte di .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="d3392-169">ClaimsAuthorizationManager is a WIF component that ships as part of .NET 4.5.</span></span> <span data-ttu-id="d3392-170">Con ClaimsAuthorizationManager è possibile intercettare le richieste in ingresso e implementare qualsiasi logica di scelta per prendere decisioni di autorizzazioni basate sulle attestazioni in ingresso.</span><span class="sxs-lookup"><span data-stu-id="d3392-170">ClaimsAuthorizationManager allows you to intercept incoming requests and implement any logic of your choice to make authorization decisions based on the incoming claims.</span></span> <span data-ttu-id="d3392-171">Questo aspetto diventa importante quando è necessario modificare la logica dell'autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="d3392-171">This becomes important when authorization logic needs to be changed.</span></span> <span data-ttu-id="d3392-172">In tal caso, l'utilizzo di ClaimsAuthorizationManager non influirà sull'integrità dell'applicazione, quindi riducendo la probabilità di un errore di applicazione come risultato della modifica.</span><span class="sxs-lookup"><span data-stu-id="d3392-172">In that case, using ClaimsAuthorizationManager will not affect the application’s integrity, thereby reducing the likelihood of an application error as a result of the change.</span></span> <span data-ttu-id="d3392-173">Per altre informazioni su come usare ClaimsAuthorizationManager per implementare il controllo degli accessi in base alle [attestazioni, vedere Procedura: Implementare l'autorizzazione delle attestazioni in un'applicazione ASP.NET in grado di](https://go.microsoft.com/fwlink/?LinkID=247446)riconoscere attestazioni mediante WIF e ACS.</span><span class="sxs-lookup"><span data-stu-id="d3392-173">To learn more about how to use ClaimsAuthorizationManager to implement claims-based access control, see [How To: Implement Claims Authorization in a Claims Aware ASP.NET Application Using WIF and ACS](https://go.microsoft.com/fwlink/?LinkID=247446).</span></span>
