---
title: Panoramica del modulo di autenticazione WSFederation
ms.date: 03/30/2017
ms.assetid: 02c4d5e8-f0a7-49ee-9cf5-3647578510ad
author: BrucePerlerMS
ms.openlocfilehash: eaf53a352238161ccec1b481649074d322954905
ms.sourcegitcommit: 205b9a204742e9c77256d43ac9d94c3f82909808
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/10/2019
ms.locfileid: "70851510"
---
# <a name="wsfederation-authentication-module-overview"></a><span data-ttu-id="b79b8-102">Panoramica del modulo di autenticazione WSFederation</span><span class="sxs-lookup"><span data-stu-id="b79b8-102">WSFederation Authentication Module Overview</span></span>
<span data-ttu-id="b79b8-103">Windows Identity Foundation (WIF) include il supporto per l'autenticazione federata nelle applicazioni ASP.NET tramite il modulo di autenticazione WS-Federated (WS-FAM, WS-Federated Authentication Module).</span><span class="sxs-lookup"><span data-stu-id="b79b8-103">Windows Identity Foundation (WIF) includes support for federated authentication in ASP.NET applications through the WS-Federated Authentication Module (WS-FAM).</span></span> <span data-ttu-id="b79b8-104">Questo argomento aiuta capire come funziona l'autenticazione federata e come usarla.</span><span class="sxs-lookup"><span data-stu-id="b79b8-104">This topic will help you understand how federated authentication works and how to use it.</span></span>  
  
### <a name="overview-of-federated-authentication"></a><span data-ttu-id="b79b8-105">Panoramica dell'autenticazione federata</span><span class="sxs-lookup"><span data-stu-id="b79b8-105">Overview of Federated Authentication</span></span>  
 <span data-ttu-id="b79b8-106">L'autenticazione federata consente a un servizio token di sicurezza in un dominio di trust di fornire informazioni di autenticazione a un servizio token di sicurezza in un altro dominio di trust quando tra i due domini c'è una relazione di trust.</span><span class="sxs-lookup"><span data-stu-id="b79b8-106">Federated authentication allows a Security Token Service (STS) in one trust domain to provide authentication information to an STS in another trust domain when there is a trust relationship between the two domains.</span></span> <span data-ttu-id="b79b8-107">Un esempio è illustrato nella figura seguente:</span><span class="sxs-lookup"><span data-stu-id="b79b8-107">An example of this is shown in the following illustration:</span></span>  
  
 ![Diagramma che illustra lo scenario di autenticazione federata.](./media/wsfederation-authentication-module-overview/federated-authentication.gif)  
  
1. <span data-ttu-id="b79b8-109">Un client nel dominio di trust Fabrikam invia una richiesta a un'applicazione relying party nel dominio di trust Contoso.</span><span class="sxs-lookup"><span data-stu-id="b79b8-109">A client in the Fabrikam trust domain sends a request to a Relying Party (RP) application in the Contoso trust domain.</span></span>  
  
2. <span data-ttu-id="b79b8-110">La relying party reindirizza il client a un servizio token di sicurezza nel dominio di trust Contoso.</span><span class="sxs-lookup"><span data-stu-id="b79b8-110">The RP redirects the client to an STS in the Contoso trust domain.</span></span> <span data-ttu-id="b79b8-111">Questo servizio token di sicurezza non conosce il client.</span><span class="sxs-lookup"><span data-stu-id="b79b8-111">This STS has no knowledge of the client.</span></span>  
  
3. <span data-ttu-id="b79b8-112">Il servizio token di sicurezza di Contoso reindirizza il client a un servizio token di sicurezza nel dominio di trust Fabrikam, con cui il dominio di trust Contoso ha una relazione di trust.</span><span class="sxs-lookup"><span data-stu-id="b79b8-112">The Contoso STS redirects the client to an STS in the Fabrikam trust domain, with which the Contoso trust domain has a trust relationship.</span></span>  
  
4. <span data-ttu-id="b79b8-113">Il servizio token di sicurezza di Fabrikam verifica l'identità del client e rilascia un token di sicurezza al servizio token di sicurezza di Contoso.</span><span class="sxs-lookup"><span data-stu-id="b79b8-113">The Fabrikam STS verifies the client’s identity and issues a security token to the Contoso STS.</span></span>  
  
5. <span data-ttu-id="b79b8-114">Il servizio token di sicurezza di Contoso usa il token di Fabrikam per creare un proprio token che può essere usato dalla relying party e lo invia alla relying party.</span><span class="sxs-lookup"><span data-stu-id="b79b8-114">The Contoso STS uses the Fabrikam token to create its own token that can be used by the RP and sends it to the RP.</span></span>  
  
6. <span data-ttu-id="b79b8-115">La relying party estrae le attestazioni del client dal token di sicurezza e prende una decisione relativa all'autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="b79b8-115">The RP extracts the client’s claims from the security token and makes an authorization decision.</span></span>  
  
### <a name="using-the-federated-authentication-module-with-aspnet"></a><span data-ttu-id="b79b8-116">Uso del modulo di autenticazione federata con ASP.NET</span><span class="sxs-lookup"><span data-stu-id="b79b8-116">Using the Federated Authentication Module with ASP.NET</span></span>  
 <span data-ttu-id="b79b8-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>WS-FAM è un modulo HTTP che consente di aggiungere l'autenticazione federata a un'applicazione ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b79b8-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) is an HTTP module that lets you add federated authentication to an ASP.NET application.</span></span> <span data-ttu-id="b79b8-118">L'autenticazione federata lascia che la logica di autenticazione venga gestita dal servizio token di sicurezza e consente allo sviluppatore di concentrarsi sulla scrittura della logica di business.</span><span class="sxs-lookup"><span data-stu-id="b79b8-118">Federated authentication lets authentication logic be handled by the STS and lets you focus on writing business logic.</span></span>  
  
 <span data-ttu-id="b79b8-119">WS-FAM viene configurato per specificare il servizio token di sicurezza a cui devono essere reindirizzate le richieste non autenticate.</span><span class="sxs-lookup"><span data-stu-id="b79b8-119">You configure the WS-FAM to specify the STS to which non-authenticated requests should be redirected.</span></span> <span data-ttu-id="b79b8-120">WIF consente di autenticare un utente in due modi:</span><span class="sxs-lookup"><span data-stu-id="b79b8-120">WIF lets you authenticate a user in two ways:</span></span>  
  
1. <span data-ttu-id="b79b8-121">Reindirizzamento passivo: Quando un utente non autenticato tenta di accedere a una risorsa protetta e si vuole semplicemente reindirizzarli a un servizio token di protezione senza richiedere una pagina di accesso, questo è l'approccio giusto.</span><span class="sxs-lookup"><span data-stu-id="b79b8-121">Passive redirect: When an unauthenticated user tries to access a protected resource, and you want to simply redirect them to an STS without requiring a login page, then this is the right approach.</span></span> <span data-ttu-id="b79b8-122">Il servizio token di sicurezza verifica l'identità dell'utente e rilascia un token di sicurezza contenente le attestazioni appropriate per l'utente.</span><span class="sxs-lookup"><span data-stu-id="b79b8-122">The STS verifies the user’s identity, and issues a security token that contains the appropriate claims for that user.</span></span> <span data-ttu-id="b79b8-123">Per questa opzione è necessario aggiungere WS-FAM nella pipeline dei moduli HTTP.</span><span class="sxs-lookup"><span data-stu-id="b79b8-123">This option requires the WS-FAM to be added in the HTTP Modules pipeline.</span></span> <span data-ttu-id="b79b8-124">È possibile usare Identity and Access Tool per Visual Studio 2012 per modificare il file di configurazione dell'applicazione per usare WS-FAM e stabilire la federazione con un servizio token di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b79b8-124">You can use the Identity and Access Tool for Visual Studio 2012 to modify your application’s configuration file to use the WS-FAM and to federate with an STS.</span></span> <span data-ttu-id="b79b8-125">Per altre informazioni, vedere [Identity and Access Tool for Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md) (Identity and Access Tool per Visual Studio 2012).</span><span class="sxs-lookup"><span data-stu-id="b79b8-125">For more information, see [Identity and Access Tool for Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span></span>  
  
2. <span data-ttu-id="b79b8-126">È possibile chiamare il metodo <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> o il metodo <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> dal code-behind per una pagina di accesso nell'applicazione relying party.</span><span class="sxs-lookup"><span data-stu-id="b79b8-126">You can call the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> method or the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> method from the code-behind for a sign-in page in your RP application.</span></span>  
  
 <span data-ttu-id="b79b8-127">Nel reindirizzamento passivo tutte le comunicazioni avvengono tramite risposta/reindirizzamento dal client (in genere un browser).</span><span class="sxs-lookup"><span data-stu-id="b79b8-127">In passive redirect, all communication is performed through response/redirect from the client (typically a browser).</span></span> <span data-ttu-id="b79b8-128">È possibile aggiungere WS-FAM alla pipeline HTTP dell'applicazione, dove controlla le richieste utente non autenticate e reindirizza gli utenti al servizio token di sicurezza specificato.</span><span class="sxs-lookup"><span data-stu-id="b79b8-128">You can add the WS-FAM to your application’s HTTP pipeline, where it watches for unauthenticated user requests and redirects users to the STS you specify.</span></span>  
  
 <span data-ttu-id="b79b8-129">WS-FAM genera inoltre diversi eventi che consentono di personalizzare le funzionalità in un'applicazione ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b79b8-129">The WS-FAM also raises several events that let you customize its functionality in an ASP.NET application.</span></span>  
  
### <a name="how-the-ws-fam-works"></a><span data-ttu-id="b79b8-130">Funzionamento di WS-FAM</span><span class="sxs-lookup"><span data-stu-id="b79b8-130">How the WS-FAM Works</span></span>  
 <span data-ttu-id="b79b8-131">WS-FAM viene implementato nella classe <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-131">The WS-FAM is implemented in the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> class.</span></span> <span data-ttu-id="b79b8-132">In genere, è necessario aggiungere WS-FAM alla pipeline HTTP dell'applicazione ASP.NET RP.</span><span class="sxs-lookup"><span data-stu-id="b79b8-132">Typically, you add the WS-FAM to the HTTP pipeline of your ASP.NET RP application.</span></span> <span data-ttu-id="b79b8-133">Quando un utente non autenticato cerca di accedere a una risorsa protetta, la relying party restituisce una risposta HTTP di tipo "401 autorizzazione negata".</span><span class="sxs-lookup"><span data-stu-id="b79b8-133">When an unauthenticated user tries to access a protected resource, the RP returns a "401 authorization denied" HTTP response.</span></span> <span data-ttu-id="b79b8-134">WS-FAM intercetta questa risposta invece di consentire al client di riceverla, quindi reindirizza l'utente al servizio token di sicurezza specificato.</span><span class="sxs-lookup"><span data-stu-id="b79b8-134">The WS-FAM intercepts this response instead of allowing the client to receive it, then it redirects the user to the specified STS.</span></span> <span data-ttu-id="b79b8-135">Il servizio token di sicurezza rilascia un token di sicurezza, che viene anch'esso intercettato da WS-FAM.</span><span class="sxs-lookup"><span data-stu-id="b79b8-135">The STS issues a security token, which the WS-FAM again intercepts.</span></span> <span data-ttu-id="b79b8-136">WS-FAM usa il token per creare un'istanza di <xref:System.Security.Claims.ClaimsPrincipal> per l'utente autenticato, che consente il funzionamento di normali meccanismi di autorizzazione del .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="b79b8-136">The WS-FAM uses the token to create an instance of <xref:System.Security.Claims.ClaimsPrincipal> for the authenticated user, which enables regular .NET Framework authorization mechanisms to function.</span></span>  
  
 <span data-ttu-id="b79b8-137">Poiché HTTP è senza stato, è necessaria una soluzione per evitare di ripetere l'intero processo ogni volta che l'utente cerca di accedere a un'altra risorsa protetta.</span><span class="sxs-lookup"><span data-stu-id="b79b8-137">Because HTTP is stateless, we need a way to avoid repeating this whole process every time that the user tries to access another protected resource.</span></span> <span data-ttu-id="b79b8-138">A questo scopo, si usa <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-138">This is where the <xref:System.IdentityModel.Services.SessionAuthenticationModule> comes in.</span></span> <span data-ttu-id="b79b8-139">Quando il servizio token di sicurezza rilascia un token di sicurezza per l'utente, <xref:System.IdentityModel.Services.SessionAuthenticationModule> crea anche un token di sicurezza della sessione per l'utente e lo inserisce in un cookie.</span><span class="sxs-lookup"><span data-stu-id="b79b8-139">When the STS issues a security token for the user, <xref:System.IdentityModel.Services.SessionAuthenticationModule> also creates a session security token for the user and puts it in a cookie.</span></span> <span data-ttu-id="b79b8-140">Nelle richieste successive, <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercetta questo cookie e lo usa per ricostruire l'oggetto <xref:System.Security.Claims.ClaimsPrincipal> dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b79b8-140">On subsequent requests, the <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepts this cookie and uses it to reconstruct the user’s <xref:System.Security.Claims.ClaimsPrincipal>.</span></span>  
  
 <span data-ttu-id="b79b8-141">Il diagramma seguente mostra il flusso generale delle informazioni nel caso del reindirizzamento passivo.</span><span class="sxs-lookup"><span data-stu-id="b79b8-141">The following diagram shows the overall flow of information in the passive redirect case.</span></span> <span data-ttu-id="b79b8-142">La richiesta viene reindirizzata automaticamente tramite il servizio token di sicurezza per stabilire le credenziali senza una pagina di accesso:</span><span class="sxs-lookup"><span data-stu-id="b79b8-142">The request is automatically redirected via the STS to establish credentials without a login page:</span></span>  
  
 ![Diagramma che mostra l'accesso con reindirizzamento passivo.](./media/wsfederation-authentication-module-overview/sign-in-using-passive-redirect.gif)  
  
 <span data-ttu-id="b79b8-144">Il diagramma seguente mostra in modo più dettagliato ciò che succede quando l'utente ha eseguito l'autenticazione nel servizio token di sicurezza e i relativi token di sicurezza vengono elaborati da <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span><span class="sxs-lookup"><span data-stu-id="b79b8-144">The following diagram shows more detail on what happens when the user has authenticated to the STS and their security tokens are processed by the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="b79b8-145">![Diagramma temporale per l'elaborazione del token con reindirizzamento passivo](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span><span class="sxs-lookup"><span data-stu-id="b79b8-145">![Timing for token processing with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span></span>  
  
 <span data-ttu-id="b79b8-146">Il diagramma seguente mostra in modo più dettagliato ciò che succede quando i token di sicurezza dell'utente sono stati serializzati nei cookie e intercettati da <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span><span class="sxs-lookup"><span data-stu-id="b79b8-146">The following diagram shows more detail on what happens when the user’s security tokens have been serialized into cookies and are intercepted by the <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="b79b8-147">![Diagramma temporale SAM che mostra l'accesso tramite controlli](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span><span class="sxs-lookup"><span data-stu-id="b79b8-147">![SAM timing diagram showing sign&#45;in using controls](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span></span>  
  
### <a name="events"></a><span data-ttu-id="b79b8-148">Eventi</span><span class="sxs-lookup"><span data-stu-id="b79b8-148">Events</span></span>  
 <span data-ttu-id="b79b8-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule> e la relativa classe padre <xref:System.IdentityModel.Services.HttpModuleBase> generano eventi in corrispondenza di varie fasi dell'elaborazione di una richiesta HTTP.</span><span class="sxs-lookup"><span data-stu-id="b79b8-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>, and their parent class, <xref:System.IdentityModel.Services.HttpModuleBase>, raise events at various stages of processing of an HTTP request.</span></span> <span data-ttu-id="b79b8-150">È possibile gestire questi eventi nel `global.asax` file dell'applicazione ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b79b8-150">You can handle these events in the `global.asax` file of your ASP.NET application.</span></span>  
  
- <span data-ttu-id="b79b8-151">L'infrastruttura ASP.NET richiama il metodo <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> del modulo per inizializzare il modulo.</span><span class="sxs-lookup"><span data-stu-id="b79b8-151">The ASP.NET infrastructure invokes the module’s <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method to initialize the module.</span></span>  
  
- <span data-ttu-id="b79b8-152">L'evento <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> viene generato quando l'infrastruttura ASP.NET richiama il metodo <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> per la prima volta in uno dei moduli dell'applicazione che derivano da <xref:System.IdentityModel.Services.HttpModuleBase>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-152">The <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> event is raised when the ASP.NET infrastructure invokes the <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method for the first time on one of the application’s modules that derive from <xref:System.IdentityModel.Services.HttpModuleBase>.</span></span> <span data-ttu-id="b79b8-153">Questo metodo accede alla proprietà <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> statica, che comporta il caricamento della configurazione dal file Web.config.</span><span class="sxs-lookup"><span data-stu-id="b79b8-153">This method accesses the static <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> property, which causes configuration to be loaded from the Web.config file.</span></span> <span data-ttu-id="b79b8-154">Questo evento viene generato solo quando si accede a questa proprietà per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="b79b8-154">This event is only raised the first time this property is accessed.</span></span> <span data-ttu-id="b79b8-155">All'oggetto <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> inizializzato dalla configurazione è possibile accedere tramite la proprietà <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> in un gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="b79b8-155">The <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> object that is initialized from configuration can be accessed through the <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> property in an event handler.</span></span> <span data-ttu-id="b79b8-156">È possibile usare questo evento per modificare la configurazione prima che venga applicata ai moduli.</span><span class="sxs-lookup"><span data-stu-id="b79b8-156">You can use this event to modify the configuration before it is applied to any modules.</span></span> <span data-ttu-id="b79b8-157">È possibile aggiungere un gestore per questo evento nel metodo Application_Start:</span><span class="sxs-lookup"><span data-stu-id="b79b8-157">You can add a handler for this event in the Application_Start method:</span></span>  
  
    ```csharp
    void Application_Start(object sender, EventArgs e)  
    {  
        FederatedAuthentication.FederationConfigurationCreated += new EventHandler<FederationConfigurationCreatedEventArgs>(FederatedAuthentication_FederationConfigurationCreated);  
    }  
    ```  
  
     <span data-ttu-id="b79b8-158">Ogni modulo esegue l'override dei metodi astratti <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> e <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-158">Each module overrides the <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> and <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> abstract methods.</span></span> <span data-ttu-id="b79b8-159">Il primo di questi metodi aggiunge i gestori per gli eventi della pipeline ASP.NET rilevanti per il modulo.</span><span class="sxs-lookup"><span data-stu-id="b79b8-159">The first of these methods adds handlers for ASP.NET pipeline events that are of interest to the module.</span></span> <span data-ttu-id="b79b8-160">Nella maggior parte dei casi, è sufficiente l'implementazione predefinita del modulo.</span><span class="sxs-lookup"><span data-stu-id="b79b8-160">In most cases the module’s default implementation will suffice.</span></span> <span data-ttu-id="b79b8-161">Il secondo di questi metodi inizializza le proprietà del modulo dalla relativa proprietà <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-161">The second of these methods initializes the module’s properties from its <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="b79b8-162">Si tratta di una copia della configurazione caricata in precedenza. Potrebbe essere necessario eseguire l'override di questo secondo metodo, se si vuole supportare l'inizializzazione di nuove proprietà dalla configurazione nelle classi derivate da <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> o <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-162">(This is a copy of the configuration that was loaded previously.) You may need to override this second method if you want to support the initialization of new properties from configuration in classes that you derive from <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="b79b8-163">In casi di questo tipo, è anche necessario derivare dagli oggetti di configurazione appropriati per supportare le proprietà di configurazione aggiunte, ad esempio da <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration> o <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-163">In such cases you would also need to derive from the appropriate configuration objects to support the added configuration properties; for example, from <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, or <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span></span>  
  
- <span data-ttu-id="b79b8-164">WS-FAM genera l'evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> quando intercetta un token di sicurezza che è stato rilasciato dal servizio token di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b79b8-164">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> event when it intercepts a security token that has been issued by the STS.</span></span>  
  
- <span data-ttu-id="b79b8-165">WS-FAM genera l'evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> dopo la convalida del token.</span><span class="sxs-lookup"><span data-stu-id="b79b8-165">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> event after it has validated the token.</span></span>  
  
- <span data-ttu-id="b79b8-166"><xref:System.IdentityModel.Services.SessionAuthenticationModule> genera l'evento <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> quando crea un token di sicurezza della sessione per l'utente.</span><span class="sxs-lookup"><span data-stu-id="b79b8-166">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> event when it creates a session security token for the user.</span></span>  
  
- <span data-ttu-id="b79b8-167"><xref:System.IdentityModel.Services.SessionAuthenticationModule> genera l'evento <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> quando intercetta le richieste successive con il cookie contenente il token di sicurezza della sessione.</span><span class="sxs-lookup"><span data-stu-id="b79b8-167">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> event when it intercepts subsequent requests with the cookie that contains the session security token.</span></span>  
  
- <span data-ttu-id="b79b8-168">Prima di reindirizzare l'utente all'autorità di certificazione, WS-FAM genera l'evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-168">Before the WS-FAM redirects the user to the issuer, it raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> event.</span></span> <span data-ttu-id="b79b8-169">La richiesta di accesso WS-Federation è disponibile tramite la proprietà <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> dell'oggetto <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passato nell'evento.</span><span class="sxs-lookup"><span data-stu-id="b79b8-169">The WS-Federation sign-in request is available through the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> property of the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passed in the event.</span></span> <span data-ttu-id="b79b8-170">È possibile scegliere di modificare la richiesta prima di inviarla all'autorità di certificazione.</span><span class="sxs-lookup"><span data-stu-id="b79b8-170">You may choose to modify the request before sending this out to the issuer.</span></span>  
  
- <span data-ttu-id="b79b8-171">WS-FAM genera l'evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> quando il cookie è stato scritto correttamente e l'utente ha effettuato l'accesso.</span><span class="sxs-lookup"><span data-stu-id="b79b8-171">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> event when the cookie is successfully written and the user is signed in.</span></span>  
  
- <span data-ttu-id="b79b8-172">WS-FAM genera l'evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> una volta per ogni sessione quando la sessione viene chiusa per ogni utente.</span><span class="sxs-lookup"><span data-stu-id="b79b8-172">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> event one time per session as the session is being closed down for each user.</span></span> <span data-ttu-id="b79b8-173">L'evento non viene generato se la sessione viene chiusa sul lato client (ad esempio, eliminando il cookie di sessione).</span><span class="sxs-lookup"><span data-stu-id="b79b8-173">It is not raised if the session is closed down on the client-side (for example, by deleting the session cookie).</span></span> <span data-ttu-id="b79b8-174">In un ambiente SSO il servizio token di sicurezza del provider di identità può richiedere anche la disconnessione di ogni relying party.</span><span class="sxs-lookup"><span data-stu-id="b79b8-174">In an SSO environment, the IP-STS can request each RP to sign out, too.</span></span> <span data-ttu-id="b79b8-175">Anche in questo caso viene generato l'evento, con il valore di <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> impostato su `true`.</span><span class="sxs-lookup"><span data-stu-id="b79b8-175">This will also raise this event, with <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> set to `true`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b79b8-176">Non usare la proprietà <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> durante qualsiasi evento generato da <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> o <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-176">You should not use the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property during any event raised by <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="b79b8-177">Il motivo è che l'impostazione di <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> avviene dopo il processo di autenticazione, mentre gli eventi vengono generati durante il processo di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="b79b8-177">This is because <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> is set after the authentication process, while events are raised during the authentication process.</span></span>  
  
### <a name="configuration-of-federated-authentication"></a><span data-ttu-id="b79b8-178">Configurazione dell'autenticazione federata</span><span class="sxs-lookup"><span data-stu-id="b79b8-178">Configuration of Federated Authentication</span></span>  
 <span data-ttu-id="b79b8-179">La configurazione di WS FAM e SAM avviene mediante l'elemento [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md).</span><span class="sxs-lookup"><span data-stu-id="b79b8-179">The WS-FAM and SAM are configured through the [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) element.</span></span> <span data-ttu-id="b79b8-180">L'elemento figlio [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) configura i valori predefiniti per le proprietà di WS-FAM, ad esempio le proprietà <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> e <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-180">The [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) child element configures default values for the WS-FAM properties; such as the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> property and the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> property.</span></span> <span data-ttu-id="b79b8-181">Questi valori possono essere modificati in base alle singole richieste fornendo i gestori per alcuni degli eventi di WS-FAM, ad esempio <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>. Il gestore di cookie usato da SAM viene configurato tramite l'elemento figlio [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md).</span><span class="sxs-lookup"><span data-stu-id="b79b8-181">(These values can be changed on a per request basis by providing handlers for some of the WS-FAM events; for example, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) The cookie handler that is used by the SAM is configured through the [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) child element.</span></span> <span data-ttu-id="b79b8-182">WIF fornisce un gestore di cookie predefinito implementato nella classe <xref:System.IdentityModel.Services.ChunkedCookieHandler> le cui dimensioni del blocco possono essere impostate tramite l'elemento [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md).</span><span class="sxs-lookup"><span data-stu-id="b79b8-182">WIF provides a default cookie handler implemented in the <xref:System.IdentityModel.Services.ChunkedCookieHandler> class that can have its chunk size set through the [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) element.</span></span> <span data-ttu-id="b79b8-183">L'elemento `<federationConfiguration>` fa riferimento a un oggetto <xref:System.IdentityModel.Configuration.IdentityConfiguration>, che fornisce la configurazione per altri componenti WIF usati nell'applicazione, ad esempio <xref:System.Security.Claims.ClaimsAuthenticationManager> e <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span><span class="sxs-lookup"><span data-stu-id="b79b8-183">The `<federationConfiguration>` element references an <xref:System.IdentityModel.Configuration.IdentityConfiguration>, which provides configuration for other WIF components used in the application, such as the <xref:System.Security.Claims.ClaimsAuthenticationManager> and the <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span></span> <span data-ttu-id="b79b8-184">È possibile fare riferimento in modo esplicito alla configurazione di identità specificando un elemento [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) denominato nell'attributo `identityConfigurationName` dell'elemento `<federationConfiguration>`.</span><span class="sxs-lookup"><span data-stu-id="b79b8-184">The identity configuration may be referenced explicitly by specifying a named [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element in the `identityConfigurationName` attribute of the `<federationConfiguration>` element.</span></span> <span data-ttu-id="b79b8-185">Se non si fa riferimento in modo esplicito alla configurazione di identità, viene usata la configurazione di identità predefinita.</span><span class="sxs-lookup"><span data-stu-id="b79b8-185">If the identity configuration is not referenced explicitly, the default identity configuration will be used.</span></span>  
  
 <span data-ttu-id="b79b8-186">Il codice XML seguente mostra una configurazione di un'applicazione relying party ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b79b8-186">The following XML shows a configuration of an ASP.NET relying party (RP) application.</span></span> <span data-ttu-id="b79b8-187">Le sezioni di configurazione <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> e <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> vengono aggiunte nell'elemento `<configSections>`.</span><span class="sxs-lookup"><span data-stu-id="b79b8-187">The <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> and <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> configuration sections are added under the `<configSections>` element.</span></span> <span data-ttu-id="b79b8-188">SAM e WS-FAM vengono aggiunti ai moduli HTTP nell'elemento `<system.webServer>`/`<modules>`.</span><span class="sxs-lookup"><span data-stu-id="b79b8-188">The SAM and WS-FAM are added to the HTTP Modules under the `<system.webServer>`/`<modules>` element.</span></span> <span data-ttu-id="b79b8-189">Infine, i componenti WIF vengono configurati negli elementi `<system.identityModel>`/`<identityConfiguration>` e `<system.identityModel.services>`/`<federationConfiguration>`.</span><span class="sxs-lookup"><span data-stu-id="b79b8-189">Finally the WIF components are configured under the `<system.identityModel>`/`<identityConfiguration>` and `<system.identityModel.services>`/`<federationConfiguration>` elements.</span></span> <span data-ttu-id="b79b8-190">Questa configurazione specifica il gestore di cookie in blocchi come se fosse il gestore di cookie predefinito e non ci fosse un tipo di gestore di cookie specificato nell'elemento `<cookieHandler>`.</span><span class="sxs-lookup"><span data-stu-id="b79b8-190">This configuration specifies the chunked cookie handler as it is the default cookie handler and there is not a cookie handler type specified in the `<cookieHandler>` element.</span></span>  
  
> [!WARNING]
> <span data-ttu-id="b79b8-191">Nell'esempio seguente sia l'attributo `requireHttps` dell'elemento `<wsFederation>` che l'attributo `requireSsl` dell'elemento `<cookieHandler>` sono `false`.</span><span class="sxs-lookup"><span data-stu-id="b79b8-191">In the following example, both the `requireHttps` attribute of the `<wsFederation>` element and the `requireSsl` attribute of the `<cookieHandler>` element are `false`.</span></span> <span data-ttu-id="b79b8-192">Ciò comporta un potenziale rischio per la sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b79b8-192">This presents a potential security threat.</span></span> <span data-ttu-id="b79b8-193">In un ambiente di produzione entrambi questi valori devono essere impostati su `true`.</span><span class="sxs-lookup"><span data-stu-id="b79b8-193">In production, both these values should be set `true`.</span></span>  
  
```xml  
<configuration>  
  <configSections>  
    <section name="system.identityModel" type="System.IdentityModel.Configuration.SystemIdentityModelSection, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
    <section name="system.identityModel.services" type="System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
  </configSections>  
  
  ...  
  
  <system.webServer>  
    <modules>  
      <add name="WSFederationAuthenticationModule" type="System.IdentityModel.Services.WSFederationAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
      <add name="SessionAuthenticationModule" type="System.IdentityModel.Services.SessionAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
    </modules>  
  </system.webServer>  
  
  <system.identityModel>  
    <identityConfiguration>  
      <audienceUris>  
        <add value="http://localhost:50969/" />  
      </audienceUris>  
      <certificateValidation certificateValidationMode="None" />  
      <issuerNameRegistry type="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">  
        <trustedIssuers>  
          <add thumbprint="9B74CB2F320F7AAFC156E1252270B1DC01EF40D0" name="LocalSTS" />  
        </trustedIssuers>  
      </issuerNameRegistry>  
    </identityConfiguration>  
  </system.identityModel>  
  <system.identityModel.services>  
    <federationConfiguration>  
      <wsFederation passiveRedirectEnabled="true" issuer="http://localhost:15839/wsFederationSTS/Issue" realm="http://localhost:50969/" reply="http://localhost:50969/" requireHttps="false" />  
      <cookieHandler requireSsl="false" />  
    </federationConfiguration>  
  </system.identityModel.services>  
</configuration>  
```  
  
## <a name="see-also"></a><span data-ttu-id="b79b8-194">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="b79b8-194">See also</span></span>

- <xref:System.IdentityModel.Services.SessionAuthenticationModule>
- <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>
- [<span data-ttu-id="b79b8-195">\<federationConfiguration></span><span class="sxs-lookup"><span data-stu-id="b79b8-195">\<federationConfiguration></span></span>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md)
