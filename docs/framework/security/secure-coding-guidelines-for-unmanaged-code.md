---
title: Linee guida per la creazione di codice sicuro applicabili al codice non gestito
ms.date: 03/30/2017
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 867157b329218b79c8cc1255b2158bbe83666531
ms.sourcegitcommit: 289e06e904b72f34ac717dbcc5074239b977e707
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/17/2019
ms.locfileid: "71045357"
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="3e735-102">Linee guida per la creazione di codice sicuro applicabili al codice non gestito</span><span class="sxs-lookup"><span data-stu-id="3e735-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="3e735-103">Alcuni codici di libreria devono chiamare codice non gestito (ad esempio, le API del codice nativo, come Win32).</span><span class="sxs-lookup"><span data-stu-id="3e735-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="3e735-104">Poiché questo comporta il superamento del perimetro di sicurezza per il codice gestito, è necessaria la dovuta attenzione.</span><span class="sxs-lookup"><span data-stu-id="3e735-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="3e735-105">Se il codice è indipendente dalla sicurezza, sia il proprio codice sia il codice da cui viene chiamato devono avere l'autorizzazione per codice non gestito (<xref:System.Security.Permissions.SecurityPermission> con il flag <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> specificato).</span><span class="sxs-lookup"><span data-stu-id="3e735-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="3e735-106">Tuttavia, è spesso sconsigliabile fornire al chiamante autorizzazioni di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="3e735-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="3e735-107">In questi casi, il codice attendibile può essere intermediario, simile al wrapper gestito o al codice di libreria descritto in [Protezione del codice wrapper](../misc/securing-wrapper-code.md).</span><span class="sxs-lookup"><span data-stu-id="3e735-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="3e735-108">Se la funzionalità di codice non gestito sottostante è totalmente sicura, può essere esposta direttamente; in caso contrario, è richiesto prima un controllo di autorizzazione appropriato (domanda).</span><span class="sxs-lookup"><span data-stu-id="3e735-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="3e735-109">Quando il codice chiama codice non gestito, ma non si vuole che i chiamanti siano autorizzati ad accedere al codice non gestito, è necessario dichiarare tale diritto.</span><span class="sxs-lookup"><span data-stu-id="3e735-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="3e735-110">Un'asserzione blocca il percorso stack in corrispondenza del frame.</span><span class="sxs-lookup"><span data-stu-id="3e735-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="3e735-111">È necessario assicurarsi di non creare un problema di sicurezza in questo processo.</span><span class="sxs-lookup"><span data-stu-id="3e735-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="3e735-112">In genere, ciò significa che è necessario richiedere un'autorizzazione dei chiamanti appropriata e quindi usare il codice non gestito per eseguire solo operazioni consentite dall'autorizzazione e nient'altro.</span><span class="sxs-lookup"><span data-stu-id="3e735-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="3e735-113">In alcuni casi (ad esempio, una funzione GET time-of-day), il codice non gestito può essere esposto direttamente ai chiamanti senza controlli di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="3e735-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="3e735-114">Il codice in cui viene eseguita l'asserzione deve consentire in ogni caso la gestione della sicurezza.</span><span class="sxs-lookup"><span data-stu-id="3e735-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="3e735-115">Poiché il codice gestito in cui viene fornito un percorso di codice all'interno del codice nativo rappresenta un obiettivo potenziale del codice dannoso, è necessaria estrema attenzione per determinare quale parte di codice non gestito può essere usata con sicurezza e come usarla.</span><span class="sxs-lookup"><span data-stu-id="3e735-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="3e735-116">In genere, il codice non gestito non deve essere mai esposto direttamente a chiamanti parzialmente attendibili.</span><span class="sxs-lookup"><span data-stu-id="3e735-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="3e735-117">Nella valutazione della sicurezza del codice non gestito nelle librerie che è possibile chiamare da codice parzialmente attendibile, sono necessarie due considerazioni principali:</span><span class="sxs-lookup"><span data-stu-id="3e735-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
- <span data-ttu-id="3e735-118">**Funzionalità**</span><span class="sxs-lookup"><span data-stu-id="3e735-118">**Functionality**.</span></span> <span data-ttu-id="3e735-119">Considerare se nel codice API non gestito sia fornita una funzionalità che non consenta ai chiamanti di eseguire operazioni potenzialmente dannose</span><span class="sxs-lookup"><span data-stu-id="3e735-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="3e735-120">La sicurezza dall'accesso di codice impiega le autorizzazioni per applicare l'accesso alle risorse; considerare quindi se l'API consente di usare file, un'interfaccia utente o il threading oppure di esporre informazioni protette.</span><span class="sxs-lookup"><span data-stu-id="3e735-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="3e735-121">In questo caso, dal codice gestito che funge da wrapper devono essere pretese le autorizzazioni necessarie prima di consentirne l'accesso.</span><span class="sxs-lookup"><span data-stu-id="3e735-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="3e735-122">Inoltre, quando non è protetta da un'autorizzazione, è necessario che l'accesso alla memoria sia limitato alla rigida indipendenza dei tipi.</span><span class="sxs-lookup"><span data-stu-id="3e735-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
- <span data-ttu-id="3e735-123">**Controllo dei caratteri**</span><span class="sxs-lookup"><span data-stu-id="3e735-123">**Parameter checking**.</span></span> <span data-ttu-id="3e735-124">In un attacco di tipo comune vengono passati parametri imprevisti a metodi API di codice non gestito esposto nel tentativo di determinarne il funzionamento al di fuori delle specifiche.</span><span class="sxs-lookup"><span data-stu-id="3e735-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="3e735-125">I sovraccarichi del buffer tramite indici non compresi nell'intervallo o valori di offset costituiscono un esempio comune di questo tipo di attacco, allo stesso modo di altri parametri che possono sfruttare bug nel codice sottostante.</span><span class="sxs-lookup"><span data-stu-id="3e735-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="3e735-126">Di conseguenza, anche se l'API del codice non gestito è protetta dal punto di vista funzionale, implementando cioè le esigenze di autorizzazioni che si reputano necessarie, per i chiamanti parzialmente attendibili deve essere eseguito anche il controllo completo della validità dei parametri, per evitare l'esecuzione di chiamate impreviste da parte di codice dannoso tramite il livello del wrapper del codice gestito.</span><span class="sxs-lookup"><span data-stu-id="3e735-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="3e735-127">Uso di SuppressUnmanagedCodeSecurityAttribute</span><span class="sxs-lookup"><span data-stu-id="3e735-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="3e735-128">Un aspetto delle prestazioni è quello relativo all'asserzione e alla chiamata di codice non gestito.</span><span class="sxs-lookup"><span data-stu-id="3e735-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="3e735-129">Per ciascuna chiamata di questo tipo, il sistema di sicurezza esige automaticamente l'autorizzazione per codice non gestito, provocando di conseguenza un percorso stack per ciascuna occorrenza.</span><span class="sxs-lookup"><span data-stu-id="3e735-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="3e735-130">Se viene eseguita l'asserzione e viene chiamato immediatamente codice non gestito, il percorso stack può essere inutile, in quanto consiste nell'asserzione e nella chiamata al codice non gestito.</span><span class="sxs-lookup"><span data-stu-id="3e735-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="3e735-131">Un attributo personalizzato denominato <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> può essere applicato ai punti di ingresso del codice non gestito per disabilitare il normale controllo di sicurezza per cui si richiede l'oggetto <xref:System.Security.Permissions.SecurityPermission> con l'autorizzazione <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> specificata.</span><span class="sxs-lookup"><span data-stu-id="3e735-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="3e735-132">Prestare sempre estrema attenzione durante l'esecuzione di questa operazione, poiché determina un punto di libero accesso al codice non gestito senza alcun controllo di sicurezza in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="3e735-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="3e735-133">Anche se si applica l'attributo **SuppressUnmanagedCodeSecurityAttribute** , con la compilazione JIT viene eseguito, seppure una sola volta, un controllo di sicurezza per garantire che il chiamante immediato disponga dell'autorizzazione per chiamare codice non gestito.</span><span class="sxs-lookup"><span data-stu-id="3e735-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="3e735-134">Se si usa l'attributo **SuppressUnmanagedCodeSecurityAttribute**, verificare i seguenti punti:</span><span class="sxs-lookup"><span data-stu-id="3e735-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
- <span data-ttu-id="3e735-135">Rendere interno il punto di ingresso del codice non gestito o, in alternativa, renderlo inaccessibile dall'esterno del codice.</span><span class="sxs-lookup"><span data-stu-id="3e735-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
- <span data-ttu-id="3e735-136">Ogni chiamata nel codice non gestito rappresenta una potenziale vulnerabilità nella sicurezza.</span><span class="sxs-lookup"><span data-stu-id="3e735-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="3e735-137">Accertarsi che il codice non rappresenti un punto di ingresso per le chiamate indirette da parte di codice dannoso al codice non gestito e non consenta di aggirare il controllo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="3e735-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="3e735-138">Esigere autorizzazioni, se necessario.</span><span class="sxs-lookup"><span data-stu-id="3e735-138">Demand permissions, if appropriate.</span></span>  
  
- <span data-ttu-id="3e735-139">Usare una convenzione di denominazione per identificare in modo esplicito la creazione di un percorso pericoloso nel codice non gestito, come descritto nella sezione seguente.</span><span class="sxs-lookup"><span data-stu-id="3e735-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="3e735-140">Convenzione di denominazione per i metodi di codice non gestito</span><span class="sxs-lookup"><span data-stu-id="3e735-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="3e735-141">Per denominare metodi di codice non gestito è stata stabilita una convenzione utile, di cui si consiglia l'impiego.</span><span class="sxs-lookup"><span data-stu-id="3e735-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="3e735-142">I metodi di codice non gestito sono suddivisi in tre categorie: **safe**, **native**e **unsafe**.</span><span class="sxs-lookup"><span data-stu-id="3e735-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="3e735-143">Queste parole chiave possono essere usate come nomi di classi all'interno delle quali sono definiti i vari tipi di punti di ingresso del codice non gestito.</span><span class="sxs-lookup"><span data-stu-id="3e735-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="3e735-144">Nel codice sorgente, le parole chiave devono essere aggiunte al nome della classe, come in `Safe.GetTimeOfDay`, `Native.Xyz`o `Unsafe.DangerousAPI`.</span><span class="sxs-lookup"><span data-stu-id="3e735-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="3e735-145">Ognuna delle seguenti parole chiave fornisce informazioni sulla sicurezza utili per gli sviluppatori che usano la classe relativa, come descritto nella seguente tabella.</span><span class="sxs-lookup"><span data-stu-id="3e735-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="3e735-146">Parola chiave</span><span class="sxs-lookup"><span data-stu-id="3e735-146">Keyword</span></span>|<span data-ttu-id="3e735-147">Considerazioni sulla sicurezza</span><span class="sxs-lookup"><span data-stu-id="3e735-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|<span data-ttu-id="3e735-148">**safe**</span><span class="sxs-lookup"><span data-stu-id="3e735-148">**safe**</span></span>|<span data-ttu-id="3e735-149">Sicurezza completa dalle chiamate da parte del codice, anche di quello dannoso.</span><span class="sxs-lookup"><span data-stu-id="3e735-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="3e735-150">L'uso è analogo a quello del normale codice gestito.</span><span class="sxs-lookup"><span data-stu-id="3e735-150">Can be used just like other managed code.</span></span> <span data-ttu-id="3e735-151">Una funzione che ottiene l'ora del giorno, ad esempio, è in genere sicura.</span><span class="sxs-lookup"><span data-stu-id="3e735-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|<span data-ttu-id="3e735-152">**native**</span><span class="sxs-lookup"><span data-stu-id="3e735-152">**native**</span></span>|<span data-ttu-id="3e735-153">Indipendente dalla sicurezza; in altre parole, codice non gestito per cui è richiesta l'autorizzazione alla chiamata di codice non gestito.</span><span class="sxs-lookup"><span data-stu-id="3e735-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="3e735-154">Viene eseguito il controllo di sicurezza, che blocca le chiamate non autorizzate.</span><span class="sxs-lookup"><span data-stu-id="3e735-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|<span data-ttu-id="3e735-155">**unsafe**</span><span class="sxs-lookup"><span data-stu-id="3e735-155">**unsafe**</span></span>|<span data-ttu-id="3e735-156">Presenza di un punto di ingresso per codice non gestito pericoloso con annullamento della sicurezza.</span><span class="sxs-lookup"><span data-stu-id="3e735-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="3e735-157">Gli sviluppatori dovranno usare la massima attenzione nell'uso di codice non gestito di questo tipo, accertandosi che siano attivi altri tipi di sicurezza per evitare vulnerabilità di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="3e735-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="3e735-158">Questa parola chiave consente l'override del sistema di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="3e735-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="3e735-159">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="3e735-159">See also</span></span>

- [<span data-ttu-id="3e735-160">Linee guida per la generazione di codice sicuro</span><span class="sxs-lookup"><span data-stu-id="3e735-160">Secure Coding Guidelines</span></span>](../../standard/security/secure-coding-guidelines.md)
