---
title: Specifica e gestione di errori in contratti e servizi
ms.date: 03/30/2017
helpviewer_keywords:
- handling faults [WCF]
ms.assetid: a9696563-d404-4905-942d-1e0834c26dea
ms.openlocfilehash: bbc1ca97c8887ebdfbe30f7dd76549572367efbe
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/15/2019
ms.locfileid: "72321104"
---
# <a name="specifying-and-handling-faults-in-contracts-and-services"></a><span data-ttu-id="fa4d2-102">Specifica e gestione di errori in contratti e servizi</span><span class="sxs-lookup"><span data-stu-id="fa4d2-102">Specifying and Handling Faults in Contracts and Services</span></span>

<span data-ttu-id="fa4d2-103">Le applicazioni Windows Communication Foundation (WCF) gestiscono le situazioni di errore eseguendo il mapping di oggetti eccezione gestiti a oggetti errore SOAP e oggetti errore SOAP a oggetti eccezione gestiti.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-103">Windows Communication Foundation (WCF) applications handle error situations by mapping managed exception objects to SOAP fault objects and SOAP fault objects to managed exception objects.</span></span> <span data-ttu-id="fa4d2-104">Negli argomenti di questa sezione viene illustrato come progettare contratti per esporre condizioni di errore come errori SOAP personalizzati, come restituire tali errori come parte dell'implementazione del servizio e come tali errori vengono rilevati dai client.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-104">The topics in this section discuss how to design contracts to expose error conditions as custom SOAP faults, how to return such faults as part of service implementation, and how clients catch such faults.</span></span>

## <a name="error-handling-overview"></a><span data-ttu-id="fa4d2-105">Panoramica sulla gestione degli errori</span><span class="sxs-lookup"><span data-stu-id="fa4d2-105">Error Handling Overview</span></span>

<span data-ttu-id="fa4d2-106">Tutte le applicazioni gestite prevedono che gli errori di elaborazione siano rappresentati dagli oggetti <xref:System.Exception>.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-106">In all managed applications, processing errors are represented by <xref:System.Exception> objects.</span></span> <span data-ttu-id="fa4d2-107">Nelle applicazioni basate su SOAP, ad esempio le applicazioni WCF, i metodi del servizio comunicano l'elaborazione delle informazioni sugli errori mediante messaggi di errore SOAP.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-107">In SOAP-based applications such as WCF applications, service methods communicate processing error information using SOAP fault messages.</span></span> <span data-ttu-id="fa4d2-108">Gli errori SOAP sono tipi di messaggio inclusi nei metadati per un'operazione del servizio e pertanto creano un contratto di errore che i client possono utilizzare per rendere il proprio funzionamento più affidabile o interattivo.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-108">SOAP faults are message types that are included in the metadata for a service operation and therefore create a fault contract that clients can use to make their operation more robust or interactive.</span></span> <span data-ttu-id="fa4d2-109">Inoltre, poiché gli errori SOAP vengono espressi ai client in formato XML, si tratta di un sistema di tipi altamente interoperabile che può essere utilizzato dai client su qualsiasi piattaforma SOAP, aumentando la portata dell'applicazione WCF.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-109">In addition, because SOAP faults are expressed to clients in XML form, it is a highly interoperable type system that clients on any SOAP platform can use, increasing the reach of your WCF application.</span></span>

<span data-ttu-id="fa4d2-110">Poiché le applicazioni WCF vengono eseguite in entrambi i tipi di sistemi di errore, le informazioni sulle eccezioni gestite inviate al client devono essere convertite da eccezioni in errori SOAP sul servizio, inviate e convertite da errori SOAP a eccezioni di errore nei client WCF.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-110">Because WCF applications run under both types of error systems, any managed exception information that is sent to the client must be converted from exceptions into SOAP faults on the service, sent, and converted from SOAP faults to fault exceptions in WCF clients.</span></span> <span data-ttu-id="fa4d2-111">Nel caso di client duplex, i contratti client possono anche restituire errori SOAP a un servizio.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-111">In the case of duplex clients, client contracts can also send SOAP faults back to a service.</span></span> <span data-ttu-id="fa4d2-112">In entrambi i casi, è possibile utilizzare i comportamenti predefiniti delle eccezioni di servizio. In alternativa, è possibile stabilire in modo esplicito se convertire le eccezioni in messaggi di errore e, in tal caso, definire le modalità di conversione.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-112">In either case, you can use the default service exception behaviors, or you can explicitly control whether—and how—exceptions are mapped to fault messages.</span></span>

<span data-ttu-id="fa4d2-113">È possibile inviare due tipi di errori SOAP, ovvero *dichiarati* e non *dichiarati*.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-113">Two types of SOAP faults can be sent: *declared* and *undeclared*.</span></span> <span data-ttu-id="fa4d2-114">Gli errori SOAP dichiarati sono quelli in cui un'operazione presenta un attributo <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> che specifica un tipo di errore SOAP personalizzato.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-114">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> attribute that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="fa4d2-115">Non *dichiarato* Gli errori SOAP non sono specificati nel contratto per un'operazione.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-115">*Undeclared* SOAP faults are not specified in the contract for an operation.</span></span>

<span data-ttu-id="fa4d2-116">È consigliabile che le operazioni del servizio dichiarino gli errori utilizzando l'attributo <xref:System.ServiceModel.FaultContractAttribute> per specificare formalmente tutti gli errori SOAP che un client può aspettarsi di ricevere durante il normale funzionamento di un'operazione.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-116">It is strongly recommended that service operations declare their faults by using the <xref:System.ServiceModel.FaultContractAttribute> attribute to formally specify all SOAP faults that a client can expect to receive in the normal course of an operation.</span></span> <span data-ttu-id="fa4d2-117">Per ridurre al minimo la divulgazione delle informazioni è inoltre consigliabile restituire negli errori SOAP solo le informazioni che il client deve conoscere.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-117">It is also recommended that you return in a SOAP fault only the information that a client must know to minimize information disclosure.</span></span>

<span data-ttu-id="fa4d2-118">In genere, i servizi (e i client duplex) prevedono i passaggi seguenti per integrare correttamente la gestione degli errori nelle applicazioni:</span><span class="sxs-lookup"><span data-stu-id="fa4d2-118">Typically, services (and duplex clients) take the following steps to successfully integrate error handling into their applications:</span></span>

- <span data-ttu-id="fa4d2-119">Eseguire il mapping delle condizioni di eccezione a errori SOAP personalizzati.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-119">Map exception conditions to custom SOAP faults.</span></span>

- <span data-ttu-id="fa4d2-120">I client e i servizi inviano e ricevono errori SOAP come eccezioni.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-120">Clients and services send and receive SOAP faults as exceptions.</span></span>

<span data-ttu-id="fa4d2-121">Inoltre, i client e i servizi WCF possono utilizzare errori SOAP non dichiarati a scopo di debug e possono estendere il comportamento predefinito degli errori.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-121">In addition, WCF clients and services can use undeclared soap faults for debugging purposes and can extend the default error behavior.</span></span> <span data-ttu-id="fa4d2-122">Nelle sezioni seguenti vengono esaminati questi concetti e attività.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-122">The following sections discuss these tasks and concepts.</span></span>

## <a name="map-exceptions-to-soap-faults"></a><span data-ttu-id="fa4d2-123">Eseguire il mapping delle eccezioni a errori SOAP</span><span class="sxs-lookup"><span data-stu-id="fa4d2-123">Map Exceptions to SOAP Faults</span></span>

<span data-ttu-id="fa4d2-124">Il primo passaggio per creare un'operazione che gestisca condizioni di errore consiste nel decidere a quali condizioni un'applicazione client deve essere informata degli errori.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-124">The first step in creating an operation that handles error conditions is to decide under what conditions a client application should be informed about errors.</span></span> <span data-ttu-id="fa4d2-125">Alcune operazioni hanno condizioni di errore specifiche per la propria funzionalità.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-125">Some operations have error conditions specific to their functionality.</span></span> <span data-ttu-id="fa4d2-126">Ad esempio, un'operazione `PurchaseOrder` potrebbe restituire informazioni specifiche a clienti a cui non è più consentito avviare un ordine d'acquisto.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-126">For example, a `PurchaseOrder` operation might return specific information to customers who are no longer permitted to initiate a purchase order.</span></span> <span data-ttu-id="fa4d2-127">In altri casi, quali, ad esempio, un servizio `Calculator`, un errore SOAP `MathFault` più generale potrebbe essere in grado di descrivere tutte le condizioni di errore di un intero servizio.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-127">In other cases, such as a `Calculator` service, a more general `MathFault` SOAP fault may be able to describe all error conditions across an entire service.</span></span> <span data-ttu-id="fa4d2-128">Dopo avere identificato tutte le condizioni di errore dei client del servizio, è possibile costruire un errore SOAP personalizzato e contrassegnare l'operazione come restituzione dell'errore SOAP quando si verifica la condizione di errore corrispondente.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-128">Once the error conditions of clients of your service are identified, a custom SOAP fault can be constructed and the operation can be marked as returning that SOAP fault when its corresponding error condition arises.</span></span>

<span data-ttu-id="fa4d2-129">Per ulteriori informazioni su questo passaggio dello sviluppo del servizio o del client, vedere [definizione e specifica degli errori](defining-and-specifying-faults.md).</span><span class="sxs-lookup"><span data-stu-id="fa4d2-129">For more information about this step of developing your service or client, see [Defining and Specifying Faults](defining-and-specifying-faults.md).</span></span>

## <a name="clients-and-services-handle-soap-faults-as-exceptions"></a><span data-ttu-id="fa4d2-130">Gestione degli errori SOAP come eccezioni da parte di client e servizi</span><span class="sxs-lookup"><span data-stu-id="fa4d2-130">Clients and Services Handle SOAP Faults as Exceptions</span></span>

<span data-ttu-id="fa4d2-131">Identificare le condizioni di errore dell'operazione, definire errori SOAP personalizzati e contrassegnare tali operazioni come restituendo tali errori sono i primi passaggi per la corretta gestione degli errori nelle applicazioni WCF.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-131">Identifying operation error conditions, defining custom SOAP faults, and marking those operations as returning those faults are the first steps in successful error handling in WCF applications.</span></span> <span data-ttu-id="fa4d2-132">Il passaggio successivo è invece rappresentato dall'implementazione di invio e ricezione degli errori.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-132">The next step is to properly implement the sending and receiving of these faults.</span></span> <span data-ttu-id="fa4d2-133">In genere, i servizi inviano errori per informare le applicazioni client delle condizioni di errore, ma anche i client duplex  possono inviare errori SOAP ai servizi.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-133">Typically services send faults to inform client applications about error conditions, but duplex clients can also send SOAP faults to services.</span></span>

<span data-ttu-id="fa4d2-134">Per ulteriori informazioni, vedere [invio e ricezione di errori](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="fa4d2-134">For more information, see [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span>

## <a name="undeclared-soap-faults-and-debugging"></a><span data-ttu-id="fa4d2-135">Errori SOAP non dichiarati e debug</span><span class="sxs-lookup"><span data-stu-id="fa4d2-135">Undeclared SOAP Faults and Debugging</span></span>

<span data-ttu-id="fa4d2-136">Gli errori SOAP non dichiarati sono estremamente utili per la compilazione di solide applicazioni distribuite e interoperabili.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-136">Declared SOAP faults are extremely useful for building robust, interoperable, distributed applications.</span></span> <span data-ttu-id="fa4d2-137">Tuttavia, in alcuni casi, è utile per un servizio (o un client duplex) inviare un errore SOAP non dichiarato, uno di quegli errori non menzionati nel codice WSDL (Web Services Description Language) dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-137">However, in some cases it is useful for a service (or duplex client) to send an undeclared SOAP fault, one that is not mentioned in the Web Services Description Language (WSDL) for that operation.</span></span> <span data-ttu-id="fa4d2-138">Ad esempio, quando si sviluppa un servizio, possono verificarsi situazioni impreviste in cui è utile, a scopo di debug, reinviare informazioni al client.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-138">For example, when developing a service, unexpected situations can occur in which it is useful for debugging purposes to send information back to the client.</span></span> <span data-ttu-id="fa4d2-139">Inoltre, è possibile impostare la proprietà <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> o la proprietà <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> su `true` per consentire ai client WCF di ottenere informazioni sulle eccezioni delle operazioni interne del servizio.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-139">In addition, you can set the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property or the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property to `true` to permit WCF clients to obtain information about internal service operation exceptions.</span></span> <span data-ttu-id="fa4d2-140">L'invio di singoli errori e l'impostazione delle proprietà del comportamento di debug sono descritti in [invio e ricezione degli errori](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="fa4d2-140">Both sending individual faults and setting the debugging behavior properties are described in [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fa4d2-141">Poiché le eccezioni gestite possono esporre informazioni interne sull'applicazione, l'impostazione di <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> su `true` può consentire ai client WCF di ottenere informazioni sulle eccezioni delle operazioni interne del servizio, tra cui l'identificazione personale o altri elementi sensibili informazioni.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-141">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>
>
> <span data-ttu-id="fa4d2-142">Di conseguenza, l'impostazione della proprietà <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> su `true` è consigliabile solo come modalità temporanea di debug di un'applicazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-142">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is recommended only as a way to temporarily debug a service application.</span></span> <span data-ttu-id="fa4d2-143">Inoltre, il codice WSDL di un metodo che restituisce in questo modo eccezioni gestite senza tuttavia gestirle non contiene il contratto dell'eccezione <xref:System.ServiceModel.FaultException%601> di tipo <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-143">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="fa4d2-144">Per ottenere correttamente le informazioni di debug, i client devono prevedere la possibilità di un errore SOAP sconosciuto (restituito ai client WCF come oggetti <xref:System.ServiceModel.FaultException?displayProperty=nameWithType>).</span><span class="sxs-lookup"><span data-stu-id="fa4d2-144">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>

## <a name="customizing-error-handling-with-ierrorhandler"></a><span data-ttu-id="fa4d2-145">Personalizzazione della gestione degli errori con IErrorHandler</span><span class="sxs-lookup"><span data-stu-id="fa4d2-145">Customizing Error Handling with IErrorHandler</span></span>

<span data-ttu-id="fa4d2-146">Se si ha l'esigenza di personalizzare il messaggio di risposta al client, quando si verifica un'eccezione a livello di applicazione, o di effettuare alcune operazioni di elaborazione personalizzate dopo la restituzione del messaggio di risposta, implementare l'interfaccia <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-146">If you have special requirements to either customize the response message to the client when an application-level exception happens or perform some custom processing after the response message is returned, implement the <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> interface.</span></span>

## <a name="fault-serialization-issues"></a><span data-ttu-id="fa4d2-147">Problemi di serializzazione</span><span class="sxs-lookup"><span data-stu-id="fa4d2-147">Fault Serialization Issues</span></span>

<span data-ttu-id="fa4d2-148">Durante la deserializzazione di un contratto di errore, in WCF viene innanzitutto effettuato il tentativo di far corrispondere il nome del contratto di errore nel messaggio SOAP con il tipo di contratto di errore.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-148">When deserializing a fault contract, WCF first attempts to match the fault contract name in the SOAP message with the fault contract type.</span></span> <span data-ttu-id="fa4d2-149">Se non si trova una corrispondenza esatta, verrà effettuata una ricerca, in ordine alfabetico, di un tipo compatibile nell'elenco di contratti di errore disponibile.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-149">If it cannot find an exact match it will then search the list of available fault contracts in alphabetical order for a compatible type.</span></span> <span data-ttu-id="fa4d2-150">Se due contratti di errore sono tipi compatibili (ad esempio uno è una sottoclasse dell'altro), per deserializzare l'errore potrebbe essere utilizzato il tipo non corretto.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-150">If two fault contracts are compatible types (one is a subclass of another, for example) the wrong type may be used to de-serialize the fault.</span></span> <span data-ttu-id="fa4d2-151">Tale situazione si verifica solo se nel contratto di errore non vengono specificati un nome, uno spazio dei nomi e un'azione.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-151">This only occurs if the fault contract does not specify a name, namespace, and action.</span></span> <span data-ttu-id="fa4d2-152">Per evitare il verificarsi di tale errore, specificare sempre completamente i contratti di errore indicando il nome, lo spazio dei nomi e gli attributi dell'azione.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-152">To prevent this issue from occurring, always fully qualify fault contracts by specifying the name, namespace, and action attributes.</span></span> <span data-ttu-id="fa4d2-153">Inoltre, se è stato definito un numero di contratti di errore correlati derivati da una classe base condivisa, assicurarsi di contrassegnare qualsiasi membro nuovo con `[DataMember(IsRequired=true)]`.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-153">Additionally if you have defined a number of related fault contracts derived from a shared base class, make sure to mark any new members with `[DataMember(IsRequired=true)]`.</span></span> <span data-ttu-id="fa4d2-154">Per ulteriori informazioni su questo attributo `IsRequired`, vedere <xref:System.Runtime.Serialization.DataMemberAttribute>.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-154">For more information on this `IsRequired` attribute see, <xref:System.Runtime.Serialization.DataMemberAttribute>.</span></span> <span data-ttu-id="fa4d2-155">In questo modo si potrà evitare che la classe base sia di tipo compatibile e si consentirà la deserializzazione dell'errore nel tipo derivato corretto.</span><span class="sxs-lookup"><span data-stu-id="fa4d2-155">This will prevent a base class from being a compatible type and force the fault to be deserialized into the correct derived type.</span></span>

## <a name="see-also"></a><span data-ttu-id="fa4d2-156">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="fa4d2-156">See also</span></span>

- <xref:System.ServiceModel.FaultException>
- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.ServiceModel.FaultException>
- <xref:System.Xml.Serialization.XmlSerializer>
- <xref:System.ServiceModel.XmlSerializerFormatAttribute>
- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.ServiceModel.CommunicationException>
- <xref:System.ServiceModel.FaultContractAttribute.Action%2A>
- <xref:System.ServiceModel.FaultException.Code%2A>
- <xref:System.ServiceModel.FaultException.Reason%2A>
- <xref:System.ServiceModel.FaultCode.SubCode%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A>
- [<span data-ttu-id="fa4d2-157">Definizione e specifica degli errori</span><span class="sxs-lookup"><span data-stu-id="fa4d2-157">Defining and Specifying Faults</span></span>](defining-and-specifying-faults.md)
