---
title: Invio e ricezione degli errori
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- handling faults [WCF], sending
ms.assetid: 7be6fb96-ce2a-450b-aebe-f932c6a4bc5d
ms.openlocfilehash: dc9dcb5d8e36984d1e5a2e5c5124e74509de7f3d
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/15/2019
ms.locfileid: "72320224"
---
# <a name="sending-and-receiving-faults"></a><span data-ttu-id="6b599-102">Invio e ricezione degli errori</span><span class="sxs-lookup"><span data-stu-id="6b599-102">Sending and Receiving Faults</span></span>

<span data-ttu-id="6b599-103">Gli errori SOAP trasportano informazioni sulla condizione di errore da un servizio a un client e, nel caso duplex, da un client a un servizio in modo interoperativo.</span><span class="sxs-lookup"><span data-stu-id="6b599-103">SOAP faults convey error condition information from a service to a client and in the duplex case from a client to a service in an interoperable way.</span></span> <span data-ttu-id="6b599-104">In genere, un servizio definisce un contenuto di errore personalizzato e specifica quali operazioni possono restituirlo.</span><span class="sxs-lookup"><span data-stu-id="6b599-104">Typically a service defines custom fault content and specifies which operations can return them.</span></span> <span data-ttu-id="6b599-105">Per ulteriori informazioni, vedere [definizione e specifica degli errori](defining-and-specifying-faults.md). In questo argomento viene illustrato il modo in cui un servizio o un client duplex può inviare tali errori quando si verifica la condizione di errore corrispondente e in che modo un'applicazione client o di servizio gestisce tali errori.</span><span class="sxs-lookup"><span data-stu-id="6b599-105">(For more information, see [Defining and Specifying Faults](defining-and-specifying-faults.md).) This topic discusses how a service or duplex client can send those faults when the corresponding error condition has occurred and how a client or service application handles these faults.</span></span> <span data-ttu-id="6b599-106">Per una panoramica della gestione degli errori nelle applicazioni Windows Communication Foundation (WCF), vedere [specifica e gestione di errori in contratti e servizi](specifying-and-handling-faults-in-contracts-and-services.md).</span><span class="sxs-lookup"><span data-stu-id="6b599-106">For an overview of error handling in Windows Communication Foundation (WCF) applications, see [Specifying and Handling Faults in Contracts and Services](specifying-and-handling-faults-in-contracts-and-services.md).</span></span>

## <a name="sending-soap-faults"></a><span data-ttu-id="6b599-107">Invio di errori SOAP</span><span class="sxs-lookup"><span data-stu-id="6b599-107">Sending SOAP Faults</span></span>

<span data-ttu-id="6b599-108">Gli errori SOAP dichiarati sono quelli in cui un'operazione presenta un <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> che specifica un tipo di errore SOAP personalizzato.</span><span class="sxs-lookup"><span data-stu-id="6b599-108">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="6b599-109">Gli errori SOAP non dichiarati sono quelli che non vengono specificati nel contratto per un'operazione.</span><span class="sxs-lookup"><span data-stu-id="6b599-109">Undeclared SOAP faults are those that are not specified in the contract for an operation.</span></span>

### <a name="sending-declared-faults"></a><span data-ttu-id="6b599-110">Invio di errori dichiarati</span><span class="sxs-lookup"><span data-stu-id="6b599-110">Sending Declared Faults</span></span>

<span data-ttu-id="6b599-111">Per inviare un errore SOAP dichiarato, rilevare la condizione di errore adatta all'errore SOAP e generare una nuova eccezione <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> in cui il parametro di tipo è un nuovo oggetto del tipo specificato nell'attributo <xref:System.ServiceModel.FaultContractAttribute> di tale operazione.</span><span class="sxs-lookup"><span data-stu-id="6b599-111">To send a declared SOAP fault, detect the error condition for which the SOAP fault is appropriate and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> where the type parameter is a new object of the type specified in the <xref:System.ServiceModel.FaultContractAttribute> for that operation.</span></span> <span data-ttu-id="6b599-112">Nell'esempio di codice seguente viene illustrato come utilizzare l'attributo <xref:System.ServiceModel.FaultContractAttribute> per specificare che l'operazione `SampleMethod` può restituire un errore SOAP contente informazioni dettagliate di tipo `GreetingFault`.</span><span class="sxs-lookup"><span data-stu-id="6b599-112">The following code example shows the use of <xref:System.ServiceModel.FaultContractAttribute> to specify that the `SampleMethod` operation can return a SOAP fault with the detail type of `GreetingFault`.</span></span>

[!code-csharp[FaultContractAttribute#4](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#4)]
[!code-vb[FaultContractAttribute#4](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#4)]

<span data-ttu-id="6b599-113">Per trasportare le informazioni sull'errore `GreetingFault` al client, intercettare la condizione di errore appropriata e generare una nuova eccezione <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> di tipo `GreetingFault` con un nuovo oggetto `GreetingFault` come argomento, come mostrato nell'esempio di codice seguente.</span><span class="sxs-lookup"><span data-stu-id="6b599-113">To convey the `GreetingFault` error information to the client, catch the appropriate error condition and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault` with a new `GreetingFault` object as the argument, as in the following code example.</span></span> <span data-ttu-id="6b599-114">Se il client è un'applicazione client WCF, questo viene considerato come un'eccezione gestita in cui il tipo è <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> di tipo `GreetingFault`.</span><span class="sxs-lookup"><span data-stu-id="6b599-114">If the client is an WCF client application, it experiences this as a managed exception where the type is <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault`.</span></span>

[!code-csharp[FaultContractAttribute#5](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#5)]
[!code-vb[FaultContractAttribute#5](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#5)]

### <a name="sending-undeclared-faults"></a><span data-ttu-id="6b599-115">Invio di errori non dichiarati</span><span class="sxs-lookup"><span data-stu-id="6b599-115">Sending Undeclared Faults</span></span>

<span data-ttu-id="6b599-116">L'invio di errori non dichiarati può essere molto utile per diagnosticare ed eseguire rapidamente il debug dei problemi nelle applicazioni WCF, ma la sua utilità come strumento di debug è limitata.</span><span class="sxs-lookup"><span data-stu-id="6b599-116">Sending undeclared faults can be very useful to quickly diagnose and debug problems in WCF applications, but its usefulness as a debugging tool is limited.</span></span> <span data-ttu-id="6b599-117">Più in generale, quando si esegue il debug è consigliabile utilizzare la proprietà <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6b599-117">More generally, when debugging it is recommended that you use the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="6b599-118">Quando si imposta questo valore su True, i client considerano questi errori come eccezioni <xref:System.ServiceModel.FaultException%601> di tipo <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="6b599-118">When you set this value to true, clients experience such faults as <xref:System.ServiceModel.FaultException%601> exceptions of type <xref:System.ServiceModel.ExceptionDetail>.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6b599-119">Poiché le eccezioni gestite possono esporre informazioni interne sull'applicazione, l'impostazione di <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> su `true` può consentire ai client WCF di ottenere informazioni sulle eccezioni delle operazioni interne del servizio, tra cui l'identificazione personale o altri elementi sensibili informazioni.</span><span class="sxs-lookup"><span data-stu-id="6b599-119">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>
>
> <span data-ttu-id="6b599-120">Di conseguenza, l'impostazione della proprietà <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> o della proprietà <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> su `true` è consigliabile solo come modalità temporanea di debug di un'applicazione di servizio.</span><span class="sxs-lookup"><span data-stu-id="6b599-120">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is only recommended as a way of temporarily debugging a service application.</span></span> <span data-ttu-id="6b599-121">Inoltre, il codice WSDL di un metodo che restituisce in questo modo eccezioni gestite senza tuttavia gestirle non contiene il contratto dell'eccezione <xref:System.ServiceModel.FaultException%601> di tipo <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="6b599-121">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="6b599-122">Per ottenere correttamente le informazioni di debug, i client devono prevedere la possibilità di un errore SOAP sconosciuto (restituito ai client WCF come oggetti <xref:System.ServiceModel.FaultException?displayProperty=nameWithType>).</span><span class="sxs-lookup"><span data-stu-id="6b599-122">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>

<span data-ttu-id="6b599-123">Per inviare un errore SOAP non dichiarato, generare un oggetto <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> (ovvero, non l'eccezione generica <xref:System.ServiceModel.FaultException%601>) e passare la stringa al costruttore.</span><span class="sxs-lookup"><span data-stu-id="6b599-123">To send an undeclared SOAP fault, throw a <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> object (that is, not the generic type <xref:System.ServiceModel.FaultException%601>) and pass the string to the constructor.</span></span> <span data-ttu-id="6b599-124">Questo viene esposto alle applicazioni client WCF come eccezione generata <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> eccezione in cui la stringa è disponibile chiamando il metodo <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6b599-124">This is exposed to the WCF client applications as a thrown <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> exception where the string is available by calling the <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> method.</span></span>

> [!NOTE]
> <span data-ttu-id="6b599-125">Se si dichiara un errore SOAP di tipo stringa e quindi si genera nel servizio l'eccezione corrispondente a tale errore come eccezione <xref:System.ServiceModel.FaultException%601> in cui il parametro di tipo è una stringa <xref:System.String?displayProperty=nameWithType>, il valore di tale stringa viene assegnato alla proprietà <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> e non è ottenibile tramite il metodo <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6b599-125">If you declare a SOAP fault of type string, and then throw this in your service as a <xref:System.ServiceModel.FaultException%601> where the type parameter is a <xref:System.String?displayProperty=nameWithType> the string value is assigned to the <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> property, and is not available from <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span></span>

## <a name="handling-faults"></a><span data-ttu-id="6b599-126">Gestione degli errori</span><span class="sxs-lookup"><span data-stu-id="6b599-126">Handling Faults</span></span>

<span data-ttu-id="6b599-127">Nei client WCF, gli errori SOAP che si verificano durante la comunicazione che sono di interesse per le applicazioni client vengono generati come eccezioni gestite.</span><span class="sxs-lookup"><span data-stu-id="6b599-127">In WCF clients, SOAP faults that occur during communication that are of interest to client applications are raised as managed exceptions.</span></span> <span data-ttu-id="6b599-128">Sebbene esistano numerose eccezioni che possono verificarsi durante l'esecuzione di qualsiasi programma, le applicazioni che utilizzano il modello di programmazione client WCF possono prevedere di gestire le eccezioni dei due tipi seguenti in seguito alla comunicazione.</span><span class="sxs-lookup"><span data-stu-id="6b599-128">While there are many exceptions that can occur during the execution of any program, applications using the WCF client programming model can expect to handle exceptions of the following two types as a result of communication.</span></span>

- <xref:System.TimeoutException>

- <xref:System.ServiceModel.CommunicationException>

<span data-ttu-id="6b599-129">Gli oggetti <xref:System.TimeoutException> vengono generati quando un'operazione supera il periodo di timeout specificato.</span><span class="sxs-lookup"><span data-stu-id="6b599-129"><xref:System.TimeoutException> objects are thrown when an operation exceeds the specified timeout period.</span></span>

<span data-ttu-id="6b599-130">Gli oggetti <xref:System.ServiceModel.CommunicationException> vengono generati quando nel servizio o nel client si verifica una condizione di errore di comunicazione risolvibile.</span><span class="sxs-lookup"><span data-stu-id="6b599-130"><xref:System.ServiceModel.CommunicationException> objects are thrown when there is some recoverable communication error condition on either the service or the client.</span></span>

<span data-ttu-id="6b599-131">La classe <xref:System.ServiceModel.CommunicationException> dispone di due tipi derivati importanti: <xref:System.ServiceModel.FaultException> e il tipo <xref:System.ServiceModel.FaultException%601> generico.</span><span class="sxs-lookup"><span data-stu-id="6b599-131">The <xref:System.ServiceModel.CommunicationException> class has two important derived types, <xref:System.ServiceModel.FaultException> and the generic <xref:System.ServiceModel.FaultException%601> type.</span></span>

<span data-ttu-id="6b599-132">Le eccezioni <xref:System.ServiceModel.FaultException> vengono generate quando un listener riceve un errore che non è previsto o non è specificato nel contratto dell'operazione. Ciò in genere si verifica quando durante il debug dell'applicazione la proprietà <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> del servizio è impostata su `true`.</span><span class="sxs-lookup"><span data-stu-id="6b599-132"><xref:System.ServiceModel.FaultException> exceptions are thrown when a listener receives a fault that is not expected or specified in the operation contract; usually this occurs when the application is being debugged and the service has the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true`.</span></span>

<span data-ttu-id="6b599-133">Le eccezioni <xref:System.ServiceModel.FaultException%601> vengono generate nel client quando un errore specificato nel contratto dell'operazione viene ricevuto in risposta a un'operazione bidirezionale, ovvero a un metodo avente un attributo <xref:System.ServiceModel.OperationContractAttribute> in cui la proprietà <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> è impostata su `false`.</span><span class="sxs-lookup"><span data-stu-id="6b599-133"><xref:System.ServiceModel.FaultException%601> exceptions are thrown on the client when a fault that is specified in the operation contract is received in response to a two-way operation (that is, a method with an <xref:System.ServiceModel.OperationContractAttribute> attribute with <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> set to `false`).</span></span>

> [!NOTE]
> <span data-ttu-id="6b599-134">Quando un servizio WCF dispone della proprietà <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> impostata su `true` il client sperimenta questo oggetto come <xref:System.ServiceModel.FaultException%601> non dichiarato di tipo <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="6b599-134">When an WCF service has the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true` the client experiences this as an undeclared <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="6b599-135">I client possono intercettare questo errore specifico oppure gestire l'errore in un blocco catch per l'eccezione <xref:System.ServiceModel.FaultException>.</span><span class="sxs-lookup"><span data-stu-id="6b599-135">Clients can either catch this specific fault or handle the fault in a catch block for <xref:System.ServiceModel.FaultException>.</span></span>

<span data-ttu-id="6b599-136">In genere, solo le eccezioni <xref:System.ServiceModel.FaultException%601>, <xref:System.TimeoutException> e <xref:System.ServiceModel.CommunicationException> sono di interesse per client e servizi.</span><span class="sxs-lookup"><span data-stu-id="6b599-136">Typically, only <xref:System.ServiceModel.FaultException%601>, <xref:System.TimeoutException>, and <xref:System.ServiceModel.CommunicationException> exceptions are of interest to clients and services.</span></span>

> [!NOTE]
> <span data-ttu-id="6b599-137">Naturalmente, si verificano anche eccezioni di altro tipo.</span><span class="sxs-lookup"><span data-stu-id="6b599-137">Other exceptions, of course, do occur.</span></span> <span data-ttu-id="6b599-138">Un esempio di eccezione imprevista è l'errore irreparabile <xref:System.OutOfMemoryException?displayProperty=nameWithType>. In genere, le applicazioni non devono intercettare tali metodi.</span><span class="sxs-lookup"><span data-stu-id="6b599-138">Unexpected exceptions include catastrophic failures like <xref:System.OutOfMemoryException?displayProperty=nameWithType>; typically applications should not catch such methods.</span></span>

### <a name="catch-fault-exceptions-in-the-correct-order"></a><span data-ttu-id="6b599-139">Intercettazione delle eccezioni di errore nell'ordine corretto</span><span class="sxs-lookup"><span data-stu-id="6b599-139">Catch Fault Exceptions in the Correct Order</span></span>

<span data-ttu-id="6b599-140">Poiché la classe <xref:System.ServiceModel.FaultException%601> deriva dalla classe <xref:System.ServiceModel.FaultException> e la classe <xref:System.ServiceModel.FaultException> deriva dalla classe <xref:System.ServiceModel.CommunicationException> è importante intercettare queste eccezioni nell'ordine corretto.</span><span class="sxs-lookup"><span data-stu-id="6b599-140">Because <xref:System.ServiceModel.FaultException%601> derives from <xref:System.ServiceModel.FaultException>, and <xref:System.ServiceModel.FaultException> derives from <xref:System.ServiceModel.CommunicationException>, it is important to catch these exceptions in the proper order.</span></span> <span data-ttu-id="6b599-141">Se ad esempio si utilizza un blocco try/catch nel quale si intercetta prima l'eccezione <xref:System.ServiceModel.CommunicationException>, tutti gli errori SOAP, siano essi specificati o non specificati, vengono gestiti in tale blocco. Qualsiasi blocco catch successivo finalizzato alla gestione di eccezioni <xref:System.ServiceModel.FaultException%601> personalizzate non viene mai chiamato.</span><span class="sxs-lookup"><span data-stu-id="6b599-141">If, for example, you have a try/catch block in which you first catch <xref:System.ServiceModel.CommunicationException>, all specified and unspecified SOAP faults are handled there; any subsequent catch blocks to handle a custom <xref:System.ServiceModel.FaultException%601> exception are never invoked.</span></span>

<span data-ttu-id="6b599-142">Si tenga presente che una stessa operazione può restituire un numero qualsiasi di errori specificati.</span><span class="sxs-lookup"><span data-stu-id="6b599-142">Remember that one operation can return any number of specified faults.</span></span> <span data-ttu-id="6b599-143">Ogni errore è un tipo univoco e deve essere gestito in modo individuale.</span><span class="sxs-lookup"><span data-stu-id="6b599-143">Each fault is a unique type and must be handled separately.</span></span>

### <a name="handle-exceptions-when-closing-the-channel"></a><span data-ttu-id="6b599-144">Gestione delle eccezioni in caso di chiusura del canale</span><span class="sxs-lookup"><span data-stu-id="6b599-144">Handle Exceptions When Closing the Channel</span></span>

<span data-ttu-id="6b599-145">La maggior parte della discussione precedente riguarda gli errori inviati durante l'elaborazione dei messaggi dell'applicazione, ovvero i messaggi inviati in modo esplicito dal client quando l'applicazione client chiama operazioni sull'oggetto client WCF.</span><span class="sxs-lookup"><span data-stu-id="6b599-145">Most of the preceding discussion has to do with faults sent in the course of processing application messages, that is, messages explicitly sent by the client when the client application calls operations on the WCF client object.</span></span>

<span data-ttu-id="6b599-146">Anche nel caso di oggetti locali, l'eliminazione dell'oggetto può generare oppure nascondere le eccezioni che si verificano durante il processo di riciclo.</span><span class="sxs-lookup"><span data-stu-id="6b599-146">Even with local objects disposing the object can either raise or mask exceptions that occur during the recycling process.</span></span> <span data-ttu-id="6b599-147">Quando si utilizzano oggetti client WCF, è possibile che si verifichi un problema simile.</span><span class="sxs-lookup"><span data-stu-id="6b599-147">Something similar can occur when you use WCF client objects.</span></span> <span data-ttu-id="6b599-148">La chiamata di un'operazione comporta l'invio di messaggi tramite una connessione stabilita.</span><span class="sxs-lookup"><span data-stu-id="6b599-148">When you call operations you are sending messages over an established connection.</span></span> <span data-ttu-id="6b599-149">Se la connessione è già stata chiusa oppure non può essere chiusa in modo corretto, la chiusura del canale può generare eccezioni. Ciò si verifica anche se tutte le operazioni hanno eseguito la restituzione in modo corretto.</span><span class="sxs-lookup"><span data-stu-id="6b599-149">Closing the channel can throw exceptions if the connection cannot be cleanly closed or is already closed, even if all the operations returned properly.</span></span>

<span data-ttu-id="6b599-150">In genere i canali dell'oggetto client vengono chiusi in uno dei casi seguenti:</span><span class="sxs-lookup"><span data-stu-id="6b599-150">Typically, client object channels are closed in one of the following ways:</span></span>

- <span data-ttu-id="6b599-151">Quando l'oggetto client WCF viene riciclato.</span><span class="sxs-lookup"><span data-stu-id="6b599-151">When the WCF client object is recycled.</span></span>

- <span data-ttu-id="6b599-152">Quando l'applicazione client chiama il metodo <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6b599-152">When the client application calls <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="6b599-153">Quando l'applicazione client chiama il metodo <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6b599-153">When the client application calls <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>.</span></span>

- <span data-ttu-id="6b599-154">Quando l'applicazione client chiama un'operazione di chiusura di una sessione.</span><span class="sxs-lookup"><span data-stu-id="6b599-154">When the client application calls an operation that is a terminating operation for a session.</span></span>

<span data-ttu-id="6b599-155">In tutti i casi, quando viene chiuso, il canale inizia a chiudere qualsiasi canale sottostante in grado di inviare messaggi allo scopo di supportare funzionalità complesse al livello applicazione.</span><span class="sxs-lookup"><span data-stu-id="6b599-155">In all cases, closing the channel instructs the channel to begin closing any underlying channels that may be sending messages to support complex functionality at the application level.</span></span> <span data-ttu-id="6b599-156">Ad esempio, quando un contratto richiede le sessioni, un'associazione tenta di stabilire una sessione scambiando messaggi con il canale del servizio fino a stabilire una sessione.</span><span class="sxs-lookup"><span data-stu-id="6b599-156">For example, when a contract requires sessions a binding attempts to establish a session by exchanging messages with the service channel until a session is established.</span></span> <span data-ttu-id="6b599-157">Quando il canale viene chiuso, il canale della sessione sottostante comunica al servizio che la sessione è terminata.</span><span class="sxs-lookup"><span data-stu-id="6b599-157">When the channel is closed, the underlying session channel notifies the service that the session is terminated.</span></span> <span data-ttu-id="6b599-158">In questo caso, se il canale risulta interrotto, chiuso o comunque inutilizzabile (ad esempio quando si scollega un cavo di rete), il canale client non può comunicare al canale del servizio che la sessione è terminata e pertanto è possibile che venga generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="6b599-158">In this case, if the channel has already aborted, closed, or is otherwise unusable (for example, when a network cable is unplugged), the client channel cannot inform the service channel that the session is terminated and an exception can result.</span></span>

### <a name="abort-the-channel-if-necessary"></a><span data-ttu-id="6b599-159">Interruzione del canale</span><span class="sxs-lookup"><span data-stu-id="6b599-159">Abort the Channel If Necessary</span></span>

<span data-ttu-id="6b599-160">Poiché anche la chiusura del canale può generare eccezioni, oltre a intercettare le eccezioni nell'ordine corretto è consigliabile interrompere il canale utilizzato per effettuare la chiamata al blocco catch.</span><span class="sxs-lookup"><span data-stu-id="6b599-160">Because closing the channel can also throw exceptions, then, it is recommended that in addition to catching fault exceptions in the correct order, it is important to abort the channel that was used in making the call in the catch block.</span></span>

<span data-ttu-id="6b599-161">Se l'errore trasporta informazioni sull'errore specifiche di un'operazione ed esiste la possibilità che tali informazioni possano essere utilizzate da terzi, non occorre interrompere il canale. Si tratta tuttavia di un caso raro.</span><span class="sxs-lookup"><span data-stu-id="6b599-161">If the fault conveys error information specific to an operation and it remains possible that others can use it, there is no need to abort the channel (although these cases are rare).</span></span> <span data-ttu-id="6b599-162">In tutti gli altri casi è consigliabile interrompere il canale.</span><span class="sxs-lookup"><span data-stu-id="6b599-162">In all other cases, it is recommended that you abort the channel.</span></span> <span data-ttu-id="6b599-163">Per un esempio in cui vengono illustrati tutti questi punti, vedere [eccezioni previste](./samples/expected-exceptions.md).</span><span class="sxs-lookup"><span data-stu-id="6b599-163">For a sample that demonstrates all of these points, see [Expected Exceptions](./samples/expected-exceptions.md).</span></span>

<span data-ttu-id="6b599-164">Nell'esempio di codice seguente viene mostrato come gestire le eccezioni di errore SOAP in un'applicazione client di base, sia nel caso di errore dichiarato sia nel caso di errore non dichiarato.</span><span class="sxs-lookup"><span data-stu-id="6b599-164">The following code example shows how to handle SOAP fault exceptions in a basic client application, including a declared fault and an undeclared fault.</span></span>

> [!NOTE]
> <span data-ttu-id="6b599-165">Questo esempio di codice non utilizza il costrutto `using`.</span><span class="sxs-lookup"><span data-stu-id="6b599-165">This sample code does not use the `using` construct.</span></span> <span data-ttu-id="6b599-166">Poiché i canali di chiusura possono generare eccezioni, è consigliabile che le applicazioni creino prima un client WCF e quindi aprano, usino e chiudano il client WCF nello stesso blocco try.</span><span class="sxs-lookup"><span data-stu-id="6b599-166">Because closing channels can throw exceptions, it is recommended that applications create a WCF client first, and then open, use, and close the WCF client in the same try block.</span></span> <span data-ttu-id="6b599-167">Per informazioni dettagliate, vedere [Cenni preliminari sui client WCF](wcf-client-overview.md) e [utilizzare Close e Abort per rilasciare le risorse client WCF](./samples/use-close-abort-release-wcf-client-resources.md).</span><span class="sxs-lookup"><span data-stu-id="6b599-167">For details, see [WCF Client Overview](wcf-client-overview.md) and [Use Close and Abort to release WCF client resources](./samples/use-close-abort-release-wcf-client-resources.md).</span></span>

[!code-csharp[FaultContractAttribute#3](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/client.cs#3)]
[!code-vb[FaultContractAttribute#3](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/client.vb#3)]

## <a name="see-also"></a><span data-ttu-id="6b599-168">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="6b599-168">See also</span></span>

- <xref:System.ServiceModel.FaultException>
- <xref:System.ServiceModel.FaultException%601>
- <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType>
- [<span data-ttu-id="6b599-169">Eccezioni previste</span><span class="sxs-lookup"><span data-stu-id="6b599-169">Expected Exceptions</span></span>](./samples/expected-exceptions.md)
- [<span data-ttu-id="6b599-170">Utilizzare Close e Abort per rilasciare le risorse client WCF</span><span class="sxs-lookup"><span data-stu-id="6b599-170">Use Close and Abort to release WCF client resources</span></span>](./samples/use-close-abort-release-wcf-client-resources.md)
