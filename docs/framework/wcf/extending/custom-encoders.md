---
title: Codificatori personalizzati
ms.date: 03/30/2017
ms.assetid: fa0e1d7f-af36-4bf4-aac9-cd4eab95bc4f
ms.openlocfilehash: 586207af0bfbe106512dfb61ee7439d4f5ce64c6
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/07/2019
ms.locfileid: "70797210"
---
# <a name="custom-encoders"></a><span data-ttu-id="21e04-102">Codificatori personalizzati</span><span class="sxs-lookup"><span data-stu-id="21e04-102">Custom Encoders</span></span>
<span data-ttu-id="21e04-103">In questo argomento verranno illustrate le procedure per creare codificatori personalizzati.</span><span class="sxs-lookup"><span data-stu-id="21e04-103">This topic discusses how to create custom encoders.</span></span>  
  
 <span data-ttu-id="21e04-104">In Windows Communication Foundation (WCF) si utilizza un' *associazione* per specificare come trasferire i dati attraverso una rete tra endpoint.</span><span class="sxs-lookup"><span data-stu-id="21e04-104">In Windows Communication Foundation (WCF), you use a *binding* to specify how to transfer data across a network between endpoints.</span></span> <span data-ttu-id="21e04-105">Un'associazione è costituita da una sequenza di *elementi di associazione*.</span><span class="sxs-lookup"><span data-stu-id="21e04-105">A binding is made up of a sequence of *binding elements*.</span></span> <span data-ttu-id="21e04-106">Un'associazione include elementi di associazione di protocollo facoltativi, ad esempio sicurezza, un elemento di associazione del *codificatore di messaggi* obbligatorio e un elemento di associazione del trasporto obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="21e04-106">A binding includes optional protocol binding elements such as security, a required *Message Encoder* binding element, and a required transport binding element.</span></span> <span data-ttu-id="21e04-107">Un codificatore di messaggi è rappresentato da un elemento di associazione di codifica dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="21e04-107">A message encoder is represented by a message encoding binding element.</span></span> <span data-ttu-id="21e04-108">In WCF sono inclusi tre codificatori di messaggi: Binary, MTOM (Message Transmission Optimization Mechanism) e Text.</span><span class="sxs-lookup"><span data-stu-id="21e04-108">Three message encoders are included in WCF: Binary, Message Transmission Optimization Mechanism (MTOM), and Text.</span></span>  
  
 <span data-ttu-id="21e04-109">Un elemento di associazione di codifica dei messaggi serializza un oggetto <xref:System.ServiceModel.Channels.Message> in uscita e lo passa al trasporto oppure riceve dal trasporto il formato serializzato di un messaggio e lo passa al livello protocollo o, se non è presente, all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="21e04-109">A message encoding binding element serializes an outgoing <xref:System.ServiceModel.Channels.Message> and passes it to the transport, or receives the serialized form of a message from the transport and passes it to the protocol layer if present, or to the application, if not present.</span></span>  
  
 <span data-ttu-id="21e04-110">I codificatori di messaggi trasformano le istanze <xref:System.ServiceModel.Channels.Message> da e in una rappresentazione di trasmissione.</span><span class="sxs-lookup"><span data-stu-id="21e04-110">Message encoders transform <xref:System.ServiceModel.Channels.Message> instances to and from a wire representation.</span></span> <span data-ttu-id="21e04-111">Anche se si ritiene che i codificatori risiedano sopra il livello trasporto nello stack del canale, essi risiedono all'interno del livello trasporto.</span><span class="sxs-lookup"><span data-stu-id="21e04-111">Although encoders are described as sitting above the transport layer in the channel stack, they reside inside the transport layer.</span></span> <span data-ttu-id="21e04-112">I trasporti (ad esempio HTTP) formattano il messaggio in base ai requisiti dello standard di trasporto.</span><span class="sxs-lookup"><span data-stu-id="21e04-112">Transports (for example HTTP) format the message according to the requirements of the transport standard.</span></span> <span data-ttu-id="21e04-113">I codificatori (ad esempio Text/XML) si limitano a codificare il messaggio.</span><span class="sxs-lookup"><span data-stu-id="21e04-113">Encoders (for example Text Xml) just encode the message.</span></span>  
  
 <span data-ttu-id="21e04-114">Quando si esegue la connessione a un client o server esistente, può non essere possibile scegliere un determinato tipo di codifica dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="21e04-114">When connecting to a preexisting client or server, you may not have a choice about using a particular message encoding.</span></span> <span data-ttu-id="21e04-115">Tuttavia, i servizi WCF possono essere resi accessibili tramite più endpoint, ognuno con un codificatore di messaggi diverso.</span><span class="sxs-lookup"><span data-stu-id="21e04-115">However, WCF services can be made accessible through multiple endpoints, each with a different message encoder.</span></span> <span data-ttu-id="21e04-116">Quando un singolo codificatore non include tutti i destinatari del servizio, è consigliabile esporre il servizio su più endpoint.</span><span class="sxs-lookup"><span data-stu-id="21e04-116">When a single encoder does not cover the entire audience for your service, consider exposing your service over multiple endpoints.</span></span> <span data-ttu-id="21e04-117">Le applicazioni client potranno quindi scegliere l'endpoint più appropriato.</span><span class="sxs-lookup"><span data-stu-id="21e04-117">Client applications can then choose the endpoint that is best for them.</span></span> <span data-ttu-id="21e04-118">L'utilizzo di più endpoint consente di combinare i vantaggi di differenti codificatori di messaggi con altri elementi di associazione.</span><span class="sxs-lookup"><span data-stu-id="21e04-118">Using multiple endpoints allows you to combine the advantages of different message encoders with other binding elements.</span></span>  
  
## <a name="system-provided-encoders"></a><span data-ttu-id="21e04-119">Codificatori forniti dal sistema</span><span class="sxs-lookup"><span data-stu-id="21e04-119">System-Provided Encoders</span></span>  
 <span data-ttu-id="21e04-120">In WCF sono disponibili diverse associazioni fornite dal sistema progettate per coprire gli scenari di applicazione più comuni.</span><span class="sxs-lookup"><span data-stu-id="21e04-120">WCF provides several system-provided bindings that are designed to cover the most common application scenarios.</span></span> <span data-ttu-id="21e04-121">Ognuna di queste associazioni combina un trasporto, un codificatore di messaggi e altre opzioni (ad esempio quelle relative alla protezione).</span><span class="sxs-lookup"><span data-stu-id="21e04-121">Each of these bindings combine a transport, message encoder, and other options (security, for example).</span></span> <span data-ttu-id="21e04-122">In questo argomento viene descritto come estendere `Text`i `Binary`codificatori `MTOM` di messaggi, e inclusi in WCF oppure creare un codificatore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="21e04-122">This topic describes how to extend the `Text`, `Binary`, and `MTOM` message encoders that are included in WCF, or create your own custom encoder.</span></span> <span data-ttu-id="21e04-123">Il codificatore dei messaggi di testo supporta sia la codifica XML semplice che le codifiche SOAP.</span><span class="sxs-lookup"><span data-stu-id="21e04-123">The text message encoder supports both a plain XML encoding as well as SOAP encodings.</span></span> <span data-ttu-id="21e04-124">La modalità di codifica XML semplice del codificatore dei messaggi di testo è denominata POX (Plain Old XML) per distinguerla dalla codifica SOAP basata su testo.</span><span class="sxs-lookup"><span data-stu-id="21e04-124">The plain XML encoding mode of the text message encoder is called the POX ("Plain Old XML") encoder to distinguish it from the text-based SOAP encoding.</span></span>  
  
 <span data-ttu-id="21e04-125">Per ulteriori informazioni sulle combinazioni di elementi di associazione forniti dalle associazioni fornite dal sistema, vedere la sezione corrispondente in scelta di [un trasporto](../feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="21e04-125">For more information about the combinations of binding elements provided by the system-provided bindings, see the corresponding section in [Choosing a Transport](../feature-details/choosing-a-transport.md).</span></span>  
  
## <a name="how-to-work-with-system-provided-encoders"></a><span data-ttu-id="21e04-126">Come usare i codificatori forniti dal sistema</span><span class="sxs-lookup"><span data-stu-id="21e04-126">How to Work with System-Provided Encoders</span></span>  
 <span data-ttu-id="21e04-127">Una codifica viene aggiunta a un'associazione usando una classe derivata da <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="21e04-127">An encoding is added to a binding using a class derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
 <span data-ttu-id="21e04-128">In WCF sono disponibili i seguenti tipi di elementi di associazione <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> derivati dalla classe che è in grado di fornire per la codifica di testo, binaria e MTOM (Message Transmission Optimization Mechanism):</span><span class="sxs-lookup"><span data-stu-id="21e04-128">WCF provides the following types of binding elements derived from the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> class that can provide for text, binary and Message Transmission Optimization Mechanism (MTOM) encoding:</span></span>  
  
- <span data-ttu-id="21e04-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: Il codificatore più interoperativo, ma il meno efficiente, per i messaggi XML.</span><span class="sxs-lookup"><span data-stu-id="21e04-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: The most interoperable, but the least efficient encoder for XML messages.</span></span> <span data-ttu-id="21e04-130">In genere un servizio Web o un client di servizio Web è in grado di comprendere codice XML in formato testo.</span><span class="sxs-lookup"><span data-stu-id="21e04-130">A Web service or Web service client can generally understand textual XML.</span></span> <span data-ttu-id="21e04-131">La trasmissione di grandi blocchi di dati binari in formato testo non è tuttavia efficiente.</span><span class="sxs-lookup"><span data-stu-id="21e04-131">However, transmitting large blocks of binary data as text is not efficient.</span></span>  
  
- <span data-ttu-id="21e04-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>: Rappresenta l'elemento di associazione che specifica la codifica dei caratteri e la versione dei messaggi utilizzati per i messaggi XML basati su binari.</span><span class="sxs-lookup"><span data-stu-id="21e04-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>: Represents the binding element that specifies the character encoding and message versioning used for binary-based XML messages.</span></span> <span data-ttu-id="21e04-133">Si tratta di una scelta più efficiente tra le opzioni di codifica, ma la meno interoperativa, perché è supportata solo dagli endpoint WCF.</span><span class="sxs-lookup"><span data-stu-id="21e04-133">This is most efficient of the encoding options, but the least interoperable, because it is only supported by WCF endpoints.</span></span>  
  
- <span data-ttu-id="21e04-134"><xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement>: Rappresenta l'elemento di associazione che specifica la codifica dei caratteri e la versione dei messaggi utilizzati per un messaggio utilizzando una codifica Message Transmission Optimization Mechanism (MTOM).</span><span class="sxs-lookup"><span data-stu-id="21e04-134"><xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement>: Represents the binding element that specifies the character encoding and message versioning used for a message using a Message Transmission Optimization Mechanism (MTOM) encoding.</span></span> <span data-ttu-id="21e04-135">MTOM è una tecnologia efficiente per la trasmissione di dati binari nei messaggi di WCF.</span><span class="sxs-lookup"><span data-stu-id="21e04-135">MTOM is an efficient technology for transmitting binary data in WCF messages.</span></span> <span data-ttu-id="21e04-136">Il codificatore MTOM cerca un equilibrio tra efficienza e interoperabilità.</span><span class="sxs-lookup"><span data-stu-id="21e04-136">The MTOM encoder attempts to balance between efficiency and interoperability.</span></span> <span data-ttu-id="21e04-137">La codifica MTOM trasmette la maggior parte del codice XML in formato testo, ma ottimizza grandi blocchi di dati binari trasmettendoli senza introdurre modifiche e senza convertirli in formato testo.</span><span class="sxs-lookup"><span data-stu-id="21e04-137">The MTOM encoding transmits most XML in textual form, but optimizes large blocks of binary data by transmitting them as-is, without conversion to text.</span></span>  
  
 <span data-ttu-id="21e04-138">L'elemento di associazione crea una classe <xref:System.ServiceModel.Channels.MessageEncoderFactory>di tipo Text, Binary o MTOM.</span><span class="sxs-lookup"><span data-stu-id="21e04-138">The binding element creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory>.</span></span> <span data-ttu-id="21e04-139">La factory crea un'istanza <xref:System.ServiceModel.Channels.MessageEncoderFactory> di tipo Text, Binary o MTOM.</span><span class="sxs-lookup"><span data-stu-id="21e04-139">The factory creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory> instance.</span></span> <span data-ttu-id="21e04-140">In genere è presente una sola istanza.</span><span class="sxs-lookup"><span data-stu-id="21e04-140">Typically, there is only a single instance.</span></span> <span data-ttu-id="21e04-141">Se tuttavia vengono usate le sessioni, a ogni sessione può essere fornito un codificatore diverso.</span><span class="sxs-lookup"><span data-stu-id="21e04-141">However if sessions are used, a different encoder may be provided to each session.</span></span> <span data-ttu-id="21e04-142">In questo modo il codificatore dei messaggi in formato binario è in grado di coordinare dizionari dinamici (vedere Infrastruttura XML).</span><span class="sxs-lookup"><span data-stu-id="21e04-142">The Binary encoder makes use of this to coordinate dynamic dictionaries (see XML Infrastructure).</span></span>  
  
 <span data-ttu-id="21e04-143">I metodi <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> e <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> rappresentano il nucleo centrale dei codificatori.</span><span class="sxs-lookup"><span data-stu-id="21e04-143">The <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> and <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> methods are the core of the encoders.</span></span> <span data-ttu-id="21e04-144">I metodi consentono la lettura di un messaggio da un flusso o da una matrice <xref:System.Byte>.</span><span class="sxs-lookup"><span data-stu-id="21e04-144">The methods provide for reading a message from a stream or from a <xref:System.Byte> array.</span></span> <span data-ttu-id="21e04-145">Le matrici di byte vengono usate quando il trasporto viene eseguito in modalità di memorizzazione nel buffer.</span><span class="sxs-lookup"><span data-stu-id="21e04-145">Byte arrays are used when the transport is operating in buffered mode.</span></span> <span data-ttu-id="21e04-146">I messaggi vengono sempre scritti in flussi.</span><span class="sxs-lookup"><span data-stu-id="21e04-146">Messages are always written to streams.</span></span> <span data-ttu-id="21e04-147">Se deve memorizzare il messaggio nel buffer, il trasporto fornisce un flusso che esegue la memorizzazione nel buffer.</span><span class="sxs-lookup"><span data-stu-id="21e04-147">If the transport must buffer the message, it provides a stream that does the buffering.</span></span>  
  
 <span data-ttu-id="21e04-148">Gli altri membri usano contenuto, tipi di supporto e proprietà <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A> di supporto.</span><span class="sxs-lookup"><span data-stu-id="21e04-148">The rest of the members work with support content, media types, and <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span></span> <span data-ttu-id="21e04-149">Il trasporto chiama questi metodi di codifica per verificare se il messaggio in ingresso può essere decodificato dal codificatore o per determinare se il messaggio in uscita è valido per questo codificatore.</span><span class="sxs-lookup"><span data-stu-id="21e04-149">The transport calls these encoder methods to test whether the incoming message can be decoded by it, or to determine if the outgoing message is valid for this encoder.</span></span>  
  
 <span data-ttu-id="21e04-150">Ognuna delle tre implementazioni del codificatore aggiunge proprietà attinenti alle codifiche specifiche ed è completamente configurabile.</span><span class="sxs-lookup"><span data-stu-id="21e04-150">Each of the three encoder implementations adds properties that are relevant to the specific encodings and is fully configurable.</span></span> <span data-ttu-id="21e04-151">I codificatori espongono inoltre quote di lettore che hanno impostazioni predefinite protette.</span><span class="sxs-lookup"><span data-stu-id="21e04-151">The encoders also expose reader quotas that have secure defaults.</span></span> <span data-ttu-id="21e04-152">Per una descrizione delle quote, vedere Infrastruttura XML.</span><span class="sxs-lookup"><span data-stu-id="21e04-152">See XML Infrastructure for a discussion of the quotas.</span></span>  
  
## <a name="features-of-system-provided-encoders"></a><span data-ttu-id="21e04-153">Funzionalità dei codificatori forniti dal sistema</span><span class="sxs-lookup"><span data-stu-id="21e04-153">Features of System-Provided Encoders</span></span>  
 <span data-ttu-id="21e04-154">I codificatori di sistema forniscono una serie di funzionalità.</span><span class="sxs-lookup"><span data-stu-id="21e04-154">There are a number of features provided by the system-provided encoders.</span></span>  
  
### <a name="pooling"></a><span data-ttu-id="21e04-155">Pooling</span><span class="sxs-lookup"><span data-stu-id="21e04-155">Pooling</span></span>  
 <span data-ttu-id="21e04-156">Ognuna delle implementazioni del codificatore tenta di eseguire il massimo numero possibile di operazioni pooling.</span><span class="sxs-lookup"><span data-stu-id="21e04-156">Each of the encoder implementations tries to pool as much as possible.</span></span> <span data-ttu-id="21e04-157">La riduzione delle allocazioni è la misura più comunemente adottata per migliorare le prestazioni del codice gestito.</span><span class="sxs-lookup"><span data-stu-id="21e04-157">Reducing allocations is a key way to improve the performance of managed code.</span></span> <span data-ttu-id="21e04-158">Per eseguire queste operazioni di pooling le implementazioni usano la classe `SynchronizedPool`.</span><span class="sxs-lookup"><span data-stu-id="21e04-158">To accomplish this pooling, the implementations use the `SynchronizedPool` class.</span></span> <span data-ttu-id="21e04-159">Il file C# contiene una descrizione delle ottimizzazioni aggiuntive usate da questa classe.</span><span class="sxs-lookup"><span data-stu-id="21e04-159">The C# file contains a description of the additional optimizations used by this class.</span></span>  
  
 <span data-ttu-id="21e04-160">Le istanze <xref:System.Xml.XmlDictionaryReader> e <xref:System.Xml.XmlDictionaryWriter> vengono inserite nel pool e reinizializzate per impedire l'allocazione di nuove istanze per ogni messaggio.</span><span class="sxs-lookup"><span data-stu-id="21e04-160"><xref:System.Xml.XmlDictionaryReader> and <xref:System.Xml.XmlDictionaryWriter> instances are pooled and reinitialized to prevent allocating new ones for each message.</span></span> <span data-ttu-id="21e04-161">Per i lettori, un callback `OnClose` richiede il lettore quando viene chiamato `Close()`.</span><span class="sxs-lookup"><span data-stu-id="21e04-161">For the readers, an `OnClose` callback reclaims the reader when `Close()` is called.</span></span> <span data-ttu-id="21e04-162">Il codificatore ricicla inoltre alcuni oggetti di stato dei messaggi usati durante la costruzione dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="21e04-162">The encoder also recycles some message state objects used when constructing messages.</span></span> <span data-ttu-id="21e04-163">Le dimensioni di questi pool sono configurabili mediante le proprietà `MaxReadPoolSize` e `MaxWritePoolSize` in ognuna delle tre classi derivata da <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="21e04-163">The sizes of these pools are configurable by the `MaxReadPoolSize` and `MaxWritePoolSize` properties on each of the three classes derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
### <a name="binary-encoding"></a><span data-ttu-id="21e04-164">Codifica binaria</span><span class="sxs-lookup"><span data-stu-id="21e04-164">Binary Encoding</span></span>  
 <span data-ttu-id="21e04-165">Quando la codifica binaria usa sessioni, la stringa del dizionario dinamica deve essere comunicata al destinatario del messaggio.</span><span class="sxs-lookup"><span data-stu-id="21e04-165">When binary encoding uses sessions, the dynamic dictionary string must be communicated to the receiver of the message.</span></span> <span data-ttu-id="21e04-166">Questa operazione viene eseguita anteponendo al messaggio le stringhe del dizionario dinamiche.</span><span class="sxs-lookup"><span data-stu-id="21e04-166">This is done by prefixing the message with the dynamic dictionary strings.</span></span> <span data-ttu-id="21e04-167">Il destinatario rimuove le stringhe, le aggiunge alla sessione ed elabora il messaggio.</span><span class="sxs-lookup"><span data-stu-id="21e04-167">The receiver strips off the strings, adds them to the session, and processes the message.</span></span> <span data-ttu-id="21e04-168">Perché le stringhe del dizionario vengano passate correttamente è necessario che il trasporto venga memorizzato nel buffer.</span><span class="sxs-lookup"><span data-stu-id="21e04-168">Correctly passing dictionary strings requires that the transport be buffered.</span></span>  
  
 <span data-ttu-id="21e04-169">Le stringhe vengono aggiunte al messaggio da un metodo `AddSessionInformationToMessage` interno.</span><span class="sxs-lookup"><span data-stu-id="21e04-169">The strings are appended to the message by an internal `AddSessionInformationToMessage` method.</span></span> <span data-ttu-id="21e04-170">Questo metodo aggiunge le stringhe in formato UTF-8 davanti al messaggio precedute dalla relativa lunghezza.</span><span class="sxs-lookup"><span data-stu-id="21e04-170">It adds the strings as UTF-8 to the front of the message prefixed with their length.</span></span> <span data-ttu-id="21e04-171">All'intera intestazione del dizionario viene quindi anteposta la lunghezza dei relativi dati.</span><span class="sxs-lookup"><span data-stu-id="21e04-171">The entire dictionary header is then prefixed with the length of its data.</span></span> <span data-ttu-id="21e04-172">L'operazione inversa viene eseguita da un metodo `ExtractSessionInformationFromMessage` interno.</span><span class="sxs-lookup"><span data-stu-id="21e04-172">The reverse operation is performed by an internal `ExtractSessionInformationFromMessage` method.</span></span>  
  
 <span data-ttu-id="21e04-173">Oltre a elaborare chiavi di dizionario dinamiche, i messaggi con sessione memorizzati nel buffer vengono ricevuti in modo univoco.</span><span class="sxs-lookup"><span data-stu-id="21e04-173">In addition to processing dynamic dictionary keys, buffered sessionful messages are received in a unique way.</span></span> <span data-ttu-id="21e04-174">Anziché creare un lettore sul documento ed elaborarlo, il codificatore binario usa la classe `MessagePatterns` interna per scomporre il flusso binario.</span><span class="sxs-lookup"><span data-stu-id="21e04-174">Instead of creating a reader over the document and processing it, the binary encoder uses the internal `MessagePatterns` class to deconstruct the binary stream.</span></span> <span data-ttu-id="21e04-175">L'idea è che la maggior parte dei messaggi disponga di un determinato set di intestazioni che vengono visualizzate in un determinato ordine quando vengono generate da WCF.</span><span class="sxs-lookup"><span data-stu-id="21e04-175">The idea is that most messages have a certain set of headers that show up in a certain order when generated by WCF.</span></span> <span data-ttu-id="21e04-176">Il sistema del modello divide in due il messaggio in base a quanto previsto.</span><span class="sxs-lookup"><span data-stu-id="21e04-176">The pattern system breaks the message apart based on what it expects.</span></span> <span data-ttu-id="21e04-177">In caso di esito positivo, inizializza un oggetto <xref:System.ServiceModel.Channels.MessageHeaders> senza analizzare il codice XML.</span><span class="sxs-lookup"><span data-stu-id="21e04-177">If it is successful, it initializes a <xref:System.ServiceModel.Channels.MessageHeaders> object without parsing the XML.</span></span> <span data-ttu-id="21e04-178">In caso contrario ricorre al metodo standard.</span><span class="sxs-lookup"><span data-stu-id="21e04-178">If not, it falls back to the standard method.</span></span>  
  
### <a name="mtom-encoding"></a><span data-ttu-id="21e04-179">Codifica MTOM</span><span class="sxs-lookup"><span data-stu-id="21e04-179">MTOM Encoding</span></span>  
 <span data-ttu-id="21e04-180">La classe <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> dispone di una proprietà di configurazione aggiuntiva denominata <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement.MaxBufferSize%2A>.</span><span class="sxs-lookup"><span data-stu-id="21e04-180">The <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> class has an additional configuration property called <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement.MaxBufferSize%2A>.</span></span> <span data-ttu-id="21e04-181">Questa proprietà impone un limite massimo alla quantità di dati che è consentito memorizzare nel buffer durante il processo di lettura di un messaggio.</span><span class="sxs-lookup"><span data-stu-id="21e04-181">This places an upper bound on how much data it is allowed to buffer during the process of reading a message.</span></span> <span data-ttu-id="21e04-182">In alcuni casi gli Infoset XML (insiemi di informazioni XML) o altre parti MIME devono essere memorizzati nel buffer per riunire tutte le parti MIME in un unico messaggio.</span><span class="sxs-lookup"><span data-stu-id="21e04-182">The XML Information Set (Infoset), or other MIME parts, may need to be buffered to reassemble all the MIME parts into a single message.</span></span>  
  
 <span data-ttu-id="21e04-183">Per usare correttamente il protocollo HTTP, la classe del codificatore di messaggi MTOM interna fornisce alcune API interne per il metodo `GetContentType` (interno) e `WriteMessage`, un metodo pubblico che può essere sottoposto a override.</span><span class="sxs-lookup"><span data-stu-id="21e04-183">To work correctly with HTTP, the internal MTOM message encoder class provides some internal APIs for `GetContentType` (which is also internal) and `WriteMessage`, which is public and can be overridden.</span></span> <span data-ttu-id="21e04-184">Per garantire che i valori dell'intestazione HTTP concordino con i valori delle intestazioni MIME deve verificarsi un numero maggiore di comunicazioni.</span><span class="sxs-lookup"><span data-stu-id="21e04-184">More communication must occur to ensure values in the HTTP headers agree with values in the MIME headers.</span></span>  
  
 <span data-ttu-id="21e04-185">Internamente, il codificatore di messaggi MTOM utilizza i reader di testo di WCF ed è simile al codificatore di testo.</span><span class="sxs-lookup"><span data-stu-id="21e04-185">Internally, the MTOM message encoder uses WCF's text readers, and is similar to the Text encoder.</span></span> <span data-ttu-id="21e04-186">La differenza principale risiede nel fatto che il codificatore MTOM ottimizza grandi blocchi di oggetti binari o BLOB (Binary Large Object) non convertendoli nella codifica Base 64 prima che vengano integrati nei byte del messaggio.</span><span class="sxs-lookup"><span data-stu-id="21e04-186">The main difference is that it optimizes large chunks of binary, or "Binary Large Objects" (BLOBs), by not converting them to Base-64 encoding prior to being embedded into the message bytes.</span></span> <span data-ttu-id="21e04-187">Questi oggetti BLOB rimangono invece estratti e vengono denominati allegati MIME.</span><span class="sxs-lookup"><span data-stu-id="21e04-187">Instead, these BLOBs are kept extracted, and referenced as the MIME attachments.</span></span>  
  
## <a name="writing-your-own-encoder"></a><span data-ttu-id="21e04-188">Creazione di un codificatore personalizzato</span><span class="sxs-lookup"><span data-stu-id="21e04-188">Writing your own Encoder</span></span>  
 <span data-ttu-id="21e04-189">Per implementare un codificatore di messaggi personalizzato, è necessario fornire implementazioni personalizzate delle classi base astratte seguenti:</span><span class="sxs-lookup"><span data-stu-id="21e04-189">To implement your own custom message encoder, you must provide custom implementations of the following abstract base classes:</span></span>  
  
- <xref:System.ServiceModel.Channels.MessageEncoder>  
  
- <xref:System.ServiceModel.Channels.MessageEncoderFactory>  
  
- <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>  
  
 <span data-ttu-id="21e04-190">La conversione dalla rappresentazione in memoria di un messaggio a una rappresentazione che può essere scritta in un flusso viene incapsulata all'interno della classe <xref:System.ServiceModel.Channels.MessageEncoder> che funziona come una factory per i lettori e i writer XML che supportano tipi specifici di codifiche XML.</span><span class="sxs-lookup"><span data-stu-id="21e04-190">Converting from the in-memory representation of a message to a representation that can be written to a stream is encapsulated within the <xref:System.ServiceModel.Channels.MessageEncoder> class, which serves as a factory for XML readers and XML writers that support specific types of XML encodings.</span></span>  
  
- <span data-ttu-id="21e04-191">I metodi principali di questa classe di cui è necessario eseguire l'override sono:</span><span class="sxs-lookup"><span data-stu-id="21e04-191">The key methods of this class that you must override are:</span></span>  
  
- <span data-ttu-id="21e04-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> che accetta un oggetto <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> e lo scrive in un oggetto <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="21e04-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> which takes a <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> object and writes it into a <xref:System.IO.Stream> object.</span></span>  
  
- <span data-ttu-id="21e04-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> che accetta un oggetto <xref:System.IO.Stream> e una dimensione di intestazione massima e restituisce un oggetto <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="21e04-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> which takes a <xref:System.IO.Stream> object and a maximum header size and returns a <xref:System.ServiceModel.Channels.Message> object.</span></span>  
  
 <span data-ttu-id="21e04-194">È il codice scritto in questi metodi che gestisce la conversione tra il protocollo di trasporto standard e la codifica personalizzata.</span><span class="sxs-lookup"><span data-stu-id="21e04-194">It is the code you write in these methods that handles conversion between the standard transport protocol, and your customized encoding.</span></span>  
  
 <span data-ttu-id="21e04-195">Successivamente sarà necessario codificare una classe factory che crei il codificatore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="21e04-195">Next you need to code a factory class that creates your custom encoder.</span></span> <span data-ttu-id="21e04-196">Eseguire l'override di <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> per restituire un'istanza del codificatore <xref:System.ServiceModel.Channels.MessageEncoder> personalizzato.</span><span class="sxs-lookup"><span data-stu-id="21e04-196">Override the <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> to return an instance of your custom <xref:System.ServiceModel.Channels.MessageEncoder>.</span></span>  
  
 <span data-ttu-id="21e04-197">Associare quindi il codificatore <xref:System.ServiceModel.Channels.MessageEncoderFactory> personalizzato allo stack dell'elemento di associazione usato per configurare il servizio o il client eseguendo l'override del metodo <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> per restituire un'istanza di questa factory.</span><span class="sxs-lookup"><span data-stu-id="21e04-197">Then connect your custom <xref:System.ServiceModel.Channels.MessageEncoderFactory> to the binding element stack used to configure the service or client by overriding the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> method to return an instance of this factory.</span></span>  
  
 <span data-ttu-id="21e04-198">Con WCF sono disponibili due esempi che illustrano questo processo con il codice di esempio: [Codificatore di messaggi personalizzato: Codificatore](../samples/custom-message-encoder-custom-text-encoder.md) di testo [personalizzato e codificatore di messaggi personalizzato: Codificatore](../samples/custom-message-encoder-compression-encoder.md)di compressione.</span><span class="sxs-lookup"><span data-stu-id="21e04-198">There are two samples provided with WCF that illustrate this process with sample code: [Custom Message Encoder: Custom Text Encoder](../samples/custom-message-encoder-custom-text-encoder.md) and [Custom Message Encoder: Compression Encoder](../samples/custom-message-encoder-compression-encoder.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="21e04-199">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="21e04-199">See also</span></span>

- <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>
- <xref:System.ServiceModel.Channels.MessageEncoderFactory>
- <xref:System.ServiceModel.Channels.MessageEncoder>
- [<span data-ttu-id="21e04-200">Panoramica dell'architettura di trasferimento dati</span><span class="sxs-lookup"><span data-stu-id="21e04-200">Data Transfer Architectural Overview</span></span>](../feature-details/data-transfer-architectural-overview.md)
- [<span data-ttu-id="21e04-201">Scelta di un codificatore di messaggi</span><span class="sxs-lookup"><span data-stu-id="21e04-201">Choosing a Message Encoder</span></span>](../feature-details/choosing-a-message-encoder.md)
- [<span data-ttu-id="21e04-202">Scelta di un trasporto</span><span class="sxs-lookup"><span data-stu-id="21e04-202">Choosing a Transport</span></span>](../feature-details/choosing-a-transport.md)
