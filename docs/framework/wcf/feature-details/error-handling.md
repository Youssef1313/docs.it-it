---
title: Gestione degli errori
ms.date: 03/30/2017
ms.assetid: c948841a-7db9-40ae-9b78-587d216cbcaf
ms.openlocfilehash: f6c0d676a37648678b2b726a46a6238ccc1b3331
ms.sourcegitcommit: eff6adb61852369ab690f3f047818c90580e7eb1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/07/2019
ms.locfileid: "72004882"
---
# <a name="error-handling-in-windows-communication-foundation-wcf"></a><span data-ttu-id="62826-102">Gestione degli errori in Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="62826-102">Error handling in Windows Communication Foundation (WCF)</span></span>

<span data-ttu-id="62826-103">Sono disponibili molti modi per progettare una soluzione di gestione degli errori o delle eccezioni impreviste rilevate in un servizio.</span><span class="sxs-lookup"><span data-stu-id="62826-103">When a service encounters an unexpected exception or error, there are multiple ways to design an exception-handling solution.</span></span> <span data-ttu-id="62826-104">Sebbene non esistano soluzioni di gestione degli errori singole "corrette" o "procedure consigliate", esistono più percorsi validi da considerare.</span><span class="sxs-lookup"><span data-stu-id="62826-104">While there is no single "correct" or "best practice" error-handling solution, there are multiple valid paths for one to consider.</span></span> <span data-ttu-id="62826-105">Si consiglia in genere di implementare una soluzione ibrida che combina più approcci dall'elenco seguente, a seconda della complessità dell'implementazione WCF, del tipo e della frequenza delle eccezioni, della natura gestita e non gestita del eccezioni ed eventuali requisiti di traccia, registrazione o criteri associati.</span><span class="sxs-lookup"><span data-stu-id="62826-105">It is normally recommended that one implement a hybrid solution that combines multiple approaches from the list below, depending on the complexity of the WCF implementation, the type and frequency of the exceptions, the handled vs. unhandled nature of the exceptions, and any associated tracing, logging, or policy requirements.</span></span>

<span data-ttu-id="62826-106">Queste soluzioni sono descritte in maggiore dettaglio nella parte restante di questa sezione.</span><span class="sxs-lookup"><span data-stu-id="62826-106">These solutions are explained more deeply in the rest of this section.</span></span>

## <a name="the-microsoft-enterprise-library"></a><span data-ttu-id="62826-107">Microsoft Enterprise Library</span><span class="sxs-lookup"><span data-stu-id="62826-107">The Microsoft Enterprise Library</span></span>

<span data-ttu-id="62826-108">Il blocco applicativo di gestione delle eccezioni della Microsoft Enterprise Library facilita l'implementazione di modelli di progettazione comuni e la creazione di una strategia coerente per elaborare le eccezioni che si verificano in tutti i livelli dell'architettura di un'applicazione aziendale.</span><span class="sxs-lookup"><span data-stu-id="62826-108">The Microsoft Enterprise Library Exception Handling Application Block helps implement common design patterns and create a consistent strategy for processing exceptions that occur in all architectural layers of an enterprise application.</span></span> <span data-ttu-id="62826-109">È progettato per supportare il codice tipico contenuto nelle istruzioni catch dei componenti di un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="62826-109">It is designed to support the typical code contained in catch statements in application components.</span></span> <span data-ttu-id="62826-110">Anziché ripetere questo codice (ad esempio il codice che registra le informazioni sulle eccezioni) in blocchi catch identici in tutta l'applicazione, il blocco applicativo di gestione delle eccezioni permette agli sviluppatori di incapsulare questa logica sotto forma di gestori riusabili delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="62826-110">Instead of repeating this code (such as code that logs exception information) in identical catch blocks throughout an application, the Exception Handling Application Block allows developers to encapsulate this logic as reusable exception handlers.</span></span>

<span data-ttu-id="62826-111">Nella libreria è incluso un gestore di eccezioni del contratto di errore pronto all'uso.</span><span class="sxs-lookup"><span data-stu-id="62826-111">This Library includes out-of-the-box a Fault Contract Exception Handler.</span></span> <span data-ttu-id="62826-112">Questo gestore di eccezioni è progettato per l'utilizzo in base ai limiti del servizio WCF e genera un nuovo contratto di errore dall'eccezione.</span><span class="sxs-lookup"><span data-stu-id="62826-112">This exception handler is designed for use at WCF service boundaries, and generates a new Fault Contract from the exception.</span></span>

<span data-ttu-id="62826-113">Scopo dei blocchi applicativi è incorporare procedure consigliate di uso comune e offrire un approccio comune per la gestione delle eccezioni nell'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="62826-113">Application blocks aim to incorporate commonly used best practices and provide a common approach for exception handling throughout your application.</span></span> <span data-ttu-id="62826-114">D'altra parte, anche i gestori degli errori e i contratti di errore sviluppati in modo personalizzato possono essere molto utili.</span><span class="sxs-lookup"><span data-stu-id="62826-114">On the other hand, custom error handlers and fault contracts developed on one’s own can also be very useful.</span></span> <span data-ttu-id="62826-115">I gestori di errori personalizzati, ad esempio, offrono un'ottima opportunità per promuovere automaticamente tutte le eccezioni a FaultExceptions e anche per aggiungere funzionalità di registrazione all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="62826-115">For instance, custom error handlers provide an excellent opportunity to automatically promote all exceptions to FaultExceptions and also to add logging capabilities to your application.</span></span>

<span data-ttu-id="62826-116">Per ulteriori informazioni, vedere [Microsoft Enterprise Library](https://docs.microsoft.com/previous-versions/msp-n-p/ff632023(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="62826-116">For more information, please see [Microsoft Enterprise Library](https://docs.microsoft.com/previous-versions/msp-n-p/ff632023(v=pandp.10)).</span></span>

## <a name="dealing-with-expected-exceptions"></a><span data-ttu-id="62826-117">Gestione delle eccezioni previste</span><span class="sxs-lookup"><span data-stu-id="62826-117">Dealing with expected exceptions</span></span>

<span data-ttu-id="62826-118">La linea di condotta appropriata consiste nell'intercettare le eccezioni previste in ogni operazione o punto di estendibilità pertinente, decidere se è possibile eseguire il ripristino da e restituire l'errore personalizzato appropriato in FaultException @ no__t-0T >.</span><span class="sxs-lookup"><span data-stu-id="62826-118">The proper course of action is to catch expected exceptions in every operation or relevant extensibility point, decide whether they can be recovered from, and return the proper custom fault in a FaultException\<T>.</span></span>
  
## <a name="dealing-with-unexpected-exceptions-using-an-ierrorhandler"></a><span data-ttu-id="62826-119">Gestione di eccezioni impreviste tramite un IErrorHandler</span><span class="sxs-lookup"><span data-stu-id="62826-119">Dealing with unexpected exceptions using an IErrorHandler</span></span>

<span data-ttu-id="62826-120">Per gestire le eccezioni impreviste, la procedura consigliata consiste nell'"hook" di un IErrorHandler.</span><span class="sxs-lookup"><span data-stu-id="62826-120">To deal with unexpected exceptions, the recommended course of action is to "hook" an IErrorHandler.</span></span> <span data-ttu-id="62826-121">I gestori di errori intercettano solo le eccezioni a livello di runtime WCF (il livello "modello di servizio"), non a livello di canale.</span><span class="sxs-lookup"><span data-stu-id="62826-121">Error handlers only catch exceptions at the WCF runtime level (the "service model" layer), not at the channel layer.</span></span> <span data-ttu-id="62826-122">L'unico modo per collegare un oggetto IErrorHandler a livello di canale consiste nel creare un canale personalizzato, soluzione non consigliabile nella maggior parte degli scenari.</span><span class="sxs-lookup"><span data-stu-id="62826-122">The only way to hook an IErrorHandler at the channel level is to create a custom channel, which is not recommended in most scenarios.</span></span>

<span data-ttu-id="62826-123">Un'eccezione imprevista non è in genere né un'eccezione irreversibile né un'eccezione di elaborazione; è invece un'eccezione imprevista dell'utente.</span><span class="sxs-lookup"><span data-stu-id="62826-123">An "unexpected exception" is generally neither an irrecoverable exception nor a processing exception; it is, instead, an unexpected user exception.</span></span> <span data-ttu-id="62826-124">Un'eccezione irreversibile, ad esempio un'eccezione di memoria insufficiente, che in genere viene gestita automaticamente dal [gestore di eccezioni del modello di servizio](xref:System.ServiceModel.Dispatcher.ExceptionHandler) , in genere non può essere gestita normalmente e l'unico motivo per gestire tale eccezione potrebbe essere registrazione aggiuntiva o per restituire un'eccezione standard al client.</span><span class="sxs-lookup"><span data-stu-id="62826-124">An irrecoverable exception (such as an out-of-memory exception) – one generally handled by the [Service Model Exception Handler](xref:System.ServiceModel.Dispatcher.ExceptionHandler) automatically – cannot generally be handled gracefully, and the only reason to handle such an exception at all may be do additional logging or to return a standard exception to the client.</span></span> <span data-ttu-id="62826-125">Un'eccezione di elaborazione si verifica nell'elaborazione del messaggio, ad esempio a livello di serializzazione, di codificatore o di formattatore, e non può essere gestita con IErrorHandler, poiché in genere avviene troppo presto o troppo tardi nell'elaborazione perché il gestore possa intervenire.</span><span class="sxs-lookup"><span data-stu-id="62826-125">A processing exception occurs in the processing of the message – for example, at the serialization, encoder, or formatter level – generally cannot be handled at an IErrorHandler, because it is generally either too early or too late for the error handler to intervene by the time these exceptions occur.</span></span> <span data-ttu-id="62826-126">Analogamente, le eccezioni di trasporto non possono essere gestite a livello di IErrorHandler.</span><span class="sxs-lookup"><span data-stu-id="62826-126">Similarly, transport exceptions cannot be handled at an IErrorHandler.</span></span>

<span data-ttu-id="62826-127">Con IErrorHandler è possibile controllare in modo esplicito il comportamento dell'applicazione quando viene generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="62826-127">With an IErrorHandler, you can explicitly control the behavior of your application when an exception is thrown.</span></span> <span data-ttu-id="62826-128">È possibile:</span><span class="sxs-lookup"><span data-stu-id="62826-128">You may:</span></span>  

1. <span data-ttu-id="62826-129">Decidere se inviare o meno un errore al client.</span><span class="sxs-lookup"><span data-stu-id="62826-129">Decide whether or not to send a fault to the client.</span></span>

2. <span data-ttu-id="62826-130">Sostituire un'eccezione con un errore.</span><span class="sxs-lookup"><span data-stu-id="62826-130">Replace an exception with a fault.</span></span>

3. <span data-ttu-id="62826-131">Sostituire un errore con un altro errore.</span><span class="sxs-lookup"><span data-stu-id="62826-131">Replace a fault with another fault.</span></span>

4. <span data-ttu-id="62826-132">Eseguire la registrazione o la traccia.</span><span class="sxs-lookup"><span data-stu-id="62826-132">Perform logging or tracing.</span></span>

5. <span data-ttu-id="62826-133">Eseguire altre attività personalizzate.</span><span class="sxs-lookup"><span data-stu-id="62826-133">Perform other custom activities.</span></span>

<span data-ttu-id="62826-134">È possibile installare un gestore degli errori personalizzato aggiungendolo alla proprietà ErrorHandlers dei dispatcher del canale per il servizio.</span><span class="sxs-lookup"><span data-stu-id="62826-134">One can install a custom error handler by adding it to the ErrorHandlers property of the channel dispatchers for your service.</span></span>  <span data-ttu-id="62826-135">I gestori degli errori possono essere più di uno, nel qual caso vengono chiamati nell'ordine in cui vengono aggiunti alla raccolta.</span><span class="sxs-lookup"><span data-stu-id="62826-135">It is possible to have more than one error handler and they are called in the order they are added to this collection.</span></span>

<span data-ttu-id="62826-136">IErrorHandler.ProvideFault determina il messaggio di errore inviato al client.</span><span class="sxs-lookup"><span data-stu-id="62826-136">IErrorHandler.ProvideFault controls the fault message that is sent to the client.</span></span> <span data-ttu-id="62826-137">Questo metodo viene chiamato indipendentemente dal tipo di eccezione generata da un'operazione nel servizio.</span><span class="sxs-lookup"><span data-stu-id="62826-137">This method is called regardless of the type of the exception thrown by an operation in your service.</span></span> <span data-ttu-id="62826-138">Se non viene eseguita alcuna operazione, WCF presuppone il comportamento predefinito e continua come se non fossero presenti gestori degli errori personalizzati.</span><span class="sxs-lookup"><span data-stu-id="62826-138">If no operation is performed here, WCF assumes its default behavior and continues as if there were no custom error handlers in place.</span></span>

<span data-ttu-id="62826-139">Un caso in cui è possibile usare questo approccio è quando si desidera creare una posizione centrale per la conversione delle eccezioni in errori prima che vengano inviate al client (assicurandosi che l'istanza non venga eliminata e il canale non passi in stato di errore).</span><span class="sxs-lookup"><span data-stu-id="62826-139">One area that you could perhaps use this approach is when you want to create a central place for converting exceptions to faults before they are sent to the client (ensuring that the instance is not disposed and the channel is not moved to the Faulted state).</span></span>

<span data-ttu-id="62826-140">Il metodo IErrorHandler.HandleError in genere viene usato per implementare comportamenti correlati agli errori, quali la registrazione degli errori, le notifiche di sistema, l'arresto dell'applicazione e così via. IErrorHandler.HandleError può essere chiamato in più punti nel servizio e, a seconda di dove viene generato l'errore, il metodo HandleError può essere chiamato o meno dallo stesso thread dell'operazione; non è possibile assicurare che questo avvenga sempre.</span><span class="sxs-lookup"><span data-stu-id="62826-140">The IErrorHandler.HandleError method is usually used to implement error-related behaviors such as error logging, system notifications, shutting down the application, etc. IErrorHandler.HandleError can be called at multiple places inside the service, and depending on where the error is thrown, the HandleError method may or may not be called by the same thread as the operation; no guarantees are made in this regard.</span></span>

## <a name="dealing-with-exceptions-outside-wcf"></a><span data-ttu-id="62826-141">Gestione delle eccezioni all'esterno di WCF</span><span class="sxs-lookup"><span data-stu-id="62826-141">Dealing with exceptions outside WCF</span></span>

<span data-ttu-id="62826-142">Spesso possono verificarsi eccezioni di configurazione, eccezioni di stringhe di connessione al database e altre simili eccezioni nel contesto di un'applicazione WCF, ma non causate dal modello di servizio o dal servizio Web in sé.</span><span class="sxs-lookup"><span data-stu-id="62826-142">Often, configuration exceptions, database connection string exceptions, and other similar exceptions may occur within the context of a WCF application, but are themselves are not exceptions caused by the service model or the web service itself.</span></span> <span data-ttu-id="62826-143">Queste eccezioni sono eccezioni "normali" esterne al servizio Web e devono essere gestite in modo analogo alle altre eccezioni esterne nell'ambiente da gestire.</span><span class="sxs-lookup"><span data-stu-id="62826-143">These exceptions are "regular" exceptions external to the web service, and should be handled just as other external exceptions in the environment are to be handled.</span></span>

## <a name="tracing-exceptions"></a><span data-ttu-id="62826-144">Traccia delle eccezioni</span><span class="sxs-lookup"><span data-stu-id="62826-144">Tracing exceptions</span></span>

<span data-ttu-id="62826-145">La traccia è l'unica posizione "catch-all" in cui è possibile che vengano visualizzate tutte le eccezioni.</span><span class="sxs-lookup"><span data-stu-id="62826-145">Tracing is the only "catch-all" place where one can potentially see all exceptions.</span></span> <span data-ttu-id="62826-146">Per altre informazioni sulla traccia e la registrazione delle eccezioni, vedere Traccia e registrazione.</span><span class="sxs-lookup"><span data-stu-id="62826-146">For more information on tracing and logging exceptions, see Tracing and Logging.</span></span>

## <a name="uri-template-errors-when-using-webgetattribute-and-webinvokeattribute"></a><span data-ttu-id="62826-147">Errori del modello URI quando si usano WebGetAttribute e WebInvokeAttribute</span><span class="sxs-lookup"><span data-stu-id="62826-147">URI template errors when using WebGetAttribute and WebInvokeAttribute</span></span>

<span data-ttu-id="62826-148">Con gli attributi WebGet e WebInvoke è possibile specificare un modello URI in cui eseguire il mapping dei componenti dell'indirizzo di richiesta ai parametri dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="62826-148">The WebGet and WebInvoke attributes allow you to specify a URI template that maps components of the request address to operation parameters.</span></span> <span data-ttu-id="62826-149">Ad esempio, il modello URI "previsioni/{regione}/{città}" esegue il mapping dell'indirizzo di richiesta in token letterali, un parametro denominato regione e un parametro denominato città.</span><span class="sxs-lookup"><span data-stu-id="62826-149">For example, the URI template "weather/{state}/{city}" maps the request address into literal tokens, a parameter named state, and a parameter named city.</span></span> <span data-ttu-id="62826-150">Questi parametri possono quindi essere associati in base al nome ad alcuni dei parametri formali dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="62826-150">These parameters might then be bound by name to some of the formal parameters of the operation.</span></span>

<span data-ttu-id="62826-151">I parametri di modello vengono visualizzati sotto forma di stringhe nell'URI mentre i parametri formali di un contratto tipizzato possono essere non di tipo stringa.</span><span class="sxs-lookup"><span data-stu-id="62826-151">The template parameters appear in the form of strings within the URI while the formal parameters of a typed contract might be of non-string types.</span></span> <span data-ttu-id="62826-152">Pertanto, è necessario effettuare una conversione prima che l'operazione possa essere richiamata.</span><span class="sxs-lookup"><span data-stu-id="62826-152">Therefore, a conversion needs to take place before the operation can be invoked.</span></span> <span data-ttu-id="62826-153">È disponibile una [tabella dei formati di conversione](wcf-web-http-programming-model-overview.md) .</span><span class="sxs-lookup"><span data-stu-id="62826-153">A [table of conversion formats](wcf-web-http-programming-model-overview.md) is available.</span></span>

<span data-ttu-id="62826-154">Tuttavia, se la conversione ha esito negativo non è possibile segnalare all'operazione che si è verificato un errore.</span><span class="sxs-lookup"><span data-stu-id="62826-154">However, if the conversion fails, then there's no way to let the operation know that something has gone wrong.</span></span> <span data-ttu-id="62826-155">La conversione dei tipi si manifesta invece sotto forma di errore di invio.</span><span class="sxs-lookup"><span data-stu-id="62826-155">The type conversion instead surfaces in the form of a dispatch failure.</span></span>

<span data-ttu-id="62826-156">Un errore di invio di conversione dei tipi può essere analizzato in modo analogo a molti altri tipi di errori di invio installando un gestore degli errori.</span><span class="sxs-lookup"><span data-stu-id="62826-156">A type conversion dispatch failure can be inspected the same as with many other types of dispatch failures by installing an error handler.</span></span> <span data-ttu-id="62826-157">Il punto di estendibilità di IErrorHandler viene chiamato per gestire le eccezioni a livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="62826-157">The IErrorHandler extensibility point is called to handle service-level exceptions.</span></span> <span data-ttu-id="62826-158">Da quel punto è possibile scegliere la risposta da inviare al chiamante ed eseguire eventuali attività personalizzate e di creazione di rapporti.</span><span class="sxs-lookup"><span data-stu-id="62826-158">From there, the response to be sent back to the caller – as well as perform any custom tasks and reporting – may be chosen.</span></span>

## <a name="see-also"></a><span data-ttu-id="62826-159">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="62826-159">See also</span></span>

- [<span data-ttu-id="62826-160">Programmazione WCF di base</span><span class="sxs-lookup"><span data-stu-id="62826-160">Basic WCF Programming</span></span>](../basic-wcf-programming.md)
