---
title: 'Procedura: Configurare le credenziali in un servizio federativo'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, federation
- federation
ms.assetid: 149ab165-0ef3-490a-83a9-4322a07bd98a
ms.openlocfilehash: 792d2f1b113c0743bd91ccf2f7ff894d7f7d319f
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/22/2019
ms.locfileid: "69912191"
---
# <a name="how-to-configure-credentials-on-a-federation-service"></a><span data-ttu-id="dba8e-102">Procedura: Configurare le credenziali in un servizio federativo</span><span class="sxs-lookup"><span data-stu-id="dba8e-102">How to: Configure Credentials on a Federation Service</span></span>
<span data-ttu-id="dba8e-103">In Windows Communication Foundation (WCF) la creazione di un servizio federato è costituita dalle procedure principali seguenti:</span><span class="sxs-lookup"><span data-stu-id="dba8e-103">In Windows Communication Foundation (WCF), creating a federated service consists of the following main procedures:</span></span>  
  
1. <span data-ttu-id="dba8e-104">Configurazione di un oggetto <xref:System.ServiceModel.WSFederationHttpBinding> o di un'associazione personalizzata simile.</span><span class="sxs-lookup"><span data-stu-id="dba8e-104">Configuring a <xref:System.ServiceModel.WSFederationHttpBinding> or similar custom binding.</span></span> <span data-ttu-id="dba8e-105">Per ulteriori informazioni sulla creazione di un'associazione appropriata, [vedere Procedura: Creare un'associazione](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)WSFederationHttpBinding.</span><span class="sxs-lookup"><span data-stu-id="dba8e-105">For more information about creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md).</span></span>  
  
2. <span data-ttu-id="dba8e-106">Configurazione della classe <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>, che controlla come vengono autenticati i token emessi presentati al servizio.</span><span class="sxs-lookup"><span data-stu-id="dba8e-106">Configuring the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> that controls how issued tokens presented to the service are authenticated.</span></span>  
  
 <span data-ttu-id="dba8e-107">In questo argomento vengono fornite informazioni dettagliate sul secondo passaggio.</span><span class="sxs-lookup"><span data-stu-id="dba8e-107">This topic provides details about the second step.</span></span> <span data-ttu-id="dba8e-108">Per ulteriori informazioni sul funzionamento di un servizio federato, vedere [Federazione](../../../../docs/framework/wcf/feature-details/federation.md).</span><span class="sxs-lookup"><span data-stu-id="dba8e-108">For more information about how a federated service works, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md).</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-code"></a><span data-ttu-id="dba8e-109">Per impostare le proprietà di IssuedTokenServiceCredential nel codice</span><span class="sxs-lookup"><span data-stu-id="dba8e-109">To set the properties of IssuedTokenServiceCredential in code</span></span>  
  
1. <span data-ttu-id="dba8e-110">Utilizzare la proprietà <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> della classe <xref:System.ServiceModel.Description.ServiceCredentials> per restituire un riferimento a un'istanza di <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-110">Use the <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> property of the <xref:System.ServiceModel.Description.ServiceCredentials> class to return a reference to an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> instance.</span></span> <span data-ttu-id="dba8e-111">L'accesso alla proprietà viene eseguito dalla proprietà <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> della classe <xref:System.ServiceModel.ServiceHostBase>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-111">The property is accessed from the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class.</span></span>  
  
2. <span data-ttu-id="dba8e-112">Impostare la <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> proprietà su `true` se i token autocertificati, ad esempio le schede CardSpace, devono essere autenticati.</span><span class="sxs-lookup"><span data-stu-id="dba8e-112">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property to `true` if self-issued tokens such as CardSpace cards are to be authenticated.</span></span> <span data-ttu-id="dba8e-113">Il valore predefinito è `false`.</span><span class="sxs-lookup"><span data-stu-id="dba8e-113">The default is `false`.</span></span>  
  
3. <span data-ttu-id="dba8e-114">Popolare la raccolta restituita dalla proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> con istanze della classe <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-114">Populate the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property with instances of the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class.</span></span> <span data-ttu-id="dba8e-115">Ogni istanza rappresenta un emittente da cui il servizio autenticherà i token.</span><span class="sxs-lookup"><span data-stu-id="dba8e-115">Each instance represents an issuer from which the service will authenticate tokens.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="dba8e-116">A differenza della raccolta lato client restituita dalla proprietà <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A>, la raccolta dei certificati noti non è una raccolta con chiave.</span><span class="sxs-lookup"><span data-stu-id="dba8e-116">Unlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection.</span></span> <span data-ttu-id="dba8e-117">Il servizio accetta i token emessi dai certificati specificati indipendentemente dall'indirizzo del client che ha inviato il messaggio contenente il token emesso (salvo gli ulteriori limiti descritti più avanti in questo argomento).</span><span class="sxs-lookup"><span data-stu-id="dba8e-117">The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).</span></span>  
  
4. <span data-ttu-id="dba8e-118">Impostare la proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> su uno dei valori dell'enumerazione <xref:System.ServiceModel.Security.X509CertificateValidationMode>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-118">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property to one of the <xref:System.ServiceModel.Security.X509CertificateValidationMode> enumeration values.</span></span> <span data-ttu-id="dba8e-119">Questa operazione può essere eseguita solo nel codice.</span><span class="sxs-lookup"><span data-stu-id="dba8e-119">This can be done only in code.</span></span> <span data-ttu-id="dba8e-120">Il valore predefinito è <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-120">The default is <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span></span>  
  
5. <span data-ttu-id="dba8e-121">Se la proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> viene impostata su <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, assegnare un'istanza della classe <xref:System.IdentityModel.Selectors.X509CertificateValidator> personalizzata alla proprietà <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-121">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property is set to <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, then assign an instance of the custom <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> property.</span></span>  
  
6. <span data-ttu-id="dba8e-122">Se la proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> viene impostata su `ChainTrust` o su `PeerOrChainTrust`, impostare la proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> su un valore appropriato ottenuto dall'enumerazione <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-122">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> is set to `ChainTrust` or `PeerOrChainTrust`, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> property to an appropriate value from the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration.</span></span> <span data-ttu-id="dba8e-123">Si noti che la modalità di revoca non viene utilizzata nelle modalità di convalida `PeerTrust` e `Custom`.</span><span class="sxs-lookup"><span data-stu-id="dba8e-123">Note that the revocation mode is not used in `PeerTrust` or `Custom` validation modes.</span></span>  
  
7. <span data-ttu-id="dba8e-124">Se necessario, assegnare un'istanza di una classe <xref:System.IdentityModel.Tokens.SamlSerializer> personalizzata alla proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-124">If needed, assign an instance of a custom <xref:System.IdentityModel.Tokens.SamlSerializer> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> property.</span></span> <span data-ttu-id="dba8e-125">Per l'analisi delle asserzioni SAML personalizzate, ad esempio, è necessario un serializzatore SAML (Security Assertions Markup Language).</span><span class="sxs-lookup"><span data-stu-id="dba8e-125">A custom Security Assertions Markup Language (SAML) serializer is needed, for example, for parsing custom SAML assertions.</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-configuration"></a><span data-ttu-id="dba8e-126">Per impostare le proprietà di IssuedTokenServiceCredential nella configurazione</span><span class="sxs-lookup"><span data-stu-id="dba8e-126">To set the properties of IssuedTokenServiceCredential in configuration</span></span>  
  
1. <span data-ttu-id="dba8e-127">Creare un `<issuedTokenAuthentication>` elemento come figlio di un elemento <`serviceCredentials`>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-127">Create an `<issuedTokenAuthentication>` element as a child of a <`serviceCredentials`> element.</span></span>  
  
2. <span data-ttu-id="dba8e-128">Impostare l' `allowUntrustedRsaIssuers` attributo `<issuedTokenAuthentication>` dell'elemento su in `true` caso di autenticazione di un token autocertificato, ad esempio una scheda CardSpace.</span><span class="sxs-lookup"><span data-stu-id="dba8e-128">Set the `allowUntrustedRsaIssuers` attribute of the `<issuedTokenAuthentication>` element to `true` if authenticating a self-issued token, such as a CardSpace card.</span></span>  
  
3. <span data-ttu-id="dba8e-129">Creare un elemento `<knownCertificates>` come figlio dell'elemento `<issuedTokenAuthentication>`.</span><span class="sxs-lookup"><span data-stu-id="dba8e-129">Create a `<knownCertificates>` element as a child of the `<issuedTokenAuthentication>` element.</span></span>  
  
4. <span data-ttu-id="dba8e-130">Creare zero o più elementi `<add>`come figli dell'elemento`<knownCertificates>`e specificare come individuare il certificato utilizzando gli attributi `storeLocation`, `storeName`, `x509FindType`,, findValue`findValue`e .</span><span class="sxs-lookup"><span data-stu-id="dba8e-130">Create zero or more `<add>` elements as children of the `<knownCertificates>` element, and specify how to locate the certificate using the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes.</span></span>  
  
5. <span data-ttu-id="dba8e-131">Se necessario, impostare l' `samlSerializer` attributo dell'elemento <`issuedTokenAuthentication`> sul nome del tipo della classe personalizzata <xref:System.IdentityModel.Tokens.SamlSerializer> .</span><span class="sxs-lookup"><span data-stu-id="dba8e-131">If necessary, set the `samlSerializer` attribute of the <`issuedTokenAuthentication`> element to the type name of the custom <xref:System.IdentityModel.Tokens.SamlSerializer> class.</span></span>  
  
## <a name="example"></a><span data-ttu-id="dba8e-132">Esempio</span><span class="sxs-lookup"><span data-stu-id="dba8e-132">Example</span></span>  
 <span data-ttu-id="dba8e-133">Nell'esempio seguente vengono impostate le proprietà di <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> nel codice.</span><span class="sxs-lookup"><span data-stu-id="dba8e-133">The following example sets the properties of an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> in code.</span></span>  
  
 [!code-csharp[C_FederatedService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedservice/cs/source.cs#2)]
 [!code-vb[C_FederatedService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedservice/vb/source.vb#2)]  
  
 <span data-ttu-id="dba8e-134">Affinché un servizio federativo autentichi un client, per il token emesso devono essere osservate le condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="dba8e-134">In order for a federated service to authenticate a client, the following must be true about the issued token:</span></span>  
  
- <span data-ttu-id="dba8e-135">Quando la firma digitale del token emesso utilizza un identificatore della chiave di sicurezza RSA, la proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> deve essere `true`.</span><span class="sxs-lookup"><span data-stu-id="dba8e-135">When the issued token’s digital signature uses an RSA security key identifier, the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property must be `true`.</span></span>  
  
- <span data-ttu-id="dba8e-136">Quando la firma del token emesso utilizza un numero di serie dell'emittente X.509, un identificatore della chiave del soggetto X.509 o un identificatore di sicurezza dell'identificazione personale X.509, il token emesso deve essere firmato da un certificato nella raccolta restituita dalla proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> della classe <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-136">When the issued token’s signature uses an X.509 issuer serial number, X.509 subject key identifier, or X.509 thumbprint security identifier, the issued token must be signed by a certificate in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class.</span></span>  
  
- <span data-ttu-id="dba8e-137">Quando il token emesso viene firmato utilizzando un certificato X.509, il certificato deve eseguire la convalida secondo la semantica specificata dal valore della proprietà <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A>, indipendentemente dal fatto che il certificato sia stato inviato al componente come <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> oppure ottenuto dalla proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-137">When the issued token is signed using an X.509 certificate, the certificate must validate per the semantics specified by the value of the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> property, regardless of whether the certificate was sent to the relying party as a <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> or was obtained from the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property.</span></span> <span data-ttu-id="dba8e-138">Per ulteriori informazioni sulla convalida del certificato X. 509, vedere [utilizzo dei certificati](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="dba8e-138">For more information about X.509 certificate validation, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="dba8e-139">Ad esempio, impostando la proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> su <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust>, verrebbe autenticato un token emesso il cui certificato di firma si trova nell'archivio certificati `TrustedPeople`.</span><span class="sxs-lookup"><span data-stu-id="dba8e-139">For example, setting the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> to <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> would authenticate any issued token whose signing certificate is in the `TrustedPeople` certificate store.</span></span> <span data-ttu-id="dba8e-140">In tal caso, impostare la proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> su <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> o su <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-140">In that case, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> property to either <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> or <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine>.</span></span> <span data-ttu-id="dba8e-141">È possibile selezionare altre modalità, tra cui <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-141">You can select other modes, including <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span></span> <span data-ttu-id="dba8e-142">Quando si seleziona `Custom`, è necessario assegnare un'istanza della classe <xref:System.IdentityModel.Selectors.X509CertificateValidator> alla proprietà <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A>.</span><span class="sxs-lookup"><span data-stu-id="dba8e-142">When `Custom` is selected, you must assign an instance of the <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> property.</span></span> <span data-ttu-id="dba8e-143">Con il validator personalizzato è possibile convalidare i certificati mediante qualsiasi criterio.</span><span class="sxs-lookup"><span data-stu-id="dba8e-143">The custom validator can validate certificates using any criteria it likes.</span></span> <span data-ttu-id="dba8e-144">Per altre informazioni, vedere [Procedura: Creare un servizio che usa un validator](../../../../docs/framework/wcf/extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md)del certificato personalizzato.</span><span class="sxs-lookup"><span data-stu-id="dba8e-144">For more information, see [How to: Create a Service that Employs a Custom Certificate Validator](../../../../docs/framework/wcf/extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dba8e-145">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="dba8e-145">See also</span></span>

- [<span data-ttu-id="dba8e-146">Federazione</span><span class="sxs-lookup"><span data-stu-id="dba8e-146">Federation</span></span>](../../../../docs/framework/wcf/feature-details/federation.md)
- [<span data-ttu-id="dba8e-147">Federazione e attendibilità</span><span class="sxs-lookup"><span data-stu-id="dba8e-147">Federation and Trust</span></span>](../../../../docs/framework/wcf/feature-details/federation-and-trust.md)
- [<span data-ttu-id="dba8e-148">Esempio di federazione</span><span class="sxs-lookup"><span data-stu-id="dba8e-148">Federation Sample</span></span>](../../../../docs/framework/wcf/samples/federation-sample.md)
- [<span data-ttu-id="dba8e-149">Procedura: Disabilitare le sessioni protette in un'associazione WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="dba8e-149">How to: Disable Secure Sessions on a WSFederationHttpBinding</span></span>](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)
- [<span data-ttu-id="dba8e-150">Procedura: Creare un'associazione WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="dba8e-150">How to: Create a WSFederationHttpBinding</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)
- [<span data-ttu-id="dba8e-151">Procedura: Creazione di un client federato</span><span class="sxs-lookup"><span data-stu-id="dba8e-151">How to: Create a Federated Client</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)
- [<span data-ttu-id="dba8e-152">Uso di certificati</span><span class="sxs-lookup"><span data-stu-id="dba8e-152">Working with Certificates</span></span>](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)
- [<span data-ttu-id="dba8e-153">Modalità di autenticazione di SecurityBindingElement</span><span class="sxs-lookup"><span data-stu-id="dba8e-153">SecurityBindingElement Authentication Modes</span></span>](../../../../docs/framework/wcf/feature-details/securitybindingelement-authentication-modes.md)
