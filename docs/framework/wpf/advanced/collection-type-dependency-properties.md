---
title: Proprietà di dipendenza di tipo raccolta
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- properties [WPF], dependency
- properties [WPF], collection-type
- dependency properties [WPF]
- collection-type properties [WPF]
ms.assetid: 99f96a42-3ab7-4f64-a16b-2e10d654e97c
ms.openlocfilehash: dd268c0c132f4ecefe7b2336432442d9569ca38f
ms.sourcegitcommit: 24a4a8eb6d8cfe7b8549fb6d823076d7c697e0c6
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/23/2019
ms.locfileid: "68401563"
---
# <a name="collection-type-dependency-properties"></a><span data-ttu-id="25aca-102">Proprietà di dipendenza di tipo raccolta</span><span class="sxs-lookup"><span data-stu-id="25aca-102">Collection-Type Dependency Properties</span></span>
<span data-ttu-id="25aca-103">Questo argomento include linee guida e modelli consigliati per l'implementazione di una proprietà di dipendenza in cui la proprietà è di tipo raccolta.</span><span class="sxs-lookup"><span data-stu-id="25aca-103">This topic provides guidance and suggested patterns for how to implement a dependency property where the type of the property is a collection type.</span></span>  

<a name="implementing"></a>   
## <a name="implementing-a-collection-type-dependency-property"></a><span data-ttu-id="25aca-104">Implementazione di una proprietà di dipendenza di tipo raccolta</span><span class="sxs-lookup"><span data-stu-id="25aca-104">Implementing a Collection-Type Dependency Property</span></span>  
 <span data-ttu-id="25aca-105">Per una proprietà di dipendenza in generale, il modello di implementazione che segue è la definizione di un wrapper della proprietà CLR, in cui tale proprietà è supportata <xref:System.Windows.DependencyProperty> da un identificatore anziché da un campo o da un altro costrutto.</span><span class="sxs-lookup"><span data-stu-id="25aca-105">For a dependency property in general, the implementation pattern that you follow is that you define a CLR property wrapper, where that property is backed by a <xref:System.Windows.DependencyProperty> identifier rather than a field or other construct.</span></span> <span data-ttu-id="25aca-106">Questo stesso modello viene seguito quando si implementa una proprietà di tipo raccolta.</span><span class="sxs-lookup"><span data-stu-id="25aca-106">You follow this same pattern when you implement a collection-type property.</span></span> <span data-ttu-id="25aca-107">Tuttavia, una proprietà di tipo raccolta introduce una certa complessità al modello ogni volta che il tipo contenuto all'interno della raccolta è a <xref:System.Windows.DependencyObject> sua <xref:System.Windows.Freezable> volta una classe derivata o.</span><span class="sxs-lookup"><span data-stu-id="25aca-107">However, a collection-type property introduces some complexity to the pattern whenever the type that is contained within the collection is itself a <xref:System.Windows.DependencyObject> or <xref:System.Windows.Freezable> derived class.</span></span>  
  
<a name="initializing"></a>   
## <a name="initializing-the-collection-beyond-the-default-value"></a><span data-ttu-id="25aca-108">Inizializzazione della raccolta oltre il valore predefinito</span><span class="sxs-lookup"><span data-stu-id="25aca-108">Initializing the Collection Beyond the Default Value</span></span>  
 <span data-ttu-id="25aca-109">Quando si crea una proprietà di dipendenza, non si specifica il valore predefinito della proprietà come valore iniziale del campo.</span><span class="sxs-lookup"><span data-stu-id="25aca-109">When you create a dependency property, you do not specify the property default value as the initial field value.</span></span> <span data-ttu-id="25aca-110">Al contrario, viene specificato il valore predefinito tramite i metadati della proprietà di dipendenza.</span><span class="sxs-lookup"><span data-stu-id="25aca-110">Instead, you specify the default value through the dependency property metadata.</span></span> <span data-ttu-id="25aca-111">Se la proprietà è un tipo di riferimento, il valore predefinito specificato nei metadati della proprietà di dipendenza non è un valore predefinito per istanza, ma un valore predefinito che viene applicato a tutte le istanze del tipo.</span><span class="sxs-lookup"><span data-stu-id="25aca-111">If your property is a reference type, the default value specified in dependency property metadata is not a default value per instance; instead it is a default value that applies to all instances of the type.</span></span> <span data-ttu-id="25aca-112">Pertanto, è necessario prestare attenzione a non usare la singola raccolta statica definita dai metadati della proprietà della raccolta come valore di lavoro predefinito per le istanze del tipo appena create.</span><span class="sxs-lookup"><span data-stu-id="25aca-112">Therefore you must be careful to not use the singular static collection defined by the collection property metadata as the working default value for newly created instances of your type.</span></span> <span data-ttu-id="25aca-113">È invece necessario assicurarsi di impostare deliberatamente il valore della raccolta su un'unica raccolta (istanza), come parte della logica del costruttore di classi.</span><span class="sxs-lookup"><span data-stu-id="25aca-113">Instead, you must make sure that you deliberately set the collection value to a unique (instance) collection as part of your class constructor logic.</span></span> <span data-ttu-id="25aca-114">In caso contrario, verrà creata una classe Singleton non intenzionale.</span><span class="sxs-lookup"><span data-stu-id="25aca-114">Otherwise you will have created an unintentional singleton class.</span></span>  
  
 <span data-ttu-id="25aca-115">Si osservi l'esempio riportato di seguito.</span><span class="sxs-lookup"><span data-stu-id="25aca-115">Consider the following example.</span></span> <span data-ttu-id="25aca-116">La sezione seguente dell'esempio descrive la definizione di una classe `Aquarium`.</span><span class="sxs-lookup"><span data-stu-id="25aca-116">The following section of the example shows the definition for a class `Aquarium`.</span></span> <span data-ttu-id="25aca-117">La classe definisce la proprietà `AquariumObjects`di dipendenza del tipo di raccolta, che usa il tipo generico <xref:System.Collections.Generic.List%601> con un <xref:System.Windows.FrameworkElement> vincolo di tipo.</span><span class="sxs-lookup"><span data-stu-id="25aca-117">The class defines the collection type dependency property `AquariumObjects`, which uses the generic <xref:System.Collections.Generic.List%601> type with a <xref:System.Windows.FrameworkElement> type constraint.</span></span> <span data-ttu-id="25aca-118">Nella chiamata per la proprietà di dipendenza, i metadati stabiliscono il valore predefinito come nuovo generico <xref:System.Collections.Generic.List%601>. <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29></span><span class="sxs-lookup"><span data-stu-id="25aca-118">In the <xref:System.Windows.DependencyProperty.Register%28System.String%2CSystem.Type%2CSystem.Type%2CSystem.Windows.PropertyMetadata%29> call for the dependency property, the metadata establishes the default value to be a new generic <xref:System.Collections.Generic.List%601>.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport2/CSharp/page.xaml.cs#collectionproblemdefinition)]
 [!code-vb[PropertiesOvwSupport2#CollectionProblemDefinition](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport2/visualbasic/page.xaml.vb#collectionproblemdefinition)]  
  
 <span data-ttu-id="25aca-119">Tuttavia, se si lascia inalterato il codice, quel singolo valore predefinito dell'elenco viene condiviso per tutte le istanze di `Aquarium`.</span><span class="sxs-lookup"><span data-stu-id="25aca-119">However, if you just left the code as shown, that single list default value is shared for all instances of `Aquarium`.</span></span> <span data-ttu-id="25aca-120">Se si esegue il codice di test riportato di seguito, destinato a mostrare la modalità di creazione di due istanze di `Aquarium` separate e si aggiunge un singolo oggetto `Fish` diverso a ciascuna di esse, il risultato è sorprendente:</span><span class="sxs-lookup"><span data-stu-id="25aca-120">If you ran the following test code, which is intended to show how you would instantiate two separate `Aquarium` instances and add a single different `Fish` to each of them, you would see a surprising result:</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemtestcode)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemTestCode](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemtestcode)]  
  
 <span data-ttu-id="25aca-121">Invece di contenere un solo elemento, ogni raccolta ne contiene due.</span><span class="sxs-lookup"><span data-stu-id="25aca-121">Instead of each collection having a count of one, each collection has a count of two!</span></span> <span data-ttu-id="25aca-122">Questa situazione si verifica in quanto ciascun oggetto `Aquarium` ha aggiunto il proprio oggetto `Fish` alla raccolta dei valori predefiniti, generata da una singola chiamata al costruttore nei metadati e pertanto condivisa tra tutte le istanze.</span><span class="sxs-lookup"><span data-stu-id="25aca-122">This is because each `Aquarium` added its `Fish` to the default value collection, which resulted from a single constructor call in the metadata and is therefore shared between all instances.</span></span> <span data-ttu-id="25aca-123">Si tratta di una situazione quasi mai auspicabile.</span><span class="sxs-lookup"><span data-stu-id="25aca-123">This situation is almost never what you want.</span></span>  
  
 <span data-ttu-id="25aca-124">Per risolvere questo problema, è necessario reimpostare il valore della proprietà di dipendenza della raccolta su un'unica istanza, come parte della chiamata al costruttore di classe.</span><span class="sxs-lookup"><span data-stu-id="25aca-124">To correct this problem, you must reset the collection dependency property value to a unique instance, as part of the class constructor call.</span></span> <span data-ttu-id="25aca-125">Poiché la proprietà è una proprietà di dipendenza di sola lettura, si usa <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> il metodo per impostarla, usando <xref:System.Windows.DependencyPropertyKey> l'oggetto che è accessibile solo all'interno della classe.</span><span class="sxs-lookup"><span data-stu-id="25aca-125">Because the property is a read-only dependency property, you use the <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyPropertyKey%2CSystem.Object%29> method to set it, using the <xref:System.Windows.DependencyPropertyKey> that is only accessible within the class.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#collectionproblemctor)]
 [!code-vb[PropertiesOvwSupport#CollectionProblemCtor](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#collectionproblemctor)]  
  
 <span data-ttu-id="25aca-126">A questo punto, se si esegue nuovamente questo stesso codice di test, è possibile ottenere i risultati previsti, in cui ciascun oggetto `Aquarium` supporta la propria raccolta univoca.</span><span class="sxs-lookup"><span data-stu-id="25aca-126">Now, if you ran that same test code again, you could see more expected results, where each `Aquarium` supported its own unique collection.</span></span>  
  
 <span data-ttu-id="25aca-127">Se si sceglie una proprietà della raccolta con possibilità di accesso in lettura/scrittura, questo modello presenta una piccola variazione.</span><span class="sxs-lookup"><span data-stu-id="25aca-127">There would be a slight variation on this pattern if you chose to have your collection property be read-write.</span></span> <span data-ttu-id="25aca-128">In tal caso, è possibile chiamare la funzione di accesso set pubblica dal costruttore per eseguire l'inizializzazione, che chiamerebbe comunque la firma colonne <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> di all'interno del wrapper del set, <xref:System.Windows.DependencyProperty> usando un identificatore pubblico.</span><span class="sxs-lookup"><span data-stu-id="25aca-128">In that case, you could call the public set accessor from the constructor to do the initialization, which would still be calling the nonkey signature of <xref:System.Windows.DependencyObject.SetValue%28System.Windows.DependencyProperty%2CSystem.Object%29> within your set wrapper, using a public <xref:System.Windows.DependencyProperty> identifier.</span></span>  
  
## <a name="reporting-binding-value-changes-from-collection-properties"></a><span data-ttu-id="25aca-129">Segnalazione di modifiche dei valori di binding nelle proprietà della raccolta</span><span class="sxs-lookup"><span data-stu-id="25aca-129">Reporting Binding Value Changes from Collection Properties</span></span>  
 <span data-ttu-id="25aca-130">Una proprietà della raccolta che costituisce essa stessa una proprietà di dipendenza non segnala automaticamente le modifiche per le relative sottoproprietà.</span><span class="sxs-lookup"><span data-stu-id="25aca-130">A collection property that is itself a dependency property does not automatically report changes to its subproperties.</span></span> <span data-ttu-id="25aca-131">La creazione di binding all'interno di una raccolta può impedire al binding di segnalare le modifiche, invalidando in tal modo alcuni scenari di data binding.</span><span class="sxs-lookup"><span data-stu-id="25aca-131">If you are creating bindings into a collection, this can prevent the binding from reporting changes, thus invalidating some data binding scenarios.</span></span> <span data-ttu-id="25aca-132">Tuttavia, se si usa il tipo <xref:System.Windows.FreezableCollection%601> di raccolta come tipo di raccolta, le modifiche alle sottoproprietà degli elementi contenuti nella raccolta vengono segnalate correttamente e il binding funziona come previsto.</span><span class="sxs-lookup"><span data-stu-id="25aca-132">However, if you use the collection type <xref:System.Windows.FreezableCollection%601> as your collection type, then subproperty changes to contained elements in the collection are properly reported, and binding works as expected.</span></span>  
  
 <span data-ttu-id="25aca-133">Per abilitare l'associazione di sottoproprietà in una raccolta di oggetti di dipendenza, creare la <xref:System.Windows.FreezableCollection%601>proprietà della raccolta come tipo, con un vincolo <xref:System.Windows.DependencyObject> di tipo per tale raccolta in una classe derivata.</span><span class="sxs-lookup"><span data-stu-id="25aca-133">To enable subproperty binding in a dependency object collection, create the collection property as type <xref:System.Windows.FreezableCollection%601>, with a type constraint for that collection to any <xref:System.Windows.DependencyObject> derived class.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="25aca-134">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="25aca-134">See also</span></span>

- <xref:System.Windows.FreezableCollection%601>
- [<span data-ttu-id="25aca-135">Classi XAML e personalizzate per WPF</span><span class="sxs-lookup"><span data-stu-id="25aca-135">XAML and Custom Classes for WPF</span></span>](xaml-and-custom-classes-for-wpf.md)
- [<span data-ttu-id="25aca-136">Panoramica sul data binding</span><span class="sxs-lookup"><span data-stu-id="25aca-136">Data Binding Overview</span></span>](../data/data-binding-overview.md)
- [<span data-ttu-id="25aca-137">Panoramica sulle proprietà di dipendenza</span><span class="sxs-lookup"><span data-stu-id="25aca-137">Dependency Properties Overview</span></span>](dependency-properties-overview.md)
- [<span data-ttu-id="25aca-138">Proprietà di dipendenza personalizzate</span><span class="sxs-lookup"><span data-stu-id="25aca-138">Custom Dependency Properties</span></span>](custom-dependency-properties.md)
- [<span data-ttu-id="25aca-139">Metadati delle proprietà di dipendenza</span><span class="sxs-lookup"><span data-stu-id="25aca-139">Dependency Property Metadata</span></span>](dependency-property-metadata.md)
