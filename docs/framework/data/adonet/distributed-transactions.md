---
title: Transazioni distribuite
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: 143d39356f444bfc3c899164c43c9608a4aab335
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/07/2019
ms.locfileid: "70795196"
---
# <a name="distributed-transactions"></a><span data-ttu-id="efad8-102">Transazioni distribuite</span><span class="sxs-lookup"><span data-stu-id="efad8-102">Distributed Transactions</span></span>
<span data-ttu-id="efad8-103">Una transazione consiste in una set di attività correlate che costituiscono una singola unità, la quale può riuscire (ovvero viene eseguito il commit della transazione) o non riuscire (il processo viene interrotto).</span><span class="sxs-lookup"><span data-stu-id="efad8-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="efad8-104">Una *transazione distribuita* è una transazione che interessa più risorse.</span><span class="sxs-lookup"><span data-stu-id="efad8-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="efad8-105">Per eseguire il commit di una transazione distribuita è necessario che tutti i partecipanti garantiscano che le eventuali modifiche apportate ai dati siano permanenti.</span><span class="sxs-lookup"><span data-stu-id="efad8-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="efad8-106">Le modifiche devono essere definitive anche in caso di arresti anomali del sistema o altri eventi imprevisti.</span><span class="sxs-lookup"><span data-stu-id="efad8-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="efad8-107">Se anche un unico partecipante non è in grado di garantire tale requisito, l'intera transazione verrà annullata e verrà effettuato il rollback di tutte le modifiche apportate ai dati nell'ambito della transazione.</span><span class="sxs-lookup"><span data-stu-id="efad8-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="efad8-108">Se si tenta di eseguire il commit o il rollback di una transazione in cui è stato avviato un `DataReader` mentre la transazione è attiva, verrà generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="efad8-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="efad8-109">Uso di System.Transactions</span><span class="sxs-lookup"><span data-stu-id="efad8-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="efad8-110">In .NET Framework, le transazioni distribuite vengono gestite tramite l'API nello spazio dei nomi <xref:System.Transactions>.</span><span class="sxs-lookup"><span data-stu-id="efad8-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="efad8-111">L'API <xref:System.Transactions> delega quindi la gestione della transazione a un monitoraggio delle transazioni, quale Microsoft Distributed Transaction Coordinator (MS DTC), quando sono interessati più gestori di risorse persistenti.</span><span class="sxs-lookup"><span data-stu-id="efad8-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="efad8-112">Per ulteriori informazioni, vedere [nozioni fondamentali sulle transazioni](../transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="efad8-112">For more information, see [Transaction Fundamentals](../transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="efad8-113">In ADO.NET 2.0 è stato introdotto il supporto per l'inserimento in una transazione distribuita usando il metodo `EnlistTransaction`, che inserisce una connessione in un'istanza di <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="efad8-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="efad8-114">Nelle versioni precedenti di ADO.NET l'inserimento esplicito nelle transazioni distribuite veniva eseguito tramite il metodo `EnlistDistributedTransaction` di una connessione per inserire una connessione in un'istanza di <xref:System.EnterpriseServices.ITransaction>, che è supportata per la compatibilità con le versioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="efad8-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="efad8-115">Per ulteriori informazioni sulle transazioni di Enterprise Services, vedere [interoperabilità con Enterprise Services e transazioni com+](../transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="efad8-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="efad8-116">Quando si usa una transazione <xref:System.Transactions> con il provider .NET Framework per SQL Server con un database SQL Server, viene usato automaticamente un tipo semplice <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="efad8-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="efad8-117">La transazione può quindi essere promossa a una piena transazione distribuita in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="efad8-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="efad8-118">Per ulteriori informazioni, vedere [integrazione di System. Transactions con SQL Server](system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="efad8-118">For more information, see [System.Transactions Integration with SQL Server](system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="efad8-119">Il numero massimo di transazioni distribuite cui un database Oracle può partecipare contemporaneamente è impostato su 10 per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="efad8-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="efad8-120">Dopo la decima transazione con una connessione a un database Oracle, viene generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="efad8-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="efad8-121">Oracle non supporta `DDL` in una transazione distribuita.</span><span class="sxs-lookup"><span data-stu-id="efad8-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="efad8-122">Inserimento automatico in una transazione distribuita</span><span class="sxs-lookup"><span data-stu-id="efad8-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="efad8-123">L'inserimento automatico è il metodo predefinito e preferenziale per integrare connessioni ADO.NET in `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="efad8-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="efad8-124">Un oggetto connessione viene automaticamente inserito in una transazione distribuita esistente se viene rilevato che la transazione è attiva. In termini di `System.Transaction`, questo significa che `Transaction.Current` non è Null.</span><span class="sxs-lookup"><span data-stu-id="efad8-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="efad8-125">L'inserimento automatico in una transazione viene eseguito quando si apre la connessione.</span><span class="sxs-lookup"><span data-stu-id="efad8-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="efad8-126">Successivamente, l'inserimento non viene più eseguito, neanche nel caso in cui venga eseguito un comando nell'ambito di una transazione.</span><span class="sxs-lookup"><span data-stu-id="efad8-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="efad8-127">È possibile disabilitare l'inserimento automatico nelle transazioni esistenti specificando `Enlist=false` come parametro della stringa di connessione per una proprietà <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType> oppure `OLE DB Services=-7` come parametro della stringa di connessione per una proprietà <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="efad8-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="efad8-128">Per altre informazioni sui parametri della stringa di connessione Oracle e ODBC, vedere <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> e <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="efad8-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="efad8-129">Inserimento manuale in una transazione distribuita</span><span class="sxs-lookup"><span data-stu-id="efad8-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="efad8-130">Se l'inserimento automatico è disabilitato o se è necessario inserire una transazione che è stata avviata dopo l'apertura della connessione, è possibile effettuare l'inserimento in una transazione distribuita usando il metodo `EnlistTransaction` dell'oggetto <xref:System.Data.Common.DbConnection> per il provider in uso.</span><span class="sxs-lookup"><span data-stu-id="efad8-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="efad8-131">L'inserimento in una transazione distribuita esistente assicura che se viene eseguito il commit o il rollback della transazione, verrà eseguito il commit o, rispettivamente, il rollback anche delle modifiche apportate dal codice all'origine dati.</span><span class="sxs-lookup"><span data-stu-id="efad8-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="efad8-132">L'inserimento in transazioni distribuite è particolarmente indicato quando si effettua il pool di oggetti business.</span><span class="sxs-lookup"><span data-stu-id="efad8-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="efad8-133">Se si effettua il pool di un oggetto business con una connessione aperta, l'inserimento automatico nella transazione verrà eseguito solo quando quella connessione è aperta.</span><span class="sxs-lookup"><span data-stu-id="efad8-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="efad8-134">Se vengono condotte più transazioni usando l'oggetto business di cui si effettua il pool, la connessione aperta per tale oggetto non verrà automaticamente inserita nelle nuove transazioni.</span><span class="sxs-lookup"><span data-stu-id="efad8-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="efad8-135">In questo caso è possibile disabilitare l'inserimento automatico nelle transazioni per la connessione e inserire tale connessione nelle transazioni usando il metodo `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="efad8-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="efad8-136">`EnlistTransaction`accetta un solo argomento di tipo <xref:System.Transactions.Transaction> che è un riferimento alla transazione esistente.</span><span class="sxs-lookup"><span data-stu-id="efad8-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="efad8-137">Dopo la chiamata al metodo `EnlistTransaction` della connessione, nella transazione sono incluse tutte le modifiche apportate all'origine dati che usa la connessione.</span><span class="sxs-lookup"><span data-stu-id="efad8-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="efad8-138">Tramite il passaggio di un valore null, la connessione viene rimossa dalla transazione distribuita corrente.</span><span class="sxs-lookup"><span data-stu-id="efad8-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="efad8-139">Si noti che la connessione deve essere aperta prima di chiamare il metodo `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="efad8-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="efad8-140">Una volta che è stata inserita esplicitamente in una transazione, una connessione non può essere rimossa né inserita in una transazione diversa fino a quando non è stata completata la prima transazione.</span><span class="sxs-lookup"><span data-stu-id="efad8-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="efad8-141">Il metodo `EnlistTransaction` genera un'eccezione se la connessione ha già iniziato una transazione usando il metodo <xref:System.Data.Common.DbConnection.BeginTransaction%2A> della connessione.</span><span class="sxs-lookup"><span data-stu-id="efad8-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="efad8-142">Tuttavia, nel caso di una transazione locale avviata nell'origine dati (ad esempio eseguendo in modo esplicito l'istruzione BEGIN TRANSACTION tramite <xref:System.Data.SqlClient.SqlCommand>), la chiamata a `EnlistTransaction` comporterà il rollback della transazione locale e l'inserimento nella transazione distribuita esistente, come richiesto.</span><span class="sxs-lookup"><span data-stu-id="efad8-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="efad8-143">Non verrà notificato che è stato eseguito il rollback della transazione locale e l'utente dovrà gestire le transazioni locali non avviate tramite il metodo <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span><span class="sxs-lookup"><span data-stu-id="efad8-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="efad8-144">Se si usa il provider di dati .NET Framework per SQL Server (`SqlClient`) con SQL Server, un tentativo di inserimento genererà un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="efad8-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="efad8-145">Tutti gli altri casi non verranno rilevati.</span><span class="sxs-lookup"><span data-stu-id="efad8-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="efad8-146">Transazioni promovibili in SQL Server</span><span class="sxs-lookup"><span data-stu-id="efad8-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="efad8-147">SQL Server supporta transazioni promuovibili in cui una transazione semplice locale può essere automaticamente promossa a transazione distribuita soltanto nel caso in cui ciò sia richiesto.</span><span class="sxs-lookup"><span data-stu-id="efad8-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="efad8-148">Una transazione promuovibile non richiama l'overhead aggiunto di una transazione distribuita, a meno che non sia necessario.</span><span class="sxs-lookup"><span data-stu-id="efad8-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="efad8-149">Per ulteriori informazioni e un esempio di codice, vedere [integrazione di System. Transactions con SQL Server](system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="efad8-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="efad8-150">Configurazione di transazioni distribuite</span><span class="sxs-lookup"><span data-stu-id="efad8-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="efad8-151">Può essere necessario abilitare MS DTC sulla rete per usare le transazioni distribuite.</span><span class="sxs-lookup"><span data-stu-id="efad8-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="efad8-152">Se Windows Firewall è abilitato, è necessario consentire al servizio MS DTC di usare la rete o aprire la porta MS DTC.</span><span class="sxs-lookup"><span data-stu-id="efad8-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="efad8-153">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="efad8-153">See also</span></span>

- [<span data-ttu-id="efad8-154">Transazioni e concorrenza</span><span class="sxs-lookup"><span data-stu-id="efad8-154">Transactions and Concurrency</span></span>](transactions-and-concurrency.md)
- [<span data-ttu-id="efad8-155">Integrazione di System.Transactions con SQL Server</span><span class="sxs-lookup"><span data-stu-id="efad8-155">System.Transactions Integration with SQL Server</span></span>](system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="efad8-156">Panoramica di ADO.NET</span><span class="sxs-lookup"><span data-stu-id="efad8-156">ADO.NET Overview</span></span>](ado-net-overview.md)
