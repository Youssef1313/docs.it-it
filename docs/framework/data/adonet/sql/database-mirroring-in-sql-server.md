---
title: Mirroring del database in SQL Server
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: 81e8bd5ba9274c84ffe18f617978b61238ebeff2
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/07/2019
ms.locfileid: "70782436"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="7f17a-102">Mirroring del database in SQL Server</span><span class="sxs-lookup"><span data-stu-id="7f17a-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="7f17a-103">Il mirroring del database in SQL Server consente di mantenere una copia, o mirror, di un database di SQL Server in un server di standby.</span><span class="sxs-lookup"><span data-stu-id="7f17a-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="7f17a-104">Il mirroring assicura che siano sempre disponibili due copie separate dei dati per assicurare un'elevata disponibilità e una ridondanza completa dei dati.</span><span class="sxs-lookup"><span data-stu-id="7f17a-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="7f17a-105">Il provider di dati .NET per SQL Server fornisce il supporto implicito per il mirroring del database. Pertanto, una volta configurato il provider per un database SQL Server, lo sviluppatore non dovrà eseguire alcuna operazione né scrivere codice.</span><span class="sxs-lookup"><span data-stu-id="7f17a-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="7f17a-106">L'oggetto <xref:System.Data.SqlClient.SqlConnection> supporta inoltre una modalità di connessione esplicita che consente di specificare il nome di un server partner di failover in <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="7f17a-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="7f17a-107">La sequenza di eventi semplificata indicata di seguito si verifica per un oggetto <xref:System.Data.SqlClient.SqlConnection> destinato a un database configurato per il mirroring:</span><span class="sxs-lookup"><span data-stu-id="7f17a-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1. <span data-ttu-id="7f17a-108">L'applicazione client esegue correttamente la connessione al database principale e il server restituisce il nome del server partner, che viene successivamente inserito nella cache del client.</span><span class="sxs-lookup"><span data-stu-id="7f17a-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2. <span data-ttu-id="7f17a-109">Se si verifica un errore nel server contenente il database principale o se viene interrotta la connettività, lo stato della connessione e lo stato della transazione andranno perduti.</span><span class="sxs-lookup"><span data-stu-id="7f17a-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="7f17a-110">L'applicazione client tenta di ristabilire una connessione al database principale ma si verificherà un errore.</span><span class="sxs-lookup"><span data-stu-id="7f17a-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3. <span data-ttu-id="7f17a-111">A questo punto, l'applicazione client tenta di ristabilire una connessione al database mirror nel server partner in modo trasparente.</span><span class="sxs-lookup"><span data-stu-id="7f17a-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="7f17a-112">Se viene eseguita correttamente, la connessione viene reindirizzata al database mirror, che diventa il nuovo database principale.</span><span class="sxs-lookup"><span data-stu-id="7f17a-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="7f17a-113">Definizione del partner di failover nella stringa di connessione</span><span class="sxs-lookup"><span data-stu-id="7f17a-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="7f17a-114">Se si specifica il nome di un server partner di failover nella stringa di connessione, il client tenterà una connessione al partner di failover in modo trasparente se il database principale non è disponibile quando l'applicazione client si connette per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="7f17a-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```  
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="7f17a-115">Se non si specifica il nome del server partner di failover e il database principale non è disponibile quando l'applicazione client si connette per la prima volta, viene generato un oggetto <xref:System.Data.SqlClient.SqlException>.</span><span class="sxs-lookup"><span data-stu-id="7f17a-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="7f17a-116">Quando un oggetto <xref:System.Data.SqlClient.SqlConnection> viene aperto correttamente, il nome del partner di failover viene restituito dal server e sostituisce qualsiasi valore specificato nella stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="7f17a-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7f17a-117">Negli scenari di mirroring del database è necessario specificare in modo esplicito il nome del catalogo o del database iniziale nella stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="7f17a-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="7f17a-118">Se il client riceve informazioni di failover su una connessione che non include un catalogo o un database iniziale specificato in modo esplicito, tali informazioni non vengono memorizzate nella cache e l'applicazione non tenterà di eseguire il failover se si verifica un errore nel server principale.</span><span class="sxs-lookup"><span data-stu-id="7f17a-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="7f17a-119">Se una stringa di connessione include un valore per il partner di failover, ma nessun valore per il catalogo o il database iniziale, viene generato un oggetto `InvalidArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="7f17a-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="7f17a-120">Recupero del nome del server corrente</span><span class="sxs-lookup"><span data-stu-id="7f17a-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="7f17a-121">In caso di failover, è possibile recuperare il nome del server al quale la connessione corrente è effettivamente collegata usando la proprietà <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> di un oggetto <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="7f17a-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="7f17a-122">Il seguente frammento di codice recupera il nome del server attivo e presuppone che la variabile della connessione faccia riferimento a un tipo <xref:System.Data.SqlClient.SqlConnection> aperto.</span><span class="sxs-lookup"><span data-stu-id="7f17a-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="7f17a-123">Quando si verifica un evento di failover e la connessione viene spostata sul server mirror, la proprietà **DataSource** viene aggiornata per riflettere il nome del mirror.</span><span class="sxs-lookup"><span data-stu-id="7f17a-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="7f17a-124">Comportamento del mirroring SqlClient</span><span class="sxs-lookup"><span data-stu-id="7f17a-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="7f17a-125">Il client tenta sempre di connettersi al server principale corrente e,</span><span class="sxs-lookup"><span data-stu-id="7f17a-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="7f17a-126">in caso di errore, passa al partner di failover.</span><span class="sxs-lookup"><span data-stu-id="7f17a-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="7f17a-127">Se il database mirror è già stato promosso al ruolo principale nel server partner, la connessione viene eseguita correttamente e il nuovo mapping principale-mirror viene inviato al client e memorizzato nella cache per l'intera durata della chiamata <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="7f17a-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="7f17a-128">Non è archiviato nell'archivio permanente e non è disponibile per le connessioni successive in un **AppDomain** o processo diverso.</span><span class="sxs-lookup"><span data-stu-id="7f17a-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="7f17a-129">Tuttavia, è disponibile per le connessioni successive nello stesso **AppDomain**.</span><span class="sxs-lookup"><span data-stu-id="7f17a-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="7f17a-130">Si noti che un altro **AppDomain** o processo in esecuzione nello stesso computer o in un computer diverso ha sempre il proprio pool di connessioni e tali connessioni non vengono reimpostate.</span><span class="sxs-lookup"><span data-stu-id="7f17a-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="7f17a-131">In tal caso, se il database primario diventa inattivo, ogni processo o **AppDomain** ha esito negativo una sola volta e il pool viene cancellato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="7f17a-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7f17a-132">Il supporto del mirroring sul server è configurato sulla base dei singoli database.</span><span class="sxs-lookup"><span data-stu-id="7f17a-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="7f17a-133">Se vengono eseguite operazioni di modifica dei dati di altri database non inclusi nel set principale/mirror usando nomi in più parti o modificando il database corrente, le modifiche apportate a tali database non verranno propagate in caso di errore.</span><span class="sxs-lookup"><span data-stu-id="7f17a-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="7f17a-134">Quando vengono modificati i dati di un database di cui non è stato eseguito il mirroring, non verrà generato alcun errore.</span><span class="sxs-lookup"><span data-stu-id="7f17a-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="7f17a-135">Lo sviluppatore deve quindi valutare il possibile impatto di tali operazioni.</span><span class="sxs-lookup"><span data-stu-id="7f17a-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="7f17a-136">Risorse relative al mirroring del database</span><span class="sxs-lookup"><span data-stu-id="7f17a-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="7f17a-137">Per la documentazione concettuale e per informazioni sulla configurazione, la distribuzione e l'amministrazione del mirroring, vedere le risorse seguenti nella documentazione di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7f17a-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.</span></span>  
  
|<span data-ttu-id="7f17a-138">Risorsa</span><span class="sxs-lookup"><span data-stu-id="7f17a-138">Resource</span></span>|<span data-ttu-id="7f17a-139">DESCRIZIONE</span><span class="sxs-lookup"><span data-stu-id="7f17a-139">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="7f17a-140">Mirroring del database</span><span class="sxs-lookup"><span data-stu-id="7f17a-140">Database Mirroring</span></span>](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|<span data-ttu-id="7f17a-141">Viene descritto come impostare e configurare il mirroring in SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7f17a-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="7f17a-142">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="7f17a-142">See also</span></span>

- [<span data-ttu-id="7f17a-143">Panoramica di ADO.NET</span><span class="sxs-lookup"><span data-stu-id="7f17a-143">ADO.NET Overview</span></span>](../ado-net-overview.md)
