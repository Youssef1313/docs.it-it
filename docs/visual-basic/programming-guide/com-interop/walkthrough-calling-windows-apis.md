---
title: 'Procedura dettagliata: Chiamata delle API di Windows (Visual Basic)'
ms.date: 07/20/2015
helpviewer_keywords:
- DLLs, calling
- Windows API, walkthroughs
- platform invoke, walkthroughs
- API calls [Visual Basic], walkthroughs [Visual Basic]
- Windows API, calling
- walkthroughs [Visual Basic], API calls
- DllImport attribute, calling Windows API
- Declare statement [Visual Basic], declaring DLL functions
ms.assetid: 9280ca96-7a93-47a3-8d01-6d01be0657cb
ms.openlocfilehash: d2dc80ec689f3e9fd2f36c36c3847ec4e5d1a576
ms.sourcegitcommit: 7f616512044ab7795e32806578e8dc0c6a0e038f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/10/2019
ms.locfileid: "67783153"
---
# <a name="walkthrough-calling-windows-apis-visual-basic"></a><span data-ttu-id="a6a84-102">Procedura dettagliata: Chiamata delle API di Windows (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="a6a84-102">Walkthrough: Calling Windows APIs (Visual Basic)</span></span>
<span data-ttu-id="a6a84-103">Le API Windows sono librerie a collegamento dinamico (DLL) che fanno parte del sistema operativo Windows.</span><span class="sxs-lookup"><span data-stu-id="a6a84-103">Windows APIs are dynamic-link libraries (DLLs) that are part of the Windows operating system.</span></span> <span data-ttu-id="a6a84-104">Usarli per eseguire attività quando è difficile scrivere procedure equivalente personalizzato.</span><span class="sxs-lookup"><span data-stu-id="a6a84-104">You use them to perform tasks when it is difficult to write equivalent procedures of your own.</span></span> <span data-ttu-id="a6a84-105">Ad esempio, Windows fornisce una funzione denominata `FlashWindowEx` che consente di apportare passare alternativamente dalla chiaro e scuro sfumatura barra del titolo per un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a6a84-105">For example, Windows provides a function named `FlashWindowEx` that lets you make the title bar for an application alternate between light and dark shades.</span></span>  
  
 <span data-ttu-id="a6a84-106">Il vantaggio di usare le API di Windows nel codice è che che possano risparmiare tempo di sviluppo perché contengono molte utili funzionalità che sono già scritto e in attesa di essere utilizzato.</span><span class="sxs-lookup"><span data-stu-id="a6a84-106">The advantage of using Windows APIs in your code is that they can save development time because they contain dozens of useful functions that are already written and waiting to be used.</span></span> <span data-ttu-id="a6a84-107">Lo svantaggio è che le API di Windows possono essere difficili da usare e grossi se si verificano problemi.</span><span class="sxs-lookup"><span data-stu-id="a6a84-107">The disadvantage is that Windows APIs can be difficult to work with and unforgiving when things go wrong.</span></span>  
  
 <span data-ttu-id="a6a84-108">Le API di Windows rappresentano una categoria speciale di interoperabilità.</span><span class="sxs-lookup"><span data-stu-id="a6a84-108">Windows APIs represent a special category of interoperability.</span></span> <span data-ttu-id="a6a84-109">Le API di Windows non usano il codice gestito, non dispongono di librerie dei tipi e usare i tipi di dati diversi da quelli usati con Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a6a84-109">Windows APIs do not use managed code, do not have built-in type libraries, and use data types that are different than those used with Visual Studio.</span></span> <span data-ttu-id="a6a84-110">Causa di tali differenze, e poiché le API di Windows non sono oggetti COM, l'interoperabilità con API Windows e .NET Framework viene eseguito usando platform invoke, o PInvoke.</span><span class="sxs-lookup"><span data-stu-id="a6a84-110">Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the .NET Framework is performed using platform invoke, or PInvoke.</span></span> <span data-ttu-id="a6a84-111">Platform invoke è un servizio che consente al codice gestito chiamare funzioni non gestite implementate in una DLL.</span><span class="sxs-lookup"><span data-stu-id="a6a84-111">Platform invoke is a service that enables managed code to call unmanaged functions implemented in DLLs.</span></span> <span data-ttu-id="a6a84-112">Per altre informazioni, vedere [Consuming Unmanaged DLL Functions](../../../framework/interop/consuming-unmanaged-dll-functions.md).</span><span class="sxs-lookup"><span data-stu-id="a6a84-112">For more information, see [Consuming Unmanaged DLL Functions](../../../framework/interop/consuming-unmanaged-dll-functions.md).</span></span> <span data-ttu-id="a6a84-113">È possibile usare PInvoke in Visual Basic usando il `Declare` istruzione o all'applicazione il `DllImport` attributo a una routine vuota.</span><span class="sxs-lookup"><span data-stu-id="a6a84-113">You can use PInvoke in Visual Basic by using either the `Declare` statement or applying the `DllImport` attribute to an empty procedure.</span></span>  
  
 <span data-ttu-id="a6a84-114">Chiamate API Windows sono una parte importante di Visual Basic programming in passato, ma in genere non sono necessarie con Visual Basic .NET.</span><span class="sxs-lookup"><span data-stu-id="a6a84-114">Windows API calls were an important part of Visual Basic programming in the past, but are seldom necessary with Visual Basic .NET.</span></span> <span data-ttu-id="a6a84-115">Quando possibile, utilizzare codice gestito da .NET Framework per eseguire attività, invece di chiamate API di Windows.</span><span class="sxs-lookup"><span data-stu-id="a6a84-115">Whenever possible, you should use managed code from the .NET Framework to perform tasks, instead of Windows API calls.</span></span> <span data-ttu-id="a6a84-116">Questa procedura dettagliata vengono fornite informazioni per i casi in cui tramite le API di Windows è necessaria.</span><span class="sxs-lookup"><span data-stu-id="a6a84-116">This walkthrough provides information for those situations in which using Windows APIs is necessary.</span></span>  
  
[!INCLUDE[note_settings_general](~/includes/note-settings-general-md.md)]  
  
## <a name="api-calls-using-declare"></a><span data-ttu-id="a6a84-117">Chiamate API con Declare</span><span class="sxs-lookup"><span data-stu-id="a6a84-117">API Calls Using Declare</span></span>  
 <span data-ttu-id="a6a84-118">Il modo più comune per chiamare le API di Windows consiste nell'usare il `Declare` istruzione.</span><span class="sxs-lookup"><span data-stu-id="a6a84-118">The most common way to call Windows APIs is by using the `Declare` statement.</span></span>  
  
### <a name="to-declare-a-dll-procedure"></a><span data-ttu-id="a6a84-119">Per dichiarare una routine DLL</span><span class="sxs-lookup"><span data-stu-id="a6a84-119">To declare a DLL procedure</span></span>  
  
1. <span data-ttu-id="a6a84-120">Determinare il nome della funzione da chiamare, oltre a relativi argomenti, i tipi di argomento e restituiscono valore, così come il nome e percorso della DLL che lo contiene.</span><span class="sxs-lookup"><span data-stu-id="a6a84-120">Determine the name of the function you want to call, plus its arguments, argument types, and return value, as well as the name and location of the DLL that contains it.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="a6a84-121">Per informazioni complete sull'API di Windows, vedere la documentazione di Win32 SDK dell'API di Windows SDK di piattaforma.</span><span class="sxs-lookup"><span data-stu-id="a6a84-121">For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API.</span></span> <span data-ttu-id="a6a84-122">Per altre informazioni sulle costanti che usano le API di Windows, esaminare i file di intestazione, ad esempio incluso con il SDK della piattaforma Windows. h.</span><span class="sxs-lookup"><span data-stu-id="a6a84-122">For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.</span></span>  
  
2. <span data-ttu-id="a6a84-123">Aprire un nuovo progetto applicazione Windows facendo clic **New** nel **File** menu e scegliendo **progetto**.</span><span class="sxs-lookup"><span data-stu-id="a6a84-123">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="a6a84-124">Verrà visualizzata la finestra di dialogo **Nuovo progetto** .</span><span class="sxs-lookup"><span data-stu-id="a6a84-124">The **New Project** dialog box appears.</span></span>  
  
3. <span data-ttu-id="a6a84-125">Selezionare **applicazioni Windows** dall'elenco dei modelli di progetto Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="a6a84-125">Select **Windows Application** from the list of Visual Basic project templates.</span></span> <span data-ttu-id="a6a84-126">Viene visualizzato il nuovo progetto.</span><span class="sxs-lookup"><span data-stu-id="a6a84-126">The new project is displayed.</span></span>  
  
4. <span data-ttu-id="a6a84-127">Aggiungere il codice seguente `Declare` funzionare alla classe o modulo in cui si desidera usare la DLL:</span><span class="sxs-lookup"><span data-stu-id="a6a84-127">Add the following `Declare` function either to the class or module in which you want to use the DLL:</span></span>  
  
     [!code-vb[VbVbalrInterop#9](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#9)]  
  
### <a name="parts-of-the-declare-statement"></a><span data-ttu-id="a6a84-128">Parti dell'istruzione Declare</span><span class="sxs-lookup"><span data-stu-id="a6a84-128">Parts of the Declare Statement</span></span>  
 <span data-ttu-id="a6a84-129">Il `Declare` istruzione include gli elementi seguenti.</span><span class="sxs-lookup"><span data-stu-id="a6a84-129">The `Declare` statement includes the following elements.</span></span>  
  
#### <a name="auto-modifier"></a><span data-ttu-id="a6a84-130">Modificatore Auto</span><span class="sxs-lookup"><span data-stu-id="a6a84-130">Auto modifier</span></span>  
 <span data-ttu-id="a6a84-131">Il `Auto` modificatore indica al runtime per convertire la stringa in base al nome di metodo in base alle regole di common language runtime (o nome di alias, se specificato).</span><span class="sxs-lookup"><span data-stu-id="a6a84-131">The `Auto` modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified).</span></span>  
  
#### <a name="lib-and-alias-keywords"></a><span data-ttu-id="a6a84-132">Parole chiave lib e Alias</span><span class="sxs-lookup"><span data-stu-id="a6a84-132">Lib and Alias keywords</span></span>  
 <span data-ttu-id="a6a84-133">Il nome che segue il `Function` la parola chiave è il nome del programma utilizzato per accedere alla funzione importata.</span><span class="sxs-lookup"><span data-stu-id="a6a84-133">The name following the `Function` keyword is the name your program uses to access the imported function.</span></span> <span data-ttu-id="a6a84-134">Può essere lo stesso come il vero nome della funzione si chiama o è possibile usare qualsiasi nome di procedura valida e quindi utilizzano il `Alias` parola chiave per specificare il nome reale della funzione che si sta chiamando.</span><span class="sxs-lookup"><span data-stu-id="a6a84-134">It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the `Alias` keyword to specify the real name of the function you are calling.</span></span>  
  
 <span data-ttu-id="a6a84-135">Specificare il `Lib` (parola chiave), seguito dal nome e percorso della DLL che contiene la funzione che si sta chiamando.</span><span class="sxs-lookup"><span data-stu-id="a6a84-135">Specify the `Lib` keyword, followed by the name and location of the DLL that contains the function you are calling.</span></span> <span data-ttu-id="a6a84-136">Non devi specificare il percorso del file che si trovano nella directory di sistema Windows.</span><span class="sxs-lookup"><span data-stu-id="a6a84-136">You do not need to specify the path for files located in the Windows system directories.</span></span>  
  
 <span data-ttu-id="a6a84-137">Usare il `Alias` parola chiave se il nome della funzione chiamata non è un nome di procedure Visual Basic valido o è in conflitto con il nome di altri elementi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a6a84-137">Use the `Alias` keyword if the name of the function you are calling is not a valid Visual Basic procedure name, or conflicts with the name of other items in your application.</span></span> <span data-ttu-id="a6a84-138">`Alias` indica il nome reale della funzione chiamata.</span><span class="sxs-lookup"><span data-stu-id="a6a84-138">`Alias` indicates the true name of the function being called.</span></span>  
  
#### <a name="argument-and-data-type-declarations"></a><span data-ttu-id="a6a84-139">Argomenti e le dichiarazioni di tipi di dati</span><span class="sxs-lookup"><span data-stu-id="a6a84-139">Argument and Data Type Declarations</span></span>  
 <span data-ttu-id="a6a84-140">Dichiarare gli argomenti e i relativi tipi di dati.</span><span class="sxs-lookup"><span data-stu-id="a6a84-140">Declare the arguments and their data types.</span></span> <span data-ttu-id="a6a84-141">Questa parte può essere difficile poiché i tipi di dati che utilizza Windows non corrispondono ai tipi di dati di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a6a84-141">This part can be challenging because the data types that Windows uses do not correspond to Visual Studio data types.</span></span> <span data-ttu-id="a6a84-142">Visual Basic esegue molte delle operazioni per l'utente convertendo gli argomenti ai tipi di dati compatibile, un processo denominato *marshalling*.</span><span class="sxs-lookup"><span data-stu-id="a6a84-142">Visual Basic does a lot of the work for you by converting arguments to compatible data types, a process called *marshaling*.</span></span> <span data-ttu-id="a6a84-143">È possibile controllare in modo esplicito la modalità di marshalling di argomenti usando il <xref:System.Runtime.InteropServices.MarshalAsAttribute> attributo definito nella <xref:System.Runtime.InteropServices> dello spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="a6a84-143">You can explicitly control how arguments are marshaled by using the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute defined in the <xref:System.Runtime.InteropServices> namespace.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a6a84-144">Le versioni precedenti di Visual Basic consentono di dichiarare i parametri `As Any`, vale a dire i dati di qualsiasi dato tipo può essere utilizzato.</span><span class="sxs-lookup"><span data-stu-id="a6a84-144">Previous versions of Visual Basic allowed you to declare parameters `As Any`, meaning that data of any data type could be used.</span></span> <span data-ttu-id="a6a84-145">Visual Basic richiede che si usino un tipo di dati specifico per tutti i `Declare` istruzioni.</span><span class="sxs-lookup"><span data-stu-id="a6a84-145">Visual Basic requires that you use a specific data type for all `Declare` statements.</span></span>  
  
#### <a name="windows-api-constants"></a><span data-ttu-id="a6a84-146">Windows API costanti</span><span class="sxs-lookup"><span data-stu-id="a6a84-146">Windows API Constants</span></span>  
 <span data-ttu-id="a6a84-147">Alcuni argomenti sono combinazioni di costanti.</span><span class="sxs-lookup"><span data-stu-id="a6a84-147">Some arguments are combinations of constants.</span></span> <span data-ttu-id="a6a84-148">Ad esempio, il `MessageBox` API illustrato in questa procedura dettagliata accetta un argomento integer denominato `Typ` che determina come appare la finestra di messaggio.</span><span class="sxs-lookup"><span data-stu-id="a6a84-148">For example, the `MessageBox` API shown in this walkthrough accepts an integer argument called `Typ` that controls how the message box is displayed.</span></span> <span data-ttu-id="a6a84-149">È possibile determinare il valore numerico di queste costanti esaminando il `#define` istruzioni nel file winuser. H.</span><span class="sxs-lookup"><span data-stu-id="a6a84-149">You can determine the numeric value of these constants by examining the `#define` statements in the file WinUser.h.</span></span> <span data-ttu-id="a6a84-150">I valori numerici vengono in genere visualizzati in formato esadecimale, pertanto è consigliabile utilizzare una calcolatrice per aggiungerli e Converti in decimale.</span><span class="sxs-lookup"><span data-stu-id="a6a84-150">The numeric values are generally shown in hexadecimal, so you may want to use a calculator to add them and convert to decimal.</span></span> <span data-ttu-id="a6a84-151">Ad esempio, se si desidera combinare le costanti per lo stile di punto esclamativo `MB_ICONEXCLAMATION` 0x00000030 e Sì/alcuno stile `MB_YESNO` 0x00000004, è possibile aggiungere i numeri e ottenere un risultato di 0x00000034 o 52 decimale.</span><span class="sxs-lookup"><span data-stu-id="a6a84-151">For example, if you want to combine the constants for the exclamation style `MB_ICONEXCLAMATION` 0x00000030 and the Yes/No style `MB_YESNO` 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal.</span></span> <span data-ttu-id="a6a84-152">Anche se è possibile usare direttamente il risultato decimale, è preferibile dichiarare questi valori come costanti all'interno dell'applicazione e combinarli usando il `Or` operatore.</span><span class="sxs-lookup"><span data-stu-id="a6a84-152">Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the `Or` operator.</span></span>  
  
##### <a name="to-declare-constants-for-windows-api-calls"></a><span data-ttu-id="a6a84-153">Per dichiarare le costanti per le chiamate API di Windows</span><span class="sxs-lookup"><span data-stu-id="a6a84-153">To declare constants for Windows API calls</span></span>  
  
1. <span data-ttu-id="a6a84-154">Consultare la documentazione per la funzione di Windows che si sta chiamando.</span><span class="sxs-lookup"><span data-stu-id="a6a84-154">Consult the documentation for the Windows function you are calling.</span></span> <span data-ttu-id="a6a84-155">Determinare il nome di costanti utilizzate e il nome del file con estensione h che contiene i valori numerici per queste costanti.</span><span class="sxs-lookup"><span data-stu-id="a6a84-155">Determine the name of the constants it uses and the name of the .h file that contains the numeric values for these constants.</span></span>  
  
2. <span data-ttu-id="a6a84-156">Usare un editor di testo, ad esempio Blocco note, per visualizzare il contenuto del file di intestazione (h) e trovare i valori associati alle costanti in uso.</span><span class="sxs-lookup"><span data-stu-id="a6a84-156">Use a text editor, such as Notepad, to view the contents of the header (.h) file, and find the values associated with the constants you are using.</span></span> <span data-ttu-id="a6a84-157">Ad esempio, il `MessageBox` API Usa la costante `MB_ICONQUESTION` per mostrare un punto interrogativo nella finestra di messaggio.</span><span class="sxs-lookup"><span data-stu-id="a6a84-157">For example, the `MessageBox` API uses the constant `MB_ICONQUESTION` to show a question mark in the message box.</span></span> <span data-ttu-id="a6a84-158">La definizione per `MB_ICONQUESTION` in winuser. H e viene visualizzato come segue:</span><span class="sxs-lookup"><span data-stu-id="a6a84-158">The definition for `MB_ICONQUESTION` is in WinUser.h and appears as follows:</span></span>  
  
     `#define MB_ICONQUESTION             0x00000020L`  
  
3. <span data-ttu-id="a6a84-159">Aggiungere equivalente `Const` istruzioni per la classe o un modulo per rendere disponibili per l'applicazione le costanti.</span><span class="sxs-lookup"><span data-stu-id="a6a84-159">Add equivalent `Const` statements to your class or module to make these constants available to your application.</span></span> <span data-ttu-id="a6a84-160">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="a6a84-160">For example:</span></span>  
  
     [!code-vb[VbVbalrInterop#11](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#11)]  
  
###### <a name="to-call-the-dll-procedure"></a><span data-ttu-id="a6a84-161">Chiamare la routine DLL</span><span class="sxs-lookup"><span data-stu-id="a6a84-161">To call the DLL procedure</span></span>  
  
1. <span data-ttu-id="a6a84-162">Aggiungere un pulsante denominato `Button1` di avvio del modulo per il progetto e quindi fare doppio clic per visualizzare il relativo codice.</span><span class="sxs-lookup"><span data-stu-id="a6a84-162">Add a button named `Button1` to the startup form for your project, and then double-click it to view its code.</span></span> <span data-ttu-id="a6a84-163">Il gestore eventi per il pulsante viene visualizzato.</span><span class="sxs-lookup"><span data-stu-id="a6a84-163">The event handler for the button is displayed.</span></span>  
  
2. <span data-ttu-id="a6a84-164">Aggiungere il codice per il `Click` gestore eventi per il pulsante è stato aggiunto, per chiamare la routine e fornire gli argomenti appropriati:</span><span class="sxs-lookup"><span data-stu-id="a6a84-164">Add code to the `Click` event handler for the button you added, to call the procedure and provide the appropriate arguments:</span></span>  
  
     [!code-vb[VbVbalrInterop#12](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#12)]  
  
3. <span data-ttu-id="a6a84-165">Eseguire il progetto premendo F5.</span><span class="sxs-lookup"><span data-stu-id="a6a84-165">Run the project by pressing F5.</span></span> <span data-ttu-id="a6a84-166">Viene visualizzata la finestra di messaggio con entrambe **Yes** e **No** pulsanti di risposta.</span><span class="sxs-lookup"><span data-stu-id="a6a84-166">The message box is displayed with both **Yes** and **No** response buttons.</span></span> <span data-ttu-id="a6a84-167">Fare clic su uno.</span><span class="sxs-lookup"><span data-stu-id="a6a84-167">Click either one.</span></span>  
  
#### <a name="data-marshaling"></a><span data-ttu-id="a6a84-168">Marshalling dei dati</span><span class="sxs-lookup"><span data-stu-id="a6a84-168">Data Marshaling</span></span>  
 <span data-ttu-id="a6a84-169">Visual Basic converte automaticamente i tipi di dati dei parametri e valori restituiti per le chiamate API di Windows, ma è possibile usare il `MarshalAs` attributo specificare in modo esplicito i tipi di dati non gestiti che prevede un'API.</span><span class="sxs-lookup"><span data-stu-id="a6a84-169">Visual Basic automatically converts the data types of parameters and return values for Windows API calls, but you can use the `MarshalAs` attribute to explicitly specify unmanaged data types that an API expects.</span></span> <span data-ttu-id="a6a84-170">Per altre informazioni sul marshalling di interoperabilità, vedere [marshalling di interoperabilità](../../../framework/interop/interop-marshaling.md).</span><span class="sxs-lookup"><span data-stu-id="a6a84-170">For more information about interop marshaling, see [Interop Marshaling](../../../framework/interop/interop-marshaling.md).</span></span>  
  
##### <a name="to-use-declare-and-marshalas-in-an-api-call"></a><span data-ttu-id="a6a84-171">Usare Declare e MarshalAs in una chiamata API</span><span class="sxs-lookup"><span data-stu-id="a6a84-171">To use Declare and MarshalAs in an API call</span></span>  
  
1. <span data-ttu-id="a6a84-172">Determinare il nome della funzione da chiamare, gli argomenti, i tipi di dati e restituiscono valori.</span><span class="sxs-lookup"><span data-stu-id="a6a84-172">Determine the name of the function you want to call, plus its arguments, data types, and return value.</span></span>  
  
2. <span data-ttu-id="a6a84-173">Per semplificare l'accesso per il `MarshalAs` dell'attributo, aggiungere un `Imports` istruzione all'inizio del codice per la classe o modulo, come nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="a6a84-173">To simplify access to the `MarshalAs` attribute, add an `Imports` statement to the top of the code for the class or module, as in the following example:</span></span>  
  
     [!code-vb[VbVbalrInterop#13](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#13)]  
  
3. <span data-ttu-id="a6a84-174">Aggiungere un prototipo di funzione per la funzione importata alla classe o modulo si utilizza e si applica il `MarshalAs` ai parametri dell'attributo o valore restituito.</span><span class="sxs-lookup"><span data-stu-id="a6a84-174">Add a function prototype for the imported function to the class or module you are using, and apply the `MarshalAs` attribute to the parameters or return value.</span></span> <span data-ttu-id="a6a84-175">Nell'esempio seguente, una chiamata API che prevede che il tipo `void*` viene sottoposto a marshalling come `AsAny`:</span><span class="sxs-lookup"><span data-stu-id="a6a84-175">In the following example, an API call that expects the type `void*` is marshaled as `AsAny`:</span></span>  
  
     [!code-vb[VbVbalrInterop#14](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#14)]  
  
## <a name="api-calls-using-dllimport"></a><span data-ttu-id="a6a84-176">Chiamate API con DllImport</span><span class="sxs-lookup"><span data-stu-id="a6a84-176">API Calls Using DllImport</span></span>  
 <span data-ttu-id="a6a84-177">Il `DllImport` attributo fornisce un secondo modo per chiamare le funzioni nelle DLL senza librerie dei tipi.</span><span class="sxs-lookup"><span data-stu-id="a6a84-177">The `DllImport` attribute provides a second way to call functions in DLLs without type libraries.</span></span> <span data-ttu-id="a6a84-178">`DllImport` è quasi equivalente all'uso di un `Declare` istruzione ma offre maggiore controllo sul modo in cui vengono chiamate le funzioni.</span><span class="sxs-lookup"><span data-stu-id="a6a84-178">`DllImport` is roughly equivalent to using a `Declare` statement but provides more control over how functions are called.</span></span>  
  
 <span data-ttu-id="a6a84-179">È possibile usare `DllImport` con l'API di Windows la maggior parte delle chiamate, purché la chiamata fa riferimento a un oggetto condiviso (detta anche *statici*) (metodo).</span><span class="sxs-lookup"><span data-stu-id="a6a84-179">You can use `DllImport` with most Windows API calls as long as the call refers to a shared (sometimes called *static*) method.</span></span> <span data-ttu-id="a6a84-180">È possibile usare i metodi che richiedono un'istanza di una classe.</span><span class="sxs-lookup"><span data-stu-id="a6a84-180">You cannot use methods that require an instance of a class.</span></span> <span data-ttu-id="a6a84-181">A differenza `Declare` istruzioni `DllImport` chiamate non è possibile utilizzare il `MarshalAs` attributo.</span><span class="sxs-lookup"><span data-stu-id="a6a84-181">Unlike `Declare` statements, `DllImport` calls cannot use the `MarshalAs` attribute.</span></span>  
  
### <a name="to-call-a-windows-api-using-the-dllimport-attribute"></a><span data-ttu-id="a6a84-182">Per chiamare un'API di Windows usando l'attributo DllImport</span><span class="sxs-lookup"><span data-stu-id="a6a84-182">To call a Windows API using the DllImport attribute</span></span>  
  
1. <span data-ttu-id="a6a84-183">Aprire un nuovo progetto applicazione Windows facendo clic **New** nel **File** menu e scegliendo **progetto**.</span><span class="sxs-lookup"><span data-stu-id="a6a84-183">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="a6a84-184">Verrà visualizzata la finestra di dialogo **Nuovo progetto** .</span><span class="sxs-lookup"><span data-stu-id="a6a84-184">The **New Project** dialog box appears.</span></span>  
  
2. <span data-ttu-id="a6a84-185">Selezionare **applicazioni Windows** dall'elenco dei modelli di progetto Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="a6a84-185">Select **Windows Application** from the list of Visual Basic project templates.</span></span> <span data-ttu-id="a6a84-186">Viene visualizzato il nuovo progetto.</span><span class="sxs-lookup"><span data-stu-id="a6a84-186">The new project is displayed.</span></span>  
  
3. <span data-ttu-id="a6a84-187">Aggiungere un pulsante denominato `Button2` al form di avvio.</span><span class="sxs-lookup"><span data-stu-id="a6a84-187">Add a button named `Button2` to the startup form.</span></span>  
  
4. <span data-ttu-id="a6a84-188">Fare doppio clic su `Button2` per aprire la visualizzazione codice per il form.</span><span class="sxs-lookup"><span data-stu-id="a6a84-188">Double-click `Button2` to open the code view for the form.</span></span>  
  
5. <span data-ttu-id="a6a84-189">Per semplificare l'accesso al `DllImport`, aggiungere un `Imports` istruzione all'inizio del codice per la classe di form di avvio:</span><span class="sxs-lookup"><span data-stu-id="a6a84-189">To simplify access to `DllImport`, add an `Imports` statement to the top of the code for the startup form class:</span></span>  
  
     [!code-vb[VbVbalrInterop#13](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#13)]  
  
6. <span data-ttu-id="a6a84-190">Dichiarare una funzione vuota prima la `End Class` istruzione per il modulo e il nome di funzione `MoveFile`.</span><span class="sxs-lookup"><span data-stu-id="a6a84-190">Declare an empty function preceding the `End Class` statement for the form, and name the function `MoveFile`.</span></span>  
  
7. <span data-ttu-id="a6a84-191">Si applicano i `Public` e `Shared` modificatori di dichiarazione di funzione e impostare i parametri per `MoveFile` basata sugli argomenti alla funzione API Windows Usa:</span><span class="sxs-lookup"><span data-stu-id="a6a84-191">Apply the `Public` and `Shared` modifiers to the function declaration and set parameters for `MoveFile` based on the arguments the Windows API function uses:</span></span>  
  
     [!code-vb[VbVbalrInterop#16](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#16)]  
  
     <span data-ttu-id="a6a84-192">La funzione può avere qualsiasi nome di procedura valida; il `DllImport` attributo specifica il nome nella DLL.</span><span class="sxs-lookup"><span data-stu-id="a6a84-192">Your function can have any valid procedure name; the `DllImport` attribute specifies the name in the DLL.</span></span> <span data-ttu-id="a6a84-193">Gestisce anche il marshalling di interoperabilità per i parametri e valori restituiti, quindi è possibile scegliere tipi di dati di Visual Studio che sono simili ai dati dei tipi utilizzati dall'API.</span><span class="sxs-lookup"><span data-stu-id="a6a84-193">It also handles interoperability marshaling for the parameters and return values, so you can choose Visual Studio data types that are similar to the data types the API uses.</span></span>  
  
8. <span data-ttu-id="a6a84-194">Applicare il `DllImport` attributo per la funzione vuota.</span><span class="sxs-lookup"><span data-stu-id="a6a84-194">Apply the `DllImport` attribute to the empty function.</span></span> <span data-ttu-id="a6a84-195">Il primo parametro è il nome e il percorso della DLL che contiene la funzione che si sta chiamando.</span><span class="sxs-lookup"><span data-stu-id="a6a84-195">The first parameter is the name and location of the DLL containing the function you are calling.</span></span> <span data-ttu-id="a6a84-196">Non devi specificare il percorso del file che si trovano nella directory di sistema Windows.</span><span class="sxs-lookup"><span data-stu-id="a6a84-196">You do not need to specify the path for files located in the Windows system directories.</span></span> <span data-ttu-id="a6a84-197">Il secondo parametro è un argomento denominato che specifica il nome della funzione nell'API di Windows.</span><span class="sxs-lookup"><span data-stu-id="a6a84-197">The second parameter is a named argument that specifies the name of the function in the Windows API.</span></span> <span data-ttu-id="a6a84-198">In questo esempio, il `DllImport` attributo impone che le chiamate a `MoveFile` deve essere inoltrato al `MoveFileW` in KERNEL32. DLL.</span><span class="sxs-lookup"><span data-stu-id="a6a84-198">In this example, the `DllImport` attribute forces calls to `MoveFile` to be forwarded to `MoveFileW` in KERNEL32.DLL.</span></span> <span data-ttu-id="a6a84-199">Il `MoveFileW` metodo consente di copiare un file dal percorso `src` sul percorso `dst`.</span><span class="sxs-lookup"><span data-stu-id="a6a84-199">The `MoveFileW` method copies a file from the path `src` to the path `dst`.</span></span>  
  
     [!code-vb[VbVbalrInterop#17](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#17)]  
  
9. <span data-ttu-id="a6a84-200">Aggiungere il codice per il `Button2_Click` gestore eventi per chiamare la funzione:</span><span class="sxs-lookup"><span data-stu-id="a6a84-200">Add code to the `Button2_Click` event handler to call the function:</span></span>  
  
     [!code-vb[VbVbalrInterop#18](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#18)]  
  
10. <span data-ttu-id="a6a84-201">Creare un file denominato test. txt e inserirlo nella directory C:\Tmp sul disco rigido.</span><span class="sxs-lookup"><span data-stu-id="a6a84-201">Create a file named Test.txt and place it in the C:\Tmp directory on your hard drive.</span></span> <span data-ttu-id="a6a84-202">Se necessario, creare la directory Tmp.</span><span class="sxs-lookup"><span data-stu-id="a6a84-202">Create the Tmp directory if necessary.</span></span>  
  
11. <span data-ttu-id="a6a84-203">Premere F5 per avviare l’applicazione.</span><span class="sxs-lookup"><span data-stu-id="a6a84-203">Press F5 to start the application.</span></span> <span data-ttu-id="a6a84-204">Viene visualizzato il form principale.</span><span class="sxs-lookup"><span data-stu-id="a6a84-204">The main form appears.</span></span>  
  
12. <span data-ttu-id="a6a84-205">Fare clic su **Button2**.</span><span class="sxs-lookup"><span data-stu-id="a6a84-205">Click **Button2**.</span></span> <span data-ttu-id="a6a84-206">Se il file può essere spostato, viene visualizzato il messaggio "il file è stato spostato correttamente".</span><span class="sxs-lookup"><span data-stu-id="a6a84-206">The message "The file was moved successfully" is displayed if the file can be moved.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a6a84-207">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="a6a84-207">See also</span></span>

- <xref:System.Runtime.InteropServices.DllImportAttribute>
- <xref:System.Runtime.InteropServices.MarshalAsAttribute>
- [<span data-ttu-id="a6a84-208">Istruzione Declare</span><span class="sxs-lookup"><span data-stu-id="a6a84-208">Declare Statement</span></span>](../../../visual-basic/language-reference/statements/declare-statement.md)
- [<span data-ttu-id="a6a84-209">Auto</span><span class="sxs-lookup"><span data-stu-id="a6a84-209">Auto</span></span>](../../../visual-basic/language-reference/modifiers/auto.md)
- [<span data-ttu-id="a6a84-210">Alias</span><span class="sxs-lookup"><span data-stu-id="a6a84-210">Alias</span></span>](../../../visual-basic/language-reference/statements/alias-clause.md)
- [<span data-ttu-id="a6a84-211">Interoperabilità COM</span><span class="sxs-lookup"><span data-stu-id="a6a84-211">COM Interop</span></span>](../../../visual-basic/programming-guide/com-interop/index.md)
- [<span data-ttu-id="a6a84-212">Creazione di prototipi nel codice gestito</span><span class="sxs-lookup"><span data-stu-id="a6a84-212">Creating Prototypes in Managed Code</span></span>](../../../framework/interop/creating-prototypes-in-managed-code.md)
- [<span data-ttu-id="a6a84-213">Marshalling di un delegato come metodo di callback</span><span class="sxs-lookup"><span data-stu-id="a6a84-213">Marshaling a Delegate as a Callback Method</span></span>](../../../framework/interop/marshaling-a-delegate-as-a-callback-method.md)
